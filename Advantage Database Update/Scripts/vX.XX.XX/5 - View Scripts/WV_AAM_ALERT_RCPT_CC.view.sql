CREATE VIEW [dbo].[WV_AAM_ALERT_RCPT_CC]
AS
SELECT AR.ALERT_ID, [EmployeeCode] = AR.EMP_CODE,
[EmployeeName] = ISNULL(E.EMP_FNAME + ' ', '') + ISNULL(E.EMP_MI + '. ', '') + ISNULL(E.EMP_LNAME, '')
FROM ALERT_RCPT AR WITH(NOLOCK) 
				INNER JOIN EMPLOYEE E WITH(NOLOCK) ON AR.EMP_CODE = E.EMP_CODE
WHERE ISNULL(AR.CURRENT_RCPT, 0) = 0
	AND ISNULL(AR.CURRENT_NOTIFY, 0) = 0
UNION
SELECT AR.ALERT_ID, [EmployeeCode] = AR.EMP_CODE,
[EmployeeName] = ISNULL(LTRIM(RTRIM(E.EMP_FNAME)) + ' ', '') + ISNULL(LTRIM(RTRIM(E.EMP_MI)) + '. ', '') + ISNULL(LTRIM(RTRIM(E.EMP_LNAME)), '')
FROM ALERT_RCPT_DISMISSED AR WITH(NOLOCK) 
				INNER JOIN EMPLOYEE E WITH(NOLOCK) ON AR.EMP_CODE = E.EMP_CODE
WHERE ISNULL(AR.CURRENT_RCPT, 0) = 0
	AND ISNULL(AR.CURRENT_NOTIFY, 0) = 0
UNION
SELECT AR.ALERT_ID, [EmployeeCode] = CONVERT(VARCHAR(6), LOWER(C.CONT_CODE))  + ' (CC)',
[EmployeeName] = C.CONT_FML + ' (CC)'
FROM
	CP_ALERT_RCPT AR WITH(NOLOCK) 
	INNER JOIN CDP_CONTACT_HDR C ON AR.CDP_CONTACT_ID = C.CDP_CONTACT_ID
WHERE ISNULL(AR.CURRENT_RCPT, 0) = 0
	AND ISNULL(AR.CURRENT_NOTIFY, 0) = 0	
GO


