CREATE PROCEDURE [dbo].[advsp_media_plan_estimate_template_markets]
	@MEDIA_PLAN_ESTIMATE_TEMPLATE_ID int
AS

SELECT
	Selected = CAST(CASE WHEN mpetm.MARKET_CODE IS NOT NULL THEN 1 ELSE 0 END as bit),
	MarketCode = m.MARKET_CODE,
	MarketName = m.MARKET_DESC
FROM dbo.MARKET m
	LEFT OUTER JOIN dbo.MEDIA_PLAN_ESTIMATE_TEMPLATE_MARKET mpetm ON m.MARKET_CODE = mpetm.MARKET_CODE AND mpetm.MEDIA_PLAN_ESTIMATE_TEMPLATE_ID = @MEDIA_PLAN_ESTIMATE_TEMPLATE_ID
WHERE COALESCE(m.INACTIVE_FLAG,0) = 0
ORDER BY m.MARKET_DESC
GO
