CREATE FUNCTION [dbo].[advfn_timesheet_is_approval_active]
(@EMP_CODE VARCHAR(6))
RETURNS BIT
AS
BEGIN
/*=========== QUERY ===========*/
	DECLARE 
	@TIME_APPR_ACTIVE SMALLINT,
	@BIT_RETURN BIT
	
	SELECT @TIME_APPR_ACTIVE = ISNULL(TIME_APPR_ACTIVE,0) 
	FROM AGENCY WITH(NOLOCK);
	
	SET @TIME_APPR_ACTIVE = ISNULL(@TIME_APPR_ACTIVE,0);
		
	IF @TIME_APPR_ACTIVE = 1 AND (NOT @EMP_CODE IS NULL)
	BEGIN
		SELECT @TIME_APPR_ACTIVE = ISNULL(TS_APPR_FLAG, 0)
		FROM EMPLOYEE WITH(NOLOCK) 
		WHERE EMP_CODE = @EMP_CODE;
		
		--THE EMP TABLE FLAG ACTS AS AN EXEMPTION; NOT INCLUSION
		IF @TIME_APPR_ACTIVE = 1
		BEGIN
			SET @TIME_APPR_ACTIVE = 0
		END
		ELSE
		BEGIN
			SET @TIME_APPR_ACTIVE = 1
		END

	END
	
	SET @TIME_APPR_ACTIVE = ISNULL(@TIME_APPR_ACTIVE,0);
	
	IF @TIME_APPR_ACTIVE = 1
	BEGIN
		SET @BIT_RETURN = 1;
	END
	ELSE
	BEGIN
		SET @BIT_RETURN = 0;
	END	
	
	SET @BIT_RETURN = ISNULL(@BIT_RETURN,0);

	RETURN @BIT_RETURN;

/*=========== QUERY ===========*/
END