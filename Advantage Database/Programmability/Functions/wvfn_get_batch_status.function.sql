
CREATE FUNCTION [dbo].[wvfn_get_batch_status](@BA_BATCH_ID INTEGER)
RETURNS VARCHAR(20)
AS
BEGIN
	DECLARE @STATUS AS VARCHAR(20)
	
	SET @STATUS = 'Pending'
	IF (SELECT BA_EXISTS FROM BILL_APPR_BATCH WITH (NOLOCK) WHERE BILL_APPR_BATCH.BA_BATCH_ID = @BA_BATCH_ID) = 1
	BEGIN
		SET @STATUS = 'In Progress'
	END
	IF (SELECT APPROVED FROM BILL_APPR_BATCH WITH (NOLOCK) WHERE BILL_APPR_BATCH.BA_BATCH_ID = @BA_BATCH_ID) = 1
	BEGIN
		SET @STATUS = 'Approved'
	END
	IF (SELECT FINISHED FROM BILL_APPR_BATCH WITH (NOLOCK) WHERE BILL_APPR_BATCH.BA_BATCH_ID = @BA_BATCH_ID) = 1
	BEGIN
		SET @STATUS = 'Finished'
	END
	IF (SELECT BILLED_ANY FROM BILL_APPR_BATCH WITH (NOLOCK) WHERE BILL_APPR_BATCH.BA_BATCH_ID = @BA_BATCH_ID) = 1
	BEGIN
		SET @STATUS = 'Partially Billed'
	END
	IF (SELECT BILLED_ALL FROM BILL_APPR_BATCH WITH (NOLOCK) WHERE BILL_APPR_BATCH.BA_BATCH_ID = @BA_BATCH_ID) = 1
	BEGIN
		SET @STATUS = 'Billed'
	END


	RETURN RTRIM(LTRIM(@STATUS))
END
