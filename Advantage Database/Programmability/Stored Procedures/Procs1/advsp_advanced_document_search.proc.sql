IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'[dbo].[advsp_advanced_document_search]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	DROP PROCEDURE [dbo].[advsp_advanced_document_search]
GO
CREATE PROCEDURE [dbo].[advsp_advanced_document_search] 
@APPLICATION_ID INT,
@USER_CODE VARCHAR(100),
@ACCESS_PRIVATE	 BIT,
@SEARCH_TEXT  VARCHAR(MAX),
@LEVEL VARCHAR(100),
@CRITERIA_ENUM_VALUE SMALLINT,
@DOCUMENT_TYPE_ID INT,
@LABEL_ID INT,
@INCLUDE_ATTACHMENTS BIT
AS
BEGIN
/*=========== QUERY ===========*/

-- INFO
/*
Level Codes (Patrick created "AdvantageFramework.DocumentManager.Classes.xxx") (Query uses this):
-----------------------------
	AN = Ad Number
	AD = Agency Desktop
	ALRT = Alert Attachment
	VN = AP Invoice
	AR = AR Invoice
	CM = Campaign
	CL = Client
	CT = Contract
	**ContractValueAdded = Contract Value Added
	ContractReport = Contract Report
	DI = Division
	EM = Employee
	EX = Expense Reports (Header)
	EXDTL = Expense details
	JO = Job
	JC = Job Component
	OF = Office
	PR = Product
	TK = Task
	DO = Desktop Object
	ED = Executive Desktop
	VR = Vendor
	VC = Vendor Contract
	BLANK/EMPTY STRING = ALL
	
Level Enum (ADV enum):
-----------------------------
	Office = 0
	Client = 1
	Division = 2
	Product = 3
	Campaign = 4
	Job = 5
	JobComponent = 6
	AccountPayableInvoice = 7
	AdNumber = 8
	ExpenseReceipts = 9
	Employee = 10
	Vendor = 11
	Contract = 12
	**ContractValueAdded = 13
	ContractReport = 14
	AccountReceivableInvoice = 15
	AgencyDesktop = 16
	ExecutiveDesktop = 17
	**Task = 18
	VendorContract = 19

Search Criteria (ADV enum):
-----------------------------
    AllCriteria = 1
    NoCriteria = 2
	AlertSubject = 16
	Campaign = 17
    Client = 3
    ClientDivisionProduct = 4
    ClientContract = 5
    Department = 6
    Division = 7
    Employee = 8
    FunctionCode = 9
    Job = 10
    JobComponent = 11
    MediaOrderLine = 12
    Office = 13
    Product = 14
    Vendor = 15

Document Types (Table):
-----------------------------
	1	Form
	2	File
	3	Document
	4	Policy
	5	Procedure
	6	Link
	7	Ad Copy
	8	Contract
	9	W9
	10	Image
	11	Estimate
	0	All

*/
	SET NOCOUNT ON;
	SET ANSI_WARNINGS OFF;
	--	VARIABLES
	BEGIN

		DECLARE 
			@ClientRestrictions INT,
			@OfficeRestrictions INT,
			@IsBlockedFromOfficeLevel BIT,
			@IsBlockedFromClientLevel BIT,
			@IsBlockedFromDivisionLevel BIT,
			@IsBlockedFromProductLevel BIT,
			@IsBlockedFromCampaignLevel BIT,
			@IsBlockedFromJobLevel BIT,
			@IsBlockedFromJobComponentLevel BIT,
			@IsBlockedFromAPLevel BIT,
			@IsBlockedFromAgencyDesktopLevel BIT,
			@IsBlockedFromExecutiveDesktopLevel BIT,
			@IsBlockedFromAdNumberLevel BIT,
			@IsBlockedFromExpenseReportLevel BIT,
			@IsBlockedFromContractLevel BIT,
			@IsBlockedFromContractReportLevel BIT,
			@IsBlockedFromARInvoiceLevel BIT,
			@IsBlockedFromVendorLevel BIT,
			@IsBlockedFromVendorContractLevel BIT,
			@IsBlockedFromEmployeeLevel BIT,
			--@IsBlockedFromTaskLevel BIT,
			@IsBlockedFromAlertLevel BIT,
			@JOB_NUMBER INT,
			@JOB_COMPONENT_NBR SMALLINT,
			@EMP_CODE AS VARCHAR(6)

		DECLARE @SEARCH_RESULTS  TABLE(
					DOCUMENT_ID INT,
					[FILENAME] VARCHAR(50),
					[DESCRIPTION] VARCHAR(200) NULL,
					KEYWORDS VARCHAR(255) NULL,
					FILE_SIZE INT,
					UPLOADED_DATE DATETIME,
					MIME_TYPE VARCHAR(50),
					USER_CODE VARCHAR(100),
					CMP_CODE VARCHAR(6) NULL,
					OFFICE_CODE VARCHAR(6) NULL,
					CL_CODE VARCHAR(6) COLLATE SQL_Latin1_General_CP1_CS_AS NULL,
					DIV_CODE VARCHAR(6) COLLATE SQL_Latin1_General_CP1_CS_AS NULL,
					PRD_CODE VARCHAR(6) COLLATE SQL_Latin1_General_CP1_CS_AS NULL,
					JOB_NUMBER INT NULL,
					JOB_COMPONENT_NBR INT NULL,
					[LEVEL] VARCHAR(100) NULL,
					OFFICE_NAME VARCHAR(30) NULL,
					CAMPAIGN_NAME VARCHAR(40) NULL,
					CLIENT_NAME VARCHAR(40) NULL,
					DIVISION_NAME VARCHAR(40) NULL,
					PRODUCT_DESCRIPTION VARCHAR(40) NULL,
					JOB_DESCRIPTION VARCHAR(60) NULL,
					JOB_COMP_DESCRIPTION VARCHAR(60) NULL,
					REPOSITORY_FILENAME VARCHAR(200),
					VENDOR_CODE VARCHAR(6) NULL,
					AP_INVOICE VARCHAR(20) NULL,
					VENDOR_NAME VARCHAR(30) NULL,
					AP_INVOICE_DESC VARCHAR(50) NULL,
					AP_ID INT NULL,
					AD_NBR VARCHAR(30) NULL,
					AD_NBR_DESC VARCHAR(60) NULL,
					LEVEL_TEXT VARCHAR(100) NULL,
					CRITERIA_NAME VARCHAR(100) NULL,
					DOCUMENT_TYPE_ID INT NULL,
					DOCUMENT_TYPE_DESC VARCHAR(100) NULL,
					LABEL_ID INT NULL,
					LABEL_NAME VARCHAR(100) NULL,
					CONTRACT_ID INT NULL,
					CONTRACT_CODE VARCHAR(6) NULL,
					CONTRACT_DESC VARCHAR(100) NULL,
					DP_TM_CODE VARCHAR(4) NULL,
					DP_TM_DESC VARCHAR(30) NULL,
					FNC_CODE VARCHAR(6) NULL,
					FNC_DESC VARCHAR(30) NULL,
					MEDIA_ORDER_LINE_ORDER_NBR INT NULL,
					MEDIA_ORDER_LINE_NBR SMALLINT NULL,
					MEDIA_ORDER_LINE_DESC VARCHAR(60) NULL,
					MEDIA_ORDER_ORDER_NBR INT NULL,
					MEDIA_ORDER_ORDER_DESC VARCHAR(60) NULL,
					VENDOR_CONTRACT_DESC VARCHAR(100) NULL,
					EMP_CODE VARCHAR(6) NULL,
					EMP_FML VARCHAR(256) NULL,
					EXPENSE_HEADER_DESC VARCHAR(30) NULL,
					IS_PRIVATE BIT NULL,
					ALERT_SUBJECT VARCHAR(254) NULL,
					CONTRACT_REPORT_DESC VARCHAR(100) NULL
				)

	END
	--	SET SECURITY
	BEGIN
		SELECT @ClientRestrictions = COUNT(1) FROM SEC_CLIENT WITH(NOLOCK) WHERE  UPPER(USER_ID) = UPPER(@USER_CODE);
		SELECT @EMP_CODE = EMP_CODE FROM SEC_USER WITH(NOLOCK) WHERE UPPER(USER_CODE) = UPPER(@USER_CODE);
		SELECT @OfficeRestrictions = COUNT(*) FROM EMP_OFFICE WITH(NOLOCK) WHERE EMP_CODE = @EMP_CODE;
		SELECT @IsBlockedFromOfficeLevel = [IsBlocked] FROM [dbo].[advtf_sec_permission_by_user_code] (@APPLICATION_ID, @USER_CODE,'Desktop_DocumentManagerLevels_Office');
		SELECT @IsBlockedFromClientLevel = [IsBlocked] FROM [dbo].[advtf_sec_permission_by_user_code] (@APPLICATION_ID, @USER_CODE,'Desktop_DocumentManagerLevels_Client');
		SELECT @IsBlockedFromDivisionLevel = [IsBlocked] FROM [dbo].[advtf_sec_permission_by_user_code] (@APPLICATION_ID, @USER_CODE,'Desktop_DocumentManagerLevels_Division');
		SELECT @IsBlockedFromProductLevel = [IsBlocked] FROM [dbo].[advtf_sec_permission_by_user_code] (@APPLICATION_ID, @USER_CODE,'Desktop_DocumentManagerLevels_Product');
		SELECT @IsBlockedFromCampaignLevel = [IsBlocked] FROM [dbo].[advtf_sec_permission_by_user_code] (@APPLICATION_ID, @USER_CODE,'Desktop_DocumentManagerLevels_Campaign');
		SELECT @IsBlockedFromJobLevel = [IsBlocked] FROM [dbo].[advtf_sec_permission_by_user_code] (@APPLICATION_ID, @USER_CODE,'Desktop_DocumentManagerLevels_Job');
		SELECT @IsBlockedFromJobComponentLevel = [IsBlocked] FROM [dbo].[advtf_sec_permission_by_user_code] (@APPLICATION_ID, @USER_CODE,'Desktop_DocumentManagerLevels_JobComponent');
		SELECT @IsBlockedFromAPLevel = [IsBlocked] FROM [dbo].[advtf_sec_permission_by_user_code] (@APPLICATION_ID, @USER_CODE,'Desktop_DocumentManagerLevels_APInvoice');
		SELECT @IsBlockedFromAgencyDesktopLevel = [IsBlocked] FROM [dbo].[advtf_sec_permission_by_user_code] (@APPLICATION_ID, @USER_CODE,'Desktop_DocumentManagerLevels_AgencyDesktop');
		SELECT @IsBlockedFromExecutiveDesktopLevel = [IsBlocked] FROM [dbo].[advtf_sec_permission_by_user_code] (@APPLICATION_ID, @USER_CODE,'Desktop_DocumentManagerLevels_ExecutiveDesktop');
		SELECT @IsBlockedFromAdNumberLevel = [IsBlocked] FROM [dbo].[advtf_sec_permission_by_user_code] (@APPLICATION_ID, @USER_CODE,'Desktop_DocumentManagerLevels_AdNumber');
		SELECT @IsBlockedFromExpenseReportLevel = [IsBlocked] FROM [dbo].[advtf_sec_permission_by_user_code] (@APPLICATION_ID, @USER_CODE,'Desktop_DocumentManagerLevels_ExpenseReceipts');
		SELECT @IsBlockedFromContractLevel = [IsBlocked] FROM [dbo].[advtf_sec_permission_by_user_code] (@APPLICATION_ID, @USER_CODE,'Desktop_DocumentManagerLevels_Contract');
		SELECT @IsBlockedFromContractReportLevel = [IsBlocked] FROM [dbo].[advtf_sec_permission_by_user_code] (@APPLICATION_ID, @USER_CODE,'Desktop_DocumentManagerLevels_ContractReport');
		SELECT @IsBlockedFromARInvoiceLevel = [IsBlocked] FROM [dbo].[advtf_sec_permission_by_user_code] (@APPLICATION_ID, @USER_CODE,'Desktop_DocumentManagerLevels_ARInvoice');
		SELECT @IsBlockedFromVendorLevel = [IsBlocked] FROM [dbo].[advtf_sec_permission_by_user_code] (@APPLICATION_ID, @USER_CODE,'Desktop_DocumentManagerLevels_Vendor');
		SELECT @IsBlockedFromVendorContractLevel = 0 --[IsBlocked] FROM [dbo].[advtf_sec_permission_by_user_code] (@APPLICATION_ID, @USER_CODE,'Desktop_DocumentManagerLevels_VendorContract');
		SELECT @IsBlockedFromEmployeeLevel = [IsBlocked] FROM [dbo].[advtf_sec_permission_by_user_code] (@APPLICATION_ID, @USER_CODE,'Desktop_DocumentManagerLevels_Employee');
		SELECT @IsBlockedFromAlertLevel = [IsBlocked] FROM [dbo].[advtf_sec_permission_by_user_code] (@APPLICATION_ID, @USER_CODE,'Desktop_Alerts');
		--SELECT @IsBlockedFromTaskLevel = [IsBlocked] FROM [dbo].[advtf_sec_permission_by_user_code] (@APPLICATION_ID, @USER_CODE,'Desktop_DocumentManagerLevels_Task');
	END
	--	INIT
	BEGIN
		SET @ACCESS_PRIVATE = ISNULL(@ACCESS_PRIVATE, 0);
		SET @LEVEL = ISNULL(@LEVEL, '');
		SET @LEVEL = RTRIM(LTRIM(UPPER(@LEVEL)));
		SET @SEARCH_TEXT = ISNULL(@SEARCH_TEXT, '%');
		SET @SEARCH_TEXT = UPPER(@SEARCH_TEXT);
		SET @CRITERIA_ENUM_VALUE = ISNULL(@CRITERIA_ENUM_VALUE, 1);
		SET @CRITERIA_ENUM_VALUE = CASE WHEN @CRITERIA_ENUM_VALUE IS NULL OR @CRITERIA_ENUM_VALUE = 0 THEN 1 ELSE @CRITERIA_ENUM_VALUE END;
		SET @DOCUMENT_TYPE_ID = ISNULL(@DOCUMENT_TYPE_ID, 0);
		SET @LABEL_ID = ISNULL(@LABEL_ID, 0);
		SET @JOB_NUMBER = ISNULL(@JOB_NUMBER, 0);
		SET @JOB_COMPONENT_NBR = ISNULL(@JOB_COMPONENT_NBR, 0);
		SET @INCLUDE_ATTACHMENTS = ISNULL(@INCLUDE_ATTACHMENTS, 0);
		IF @LEVEL = 'ALRT'
		BEGIN
			SET @INCLUDE_ATTACHMENTS = 1;
		END
	END
	--	SEARCH
	BEGIN
		--	LEVELS WITH CLIENT RESTRICTIONS
	    IF @ClientRestrictions > 0
	    BEGIN
			IF @OfficeRestrictions > 0
			BEGIN
				IF @IsBlockedFromClientLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'CL')
				BEGIN
					INSERT INTO @SEARCH_RESULTS	
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CL_CODE,
						[LEVEL],
						CLIENT_NAME,
						REPOSITORY_FILENAME
					)
					SELECT DISTINCT
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CLIENT.CL_CODE AS CL_CODE,
						'CL' AS [LEVEL],
						CLIENT.CL_NAME AS CLIENT_NAME,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM   
						WV_CURRENT_CLIENT_DOCUMENTS
						INNER JOIN CLIENT ON WV_CURRENT_CLIENT_DOCUMENTS.CL_CODE = CLIENT.CL_CODE
						INNER JOIN DIVISION ON CLIENT.CL_CODE = DIVISION.CL_CODE 
						INNER JOIN PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE
						INNER JOIN SEC_CLIENT ON WV_CURRENT_CLIENT_DOCUMENTS.CL_CODE = SEC_CLIENT.CL_CODE
						INNER JOIN EMP_OFFICE ON PRODUCT.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE  
						(
							CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						)
						AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END;
				IF @IsBlockedFromDivisionLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'DI')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CL_CODE,
						DIV_CODE,
						[LEVEL],
						CLIENT_NAME,
						DIVISION_NAME,
						REPOSITORY_FILENAME
					)
					SELECT DISTINCT
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CLIENT.CL_CODE AS CL_CODE,
						DIVISION.DIV_CODE AS DIV_CODE,
						'DI' AS [LEVEL],
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM   
						WV_CURRENT_DIVISION_DOCUMENTS
						INNER JOIN DIVISION ON DIVISION.DIV_CODE = WV_CURRENT_DIVISION_DOCUMENTS.DIV_CODE AND WV_CURRENT_DIVISION_DOCUMENTS.CL_CODE = DIVISION.CL_CODE
						INNER JOIN CLIENT ON CLIENT.CL_CODE = DIVISION.CL_CODE
						INNER JOIN PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE
						INNER JOIN SEC_CLIENT ON WV_CURRENT_DIVISION_DOCUMENTS.CL_CODE = SEC_CLIENT.CL_CODE AND WV_CURRENT_DIVISION_DOCUMENTS.DIV_CODE = SEC_CLIENT.DIV_CODE
						INNER JOIN EMP_OFFICE ON PRODUCT.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE  (
							   CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							   OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							   OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							   OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							   OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							   OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							   OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							   OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						   )
						   AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						   AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END;
				IF @IsBlockedFromProductLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'PR')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						[LEVEL],
						OFFICE_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME
					)
					SELECT DISTINCT
						WV_CURRENT_PRODUCT_DOCUMENTS.DOCUMENT_ID,
						WV_CURRENT_PRODUCT_DOCUMENTS.[FILENAME],
						WV_CURRENT_PRODUCT_DOCUMENTS.[DESCRIPTION],
						WV_CURRENT_PRODUCT_DOCUMENTS.KEYWORDS,
						WV_CURRENT_PRODUCT_DOCUMENTS.FILE_SIZE,
						WV_CURRENT_PRODUCT_DOCUMENTS.UPLOADED_DATE,
						WV_CURRENT_PRODUCT_DOCUMENTS.MIME_TYPE,
						WV_CURRENT_PRODUCT_DOCUMENTS.USER_CODE,
						OFFICE.OFFICE_CODE,
						CLIENT.CL_CODE,
						DIVISION.DIV_CODE,
						PRODUCT.PRD_CODE,
						'PR' AS [LEVEL],
						OFFICE.OFFICE_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						WV_CURRENT_PRODUCT_DOCUMENTS.REPOSITORY_FILENAME
					FROM   
						WV_CURRENT_PRODUCT_DOCUMENTS
						INNER JOIN CLIENT ON WV_CURRENT_PRODUCT_DOCUMENTS.CL_CODE = CLIENT.CL_CODE
						INNER JOIN DIVISION ON WV_CURRENT_PRODUCT_DOCUMENTS.DIV_CODE = DIVISION.DIV_CODE AND WV_CURRENT_PRODUCT_DOCUMENTS.CL_CODE = DIVISION.CL_CODE
						INNER JOIN PRODUCT
						INNER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
						ON WV_CURRENT_PRODUCT_DOCUMENTS.CL_CODE = PRODUCT.CL_CODE AND WV_CURRENT_PRODUCT_DOCUMENTS.DIV_CODE = PRODUCT.DIV_CODE AND WV_CURRENT_PRODUCT_DOCUMENTS.PRD_CODE = PRODUCT.PRD_CODE
						INNER JOIN SEC_CLIENT ON PRODUCT.CL_CODE = SEC_CLIENT.CL_CODE AND PRODUCT.DIV_CODE = SEC_CLIENT.DIV_CODE AND PRODUCT.PRD_CODE = SEC_CLIENT.PRD_CODE
						INNER JOIN EMP_OFFICE ON PRODUCT.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE  
						(
							CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(WV_CURRENT_PRODUCT_DOCUMENTS.KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(WV_CURRENT_PRODUCT_DOCUMENTS.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(WV_CURRENT_PRODUCT_DOCUMENTS.[FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(WV_CURRENT_PRODUCT_DOCUMENTS.USER_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						)
						AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END
				IF @IsBlockedFromCampaignLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'CM')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CMP_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						[LEVEL],
						OFFICE_NAME,
						CAMPAIGN_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME
					)
					SELECT DISTINCT
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CAMPAIGN.CMP_CODE AS CMP_CODE,
						OFFICE.OFFICE_CODE,
						CAMPAIGN.CL_CODE AS CL_CODE,
						CAMPAIGN.DIV_CODE AS DIV_CODE,
						CAMPAIGN.PRD_CODE AS PRD_CODE,
						'CM' AS [LEVEL],
						OFFICE.OFFICE_NAME,
						CAMPAIGN.CMP_NAME AS CAMPAIGN_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM   
						WV_CURRENT_CAMPAIGN_DOCUMENTS
						INNER JOIN CAMPAIGN ON WV_CURRENT_CAMPAIGN_DOCUMENTS.CMP_IDENTIFIER = CAMPAIGN.CMP_IDENTIFIER
						LEFT OUTER JOIN CLIENT ON CAMPAIGN.CL_CODE = CLIENT.CL_CODE
						LEFT OUTER JOIN DIVISION ON CAMPAIGN.CL_CODE = DIVISION.CL_CODE AND CAMPAIGN.DIV_CODE = DIVISION.DIV_CODE
						LEFT OUTER JOIN PRODUCT ON CAMPAIGN.CL_CODE = PRODUCT.CL_CODE AND CAMPAIGN.DIV_CODE = PRODUCT.DIV_CODE AND CAMPAIGN.PRD_CODE = PRODUCT.PRD_CODE
						LEFT OUTER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
						LEFT OUTER JOIN MEDIA_ORDER_HEADER MOH ON CAMPAIGN.CMP_IDENTIFIER = MOH.CMP_IDENTIFIER
						INNER JOIN SEC_CLIENT ON PRODUCT.CL_CODE = SEC_CLIENT.CL_CODE AND PRODUCT.DIV_CODE = SEC_CLIENT.DIV_CODE AND PRODUCT.PRD_CODE = SEC_CLIENT.PRD_CODE
						INNER JOIN EMP_OFFICE ON PRODUCT.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE  
						(
							CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR UPPER(CAMPAIGN.CMP_NAME) LIKE '%' + @SEARCH_TEXT + '%'
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 12)) AND UPPER(MOH.ORDER_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 12)) AND UPPER(CAST(MOH.ORDER_COMMENT AS VARCHAR)) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						)
						AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END
				IF @IsBlockedFromJobLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'JO')
				BEGIN
					SELECT @JOB_NUMBER = JOB_NUMBER FROM [dbo].[advtf_get_job_component_from_string] (@SEARCH_TEXT);
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CMP_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						JOB_NUMBER,
						[LEVEL],
						OFFICE_NAME,
						CAMPAIGN_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						JOB_DESCRIPTION,
						REPOSITORY_FILENAME
					)
					SELECT DISTINCT
						JD.DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CAMPAIGN.CMP_CODE AS CMP_CODE,
						OFFICE.OFFICE_CODE AS OFFICE_CODE,
						CLIENT.CL_CODE AS CL_CODE,
						DIVISION.DIV_CODE AS DIV_CODE,
						PRODUCT.PRD_CODE AS PRD_CODE,
						JOB_LOG.JOB_NUMBER AS JOB_NUMBER,
						'JO' AS [LEVEL],
						OFFICE_NAME AS OFFICE_NAME,
						CAMPAIGN.CMP_NAME AS CAMPAIGN_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						JOB_LOG.JOB_DESC AS JOB_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM  
						JOB_DOCUMENTS JD
						INNER JOIN DOCUMENTS D ON JD.DOCUMENT_ID = D.DOCUMENT_ID
						INNER JOIN DIVISION
						INNER JOIN PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE
						INNER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
						INNER JOIN JOB_LOG ON PRODUCT.CL_CODE = JOB_LOG.CL_CODE AND PRODUCT.DIV_CODE = JOB_LOG.DIV_CODE AND PRODUCT.PRD_CODE = JOB_LOG.PRD_CODE ON JD.JOB_NUMBER = JOB_LOG.JOB_NUMBER
						INNER JOIN CLIENT ON DIVISION.CL_CODE = CLIENT.CL_CODE
						INNER JOIN SEC_CLIENT ON PRODUCT.CL_CODE = SEC_CLIENT.CL_CODE AND PRODUCT.DIV_CODE = SEC_CLIENT.DIV_CODE AND PRODUCT.PRD_CODE = SEC_CLIENT.PRD_CODE
						LEFT OUTER JOIN CAMPAIGN ON JOB_LOG.CMP_IDENTIFIER = CAMPAIGN.CMP_IDENTIFIER
						INNER JOIN EMP_OFFICE ON JOB_LOG.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE  (
								CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(JOB_LOG.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN ISNUMERIC(@SEARCH_TEXT) = 1 AND JD.JOB_NUMBER = CAST(@SEARCH_TEXT AS INT) THEN 1 ELSE 0 END = 1
								OR CASE WHEN @JOB_NUMBER > 0 AND JD.JOB_NUMBER = @JOB_NUMBER THEN 1 ELSE 0 END = 1
						   )
						   AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						   AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END
				IF @IsBlockedFromJobComponentLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'JC')
				BEGIN
					SELECT @JOB_NUMBER = JOB_NUMBER, @JOB_COMPONENT_NBR = JOB_COMPONENT_NBR FROM [dbo].[advtf_get_job_component_from_string] (@SEARCH_TEXT);
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CMP_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						JOB_NUMBER,
						JOB_COMPONENT_NBR,
						[LEVEL],
						OFFICE_NAME,
						CAMPAIGN_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						JOB_DESCRIPTION,
						JOB_COMP_DESCRIPTION,
						REPOSITORY_FILENAME
					)
					SELECT
						JCD.DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						JOB_LOG.CMP_CODE AS CMP_CODE,
						JOB_LOG.OFFICE_CODE AS OFFICE_CODE,
						JOB_LOG.CL_CODE AS CL_CODE,
						JOB_LOG.DIV_CODE AS DIV_CODE,
						JOB_LOG.PRD_CODE AS PRD_CODE,
						JOB_COMPONENT.JOB_NUMBER AS JOB_NUMBER,
						JOB_COMPONENT.JOB_COMPONENT_NBR AS JOB_COMPONENT_NBR,
						'JC' AS [LEVEL],
						OFFICE_NAME AS OFFICE_NAME,
						CAMPAIGN.CMP_NAME AS CAMPAIGN_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						JOB_LOG.JOB_DESC AS JOB_DESCRIPTION,
						JOB_COMPONENT.JOB_COMP_DESC AS JOB_COMP_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM   
						JOB_COMPONENT_DOCUMENTS JCD
						INNER JOIN DOCUMENTS D ON D.DOCUMENT_ID = JCD.DOCUMENT_ID
						INNER JOIN JOB_COMPONENT ON JOB_COMPONENT.JOB_NUMBER = JCD.JOB_NUMBER AND JOB_COMPONENT.JOB_COMPONENT_NBR = JCD.JOB_COMPONENT_NUMBER
						INNER JOIN JOB_LOG ON JOB_LOG.JOB_NUMBER = JCD.JOB_NUMBER
						INNER JOIN PRODUCT ON PRODUCT.CL_CODE = JOB_LOG.CL_CODE AND PRODUCT.DIV_CODE = JOB_LOG.DIV_CODE AND PRODUCT.PRD_CODE = JOB_LOG.PRD_CODE
						INNER JOIN DIVISION ON DIVISION.CL_CODE = JOB_LOG.CL_CODE AND DIVISION.DIV_CODE = JOB_LOG.DIV_CODE
						INNER JOIN CLIENT ON CLIENT.CL_CODE = JOB_LOG.CL_CODE
						INNER JOIN OFFICE ON OFFICE.OFFICE_CODE = JOB_LOG.OFFICE_CODE
						INNER JOIN SEC_CLIENT ON PRODUCT.CL_CODE = SEC_CLIENT.CL_CODE AND PRODUCT.DIV_CODE = SEC_CLIENT.DIV_CODE AND PRODUCT.PRD_CODE = SEC_CLIENT.PRD_CODE
						LEFT OUTER JOIN CAMPAIGN ON CAMPAIGN.CMP_IDENTIFIER = JOB_LOG.CMP_IDENTIFIER
						INNER JOIN EMP_OFFICE ON JOB_LOG.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE  (
								CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(JOB_LOG.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10, 11)) AND UPPER(JOB_COMPONENT.JOB_COMP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN @JOB_NUMBER > 0 AND @JOB_COMPONENT_NBR = 0 AND JCD.JOB_NUMBER = @JOB_NUMBER THEN 1 ELSE 0 END = 1
								OR CASE WHEN @JOB_NUMBER > 0 AND @JOB_COMPONENT_NBR > 0 AND JCD.JOB_NUMBER = @JOB_NUMBER AND JCD.JOB_COMPONENT_NUMBER = @JOB_COMPONENT_NBR THEN 1 ELSE 0 END = 1
						   )
						   AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						   AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
					--	PROJECT SCHEDULE TASK DOCS
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						REPOSITORY_FILENAME,
						[LEVEL],
						JOB_NUMBER,
						JOB_COMPONENT_NBR,
						FNC_CODE,
						FNC_DESC
					)
					SELECT DISTINCT
						PSTDA.DOCUMENT_ID, 
						PSTDA.[FILENAME], 
						PSTDA.[DESCRIPTION], 
						PSTDA.KEYWORDS, 
						PSTDA.FILE_SIZE, 
						PSTDA.UPLOADED_DATE, 
						PSTDA.MIME_TYPE,
						PSTDA.USER_CODE,
						PSTDA.REPOSITORY_FILENAME,
						'PST', 
						PSTDA.JOB_NUMBER, 
						PSTDA.JOB_COMPONENT_NBR,
						TF.TRF_CODE,
						TF.TRF_DESC
					FROM 
						PROJECT_SCHEDULE_TASK_DOCUMENTS_ALL PSTDA
						INNER JOIN JOB_TRAFFIC_DET JTD ON JTD.JOB_NUMBER = PSTDA.JOB_NUMBER AND JTD.JOB_COMPONENT_NBR = PSTDA.JOB_COMPONENT_NBR AND JTD.SEQ_NBR = PSTDA.SEQ_NBR
						LEFT OUTER JOIN TRAFFIC_FNC TF ON JTD.FNC_CODE = TF.TRF_CODE
						LEFT OUTER JOIN FUNCTIONS F ON TF.FNC_CODE = F.FNC_CODE
						INNER JOIN JOB_COMPONENT ON JOB_COMPONENT.JOB_NUMBER = PSTDA.JOB_NUMBER AND JOB_COMPONENT.JOB_COMPONENT_NBR = PSTDA.JOB_COMPONENT_NBR
						INNER JOIN JOB_LOG JL ON JL.JOB_NUMBER = JOB_COMPONENT.JOB_NUMBER
						INNER JOIN PRODUCT ON PRODUCT.CL_CODE = JL.CL_CODE AND PRODUCT.DIV_CODE = JL.DIV_CODE AND PRODUCT.PRD_CODE = JL.PRD_CODE
						INNER JOIN DIVISION ON DIVISION.CL_CODE = JL.CL_CODE AND DIVISION.DIV_CODE = JL.DIV_CODE
						INNER JOIN CLIENT ON CLIENT.CL_CODE = JL.CL_CODE
						INNER JOIN OFFICE ON OFFICE.OFFICE_CODE = JL.OFFICE_CODE
						INNER JOIN SEC_CLIENT ON PRODUCT.CL_CODE = SEC_CLIENT.CL_CODE AND PRODUCT.DIV_CODE = SEC_CLIENT.DIV_CODE AND PRODUCT.PRD_CODE = SEC_CLIENT.PRD_CODE
					WHERE
						(
							CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(JL.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10, 11)) AND UPPER(JOB_COMPONENT.JOB_COMP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @JOB_NUMBER > 0 AND @JOB_COMPONENT_NBR = 0 AND PSTDA.JOB_NUMBER = @JOB_NUMBER THEN 1 ELSE 0 END = 1
							OR CASE WHEN @JOB_NUMBER > 0 AND @JOB_COMPONENT_NBR > 0 AND PSTDA.JOB_NUMBER = @JOB_NUMBER AND PSTDA.JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR THEN 1 ELSE 0 END = 1
						)
						AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END
				IF @IsBlockedFromAPLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'VN')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						--OFFICE_CODE,
						--CL_CODE,
						--DIV_CODE,
						--PRD_CODE,
						--JOB_NUMBER,
						--JOB_COMPONENT_NBR,
						[LEVEL],
						--OFFICE_NAME,
						--CLIENT_NAME,
						--DIVISION_NAME,
						--PRODUCT_DESCRIPTION,
						--JOB_DESCRIPTION,
						--JOB_COMP_DESCRIPTION,
						REPOSITORY_FILENAME,
						VENDOR_CODE,
						AP_INVOICE,
						VENDOR_NAME,
						AP_INVOICE_DESC,
						AP_ID
					)
					SELECT DISTINCT 
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						--OFFICE.OFFICE_CODE AS OFFICE_CODE,
						--CLIENT.CL_CODE AS CL_CODE,
						--DIVISION.DIV_CODE AS DIV_CODE,
						--PRODUCT.PRD_CODE AS PRD_CODE,
						--JOB_LOG.JOB_NUMBER AS JOB_NUMBER,
						--JOB_COMPONENT.JOB_COMPONENT_NBR AS JOB_COMPONENT_NBR,
						'VN' AS [LEVEL],
						--OFFICE.OFFICE_NAME AS OFFICE_NAME,
						--CLIENT.CL_NAME AS CLIENT_NAME,
						--DIVISION.DIV_NAME AS DIVISION_NAME,
						--PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						--JOB_LOG.JOB_DESC AS JOB_DESCRIPTION,
						--JOB_COMPONENT.JOB_COMP_DESC AS JOB_COMP_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME,
						AP_HEADER.VN_FRL_EMP_CODE AS VENDOR_CODE,
						AP_HEADER.AP_INV_VCHR AS AP_INVOICE,
						VENDOR.VN_NAME AS VENDOR_NAME,
						AP_HEADER.AP_DESC AS AP_INVOICE_DESC,
						AP_HEADER.AP_ID
					FROM   
						WV_CURRENT_AP_DOCUMENTS
						INNER JOIN AP_HEADER ON AP_HEADER.AP_ID = WV_CURRENT_AP_DOCUMENTS.AP_ID
						LEFT OUTER JOIN AP_PRODUCTION ON AP_PRODUCTION.AP_ID = WV_CURRENT_AP_DOCUMENTS.AP_ID
						LEFT OUTER JOIN JOB_COMPONENT ON JOB_COMPONENT.JOB_NUMBER = AP_PRODUCTION.JOB_NUMBER AND JOB_COMPONENT.JOB_COMPONENT_NBR = AP_PRODUCTION.JOB_COMPONENT_NBR
						LEFT OUTER JOIN JOB_LOG ON JOB_LOG.JOB_NUMBER = AP_PRODUCTION.JOB_NUMBER
						INNER JOIN SEC_CLIENT ON JOB_LOG.CL_CODE = SEC_CLIENT.CL_CODE AND JOB_LOG.DIV_CODE = SEC_CLIENT.DIV_CODE AND JOB_LOG.PRD_CODE = SEC_CLIENT.PRD_CODE
						INNER JOIN VENDOR ON AP_HEADER.VN_FRL_EMP_CODE = VENDOR.VN_CODE
						LEFT OUTER JOIN CLIENT ON JOB_LOG.CL_CODE = CLIENT.CL_CODE
						LEFT OUTER JOIN DIVISION ON JOB_LOG.DIV_CODE = DIVISION.DIV_CODE
						LEFT OUTER JOIN PRODUCT ON JOB_LOG.PRD_CODE = PRODUCT.PRD_CODE
						LEFT OUTER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
						INNER JOIN EMP_OFFICE ON VENDOR.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE  
						(
							CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(AP_HEADER.VN_FRL_EMP_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(AP_HEADER.AP_INV_VCHR) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 12) AND UPPER(VENDOR.VN_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 12) AND UPPER(VENDOR.VN_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(AP_HEADER.AP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						)
						AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END
				IF @IsBlockedFromAdNumberLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'AN')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CL_CODE,
						[LEVEL],
						CLIENT_NAME,
						REPOSITORY_FILENAME,
						AD_NBR,
						AD_NBR_DESC
					)
					SELECT DISTINCT
						DOCUMENTS.DOCUMENT_ID,
						DOCUMENTS.[FILENAME],
						DOCUMENTS.[DESCRIPTION],
						DOCUMENTS.KEYWORDS,
						DOCUMENTS.FILE_SIZE,
						DOCUMENTS.UPLOADED_DATE,
						DOCUMENTS.MIME_TYPE,
						DOCUMENTS.USER_CODE,
						AD_NUMBER.CL_CODE AS CL_CODE,
						'AN' AS [LEVEL],
						CLIENT.CL_NAME AS CLIENT_NAME,
						DOCUMENTS.REPOSITORY_FILENAME AS REPOSITORY_FILENAME,
						AD_NUMBER.AD_NBR,
						AD_NUMBER.AD_NBR_DESC
					FROM   
						DOCUMENTS
						INNER JOIN AD_NUMBER ON DOCUMENTS.DOCUMENT_ID = AD_NUMBER.DOCUMENT_ID
						LEFT OUTER JOIN CLIENT ON AD_NUMBER.CL_CODE = CLIENT.CL_CODE
						LEFT OUTER JOIN JOB_COMPONENT ON JOB_COMPONENT.AD_NBR = AD_NUMBER.AD_NBR
						LEFT OUTER JOIN JOB_LOG ON JOB_COMPONENT.JOB_NUMBER = JOB_LOG.JOB_NUMBER
						LEFT OUTER JOIN OFFICE ON JOB_LOG.OFFICE_CODE = OFFICE.OFFICE_CODE
						INNER JOIN SEC_CLIENT ON AD_NUMBER.CL_CODE = SEC_CLIENT.CL_CODE
						INNER JOIN DIVISION ON CLIENT.CL_CODE = DIVISION.CL_CODE 
						INNER JOIN PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE
						INNER JOIN EMP_OFFICE ON PRODUCT.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE  
						(
							CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(DOCUMENTS.KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(DOCUMENTS.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(DOCUMENTS.[FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR UPPER(AD_NUMBER.AD_NBR_DESC) LIKE '%' + @SEARCH_TEXT + '%'
							OR UPPER(AD_NUMBER.AD_NBR) LIKE '%' + @SEARCH_TEXT + '%'
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(JOB_LOG.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10, 11)) AND UPPER(JOB_COMPONENT.JOB_COMP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(DOCUMENTS.USER_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						)
						AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END
				IF @IsBlockedFromExpenseReportLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'EXDTL')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						JOB_NUMBER,
						JOB_COMPONENT_NBR,
						[LEVEL],
						OFFICE_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						JOB_DESCRIPTION,
						REPOSITORY_FILENAME,
						EMP_CODE,
						AP_ID,
						EMP_FML,
						EXPENSE_HEADER_DESC
					)
					SELECT DISTINCT 
						DOCUMENTS.DOCUMENT_ID,
						DOCUMENTS.[FILENAME],
						DOCUMENTS.[DESCRIPTION],
						DOCUMENTS.KEYWORDS,
						DOCUMENTS.FILE_SIZE,
						DOCUMENTS.UPLOADED_DATE,
						DOCUMENTS.MIME_TYPE,
						DOCUMENTS.USER_CODE,
						OFFICE.OFFICE_CODE,
						EXPENSE_DETAIL.CL_CODE,
						EXPENSE_DETAIL.DIV_CODE,
						EXPENSE_DETAIL.PRD_CODE,
						EXPENSE_DETAIL.JOB_NBR,
						EXPENSE_DETAIL.JOB_COMP_NBR,
						'EXDTL',
						OFFICE.OFFICE_NAME,
						CLIENT.CL_NAME,
						DIVISION.DIV_NAME,
						PRODUCT.PRD_DESCRIPTION,
						JOB_LOG.JOB_DESC,
						DOCUMENTS.REPOSITORY_FILENAME,
						EXPENSE_HEADER.EMP_CODE,
						EXPENSE_DETAIL.INV_NBR,
						ISNULL(E.EMP_FNAME + ' ','') + ISNULL(E.EMP_MI + '. ', '') + ISNULL(E.EMP_LNAME, ''),
						EXPENSE_HEADER.EXP_DESC
					FROM   
						DOCUMENTS
						INNER JOIN EXPENSE_DETAIL_DOCS ON DOCUMENTS.DOCUMENT_ID = EXPENSE_DETAIL_DOCS.DOCUMENT_ID
						INNER JOIN EXPENSE_DETAIL ON EXPENSE_DETAIL.EXPDETAILID = EXPENSE_DETAIL_DOCS.EXPDETAILID
						INNER JOIN EXPENSE_HEADER ON EXPENSE_HEADER.INV_NBR = EXPENSE_DETAIL.INV_NBR
						INNER JOIN EMPLOYEE E ON EXPENSE_HEADER.EMP_CODE = E.EMP_CODE
						LEFT OUTER JOIN CLIENT ON CLIENT.CL_CODE = EXPENSE_DETAIL.CL_CODE
						LEFT OUTER JOIN DIVISION ON DIVISION.DIV_CODE = EXPENSE_DETAIL.DIV_CODE
						LEFT OUTER JOIN PRODUCT ON PRODUCT.PRD_CODE = EXPENSE_DETAIL.PRD_CODE
						LEFT OUTER JOIN OFFICE ON OFFICE.OFFICE_CODE = PRODUCT.OFFICE_CODE
						LEFT OUTER JOIN JOB_LOG ON JOB_LOG.JOB_NUMBER = EXPENSE_DETAIL.JOB_NBR
						LEFT OUTER JOIN JOB_COMPONENT ON JOB_COMPONENT.JOB_NUMBER = EXPENSE_DETAIL.JOB_NBR AND JOB_COMPONENT.JOB_COMPONENT_NBR = EXPENSE_DETAIL.JOB_COMP_NBR
						LEFT OUTER JOIN FUNCTIONS F ON EXPENSE_DETAIL.FNC_CODE = F.FNC_CODE
						INNER JOIN SEC_CLIENT ON EXPENSE_DETAIL.CL_CODE = SEC_CLIENT.CL_CODE AND EXPENSE_DETAIL.DIV_CODE = SEC_CLIENT.DIV_CODE AND EXPENSE_DETAIL.PRD_CODE = SEC_CLIENT.PRD_CODE
						INNER JOIN EMP_OFFICE ON E.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE
						(
							CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1 
							OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(JOB_LOG.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10, 11)) AND UPPER(JOB_COMPONENT.JOB_COMP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR UPPER(EXPENSE_HEADER.EXP_DESC) LIKE '%' + @SEARCH_TEXT + '%'
							OR UPPER(E.EMP_CODE) LIKE '%' + @SEARCH_TEXT + '%'
							OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 6) AND UPPER(E.EMP_FNAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 6) AND UPPER(E.EMP_MI) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 6) AND UPPER(E.EMP_LNAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 9) AND UPPER(F.FNC_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 9) AND UPPER(F.FNC_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						)
						AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END 
				IF @IsBlockedFromContractLevel = 0 AND (@LEVEL = '' OR @LEVEL = 'CT')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						[LEVEL],
						OFFICE_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME,
						CONTRACT_ID,
						CONTRACT_CODE,
						CONTRACT_DESC
					)
					SELECT DISTINCT
						DOCUMENT_ID,
						[FILENAME],
						CONTRACT_DOCUMENTS_ALL.[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE.OFFICE_CODE,
						CLIENT.CL_CODE,
						DIVISION.DIV_CODE,
						PRODUCT.PRD_CODE,
						'CT' AS [LEVEL],
						OFFICE.OFFICE_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME,
						CT.CONTRACT_ID,
						CT.CONTRACT_CODE,
						CT.[DESCRIPTION]
					FROM   
						CONTRACT_DOCUMENTS_ALL
						INNER JOIN CONTRACT CT ON CT.CONTRACT_ID = CONTRACT_DOCUMENTS_ALL.CONTRACT_ID
						INNER JOIN CLIENT ON CLIENT.CL_CODE = CT.CL_CODE
						LEFT OUTER JOIN DIVISION ON CT.CL_CODE = DIVISION.CL_CODE AND CT.DIV_CODE = DIVISION.DIV_CODE
						LEFT OUTER JOIN PRODUCT ON PRODUCT.CL_CODE = CT.CL_CODE AND PRODUCT.DIV_CODE = CT.DIV_CODE AND PRODUCT.PRD_CODE = CT.PRD_CODE
						INNER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
						INNER JOIN SEC_CLIENT ON CT.CL_CODE = SEC_CLIENT.CL_CODE
					WHERE
						( 
							CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(CONTRACT_DOCUMENTS_ALL.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						)
						AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END
				IF @IsBlockedFromContractReportLevel = 0 AND (@LEVEL = '' OR @LEVEL = 'ContractReport')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						[LEVEL],
						OFFICE_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME,
						CONTRACT_ID,
						CONTRACT_CODE,
						CONTRACT_DESC,
						CONTRACT_REPORT_DESC
					)
					SELECT DISTINCT
						DOCUMENT_ID,
						[FILENAME],
						CONTRACT_REPORT_DOCUMENTS_ALL.[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE.OFFICE_CODE,
						CLIENT.CL_CODE,
						DIVISION.DIV_CODE,
						PRODUCT.PRD_CODE,
						'CTR' AS [LEVEL],
						OFFICE.OFFICE_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME,
						CT.CONTRACT_ID,
						CT.CONTRACT_CODE,
						CT.[DESCRIPTION],
						CR.[DESCRIPTION]
					FROM   
						CONTRACT_REPORT_DOCUMENTS_ALL
						INNER JOIN CONTRACT_REPORT CR ON CR.CONTRACT_REPORT_ID = CONTRACT_REPORT_DOCUMENTS_ALL.CONTRACT_REPORT_ID
						INNER JOIN CONTRACT CT ON CT.CONTRACT_ID = CR.CONTRACT_ID
						INNER JOIN CLIENT ON CLIENT.CL_CODE = CT.CL_CODE
						LEFT OUTER JOIN DIVISION ON CT.CL_CODE = DIVISION.CL_CODE AND CT.DIV_CODE = DIVISION.DIV_CODE
						LEFT OUTER JOIN PRODUCT ON PRODUCT.CL_CODE = CT.CL_CODE AND PRODUCT.DIV_CODE = CT.DIV_CODE AND PRODUCT.PRD_CODE = CT.PRD_CODE
						INNER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
						INNER JOIN SEC_CLIENT ON CT.CL_CODE = SEC_CLIENT.CL_CODE
					WHERE  
						(
							CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(CONTRACT_REPORT_DOCUMENTS_ALL.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(CR.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 5)) AND UPPER(CT.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						)
						AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END
				IF @IsBlockedFromARInvoiceLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'AR')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CMP_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						JOB_NUMBER,
						JOB_COMPONENT_NBR,
						[LEVEL],
						OFFICE_NAME,
						CAMPAIGN_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						JOB_DESCRIPTION,
						JOB_COMP_DESCRIPTION,
						REPOSITORY_FILENAME
					)
					SELECT DISTINCT
						AIDA.DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						JOB_LOG.CMP_CODE AS CMP_CODE,
						JOB_LOG.OFFICE_CODE AS OFFICE_CODE,
						JOB_LOG.CL_CODE AS CL_CODE,
						JOB_LOG.DIV_CODE AS DIV_CODE,
						JOB_LOG.PRD_CODE AS PRD_CODE,
						JOB_COMPONENT.JOB_NUMBER AS JOB_NUMBER,
						JOB_COMPONENT.JOB_COMPONENT_NBR AS JOB_COMPONENT_NBR,
						'AR' AS [LEVEL],
						OFFICE_NAME AS OFFICE_NAME,
						CAMPAIGN.CMP_NAME AS CAMPAIGN_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						JOB_LOG.JOB_DESC AS JOB_DESCRIPTION,
						JOB_COMPONENT.JOB_COMP_DESC AS JOB_COMP_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM   
						AR_INVOICE_DOCUMENTS_ALL AIDA
						LEFT OUTER JOIN JOB_LOG ON JOB_LOG.JOB_NUMBER = AIDA.JOB_NUMBER
						LEFT OUTER JOIN JOB_COMPONENT ON JOB_COMPONENT.JOB_NUMBER = AIDA.JOB_NUMBER AND JOB_COMPONENT.JOB_COMPONENT_NBR = AIDA.JOB_COMPONENT_NBR
						INNER JOIN PRODUCT ON PRODUCT.CL_CODE = JOB_LOG.CL_CODE AND PRODUCT.DIV_CODE = JOB_LOG.DIV_CODE AND PRODUCT.PRD_CODE = JOB_LOG.PRD_CODE
						INNER JOIN DIVISION ON DIVISION.CL_CODE = JOB_LOG.CL_CODE AND DIVISION.DIV_CODE = JOB_LOG.DIV_CODE
						INNER JOIN CLIENT ON CLIENT.CL_CODE = JOB_LOG.CL_CODE
						INNER JOIN OFFICE ON OFFICE.OFFICE_CODE = JOB_LOG.OFFICE_CODE
						LEFT OUTER JOIN CAMPAIGN ON CAMPAIGN.CMP_IDENTIFIER = JOB_LOG.CMP_IDENTIFIER
						LEFT OUTER JOIN MEDIA_ORDER_HEADER MOH ON MOH.CL_CODE = CLIENT.CL_CODE AND MOH.DIV_CODE = DIVISION.DIV_CODE AND MOH.PRD_CODE = PRODUCT.PRD_CODE
						INNER JOIN SEC_CLIENT ON JOB_LOG.CL_CODE = SEC_CLIENT.CL_CODE AND JOB_LOG.DIV_CODE = SEC_CLIENT.DIV_CODE AND JOB_LOG.PRD_CODE = SEC_CLIENT.PRD_CODE
						INNER JOIN EMP_OFFICE ON JOB_LOG.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE 
						(
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(JOB_LOG.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10, 11)) AND UPPER(JOB_COMPONENT.JOB_COMP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(MOH.ORDER_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						)
						AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END
				IF @IsBlockedFromVendorLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'VC')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						[LEVEL],
						OFFICE_NAME,
						REPOSITORY_FILENAME,
						VENDOR_CODE,
						VENDOR_NAME
					)
					SELECT 
						DOCUMENT_ID,
						[FILENAME],
						VCDA.[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE.OFFICE_CODE AS OFFICE_CODE,
						'VC' AS [LEVEL],
						OFFICE.OFFICE_NAME AS OFFICE_NAME,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME,
						V.VN_CODE AS VENDOR_CODE,
						V.VN_NAME AS VENDOR_NAME
					FROM   
						VENDOR_CONTRACT_DOCUMENTS_ALL VCDA
						INNER JOIN VENDOR_CONTRACT VC ON VCDA.VENDOR_CONTRACT_ID = VC.VENDOR_CONTRACT_ID
						INNER JOIN VENDOR V ON VC.VN_CODE = V.VN_CODE
						LEFT OUTER JOIN OFFICE ON OFFICE.OFFICE_CODE = V.OFFICE_CODE
						INNER JOIN EMP_OFFICE ON V.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
						--INNER JOIN SEC_CLIENT ON MOH.CL_CODE = SEC_CLIENT.CL_CODE AND MOH.DIV_CODE = SEC_CLIENT.DIV_CODE AND MOH.PRD_CODE = SEC_CLIENT.PRD_CODE
					WHERE  
						(
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(VCDA.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR UPPER(VC.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%'
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 15)) AND UPPER(V.VN_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 15)) AND UPPER(V.VN_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						)
						--AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						--AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END;
				IF @IsBlockedFromAlertLevel = 0 AND(@LEVEL = '' OR @LEVEL = 'ALRT') AND @INCLUDE_ATTACHMENTS = 1
				BEGIN
					SELECT @JOB_NUMBER = JOB_NUMBER, @JOB_COMPONENT_NBR = JOB_COMPONENT_NBR FROM [dbo].[advtf_get_job_component_from_string] (@SEARCH_TEXT);
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						REPOSITORY_FILENAME,
						USER_CODE,
						[LEVEL],
						OFFICE_CODE,
						OFFICE_NAME,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						JOB_NUMBER,
						JOB_DESCRIPTION,
						JOB_COMPONENT_NBR,
						JOB_COMP_DESCRIPTION,
						ALERT_SUBJECT,
						CMP_CODE,
						CAMPAIGN_NAME
					)
					SELECT 
						D.DOCUMENT_ID,
						D.[FILENAME],
						D.[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						REPOSITORY_FILENAME,
						D.USER_CODE,
						'ALRT',
						OFFICE.OFFICE_CODE,
						OFFICE.OFFICE_NAME,
						CLIENT.CL_CODE,
						DIVISION.DIV_CODE,
						PRODUCT.PRD_CODE,
						CLIENT.CL_NAME,
						DIVISION.DIV_NAME,
						PRODUCT.PRD_DESCRIPTION,
						J.JOB_NUMBER,
						J.JOB_DESC,
						JC.JOB_COMPONENT_NBR,
						JC.JOB_COMP_DESC,
						A.[SUBJECT],
						C.CMP_CODE,
						C.CMP_NAME
					FROM
						DOCUMENTS D
						INNER JOIN ALERT_ATTACHMENT AA ON D.DOCUMENT_ID = AA.DOCUMENT_ID
						INNER JOIN ALERT A ON A.ALERT_ID = AA.ALERT_ID
						LEFT OUTER JOIN CLIENT ON A.CL_CODE = CLIENT.CL_CODE
						LEFT OUTER JOIN DIVISION ON A.DIV_CODE = DIVISION.DIV_CODE AND A.CL_CODE = DIVISION.CL_CODE
						LEFT OUTER JOIN PRODUCT ON A.CL_CODE = PRODUCT.CL_CODE AND A.DIV_CODE = PRODUCT.DIV_CODE AND A.PRD_CODE = PRODUCT.PRD_CODE
						LEFT OUTER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
						LEFT OUTER JOIN JOB_LOG J ON J.JOB_NUMBER = A.JOB_NUMBER
						LEFT OUTER JOIN JOB_COMPONENT JC ON JC.JOB_NUMBER = A.JOB_NUMBER AND JC.JOB_COMPONENT_NBR = A.JOB_COMPONENT_NBR
						LEFT OUTER JOIN CAMPAIGN C ON C.CMP_IDENTIFIER = A.CMP_IDENTIFIER
						INNER JOIN SEC_CLIENT ON A.CL_CODE = SEC_CLIENT.CL_CODE AND A.DIV_CODE = SEC_CLIENT.DIV_CODE AND A.PRD_CODE = SEC_CLIENT.PRD_CODE						
						INNER JOIN EMP_OFFICE ON J.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE 
						(
							CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(D.KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(D.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(D.[FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(D.USER_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 16)) AND UPPER(A.[SUBJECT]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 16)) AND UPPER(CAST(A.BODY AS VARCHAR(MAX))) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @JOB_NUMBER > 0 AND @JOB_COMPONENT_NBR = 0 AND J.JOB_NUMBER = @JOB_NUMBER THEN 1 ELSE 0 END = 1
							OR CASE WHEN @JOB_NUMBER > 0 AND @JOB_COMPONENT_NBR > 0 AND JC.JOB_NUMBER = @JOB_NUMBER AND JC.JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR THEN 1 ELSE 0 END = 1
							OR CASE WHEN @JOB_NUMBER = 0 AND (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(J.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @JOB_NUMBER = 0 AND @JOB_COMPONENT_NBR = 0 AND (@CRITERIA_ENUM_VALUE IN (1, 11)) AND UPPER(JC.JOB_COMP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 17)) AND UPPER(C.CMP_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						)
						AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END
			END
			ELSE
			BEGIN
				IF @IsBlockedFromClientLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'CL')
				BEGIN
					INSERT INTO @SEARCH_RESULTS	
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CL_CODE,
						[LEVEL],
						CLIENT_NAME,
						REPOSITORY_FILENAME
					)
					SELECT DISTINCT
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CLIENT.CL_CODE AS CL_CODE,
						'CL' AS [LEVEL],
						CLIENT.CL_NAME AS CLIENT_NAME,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM   
						WV_CURRENT_CLIENT_DOCUMENTS
						INNER JOIN CLIENT ON WV_CURRENT_CLIENT_DOCUMENTS.CL_CODE = CLIENT.CL_CODE
						INNER JOIN SEC_CLIENT ON WV_CURRENT_CLIENT_DOCUMENTS.CL_CODE = SEC_CLIENT.CL_CODE
					WHERE  
						(
							CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						)
						AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END;
				IF @IsBlockedFromDivisionLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'DI')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CL_CODE,
						DIV_CODE,
						[LEVEL],
						CLIENT_NAME,
						DIVISION_NAME,
						REPOSITORY_FILENAME
					)
					SELECT DISTINCT
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CLIENT.CL_CODE AS CL_CODE,
						DIVISION.DIV_CODE AS DIV_CODE,
						'DI' AS [LEVEL],
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM   
						WV_CURRENT_DIVISION_DOCUMENTS
						INNER JOIN DIVISION ON DIVISION.DIV_CODE = WV_CURRENT_DIVISION_DOCUMENTS.DIV_CODE AND WV_CURRENT_DIVISION_DOCUMENTS.CL_CODE = DIVISION.CL_CODE
						INNER JOIN CLIENT ON CLIENT.CL_CODE = DIVISION.CL_CODE
						INNER JOIN SEC_CLIENT ON WV_CURRENT_DIVISION_DOCUMENTS.CL_CODE = SEC_CLIENT.CL_CODE AND WV_CURRENT_DIVISION_DOCUMENTS.DIV_CODE = SEC_CLIENT.DIV_CODE
					WHERE  (
							   CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							   OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							   OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							   OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							   OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							   OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							   OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							   OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						   )
						   AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						   AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END;
				IF @IsBlockedFromProductLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'PR')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						[LEVEL],
						OFFICE_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME
					)
					SELECT DISTINCT
						WV_CURRENT_PRODUCT_DOCUMENTS.DOCUMENT_ID,
						WV_CURRENT_PRODUCT_DOCUMENTS.[FILENAME],
						WV_CURRENT_PRODUCT_DOCUMENTS.[DESCRIPTION],
						WV_CURRENT_PRODUCT_DOCUMENTS.KEYWORDS,
						WV_CURRENT_PRODUCT_DOCUMENTS.FILE_SIZE,
						WV_CURRENT_PRODUCT_DOCUMENTS.UPLOADED_DATE,
						WV_CURRENT_PRODUCT_DOCUMENTS.MIME_TYPE,
						WV_CURRENT_PRODUCT_DOCUMENTS.USER_CODE,
						OFFICE.OFFICE_CODE,
						CLIENT.CL_CODE,
						DIVISION.DIV_CODE,
						PRODUCT.PRD_CODE,
						'PR' AS [LEVEL],
						OFFICE.OFFICE_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						WV_CURRENT_PRODUCT_DOCUMENTS.REPOSITORY_FILENAME
					FROM   
						WV_CURRENT_PRODUCT_DOCUMENTS
						INNER JOIN CLIENT ON WV_CURRENT_PRODUCT_DOCUMENTS.CL_CODE = CLIENT.CL_CODE
						INNER JOIN DIVISION ON WV_CURRENT_PRODUCT_DOCUMENTS.DIV_CODE = DIVISION.DIV_CODE AND WV_CURRENT_PRODUCT_DOCUMENTS.CL_CODE = DIVISION.CL_CODE
						INNER JOIN PRODUCT
						INNER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
						ON WV_CURRENT_PRODUCT_DOCUMENTS.CL_CODE = PRODUCT.CL_CODE AND WV_CURRENT_PRODUCT_DOCUMENTS.DIV_CODE = PRODUCT.DIV_CODE AND WV_CURRENT_PRODUCT_DOCUMENTS.PRD_CODE = PRODUCT.PRD_CODE
						INNER JOIN SEC_CLIENT ON PRODUCT.CL_CODE = SEC_CLIENT.CL_CODE AND PRODUCT.DIV_CODE = SEC_CLIENT.DIV_CODE AND PRODUCT.PRD_CODE = SEC_CLIENT.PRD_CODE
					WHERE  
						(
							CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(WV_CURRENT_PRODUCT_DOCUMENTS.KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(WV_CURRENT_PRODUCT_DOCUMENTS.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(WV_CURRENT_PRODUCT_DOCUMENTS.[FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(WV_CURRENT_PRODUCT_DOCUMENTS.USER_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						)
						AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END
				IF @IsBlockedFromCampaignLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'CM')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CMP_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						[LEVEL],
						OFFICE_NAME,
						CAMPAIGN_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME
					)
					SELECT DISTINCT
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CAMPAIGN.CMP_CODE AS CMP_CODE,
						OFFICE.OFFICE_CODE,
						CAMPAIGN.CL_CODE AS CL_CODE,
						CAMPAIGN.DIV_CODE AS DIV_CODE,
						CAMPAIGN.PRD_CODE AS PRD_CODE,
						'CM' AS [LEVEL],
						OFFICE.OFFICE_NAME,
						CAMPAIGN.CMP_NAME AS CAMPAIGN_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM   
						WV_CURRENT_CAMPAIGN_DOCUMENTS
						INNER JOIN CAMPAIGN ON WV_CURRENT_CAMPAIGN_DOCUMENTS.CMP_IDENTIFIER = CAMPAIGN.CMP_IDENTIFIER
						LEFT OUTER JOIN CLIENT ON CAMPAIGN.CL_CODE = CLIENT.CL_CODE
						LEFT OUTER JOIN DIVISION ON CAMPAIGN.CL_CODE = DIVISION.CL_CODE AND CAMPAIGN.DIV_CODE = DIVISION.DIV_CODE
						LEFT OUTER JOIN PRODUCT ON CAMPAIGN.CL_CODE = PRODUCT.CL_CODE AND CAMPAIGN.DIV_CODE = PRODUCT.DIV_CODE AND CAMPAIGN.PRD_CODE = PRODUCT.PRD_CODE
						LEFT OUTER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
						LEFT OUTER JOIN MEDIA_ORDER_HEADER MOH ON CAMPAIGN.CMP_IDENTIFIER = MOH.CMP_IDENTIFIER
						INNER JOIN SEC_CLIENT ON PRODUCT.CL_CODE = SEC_CLIENT.CL_CODE AND PRODUCT.DIV_CODE = SEC_CLIENT.DIV_CODE AND PRODUCT.PRD_CODE = SEC_CLIENT.PRD_CODE
					WHERE  
						(
							CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR UPPER(CAMPAIGN.CMP_NAME) LIKE '%' + @SEARCH_TEXT + '%'
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 12)) AND UPPER(MOH.ORDER_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 12)) AND UPPER(CAST(MOH.ORDER_COMMENT AS VARCHAR)) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						)
						AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END
				IF @IsBlockedFromJobLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'JO')
				BEGIN
					SELECT @JOB_NUMBER = JOB_NUMBER FROM [dbo].[advtf_get_job_component_from_string] (@SEARCH_TEXT);
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CMP_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						JOB_NUMBER,
						[LEVEL],
						OFFICE_NAME,
						CAMPAIGN_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						JOB_DESCRIPTION,
						REPOSITORY_FILENAME
					)
					SELECT DISTINCT
						JD.DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CAMPAIGN.CMP_CODE AS CMP_CODE,
						OFFICE.OFFICE_CODE AS OFFICE_CODE,
						CLIENT.CL_CODE AS CL_CODE,
						DIVISION.DIV_CODE AS DIV_CODE,
						PRODUCT.PRD_CODE AS PRD_CODE,
						JOB_LOG.JOB_NUMBER AS JOB_NUMBER,
						'JO' AS [LEVEL],
						OFFICE_NAME AS OFFICE_NAME,
						CAMPAIGN.CMP_NAME AS CAMPAIGN_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						JOB_LOG.JOB_DESC AS JOB_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM  
						JOB_DOCUMENTS JD
						INNER JOIN DOCUMENTS D ON JD.DOCUMENT_ID = D.DOCUMENT_ID
						INNER JOIN DIVISION
						INNER JOIN PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE
						INNER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
						INNER JOIN JOB_LOG ON PRODUCT.CL_CODE = JOB_LOG.CL_CODE AND PRODUCT.DIV_CODE = JOB_LOG.DIV_CODE AND PRODUCT.PRD_CODE = JOB_LOG.PRD_CODE ON JD.JOB_NUMBER = JOB_LOG.JOB_NUMBER
						INNER JOIN CLIENT ON DIVISION.CL_CODE = CLIENT.CL_CODE
						INNER JOIN SEC_CLIENT ON PRODUCT.CL_CODE = SEC_CLIENT.CL_CODE AND PRODUCT.DIV_CODE = SEC_CLIENT.DIV_CODE AND PRODUCT.PRD_CODE = SEC_CLIENT.PRD_CODE
						LEFT OUTER JOIN CAMPAIGN ON JOB_LOG.CMP_IDENTIFIER = CAMPAIGN.CMP_IDENTIFIER
					WHERE  (
								CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(JOB_LOG.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN ISNUMERIC(@SEARCH_TEXT) = 1 AND JD.JOB_NUMBER = CAST(@SEARCH_TEXT AS INT) THEN 1 ELSE 0 END = 1
								OR CASE WHEN @JOB_NUMBER > 0 AND JD.JOB_NUMBER = @JOB_NUMBER THEN 1 ELSE 0 END = 1
						   )
						   AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						   AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END
				IF @IsBlockedFromJobComponentLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'JC')
				BEGIN
					SELECT @JOB_NUMBER = JOB_NUMBER, @JOB_COMPONENT_NBR = JOB_COMPONENT_NBR FROM [dbo].[advtf_get_job_component_from_string] (@SEARCH_TEXT);
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CMP_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						JOB_NUMBER,
						JOB_COMPONENT_NBR,
						[LEVEL],
						OFFICE_NAME,
						CAMPAIGN_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						JOB_DESCRIPTION,
						JOB_COMP_DESCRIPTION,
						REPOSITORY_FILENAME
					)
					SELECT
						JCD.DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						JOB_LOG.CMP_CODE AS CMP_CODE,
						JOB_LOG.OFFICE_CODE AS OFFICE_CODE,
						JOB_LOG.CL_CODE AS CL_CODE,
						JOB_LOG.DIV_CODE AS DIV_CODE,
						JOB_LOG.PRD_CODE AS PRD_CODE,
						JOB_COMPONENT.JOB_NUMBER AS JOB_NUMBER,
						JOB_COMPONENT.JOB_COMPONENT_NBR AS JOB_COMPONENT_NBR,
						'JC' AS [LEVEL],
						OFFICE_NAME AS OFFICE_NAME,
						CAMPAIGN.CMP_NAME AS CAMPAIGN_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						JOB_LOG.JOB_DESC AS JOB_DESCRIPTION,
						JOB_COMPONENT.JOB_COMP_DESC AS JOB_COMP_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM   
						JOB_COMPONENT_DOCUMENTS JCD
						INNER JOIN DOCUMENTS D ON D.DOCUMENT_ID = JCD.DOCUMENT_ID
						INNER JOIN JOB_COMPONENT ON JOB_COMPONENT.JOB_NUMBER = JCD.JOB_NUMBER AND JOB_COMPONENT.JOB_COMPONENT_NBR = JCD.JOB_COMPONENT_NUMBER
						INNER JOIN JOB_LOG ON JOB_LOG.JOB_NUMBER = JCD.JOB_NUMBER
						INNER JOIN PRODUCT ON PRODUCT.CL_CODE = JOB_LOG.CL_CODE AND PRODUCT.DIV_CODE = JOB_LOG.DIV_CODE AND PRODUCT.PRD_CODE = JOB_LOG.PRD_CODE
						INNER JOIN DIVISION ON DIVISION.CL_CODE = JOB_LOG.CL_CODE AND DIVISION.DIV_CODE = JOB_LOG.DIV_CODE
						INNER JOIN CLIENT ON CLIENT.CL_CODE = JOB_LOG.CL_CODE
						INNER JOIN OFFICE ON OFFICE.OFFICE_CODE = JOB_LOG.OFFICE_CODE
						INNER JOIN SEC_CLIENT ON PRODUCT.CL_CODE = SEC_CLIENT.CL_CODE AND PRODUCT.DIV_CODE = SEC_CLIENT.DIV_CODE AND PRODUCT.PRD_CODE = SEC_CLIENT.PRD_CODE
						LEFT OUTER JOIN CAMPAIGN ON CAMPAIGN.CMP_IDENTIFIER = JOB_LOG.CMP_IDENTIFIER
					WHERE  (
								CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(JOB_LOG.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10, 11)) AND UPPER(JOB_COMPONENT.JOB_COMP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
								OR CASE WHEN @JOB_NUMBER > 0 AND @JOB_COMPONENT_NBR = 0 AND JCD.JOB_NUMBER = @JOB_NUMBER THEN 1 ELSE 0 END = 1
								OR CASE WHEN @JOB_NUMBER > 0 AND @JOB_COMPONENT_NBR > 0 AND JCD.JOB_NUMBER = @JOB_NUMBER AND JCD.JOB_COMPONENT_NUMBER = @JOB_COMPONENT_NBR THEN 1 ELSE 0 END = 1
						   )
						   AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						   AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
					--	PROJECT SCHEDULE TASK DOCS
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						REPOSITORY_FILENAME,
						[LEVEL],
						JOB_NUMBER,
						JOB_COMPONENT_NBR,
						FNC_CODE,
						FNC_DESC
					)
					SELECT DISTINCT
						PSTDA.DOCUMENT_ID, 
						PSTDA.[FILENAME], 
						PSTDA.[DESCRIPTION], 
						PSTDA.KEYWORDS, 
						PSTDA.FILE_SIZE, 
						PSTDA.UPLOADED_DATE, 
						PSTDA.MIME_TYPE,
						PSTDA.USER_CODE,
						PSTDA.REPOSITORY_FILENAME,
						'PST', 
						PSTDA.JOB_NUMBER, 
						PSTDA.JOB_COMPONENT_NBR,
						TF.TRF_CODE,
						TF.TRF_DESC
					FROM 
						PROJECT_SCHEDULE_TASK_DOCUMENTS_ALL PSTDA
						INNER JOIN JOB_TRAFFIC_DET JTD ON JTD.JOB_NUMBER = PSTDA.JOB_NUMBER AND JTD.JOB_COMPONENT_NBR = PSTDA.JOB_COMPONENT_NBR AND JTD.SEQ_NBR = PSTDA.SEQ_NBR
						LEFT OUTER JOIN TRAFFIC_FNC TF ON JTD.FNC_CODE = TF.TRF_CODE
						LEFT OUTER JOIN FUNCTIONS F ON TF.FNC_CODE = F.FNC_CODE
						INNER JOIN JOB_COMPONENT ON JOB_COMPONENT.JOB_NUMBER = PSTDA.JOB_NUMBER AND JOB_COMPONENT.JOB_COMPONENT_NBR = PSTDA.JOB_COMPONENT_NBR
						INNER JOIN JOB_LOG JL ON JL.JOB_NUMBER = JOB_COMPONENT.JOB_NUMBER
						INNER JOIN PRODUCT ON PRODUCT.CL_CODE = JL.CL_CODE AND PRODUCT.DIV_CODE = JL.DIV_CODE AND PRODUCT.PRD_CODE = JL.PRD_CODE
						INNER JOIN DIVISION ON DIVISION.CL_CODE = JL.CL_CODE AND DIVISION.DIV_CODE = JL.DIV_CODE
						INNER JOIN CLIENT ON CLIENT.CL_CODE = JL.CL_CODE
						INNER JOIN OFFICE ON OFFICE.OFFICE_CODE = JL.OFFICE_CODE
						INNER JOIN SEC_CLIENT ON PRODUCT.CL_CODE = SEC_CLIENT.CL_CODE AND PRODUCT.DIV_CODE = SEC_CLIENT.DIV_CODE AND PRODUCT.PRD_CODE = SEC_CLIENT.PRD_CODE
					WHERE
						(
							CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(JL.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10, 11)) AND UPPER(JOB_COMPONENT.JOB_COMP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @JOB_NUMBER > 0 AND @JOB_COMPONENT_NBR = 0 AND PSTDA.JOB_NUMBER = @JOB_NUMBER THEN 1 ELSE 0 END = 1
							OR CASE WHEN @JOB_NUMBER > 0 AND @JOB_COMPONENT_NBR > 0 AND PSTDA.JOB_NUMBER = @JOB_NUMBER AND PSTDA.JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR THEN 1 ELSE 0 END = 1
						)
						AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END
				IF @IsBlockedFromAPLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'VN')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						--OFFICE_CODE,
						--CL_CODE,
						--DIV_CODE,
						--PRD_CODE,
						--JOB_NUMBER,
						--JOB_COMPONENT_NBR,
						[LEVEL],
						--OFFICE_NAME,
						--CLIENT_NAME,
						--DIVISION_NAME,
						--PRODUCT_DESCRIPTION,
						--JOB_DESCRIPTION,
						--JOB_COMP_DESCRIPTION,
						REPOSITORY_FILENAME,
						VENDOR_CODE,
						AP_INVOICE,
						VENDOR_NAME,
						AP_INVOICE_DESC,
						AP_ID
					)
					SELECT DISTINCT 
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						--OFFICE.OFFICE_CODE AS OFFICE_CODE,
						--CLIENT.CL_CODE AS CL_CODE,
						--DIVISION.DIV_CODE AS DIV_CODE,
						--PRODUCT.PRD_CODE AS PRD_CODE,
						--JOB_LOG.JOB_NUMBER AS JOB_NUMBER,
						--JOB_COMPONENT.JOB_COMPONENT_NBR AS JOB_COMPONENT_NBR,
						'VN' AS [LEVEL],
						--OFFICE.OFFICE_NAME AS OFFICE_NAME,
						--CLIENT.CL_NAME AS CLIENT_NAME,
						--DIVISION.DIV_NAME AS DIVISION_NAME,
						--PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						--JOB_LOG.JOB_DESC AS JOB_DESCRIPTION,
						--JOB_COMPONENT.JOB_COMP_DESC AS JOB_COMP_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME,
						AP_HEADER.VN_FRL_EMP_CODE AS VENDOR_CODE,
						AP_HEADER.AP_INV_VCHR AS AP_INVOICE,
						VENDOR.VN_NAME AS VENDOR_NAME,
						AP_HEADER.AP_DESC AS AP_INVOICE_DESC,
						AP_HEADER.AP_ID
					FROM   
						WV_CURRENT_AP_DOCUMENTS
						INNER JOIN AP_HEADER ON AP_HEADER.AP_ID = WV_CURRENT_AP_DOCUMENTS.AP_ID
						LEFT OUTER JOIN AP_PRODUCTION ON AP_PRODUCTION.AP_ID = WV_CURRENT_AP_DOCUMENTS.AP_ID
						LEFT OUTER JOIN JOB_COMPONENT ON JOB_COMPONENT.JOB_NUMBER = AP_PRODUCTION.JOB_NUMBER AND JOB_COMPONENT.JOB_COMPONENT_NBR = AP_PRODUCTION.JOB_COMPONENT_NBR
						LEFT OUTER JOIN JOB_LOG ON JOB_LOG.JOB_NUMBER = AP_PRODUCTION.JOB_NUMBER
						INNER JOIN SEC_CLIENT ON JOB_LOG.CL_CODE = SEC_CLIENT.CL_CODE AND JOB_LOG.DIV_CODE = SEC_CLIENT.DIV_CODE AND JOB_LOG.PRD_CODE = SEC_CLIENT.PRD_CODE
						INNER JOIN VENDOR ON AP_HEADER.VN_FRL_EMP_CODE = VENDOR.VN_CODE
						LEFT OUTER JOIN CLIENT ON JOB_LOG.CL_CODE = CLIENT.CL_CODE
						LEFT OUTER JOIN DIVISION ON JOB_LOG.DIV_CODE = DIVISION.DIV_CODE
						LEFT OUTER JOIN PRODUCT ON JOB_LOG.PRD_CODE = PRODUCT.PRD_CODE
						LEFT OUTER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
					WHERE  
						(
							CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(AP_HEADER.VN_FRL_EMP_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(AP_HEADER.AP_INV_VCHR) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 12) AND UPPER(VENDOR.VN_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 12) AND UPPER(VENDOR.VN_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(AP_HEADER.AP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						)
						AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END
				IF @IsBlockedFromAdNumberLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'AN')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CL_CODE,
						[LEVEL],
						CLIENT_NAME,
						REPOSITORY_FILENAME,
						AD_NBR,
						AD_NBR_DESC
					)
					SELECT DISTINCT
						DOCUMENTS.DOCUMENT_ID,
						DOCUMENTS.[FILENAME],
						DOCUMENTS.[DESCRIPTION],
						DOCUMENTS.KEYWORDS,
						DOCUMENTS.FILE_SIZE,
						DOCUMENTS.UPLOADED_DATE,
						DOCUMENTS.MIME_TYPE,
						DOCUMENTS.USER_CODE,
						AD_NUMBER.CL_CODE AS CL_CODE,
						'AN' AS [LEVEL],
						CLIENT.CL_NAME AS CLIENT_NAME,
						DOCUMENTS.REPOSITORY_FILENAME AS REPOSITORY_FILENAME,
						AD_NUMBER.AD_NBR,
						AD_NUMBER.AD_NBR_DESC
					FROM   
						DOCUMENTS
						INNER JOIN AD_NUMBER ON DOCUMENTS.DOCUMENT_ID = AD_NUMBER.DOCUMENT_ID
						LEFT OUTER JOIN CLIENT ON AD_NUMBER.CL_CODE = CLIENT.CL_CODE
						LEFT OUTER JOIN JOB_COMPONENT ON JOB_COMPONENT.AD_NBR = AD_NUMBER.AD_NBR
						LEFT OUTER JOIN JOB_LOG ON JOB_COMPONENT.JOB_NUMBER = JOB_LOG.JOB_NUMBER
						LEFT OUTER JOIN OFFICE ON JOB_LOG.OFFICE_CODE = OFFICE.OFFICE_CODE
						INNER JOIN SEC_CLIENT ON AD_NUMBER.CL_CODE = SEC_CLIENT.CL_CODE
					WHERE  
						(
							CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(DOCUMENTS.KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(DOCUMENTS.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(DOCUMENTS.[FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR UPPER(AD_NUMBER.AD_NBR_DESC) LIKE '%' + @SEARCH_TEXT + '%'
							OR UPPER(AD_NUMBER.AD_NBR) LIKE '%' + @SEARCH_TEXT + '%'
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(JOB_LOG.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10, 11)) AND UPPER(JOB_COMPONENT.JOB_COMP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(DOCUMENTS.USER_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						)
						AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END
				IF @IsBlockedFromExpenseReportLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'EXDTL')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						JOB_NUMBER,
						JOB_COMPONENT_NBR,
						[LEVEL],
						OFFICE_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						JOB_DESCRIPTION,
						REPOSITORY_FILENAME,
						EMP_CODE,
						AP_ID,
						EMP_FML,
						EXPENSE_HEADER_DESC
					)
					SELECT DISTINCT 
						DOCUMENTS.DOCUMENT_ID,
						DOCUMENTS.[FILENAME],
						DOCUMENTS.[DESCRIPTION],
						DOCUMENTS.KEYWORDS,
						DOCUMENTS.FILE_SIZE,
						DOCUMENTS.UPLOADED_DATE,
						DOCUMENTS.MIME_TYPE,
						DOCUMENTS.USER_CODE,
						OFFICE.OFFICE_CODE,
						EXPENSE_DETAIL.CL_CODE,
						EXPENSE_DETAIL.DIV_CODE,
						EXPENSE_DETAIL.PRD_CODE,
						EXPENSE_DETAIL.JOB_NBR,
						EXPENSE_DETAIL.JOB_COMP_NBR,
						'EXDTL',
						OFFICE.OFFICE_NAME,
						CLIENT.CL_NAME,
						DIVISION.DIV_NAME,
						PRODUCT.PRD_DESCRIPTION,
						JOB_LOG.JOB_DESC,
						DOCUMENTS.REPOSITORY_FILENAME,
						EXPENSE_HEADER.EMP_CODE,
						EXPENSE_DETAIL.INV_NBR,
						ISNULL(E.EMP_FNAME + ' ','') + ISNULL(E.EMP_MI + '. ', '') + ISNULL(E.EMP_LNAME, ''),
						EXPENSE_HEADER.EXP_DESC
					FROM   
						DOCUMENTS
						INNER JOIN EXPENSE_DETAIL_DOCS ON DOCUMENTS.DOCUMENT_ID = EXPENSE_DETAIL_DOCS.DOCUMENT_ID
						INNER JOIN EXPENSE_DETAIL ON EXPENSE_DETAIL.EXPDETAILID = EXPENSE_DETAIL_DOCS.EXPDETAILID
						INNER JOIN EXPENSE_HEADER ON EXPENSE_HEADER.INV_NBR = EXPENSE_DETAIL.INV_NBR
						INNER JOIN EMPLOYEE E ON EXPENSE_HEADER.EMP_CODE = E.EMP_CODE
						LEFT OUTER JOIN CLIENT ON CLIENT.CL_CODE = EXPENSE_DETAIL.CL_CODE
						LEFT OUTER JOIN DIVISION ON DIVISION.DIV_CODE = EXPENSE_DETAIL.DIV_CODE
						LEFT OUTER JOIN PRODUCT ON PRODUCT.PRD_CODE = EXPENSE_DETAIL.PRD_CODE
						LEFT OUTER JOIN OFFICE ON OFFICE.OFFICE_CODE = PRODUCT.OFFICE_CODE
						LEFT OUTER JOIN JOB_LOG ON JOB_LOG.JOB_NUMBER = EXPENSE_DETAIL.JOB_NBR
						LEFT OUTER JOIN JOB_COMPONENT ON JOB_COMPONENT.JOB_NUMBER = EXPENSE_DETAIL.JOB_NBR AND JOB_COMPONENT.JOB_COMPONENT_NBR = EXPENSE_DETAIL.JOB_COMP_NBR
						LEFT OUTER JOIN FUNCTIONS F ON EXPENSE_DETAIL.FNC_CODE = F.FNC_CODE
						INNER JOIN SEC_CLIENT ON EXPENSE_DETAIL.CL_CODE = SEC_CLIENT.CL_CODE AND EXPENSE_DETAIL.DIV_CODE = SEC_CLIENT.DIV_CODE AND EXPENSE_DETAIL.PRD_CODE = SEC_CLIENT.PRD_CODE
					WHERE
						(
							CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1 
							OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(JOB_LOG.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10, 11)) AND UPPER(JOB_COMPONENT.JOB_COMP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR UPPER(EXPENSE_HEADER.EXP_DESC) LIKE '%' + @SEARCH_TEXT + '%'
							OR UPPER(E.EMP_CODE) LIKE '%' + @SEARCH_TEXT + '%'
							OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 6) AND UPPER(E.EMP_FNAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 6) AND UPPER(E.EMP_MI) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 6) AND UPPER(E.EMP_LNAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 9) AND UPPER(F.FNC_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 9) AND UPPER(F.FNC_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						)
						AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END 
				IF @IsBlockedFromContractLevel = 0 AND (@LEVEL = '' OR @LEVEL = 'CT')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						[LEVEL],
						OFFICE_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME,
						CONTRACT_ID,
						CONTRACT_CODE,
						CONTRACT_DESC
					)
					SELECT DISTINCT
						DOCUMENT_ID,
						[FILENAME],
						CONTRACT_DOCUMENTS_ALL.[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE.OFFICE_CODE,
						CLIENT.CL_CODE,
						DIVISION.DIV_CODE,
						PRODUCT.PRD_CODE,
						'CT' AS [LEVEL],
						OFFICE.OFFICE_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME,
						CT.CONTRACT_ID,
						CT.CONTRACT_CODE,
						CT.[DESCRIPTION]
					FROM   
						CONTRACT_DOCUMENTS_ALL
						INNER JOIN CONTRACT CT ON CT.CONTRACT_ID = CONTRACT_DOCUMENTS_ALL.CONTRACT_ID
						INNER JOIN CLIENT ON CLIENT.CL_CODE = CT.CL_CODE
						LEFT OUTER JOIN DIVISION ON CT.CL_CODE = DIVISION.CL_CODE AND CT.DIV_CODE = DIVISION.DIV_CODE
						LEFT OUTER JOIN PRODUCT ON PRODUCT.CL_CODE = CT.CL_CODE AND PRODUCT.DIV_CODE = CT.DIV_CODE AND PRODUCT.PRD_CODE = CT.PRD_CODE
						INNER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
						INNER JOIN SEC_CLIENT ON CT.CL_CODE = SEC_CLIENT.CL_CODE
					WHERE
						( 
							CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(CONTRACT_DOCUMENTS_ALL.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						)
						AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END
				IF @IsBlockedFromContractReportLevel = 0 AND (@LEVEL = '' OR @LEVEL = 'ContractReport')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						[LEVEL],
						OFFICE_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME,
						CONTRACT_ID,
						CONTRACT_CODE,
						CONTRACT_DESC,
						CONTRACT_REPORT_DESC
					)
					SELECT DISTINCT
						DOCUMENT_ID,
						[FILENAME],
						CONTRACT_REPORT_DOCUMENTS_ALL.[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE.OFFICE_CODE,
						CLIENT.CL_CODE,
						DIVISION.DIV_CODE,
						PRODUCT.PRD_CODE,
						'CTR' AS [LEVEL],
						OFFICE.OFFICE_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME,
						CT.CONTRACT_ID,
						CT.CONTRACT_CODE,
						CT.[DESCRIPTION],
						CR.[DESCRIPTION]
					FROM   
						CONTRACT_REPORT_DOCUMENTS_ALL
						INNER JOIN CONTRACT_REPORT CR ON CR.CONTRACT_REPORT_ID = CONTRACT_REPORT_DOCUMENTS_ALL.CONTRACT_REPORT_ID
						INNER JOIN CONTRACT CT ON CT.CONTRACT_ID = CR.CONTRACT_ID
						INNER JOIN CLIENT ON CLIENT.CL_CODE = CT.CL_CODE
						LEFT OUTER JOIN DIVISION ON CT.CL_CODE = DIVISION.CL_CODE AND CT.DIV_CODE = DIVISION.DIV_CODE
						LEFT OUTER JOIN PRODUCT ON PRODUCT.CL_CODE = CT.CL_CODE AND PRODUCT.DIV_CODE = CT.DIV_CODE AND PRODUCT.PRD_CODE = CT.PRD_CODE
						INNER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
						INNER JOIN SEC_CLIENT ON CT.CL_CODE = SEC_CLIENT.CL_CODE
					WHERE  
						(
							CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(CONTRACT_REPORT_DOCUMENTS_ALL.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(CR.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 5)) AND UPPER(CT.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						)
						AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END
				IF @IsBlockedFromARInvoiceLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'AR')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CMP_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						JOB_NUMBER,
						JOB_COMPONENT_NBR,
						[LEVEL],
						OFFICE_NAME,
						CAMPAIGN_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						JOB_DESCRIPTION,
						JOB_COMP_DESCRIPTION,
						REPOSITORY_FILENAME
					)
					SELECT DISTINCT
						AIDA.DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						JOB_LOG.CMP_CODE AS CMP_CODE,
						JOB_LOG.OFFICE_CODE AS OFFICE_CODE,
						JOB_LOG.CL_CODE AS CL_CODE,
						JOB_LOG.DIV_CODE AS DIV_CODE,
						JOB_LOG.PRD_CODE AS PRD_CODE,
						JOB_COMPONENT.JOB_NUMBER AS JOB_NUMBER,
						JOB_COMPONENT.JOB_COMPONENT_NBR AS JOB_COMPONENT_NBR,
						'AR' AS [LEVEL],
						OFFICE_NAME AS OFFICE_NAME,
						CAMPAIGN.CMP_NAME AS CAMPAIGN_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						JOB_LOG.JOB_DESC AS JOB_DESCRIPTION,
						JOB_COMPONENT.JOB_COMP_DESC AS JOB_COMP_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM   
						AR_INVOICE_DOCUMENTS_ALL AIDA
						LEFT OUTER JOIN JOB_LOG ON JOB_LOG.JOB_NUMBER = AIDA.JOB_NUMBER
						LEFT OUTER JOIN JOB_COMPONENT ON JOB_COMPONENT.JOB_NUMBER = AIDA.JOB_NUMBER AND JOB_COMPONENT.JOB_COMPONENT_NBR = AIDA.JOB_COMPONENT_NBR
						INNER JOIN PRODUCT ON PRODUCT.CL_CODE = JOB_LOG.CL_CODE AND PRODUCT.DIV_CODE = JOB_LOG.DIV_CODE AND PRODUCT.PRD_CODE = JOB_LOG.PRD_CODE
						INNER JOIN DIVISION ON DIVISION.CL_CODE = JOB_LOG.CL_CODE AND DIVISION.DIV_CODE = JOB_LOG.DIV_CODE
						INNER JOIN CLIENT ON CLIENT.CL_CODE = JOB_LOG.CL_CODE
						INNER JOIN OFFICE ON OFFICE.OFFICE_CODE = JOB_LOG.OFFICE_CODE
						LEFT OUTER JOIN CAMPAIGN ON CAMPAIGN.CMP_IDENTIFIER = JOB_LOG.CMP_IDENTIFIER
						LEFT OUTER JOIN MEDIA_ORDER_HEADER MOH ON MOH.CL_CODE = CLIENT.CL_CODE AND MOH.DIV_CODE = DIVISION.DIV_CODE AND MOH.PRD_CODE = PRODUCT.PRD_CODE
						INNER JOIN SEC_CLIENT ON JOB_LOG.CL_CODE = SEC_CLIENT.CL_CODE AND JOB_LOG.DIV_CODE = SEC_CLIENT.DIV_CODE AND JOB_LOG.PRD_CODE = SEC_CLIENT.PRD_CODE
					WHERE 
						(
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(JOB_LOG.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10, 11)) AND UPPER(JOB_COMPONENT.JOB_COMP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(MOH.ORDER_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						)
						AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END
				IF @IsBlockedFromVendorLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'VC')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						[LEVEL],
						OFFICE_NAME,
						REPOSITORY_FILENAME,
						VENDOR_CODE,
						VENDOR_NAME
					)
					SELECT 
						DOCUMENT_ID,
						[FILENAME],
						VCDA.[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE.OFFICE_CODE AS OFFICE_CODE,
						'VC' AS [LEVEL],
						OFFICE.OFFICE_NAME AS OFFICE_NAME,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME,
						V.VN_CODE AS VENDOR_CODE,
						V.VN_NAME AS VENDOR_NAME
					FROM   
						VENDOR_CONTRACT_DOCUMENTS_ALL VCDA
						INNER JOIN VENDOR_CONTRACT VC ON VCDA.VENDOR_CONTRACT_ID = VC.VENDOR_CONTRACT_ID
						INNER JOIN VENDOR V ON VC.VN_CODE = V.VN_CODE
						LEFT OUTER JOIN OFFICE ON OFFICE.OFFICE_CODE = V.OFFICE_CODE
						--INNER JOIN SEC_CLIENT ON MOH.CL_CODE = SEC_CLIENT.CL_CODE AND MOH.DIV_CODE = SEC_CLIENT.DIV_CODE AND MOH.PRD_CODE = SEC_CLIENT.PRD_CODE
					WHERE  
						(
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(VCDA.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR UPPER(VC.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%'
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 15)) AND UPPER(V.VN_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 15)) AND UPPER(V.VN_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						)
						--AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						--AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END;
				IF @IsBlockedFromAlertLevel = 0 AND(@LEVEL = '' OR @LEVEL = 'ALRT') AND @INCLUDE_ATTACHMENTS = 1
				BEGIN
					SELECT @JOB_NUMBER = JOB_NUMBER, @JOB_COMPONENT_NBR = JOB_COMPONENT_NBR FROM [dbo].[advtf_get_job_component_from_string] (@SEARCH_TEXT);
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						REPOSITORY_FILENAME,
						USER_CODE,
						[LEVEL],
						OFFICE_CODE,
						OFFICE_NAME,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						JOB_NUMBER,
						JOB_DESCRIPTION,
						JOB_COMPONENT_NBR,
						JOB_COMP_DESCRIPTION,
						ALERT_SUBJECT,
						CMP_CODE,
						CAMPAIGN_NAME
					)
					SELECT 
						D.DOCUMENT_ID,
						D.[FILENAME],
						D.[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						REPOSITORY_FILENAME,
						D.USER_CODE,
						'ALRT',
						OFFICE.OFFICE_CODE,
						OFFICE.OFFICE_NAME,
						CLIENT.CL_CODE,
						DIVISION.DIV_CODE,
						PRODUCT.PRD_CODE,
						CLIENT.CL_NAME,
						DIVISION.DIV_NAME,
						PRODUCT.PRD_DESCRIPTION,
						J.JOB_NUMBER,
						J.JOB_DESC,
						JC.JOB_COMPONENT_NBR,
						JC.JOB_COMP_DESC,
						A.[SUBJECT],
						C.CMP_CODE,
						C.CMP_NAME
					FROM
						DOCUMENTS D
						INNER JOIN ALERT_ATTACHMENT AA ON D.DOCUMENT_ID = AA.DOCUMENT_ID
						INNER JOIN ALERT A ON A.ALERT_ID = AA.ALERT_ID
						LEFT OUTER JOIN CLIENT ON A.CL_CODE = CLIENT.CL_CODE
						LEFT OUTER JOIN DIVISION ON A.DIV_CODE = DIVISION.DIV_CODE AND A.CL_CODE = DIVISION.CL_CODE
						LEFT OUTER JOIN PRODUCT ON A.CL_CODE = PRODUCT.CL_CODE AND A.DIV_CODE = PRODUCT.DIV_CODE AND A.PRD_CODE = PRODUCT.PRD_CODE
						LEFT OUTER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
						LEFT OUTER JOIN JOB_LOG J ON J.JOB_NUMBER = A.JOB_NUMBER
						LEFT OUTER JOIN JOB_COMPONENT JC ON JC.JOB_NUMBER = A.JOB_NUMBER AND JC.JOB_COMPONENT_NBR = A.JOB_COMPONENT_NBR
						LEFT OUTER JOIN CAMPAIGN C ON C.CMP_IDENTIFIER = A.CMP_IDENTIFIER
						INNER JOIN SEC_CLIENT ON A.CL_CODE = SEC_CLIENT.CL_CODE AND A.DIV_CODE = SEC_CLIENT.DIV_CODE AND A.PRD_CODE = SEC_CLIENT.PRD_CODE
					WHERE 
						(
							CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(D.KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(D.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(D.[FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(D.USER_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 16)) AND UPPER(A.[SUBJECT]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 16)) AND UPPER(CAST(A.BODY AS VARCHAR(MAX))) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @JOB_NUMBER > 0 AND @JOB_COMPONENT_NBR = 0 AND J.JOB_NUMBER = @JOB_NUMBER THEN 1 ELSE 0 END = 1
							OR CASE WHEN @JOB_NUMBER > 0 AND @JOB_COMPONENT_NBR > 0 AND JC.JOB_NUMBER = @JOB_NUMBER AND JC.JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR THEN 1 ELSE 0 END = 1
							OR CASE WHEN @JOB_NUMBER = 0 AND (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(J.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN @JOB_NUMBER = 0 AND @JOB_COMPONENT_NBR = 0 AND (@CRITERIA_ENUM_VALUE IN (1, 11)) AND UPPER(JC.JOB_COMP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
							OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 17)) AND UPPER(C.CMP_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						)
						AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@USER_CODE)
						AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				END
			END		
	    END
	    ELSE
	    BEGIN
			IF @OfficeRestrictions > 0
			BEGIN
				IF @IsBlockedFromClientLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'CL')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CL_CODE,
						[LEVEL],
						CLIENT_NAME,
						REPOSITORY_FILENAME
					)
					SELECT DISTINCT
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CLIENT.CL_CODE AS CL_CODE,
						'CL' AS [LEVEL],
						CLIENT.CL_NAME AS CLIENT_NAME,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM   
						WV_CURRENT_CLIENT_DOCUMENTS
						INNER JOIN CLIENT ON CLIENT.CL_CODE = WV_CURRENT_CLIENT_DOCUMENTS.CL_CODE
						INNER JOIN DIVISION ON CLIENT.CL_CODE = DIVISION.CL_CODE 
						INNER JOIN PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE
						INNER JOIN EMP_OFFICE ON PRODUCT.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE  
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END
				IF @IsBlockedFromDivisionLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'DI')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CL_CODE,
						DIV_CODE,
						[LEVEL],
						CLIENT_NAME,
						DIVISION_NAME,
						REPOSITORY_FILENAME
					)
					SELECT 
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CLIENT.CL_CODE AS CL_CODE,
						DIVISION.DIV_CODE AS DIV_CODE,
						'DI' AS [LEVEL],
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM   
						WV_CURRENT_DIVISION_DOCUMENTS
						INNER JOIN DIVISION ON DIVISION.DIV_CODE = WV_CURRENT_DIVISION_DOCUMENTS.DIV_CODE
						INNER JOIN CLIENT ON CLIENT.CL_CODE = DIVISION.CL_CODE
						INNER JOIN PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE
						INNER JOIN EMP_OFFICE ON PRODUCT.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE  
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END
				IF @IsBlockedFromProductLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'PR')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						[LEVEL],
						OFFICE_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME
					)
					SELECT DISTINCT
						WV_CURRENT_PRODUCT_DOCUMENTS.DOCUMENT_ID,
						WV_CURRENT_PRODUCT_DOCUMENTS.[FILENAME],
						WV_CURRENT_PRODUCT_DOCUMENTS.[DESCRIPTION],
						WV_CURRENT_PRODUCT_DOCUMENTS.KEYWORDS,
						WV_CURRENT_PRODUCT_DOCUMENTS.FILE_SIZE,
						WV_CURRENT_PRODUCT_DOCUMENTS.UPLOADED_DATE,
						WV_CURRENT_PRODUCT_DOCUMENTS.MIME_TYPE,
						WV_CURRENT_PRODUCT_DOCUMENTS.USER_CODE,
						OFFICE.OFFICE_CODE,
						CLIENT.CL_CODE,
						DIVISION.DIV_CODE,
						PRODUCT.PRD_CODE,
						'PR' AS [LEVEL],
						OFFICE.OFFICE_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						WV_CURRENT_PRODUCT_DOCUMENTS.REPOSITORY_FILENAME
					FROM   
						WV_CURRENT_PRODUCT_DOCUMENTS
						INNER JOIN CLIENT ON WV_CURRENT_PRODUCT_DOCUMENTS.CL_CODE = CLIENT.CL_CODE
						INNER JOIN DIVISION ON WV_CURRENT_PRODUCT_DOCUMENTS.DIV_CODE = DIVISION.DIV_CODE AND WV_CURRENT_PRODUCT_DOCUMENTS.CL_CODE = DIVISION.CL_CODE
						INNER JOIN PRODUCT
						INNER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
						ON WV_CURRENT_PRODUCT_DOCUMENTS.CL_CODE = PRODUCT.CL_CODE AND WV_CURRENT_PRODUCT_DOCUMENTS.DIV_CODE = PRODUCT.DIV_CODE AND WV_CURRENT_PRODUCT_DOCUMENTS.PRD_CODE = PRODUCT.PRD_CODE
						INNER JOIN EMP_OFFICE ON PRODUCT.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE 
						CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(WV_CURRENT_PRODUCT_DOCUMENTS.KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(WV_CURRENT_PRODUCT_DOCUMENTS.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(WV_CURRENT_PRODUCT_DOCUMENTS.[FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(WV_CURRENT_PRODUCT_DOCUMENTS.USER_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END
				IF @IsBlockedFromCampaignLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'CM')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CMP_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						[LEVEL],
						OFFICE_NAME,
						CAMPAIGN_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME
					)
					SELECT DISTINCT
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CAMPAIGN.CMP_CODE AS CMP_CODE,
						OFFICE.OFFICE_CODE,
						CAMPAIGN.CL_CODE AS CL_CODE,
						CAMPAIGN.DIV_CODE AS DIV_CODE,
						CAMPAIGN.PRD_CODE AS PRD_CODE,
						'CM' AS [LEVEL],
						OFFICE.OFFICE_NAME,
						CAMPAIGN.CMP_NAME AS CAMPAIGN_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM   
						WV_CURRENT_CAMPAIGN_DOCUMENTS
						INNER JOIN CAMPAIGN ON WV_CURRENT_CAMPAIGN_DOCUMENTS.CMP_IDENTIFIER = CAMPAIGN.CMP_IDENTIFIER
						LEFT OUTER JOIN CLIENT ON CAMPAIGN.CL_CODE = CLIENT.CL_CODE
						LEFT OUTER JOIN DIVISION ON CAMPAIGN.CL_CODE = DIVISION.CL_CODE AND CAMPAIGN.DIV_CODE = DIVISION.DIV_CODE
						LEFT OUTER JOIN PRODUCT ON CAMPAIGN.CL_CODE = PRODUCT.CL_CODE AND CAMPAIGN.DIV_CODE = PRODUCT.DIV_CODE AND CAMPAIGN.PRD_CODE = PRODUCT.PRD_CODE
						LEFT OUTER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
						LEFT OUTER JOIN MEDIA_ORDER_HEADER MOH ON CAMPAIGN.CMP_IDENTIFIER = MOH.CMP_IDENTIFIER
						INNER JOIN EMP_OFFICE ON PRODUCT.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE  
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR UPPER(CAMPAIGN.CMP_NAME) LIKE '%' + @SEARCH_TEXT + '%'
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 12)) AND UPPER(MOH.ORDER_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 12)) AND UPPER(CAST(MOH.ORDER_COMMENT AS VARCHAR)) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END
				IF @IsBlockedFromJobLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'JO')
				BEGIN
					SELECT @JOB_NUMBER = JOB_NUMBER FROM [dbo].[advtf_get_job_component_from_string] (@SEARCH_TEXT);
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CMP_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						JOB_NUMBER,
						[LEVEL],
						OFFICE_NAME,
						CAMPAIGN_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						JOB_DESCRIPTION,
						REPOSITORY_FILENAME
					)
					SELECT DISTINCT
						JD.DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CAMPAIGN.CMP_CODE AS CMP_CODE,
						OFFICE.OFFICE_CODE AS OFFICE_CODE,
						CLIENT.CL_CODE AS CL_CODE,
						DIVISION.DIV_CODE AS DIV_CODE,
						PRODUCT.PRD_CODE AS PRD_CODE,
						JOB_LOG.JOB_NUMBER AS JOB_NUMBER,
						'JO' AS [LEVEL],
						OFFICE_NAME AS OFFICE_NAME,
						CAMPAIGN.CMP_NAME AS CAMPAIGN_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						JOB_LOG.JOB_DESC AS JOB_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM  
						JOB_DOCUMENTS JD
						INNER JOIN DOCUMENTS D ON JD.DOCUMENT_ID = D.DOCUMENT_ID
						INNER JOIN DIVISION
						INNER JOIN PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE
						INNER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
						INNER JOIN JOB_LOG ON PRODUCT.CL_CODE = JOB_LOG.CL_CODE AND PRODUCT.DIV_CODE = JOB_LOG.DIV_CODE AND PRODUCT.PRD_CODE = JOB_LOG.PRD_CODE ON JD.JOB_NUMBER = JOB_LOG.JOB_NUMBER
						INNER JOIN CLIENT ON DIVISION.CL_CODE = CLIENT.CL_CODE
						LEFT OUTER JOIN CAMPAIGN ON JOB_LOG.CMP_IDENTIFIER = CAMPAIGN.CMP_IDENTIFIER
						INNER JOIN EMP_OFFICE ON JOB_LOG.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE  
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(JOB_LOG.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @JOB_NUMBER > 0 AND JD.JOB_NUMBER = @JOB_NUMBER THEN 1 ELSE 0 END = 1
				END
				IF @IsBlockedFromJobComponentLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'JC')
				BEGIN
					SELECT @JOB_NUMBER = JOB_NUMBER, @JOB_COMPONENT_NBR = JOB_COMPONENT_NBR FROM [dbo].[advtf_get_job_component_from_string] (@SEARCH_TEXT);
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CMP_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						JOB_NUMBER,
						JOB_COMPONENT_NBR,
						[LEVEL],
						OFFICE_NAME,
						CAMPAIGN_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						JOB_DESCRIPTION,
						JOB_COMP_DESCRIPTION,
						REPOSITORY_FILENAME
					)
					SELECT
						JCD.DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						JOB_LOG.CMP_CODE AS CMP_CODE,
						JOB_LOG.OFFICE_CODE AS OFFICE_CODE,
						JOB_LOG.CL_CODE AS CL_CODE,
						JOB_LOG.DIV_CODE AS DIV_CODE,
						JOB_LOG.PRD_CODE AS PRD_CODE,
						JOB_COMPONENT.JOB_NUMBER AS JOB_NUMBER,
						JOB_COMPONENT.JOB_COMPONENT_NBR AS JOB_COMPONENT_NBR,
						'JC' AS [LEVEL],
						OFFICE_NAME AS OFFICE_NAME,
						CAMPAIGN.CMP_NAME AS CAMPAIGN_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						JOB_LOG.JOB_DESC AS JOB_DESCRIPTION,
						JOB_COMPONENT.JOB_COMP_DESC AS JOB_COMP_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM   
						JOB_COMPONENT_DOCUMENTS JCD
						INNER JOIN DOCUMENTS D ON D.DOCUMENT_ID = JCD.DOCUMENT_ID
						INNER JOIN JOB_COMPONENT ON JOB_COMPONENT.JOB_NUMBER = JCD.JOB_NUMBER AND JOB_COMPONENT.JOB_COMPONENT_NBR = JCD.JOB_COMPONENT_NUMBER
						INNER JOIN JOB_LOG ON JOB_LOG.JOB_NUMBER = JCD.JOB_NUMBER
						INNER JOIN PRODUCT ON PRODUCT.CL_CODE = JOB_LOG.CL_CODE AND PRODUCT.DIV_CODE = JOB_LOG.DIV_CODE AND PRODUCT.PRD_CODE = JOB_LOG.PRD_CODE
						INNER JOIN DIVISION ON DIVISION.CL_CODE = JOB_LOG.CL_CODE AND DIVISION.DIV_CODE = JOB_LOG.DIV_CODE
						INNER JOIN CLIENT ON CLIENT.CL_CODE = JOB_LOG.CL_CODE
						INNER JOIN OFFICE ON OFFICE.OFFICE_CODE = JOB_LOG.OFFICE_CODE
						LEFT OUTER JOIN CAMPAIGN ON CAMPAIGN.CMP_IDENTIFIER = JOB_LOG.CMP_IDENTIFIER
						INNER JOIN EMP_OFFICE ON JOB_LOG.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE 
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(JOB_LOG.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10, 11)) AND UPPER(JOB_COMPONENT.JOB_COMP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @JOB_NUMBER > 0 AND @JOB_COMPONENT_NBR = 0 AND JCD.JOB_NUMBER = @JOB_NUMBER THEN 1 ELSE 0 END = 1
						OR CASE WHEN @JOB_NUMBER > 0 AND @JOB_COMPONENT_NBR > 0 AND JCD.JOB_NUMBER = @JOB_NUMBER AND JCD.JOB_COMPONENT_NUMBER = @JOB_COMPONENT_NBR THEN 1 ELSE 0 END = 1
					--	PROJECT SCHEDULE TASK DOCS
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						REPOSITORY_FILENAME,
						[LEVEL],
						JOB_NUMBER,
						JOB_COMPONENT_NBR,
						FNC_CODE,
						FNC_DESC
					)
					SELECT DISTINCT
						PSTDA.DOCUMENT_ID, 
						PSTDA.[FILENAME], 
						PSTDA.[DESCRIPTION], 
						PSTDA.KEYWORDS, 
						PSTDA.FILE_SIZE, 
						PSTDA.UPLOADED_DATE, 
						PSTDA.MIME_TYPE,
						PSTDA.USER_CODE,
						PSTDA.REPOSITORY_FILENAME,
						'PST', 
						PSTDA.JOB_NUMBER, 
						PSTDA.JOB_COMPONENT_NBR,
						TF.TRF_CODE,
						TF.TRF_DESC
					FROM 
						PROJECT_SCHEDULE_TASK_DOCUMENTS_ALL PSTDA
						INNER JOIN JOB_TRAFFIC_DET JTD ON JTD.JOB_NUMBER = PSTDA.JOB_NUMBER AND JTD.JOB_COMPONENT_NBR = PSTDA.JOB_COMPONENT_NBR AND JTD.SEQ_NBR = PSTDA.SEQ_NBR
						LEFT OUTER JOIN TRAFFIC_FNC TF ON JTD.FNC_CODE = TF.TRF_CODE
						LEFT OUTER JOIN FUNCTIONS F ON TF.FNC_CODE = F.FNC_CODE
						INNER JOIN JOB_COMPONENT ON JOB_COMPONENT.JOB_NUMBER = PSTDA.JOB_NUMBER AND JOB_COMPONENT.JOB_COMPONENT_NBR = PSTDA.JOB_COMPONENT_NBR
						INNER JOIN JOB_LOG JL ON JL.JOB_NUMBER = JOB_COMPONENT.JOB_NUMBER
						INNER JOIN PRODUCT ON PRODUCT.CL_CODE = JL.CL_CODE AND PRODUCT.DIV_CODE = JL.DIV_CODE AND PRODUCT.PRD_CODE = JL.PRD_CODE
						INNER JOIN DIVISION ON DIVISION.CL_CODE = JL.CL_CODE AND DIVISION.DIV_CODE = JL.DIV_CODE
						INNER JOIN CLIENT ON CLIENT.CL_CODE = JL.CL_CODE
						INNER JOIN OFFICE ON OFFICE.OFFICE_CODE = JL.OFFICE_CODE
					WHERE
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(JL.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10, 11)) AND UPPER(JOB_COMPONENT.JOB_COMP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @JOB_NUMBER > 0 AND @JOB_COMPONENT_NBR = 0 AND PSTDA.JOB_NUMBER = @JOB_NUMBER THEN 1 ELSE 0 END = 1
						OR CASE WHEN @JOB_NUMBER > 0 AND @JOB_COMPONENT_NBR > 0 AND PSTDA.JOB_NUMBER = @JOB_NUMBER AND PSTDA.JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR THEN 1 ELSE 0 END = 1
				END
				IF @IsBlockedFromAPLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'VN')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						--OFFICE_CODE,
						--CL_CODE,
						--DIV_CODE,
						--PRD_CODE,
						--JOB_NUMBER,
						--JOB_COMPONENT_NBR,
						[LEVEL],
						--OFFICE_NAME,
						--CLIENT_NAME,
						--DIVISION_NAME,
						--PRODUCT_DESCRIPTION,
						--JOB_DESCRIPTION,
						--JOB_COMP_DESCRIPTION,
						REPOSITORY_FILENAME,
						VENDOR_CODE,
						AP_INVOICE,
						VENDOR_NAME,
						AP_INVOICE_DESC,
						AP_ID
					)
					SELECT DISTINCT 
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						--OFFICE.OFFICE_CODE AS OFFICE_CODE,
						--CLIENT.CL_CODE AS CL_CODE,
						--DIVISION.DIV_CODE AS DIV_CODE,
						--PRODUCT.PRD_CODE AS PRD_CODE,
						--JOB_LOG.JOB_NUMBER AS JOB_NUMBER,
						--JOB_COMPONENT.JOB_COMPONENT_NBR AS JOB_COMPONENT_NBR,
						'VN' AS [LEVEL],
						--OFFICE.OFFICE_NAME AS OFFICE_NAME,
						--CLIENT.CL_NAME AS CLIENT_NAME,
						--DIVISION.DIV_NAME AS DIVISION_NAME,
						--PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						--JOB_LOG.JOB_DESC AS JOB_DESCRIPTION,
						--JOB_COMPONENT.JOB_COMP_DESC AS JOB_COMP_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME,
						AP_HEADER.VN_FRL_EMP_CODE AS VENDOR_CODE,
						AP_HEADER.AP_INV_VCHR AS AP_INVOICE,
						VENDOR.VN_NAME AS VENDOR_NAME,
						AP_HEADER.AP_DESC AS AP_INVOICE_DESC,
						AP_HEADER.AP_ID
					FROM   
						WV_CURRENT_AP_DOCUMENTS
						INNER JOIN AP_HEADER ON AP_HEADER.AP_ID = WV_CURRENT_AP_DOCUMENTS.AP_ID
						LEFT OUTER JOIN AP_PRODUCTION ON AP_PRODUCTION.AP_ID = WV_CURRENT_AP_DOCUMENTS.AP_ID
						LEFT OUTER JOIN JOB_COMPONENT ON JOB_COMPONENT.JOB_NUMBER = AP_PRODUCTION.JOB_NUMBER
						AND JOB_COMPONENT.JOB_COMPONENT_NBR = AP_PRODUCTION.JOB_COMPONENT_NBR
						LEFT OUTER JOIN JOB_LOG ON JOB_LOG.JOB_NUMBER = AP_PRODUCTION.JOB_NUMBER
						INNER JOIN VENDOR ON AP_HEADER.VN_FRL_EMP_CODE = VENDOR.VN_CODE
						LEFT OUTER JOIN CLIENT ON JOB_LOG.CL_CODE = CLIENT.CL_CODE
						LEFT OUTER JOIN DIVISION ON JOB_LOG.DIV_CODE = DIVISION.DIV_CODE
						LEFT OUTER JOIN PRODUCT ON JOB_LOG.PRD_CODE = PRODUCT.PRD_CODE
						LEFT OUTER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
						INNER JOIN EMP_OFFICE ON VENDOR.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE  
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(AP_HEADER.VN_FRL_EMP_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(AP_HEADER.AP_INV_VCHR) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 12) AND UPPER(VENDOR.VN_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 12) AND UPPER(VENDOR.VN_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(AP_HEADER.AP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END
				IF @IsBlockedFromAdNumberLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'AN')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CL_CODE,
						[LEVEL],
						CLIENT_NAME,
						REPOSITORY_FILENAME,
						AD_NBR,
						AD_NBR_DESC
					)
					SELECT DISTINCT
						DOCUMENTS.DOCUMENT_ID,
						DOCUMENTS.[FILENAME],
						DOCUMENTS.[DESCRIPTION],
						DOCUMENTS.KEYWORDS,
						DOCUMENTS.FILE_SIZE,
						DOCUMENTS.UPLOADED_DATE,
						DOCUMENTS.MIME_TYPE,
						DOCUMENTS.USER_CODE,
						AD_NUMBER.CL_CODE AS CL_CODE,
						'AN' AS [LEVEL],
						CLIENT.CL_NAME AS CLIENT_NAME,
						DOCUMENTS.REPOSITORY_FILENAME AS REPOSITORY_FILENAME,
						AD_NUMBER.AD_NBR,
						AD_NUMBER.AD_NBR_DESC
					FROM   
						DOCUMENTS
						INNER JOIN AD_NUMBER ON DOCUMENTS.DOCUMENT_ID = AD_NUMBER.DOCUMENT_ID
						LEFT OUTER JOIN CLIENT ON AD_NUMBER.CL_CODE = CLIENT.CL_CODE
						LEFT OUTER JOIN JOB_COMPONENT ON JOB_COMPONENT.AD_NBR = AD_NUMBER.AD_NBR
						LEFT OUTER JOIN JOB_LOG ON JOB_COMPONENT.JOB_NUMBER = JOB_LOG.JOB_NUMBER
						LEFT OUTER JOIN OFFICE ON JOB_LOG.OFFICE_CODE = OFFICE.OFFICE_CODE
						INNER JOIN DIVISION ON CLIENT.CL_CODE = DIVISION.CL_CODE 
						INNER JOIN PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE
						INNER JOIN EMP_OFFICE ON PRODUCT.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE  
						CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(DOCUMENTS.KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(DOCUMENTS.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(DOCUMENTS.[FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR UPPER(AD_NUMBER.AD_NBR_DESC) LIKE '%' + @SEARCH_TEXT + '%'
						OR UPPER(AD_NUMBER.AD_NBR) LIKE '%' + @SEARCH_TEXT + '%'
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(JOB_LOG.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10, 11)) AND UPPER(JOB_COMPONENT.JOB_COMP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(DOCUMENTS.USER_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END
				IF @IsBlockedFromExpenseReportLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'EXDTL')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						JOB_NUMBER,
						JOB_COMPONENT_NBR,
						[LEVEL],
						OFFICE_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						JOB_DESCRIPTION,
						REPOSITORY_FILENAME,
						EMP_CODE,
						AP_ID,
						EMP_FML,
						EXPENSE_HEADER_DESC
					)
					SELECT DISTINCT 
						DOCUMENTS.DOCUMENT_ID,
						DOCUMENTS.[FILENAME],
						DOCUMENTS.[DESCRIPTION],
						DOCUMENTS.KEYWORDS,
						DOCUMENTS.FILE_SIZE,
						DOCUMENTS.UPLOADED_DATE,
						DOCUMENTS.MIME_TYPE,
						DOCUMENTS.USER_CODE,
						OFFICE.OFFICE_CODE,
						EXPENSE_DETAIL.CL_CODE,
						EXPENSE_DETAIL.DIV_CODE,
						EXPENSE_DETAIL.PRD_CODE,
						EXPENSE_DETAIL.JOB_NBR,
						EXPENSE_DETAIL.JOB_COMP_NBR,
						'EXDTL',
						OFFICE.OFFICE_NAME,
						CLIENT.CL_NAME,
						DIVISION.DIV_NAME,
						PRODUCT.PRD_DESCRIPTION,
						JOB_LOG.JOB_DESC,
						DOCUMENTS.REPOSITORY_FILENAME,
						EXPENSE_HEADER.EMP_CODE,
						EXPENSE_DETAIL.INV_NBR,
						ISNULL(E.EMP_FNAME + ' ','') + ISNULL(E.EMP_MI + '. ', '') + ISNULL(E.EMP_LNAME, ''),
						EXPENSE_HEADER.EXP_DESC
					FROM   
						DOCUMENTS
						INNER JOIN EXPENSE_DETAIL_DOCS ON DOCUMENTS.DOCUMENT_ID = EXPENSE_DETAIL_DOCS.DOCUMENT_ID
						INNER JOIN EXPENSE_DETAIL ON EXPENSE_DETAIL.EXPDETAILID = EXPENSE_DETAIL_DOCS.EXPDETAILID
						INNER JOIN EXPENSE_HEADER ON EXPENSE_HEADER.INV_NBR = EXPENSE_DETAIL.INV_NBR
						INNER JOIN EMPLOYEE E ON EXPENSE_HEADER.EMP_CODE = E.EMP_CODE
						LEFT OUTER JOIN CLIENT ON CLIENT.CL_CODE = EXPENSE_DETAIL.CL_CODE
						LEFT OUTER JOIN DIVISION ON DIVISION.DIV_CODE = EXPENSE_DETAIL.DIV_CODE
						LEFT OUTER JOIN PRODUCT ON PRODUCT.PRD_CODE = EXPENSE_DETAIL.PRD_CODE
						LEFT OUTER JOIN OFFICE ON OFFICE.OFFICE_CODE = PRODUCT.OFFICE_CODE
						LEFT OUTER JOIN JOB_LOG ON JOB_LOG.JOB_NUMBER = EXPENSE_DETAIL.JOB_NBR
						LEFT OUTER JOIN JOB_COMPONENT ON JOB_COMPONENT.JOB_NUMBER = EXPENSE_DETAIL.JOB_NBR AND JOB_COMPONENT.JOB_COMPONENT_NBR = EXPENSE_DETAIL.JOB_COMP_NBR
						LEFT OUTER JOIN FUNCTIONS F ON EXPENSE_DETAIL.FNC_CODE = F.FNC_CODE
						INNER JOIN EMP_OFFICE ON E.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1 
						OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(JOB_LOG.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10, 11)) AND UPPER(JOB_COMPONENT.JOB_COMP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR UPPER(EXPENSE_HEADER.EXP_DESC) LIKE '%' + @SEARCH_TEXT + '%'
						OR UPPER(E.EMP_CODE) LIKE '%' + @SEARCH_TEXT + '%'
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 6) AND UPPER(E.EMP_FNAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 6) AND UPPER(E.EMP_MI) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 6) AND UPPER(E.EMP_LNAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 9) AND UPPER(F.FNC_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 9) AND UPPER(F.FNC_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END 
				IF @IsBlockedFromContractLevel = 0 AND (@LEVEL = '' OR @LEVEL = 'CT')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						[LEVEL],
						OFFICE_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME,
						CONTRACT_ID,
						CONTRACT_CODE,
						CONTRACT_DESC
					)
					SELECT DISTINCT
						DOCUMENT_ID,
						[FILENAME],
						CONTRACT_DOCUMENTS_ALL.[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE.OFFICE_CODE,
						CLIENT.CL_CODE,
						DIVISION.DIV_CODE,
						PRODUCT.PRD_CODE,
						'CT' AS [LEVEL],
						OFFICE.OFFICE_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME,
						CT.CONTRACT_ID,
						CT.CONTRACT_CODE,
						CT.[DESCRIPTION]
					FROM   
						CONTRACT_DOCUMENTS_ALL
						INNER JOIN CONTRACT CT ON CT.CONTRACT_ID = CONTRACT_DOCUMENTS_ALL.CONTRACT_ID
						INNER JOIN CLIENT ON CLIENT.CL_CODE = CT.CL_CODE
						LEFT OUTER JOIN DIVISION ON CT.CL_CODE = DIVISION.CL_CODE AND CT.DIV_CODE = DIVISION.DIV_CODE
						LEFT OUTER JOIN PRODUCT ON PRODUCT.CL_CODE = CT.CL_CODE AND PRODUCT.DIV_CODE = CT.DIV_CODE AND PRODUCT.PRD_CODE = CT.PRD_CODE
						INNER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
					WHERE  
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(CONTRACT_DOCUMENTS_ALL.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END
				IF @IsBlockedFromContractReportLevel = 0 AND (@LEVEL = '' OR @LEVEL = 'ContractReport')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						[LEVEL],
						OFFICE_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME,
						CONTRACT_ID,
						CONTRACT_CODE,
						CONTRACT_DESC,
						CONTRACT_REPORT_DESC
					)
					SELECT DISTINCT
						DOCUMENT_ID,
						[FILENAME],
						CONTRACT_REPORT_DOCUMENTS_ALL.[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE.OFFICE_CODE,
						CLIENT.CL_CODE,
						DIVISION.DIV_CODE,
						PRODUCT.PRD_CODE,
						'CTR' AS [LEVEL],
						OFFICE.OFFICE_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME,
						CT.CONTRACT_ID,
						CT.CONTRACT_CODE,
						CT.[DESCRIPTION],
						CR.[DESCRIPTION]
					FROM   
						CONTRACT_REPORT_DOCUMENTS_ALL
						INNER JOIN CONTRACT_REPORT CR ON CR.CONTRACT_REPORT_ID = CONTRACT_REPORT_DOCUMENTS_ALL.CONTRACT_REPORT_ID
						INNER JOIN CONTRACT CT ON CT.CONTRACT_ID = CR.CONTRACT_ID
						INNER JOIN CLIENT ON CLIENT.CL_CODE = CT.CL_CODE
						LEFT OUTER JOIN DIVISION ON CT.CL_CODE = DIVISION.CL_CODE AND CT.DIV_CODE = DIVISION.DIV_CODE
						LEFT OUTER JOIN PRODUCT ON PRODUCT.CL_CODE = CT.CL_CODE AND PRODUCT.DIV_CODE = CT.DIV_CODE AND PRODUCT.PRD_CODE = CT.PRD_CODE
						INNER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
					WHERE  
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(CONTRACT_REPORT_DOCUMENTS_ALL.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(CR.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 5)) AND UPPER(CT.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END
				IF @IsBlockedFromARInvoiceLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'AR')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CMP_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						JOB_NUMBER,
						JOB_COMPONENT_NBR,
						[LEVEL],
						OFFICE_NAME,
						CAMPAIGN_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						JOB_DESCRIPTION,
						JOB_COMP_DESCRIPTION,
						REPOSITORY_FILENAME
					)
					SELECT DISTINCT
						AIDA.DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						JOB_LOG.CMP_CODE AS CMP_CODE,
						JOB_LOG.OFFICE_CODE AS OFFICE_CODE,
						JOB_LOG.CL_CODE AS CL_CODE,
						JOB_LOG.DIV_CODE AS DIV_CODE,
						JOB_LOG.PRD_CODE AS PRD_CODE,
						JOB_COMPONENT.JOB_NUMBER AS JOB_NUMBER,
						JOB_COMPONENT.JOB_COMPONENT_NBR AS JOB_COMPONENT_NBR,
						'AR' AS [LEVEL],
						OFFICE_NAME AS OFFICE_NAME,
						CAMPAIGN.CMP_NAME AS CAMPAIGN_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						JOB_LOG.JOB_DESC AS JOB_DESCRIPTION,
						JOB_COMPONENT.JOB_COMP_DESC AS JOB_COMP_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM   
						AR_INVOICE_DOCUMENTS_ALL AIDA
						LEFT OUTER JOIN JOB_LOG ON JOB_LOG.JOB_NUMBER = AIDA.JOB_NUMBER
						LEFT OUTER JOIN JOB_COMPONENT ON JOB_COMPONENT.JOB_NUMBER = AIDA.JOB_NUMBER AND JOB_COMPONENT.JOB_COMPONENT_NBR = AIDA.JOB_COMPONENT_NBR
						INNER JOIN PRODUCT ON PRODUCT.CL_CODE = JOB_LOG.CL_CODE AND PRODUCT.DIV_CODE = JOB_LOG.DIV_CODE AND PRODUCT.PRD_CODE = JOB_LOG.PRD_CODE
						INNER JOIN DIVISION ON DIVISION.CL_CODE = JOB_LOG.CL_CODE AND DIVISION.DIV_CODE = JOB_LOG.DIV_CODE
						INNER JOIN CLIENT ON CLIENT.CL_CODE = JOB_LOG.CL_CODE
						INNER JOIN OFFICE ON OFFICE.OFFICE_CODE = JOB_LOG.OFFICE_CODE
						LEFT OUTER JOIN CAMPAIGN ON CAMPAIGN.CMP_IDENTIFIER = JOB_LOG.CMP_IDENTIFIER
						LEFT OUTER JOIN MEDIA_ORDER_HEADER MOH ON MOH.CL_CODE = CLIENT.CL_CODE AND MOH.DIV_CODE = DIVISION.DIV_CODE AND MOH.PRD_CODE = PRODUCT.PRD_CODE
						INNER JOIN EMP_OFFICE ON JOB_LOG.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE 
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(JOB_LOG.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10, 11)) AND UPPER(JOB_COMPONENT.JOB_COMP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(MOH.ORDER_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END
				IF @IsBlockedFromVendorLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'VC')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						[LEVEL],
						OFFICE_NAME,
						REPOSITORY_FILENAME,
						VENDOR_CODE,
						VENDOR_NAME
					)
					SELECT 
						DOCUMENT_ID,
						[FILENAME],
						VCDA.[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE.OFFICE_CODE AS OFFICE_CODE,
						'VC' AS [LEVEL],
						OFFICE.OFFICE_NAME AS OFFICE_NAME,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME,
						V.VN_CODE AS VENDOR_CODE,
						V.VN_NAME AS VENDOR_NAME
					FROM   
						VENDOR_CONTRACT_DOCUMENTS_ALL VCDA
						INNER JOIN VENDOR_CONTRACT VC ON VCDA.VENDOR_CONTRACT_ID = VC.VENDOR_CONTRACT_ID
						INNER JOIN VENDOR V ON VC.VN_CODE = V.VN_CODE
						LEFT OUTER JOIN OFFICE ON OFFICE.OFFICE_CODE = V.OFFICE_CODE
						INNER JOIN EMP_OFFICE ON V.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE  
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(VCDA.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR UPPER(VC.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%'
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 15)) AND UPPER(V.VN_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 15)) AND UPPER(V.VN_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END;
				IF @IsBlockedFromAlertLevel = 0 AND(@LEVEL = '' OR @LEVEL = 'ALRT') AND @INCLUDE_ATTACHMENTS = 1
				BEGIN
					SELECT @JOB_NUMBER = JOB_NUMBER, @JOB_COMPONENT_NBR = JOB_COMPONENT_NBR FROM [dbo].[advtf_get_job_component_from_string] (@SEARCH_TEXT);
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						REPOSITORY_FILENAME,
						USER_CODE,
						[LEVEL],
						OFFICE_CODE,
						OFFICE_NAME,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						JOB_NUMBER,
						JOB_DESCRIPTION,
						JOB_COMPONENT_NBR,
						JOB_COMP_DESCRIPTION,
						ALERT_SUBJECT,
						CMP_CODE,
						CAMPAIGN_NAME
					)
					SELECT 
						D.DOCUMENT_ID,
						D.[FILENAME],
						D.[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						REPOSITORY_FILENAME,
						D.USER_CODE,
						'ALRT',
						OFFICE.OFFICE_CODE,
						OFFICE.OFFICE_NAME,
						CLIENT.CL_CODE,
						DIVISION.DIV_CODE,
						PRODUCT.PRD_CODE,
						CLIENT.CL_NAME,
						DIVISION.DIV_NAME,
						PRODUCT.PRD_DESCRIPTION,
						J.JOB_NUMBER,
						J.JOB_DESC,
						JC.JOB_COMPONENT_NBR,
						JC.JOB_COMP_DESC,
						A.[SUBJECT],
						C.CMP_CODE,
						C.CMP_NAME
					FROM
						DOCUMENTS D
						INNER JOIN ALERT_ATTACHMENT AA ON D.DOCUMENT_ID = AA.DOCUMENT_ID
						INNER JOIN ALERT A ON A.ALERT_ID = AA.ALERT_ID
						LEFT OUTER JOIN CLIENT ON A.CL_CODE = CLIENT.CL_CODE
						LEFT OUTER JOIN DIVISION ON A.DIV_CODE = DIVISION.DIV_CODE AND A.CL_CODE = DIVISION.CL_CODE
						LEFT OUTER JOIN PRODUCT ON A.CL_CODE = PRODUCT.CL_CODE AND A.DIV_CODE = PRODUCT.DIV_CODE AND A.PRD_CODE = PRODUCT.PRD_CODE
						LEFT OUTER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
						LEFT OUTER JOIN JOB_LOG J ON J.JOB_NUMBER = A.JOB_NUMBER
						LEFT OUTER JOIN JOB_COMPONENT JC ON JC.JOB_NUMBER = A.JOB_NUMBER AND JC.JOB_COMPONENT_NBR = A.JOB_COMPONENT_NBR
						LEFT OUTER JOIN CAMPAIGN C ON C.CMP_IDENTIFIER = A.CMP_IDENTIFIER						
						INNER JOIN EMP_OFFICE ON J.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE 
						CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(D.KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(D.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(D.[FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(D.USER_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 16)) AND UPPER(A.[SUBJECT]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 16)) AND UPPER(CAST(A.BODY AS VARCHAR(MAX))) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @JOB_NUMBER > 0 AND @JOB_COMPONENT_NBR = 0 AND J.JOB_NUMBER = @JOB_NUMBER THEN 1 ELSE 0 END = 1
						OR CASE WHEN @JOB_NUMBER > 0 AND @JOB_COMPONENT_NBR > 0 AND JC.JOB_NUMBER = @JOB_NUMBER AND JC.JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR THEN 1 ELSE 0 END = 1
						OR CASE WHEN @JOB_NUMBER = 0 AND (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(J.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @JOB_NUMBER = 0 AND @JOB_COMPONENT_NBR = 0 AND (@CRITERIA_ENUM_VALUE IN (1, 11)) AND UPPER(JC.JOB_COMP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 17)) AND UPPER(C.CMP_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END
			END
			ELSE
			BEGIN
				IF @IsBlockedFromClientLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'CL')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CL_CODE,
						[LEVEL],
						CLIENT_NAME,
						REPOSITORY_FILENAME
					)
					SELECT DISTINCT
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CLIENT.CL_CODE AS CL_CODE,
						'CL' AS [LEVEL],
						CLIENT.CL_NAME AS CLIENT_NAME,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM   
						WV_CURRENT_CLIENT_DOCUMENTS
						INNER JOIN CLIENT ON CLIENT.CL_CODE = WV_CURRENT_CLIENT_DOCUMENTS.CL_CODE
					WHERE  
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END
				IF @IsBlockedFromDivisionLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'DI')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CL_CODE,
						DIV_CODE,
						[LEVEL],
						CLIENT_NAME,
						DIVISION_NAME,
						REPOSITORY_FILENAME
					)
					SELECT 
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CLIENT.CL_CODE AS CL_CODE,
						DIVISION.DIV_CODE AS DIV_CODE,
						'DI' AS [LEVEL],
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM   
						WV_CURRENT_DIVISION_DOCUMENTS
						INNER JOIN DIVISION ON DIVISION.DIV_CODE = WV_CURRENT_DIVISION_DOCUMENTS.DIV_CODE
						INNER JOIN CLIENT ON CLIENT.CL_CODE = DIVISION.CL_CODE
					WHERE  
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END
				IF @IsBlockedFromProductLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'PR')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						[LEVEL],
						OFFICE_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME
					)
					SELECT DISTINCT
						WV_CURRENT_PRODUCT_DOCUMENTS.DOCUMENT_ID,
						WV_CURRENT_PRODUCT_DOCUMENTS.[FILENAME],
						WV_CURRENT_PRODUCT_DOCUMENTS.[DESCRIPTION],
						WV_CURRENT_PRODUCT_DOCUMENTS.KEYWORDS,
						WV_CURRENT_PRODUCT_DOCUMENTS.FILE_SIZE,
						WV_CURRENT_PRODUCT_DOCUMENTS.UPLOADED_DATE,
						WV_CURRENT_PRODUCT_DOCUMENTS.MIME_TYPE,
						WV_CURRENT_PRODUCT_DOCUMENTS.USER_CODE,
						OFFICE.OFFICE_CODE,
						CLIENT.CL_CODE,
						DIVISION.DIV_CODE,
						PRODUCT.PRD_CODE,
						'PR' AS [LEVEL],
						OFFICE.OFFICE_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						WV_CURRENT_PRODUCT_DOCUMENTS.REPOSITORY_FILENAME
					FROM   
						WV_CURRENT_PRODUCT_DOCUMENTS
						INNER JOIN CLIENT ON WV_CURRENT_PRODUCT_DOCUMENTS.CL_CODE = CLIENT.CL_CODE
						INNER JOIN DIVISION ON WV_CURRENT_PRODUCT_DOCUMENTS.DIV_CODE = DIVISION.DIV_CODE AND WV_CURRENT_PRODUCT_DOCUMENTS.CL_CODE = DIVISION.CL_CODE
						INNER JOIN PRODUCT
						INNER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
						ON WV_CURRENT_PRODUCT_DOCUMENTS.CL_CODE = PRODUCT.CL_CODE AND WV_CURRENT_PRODUCT_DOCUMENTS.DIV_CODE = PRODUCT.DIV_CODE AND WV_CURRENT_PRODUCT_DOCUMENTS.PRD_CODE = PRODUCT.PRD_CODE
					WHERE 
						CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(WV_CURRENT_PRODUCT_DOCUMENTS.KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(WV_CURRENT_PRODUCT_DOCUMENTS.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(WV_CURRENT_PRODUCT_DOCUMENTS.[FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(WV_CURRENT_PRODUCT_DOCUMENTS.USER_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END
				IF @IsBlockedFromCampaignLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'CM')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CMP_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						[LEVEL],
						OFFICE_NAME,
						CAMPAIGN_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME
					)
					SELECT DISTINCT
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CAMPAIGN.CMP_CODE AS CMP_CODE,
						OFFICE.OFFICE_CODE,
						CAMPAIGN.CL_CODE AS CL_CODE,
						CAMPAIGN.DIV_CODE AS DIV_CODE,
						CAMPAIGN.PRD_CODE AS PRD_CODE,
						'CM' AS [LEVEL],
						OFFICE.OFFICE_NAME,
						CAMPAIGN.CMP_NAME AS CAMPAIGN_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM   
						WV_CURRENT_CAMPAIGN_DOCUMENTS
						INNER JOIN CAMPAIGN ON WV_CURRENT_CAMPAIGN_DOCUMENTS.CMP_IDENTIFIER = CAMPAIGN.CMP_IDENTIFIER
						LEFT OUTER JOIN CLIENT ON CAMPAIGN.CL_CODE = CLIENT.CL_CODE
						LEFT OUTER JOIN DIVISION ON CAMPAIGN.CL_CODE = DIVISION.CL_CODE AND CAMPAIGN.DIV_CODE = DIVISION.DIV_CODE
						LEFT OUTER JOIN PRODUCT ON CAMPAIGN.CL_CODE = PRODUCT.CL_CODE AND CAMPAIGN.DIV_CODE = PRODUCT.DIV_CODE AND CAMPAIGN.PRD_CODE = PRODUCT.PRD_CODE
						LEFT OUTER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
						LEFT OUTER JOIN MEDIA_ORDER_HEADER MOH ON CAMPAIGN.CMP_IDENTIFIER = MOH.CMP_IDENTIFIER
					WHERE  
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR UPPER(CAMPAIGN.CMP_NAME) LIKE '%' + @SEARCH_TEXT + '%'
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 12)) AND UPPER(MOH.ORDER_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 12)) AND UPPER(CAST(MOH.ORDER_COMMENT AS VARCHAR)) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END
				IF @IsBlockedFromJobLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'JO')
				BEGIN
					SELECT @JOB_NUMBER = JOB_NUMBER FROM [dbo].[advtf_get_job_component_from_string] (@SEARCH_TEXT);
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CMP_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						JOB_NUMBER,
						[LEVEL],
						OFFICE_NAME,
						CAMPAIGN_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						JOB_DESCRIPTION,
						REPOSITORY_FILENAME
					)
					SELECT DISTINCT
						JD.DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CAMPAIGN.CMP_CODE AS CMP_CODE,
						OFFICE.OFFICE_CODE AS OFFICE_CODE,
						CLIENT.CL_CODE AS CL_CODE,
						DIVISION.DIV_CODE AS DIV_CODE,
						PRODUCT.PRD_CODE AS PRD_CODE,
						JOB_LOG.JOB_NUMBER AS JOB_NUMBER,
						'JO' AS [LEVEL],
						OFFICE_NAME AS OFFICE_NAME,
						CAMPAIGN.CMP_NAME AS CAMPAIGN_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						JOB_LOG.JOB_DESC AS JOB_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM  
						JOB_DOCUMENTS JD
						INNER JOIN DOCUMENTS D ON JD.DOCUMENT_ID = D.DOCUMENT_ID
						INNER JOIN DIVISION
						INNER JOIN PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE
						INNER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
						INNER JOIN JOB_LOG ON PRODUCT.CL_CODE = JOB_LOG.CL_CODE AND PRODUCT.DIV_CODE = JOB_LOG.DIV_CODE AND PRODUCT.PRD_CODE = JOB_LOG.PRD_CODE ON JD.JOB_NUMBER = JOB_LOG.JOB_NUMBER
						INNER JOIN CLIENT ON DIVISION.CL_CODE = CLIENT.CL_CODE
						LEFT OUTER JOIN CAMPAIGN ON JOB_LOG.CMP_IDENTIFIER = CAMPAIGN.CMP_IDENTIFIER
					WHERE  
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(JOB_LOG.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @JOB_NUMBER > 0 AND JD.JOB_NUMBER = @JOB_NUMBER THEN 1 ELSE 0 END = 1
				END
				IF @IsBlockedFromJobComponentLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'JC')
				BEGIN
					SELECT @JOB_NUMBER = JOB_NUMBER, @JOB_COMPONENT_NBR = JOB_COMPONENT_NBR FROM [dbo].[advtf_get_job_component_from_string] (@SEARCH_TEXT);
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CMP_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						JOB_NUMBER,
						JOB_COMPONENT_NBR,
						[LEVEL],
						OFFICE_NAME,
						CAMPAIGN_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						JOB_DESCRIPTION,
						JOB_COMP_DESCRIPTION,
						REPOSITORY_FILENAME
					)
					SELECT
						JCD.DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						JOB_LOG.CMP_CODE AS CMP_CODE,
						JOB_LOG.OFFICE_CODE AS OFFICE_CODE,
						JOB_LOG.CL_CODE AS CL_CODE,
						JOB_LOG.DIV_CODE AS DIV_CODE,
						JOB_LOG.PRD_CODE AS PRD_CODE,
						JOB_COMPONENT.JOB_NUMBER AS JOB_NUMBER,
						JOB_COMPONENT.JOB_COMPONENT_NBR AS JOB_COMPONENT_NBR,
						'JC' AS [LEVEL],
						OFFICE_NAME AS OFFICE_NAME,
						CAMPAIGN.CMP_NAME AS CAMPAIGN_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						JOB_LOG.JOB_DESC AS JOB_DESCRIPTION,
						JOB_COMPONENT.JOB_COMP_DESC AS JOB_COMP_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM   
						JOB_COMPONENT_DOCUMENTS JCD
						INNER JOIN DOCUMENTS D ON D.DOCUMENT_ID = JCD.DOCUMENT_ID
						INNER JOIN JOB_COMPONENT ON JOB_COMPONENT.JOB_NUMBER = JCD.JOB_NUMBER AND JOB_COMPONENT.JOB_COMPONENT_NBR = JCD.JOB_COMPONENT_NUMBER
						INNER JOIN JOB_LOG ON JOB_LOG.JOB_NUMBER = JCD.JOB_NUMBER
						INNER JOIN PRODUCT ON PRODUCT.CL_CODE = JOB_LOG.CL_CODE AND PRODUCT.DIV_CODE = JOB_LOG.DIV_CODE AND PRODUCT.PRD_CODE = JOB_LOG.PRD_CODE
						INNER JOIN DIVISION ON DIVISION.CL_CODE = JOB_LOG.CL_CODE AND DIVISION.DIV_CODE = JOB_LOG.DIV_CODE
						INNER JOIN CLIENT ON CLIENT.CL_CODE = JOB_LOG.CL_CODE
						INNER JOIN OFFICE ON OFFICE.OFFICE_CODE = JOB_LOG.OFFICE_CODE
						LEFT OUTER JOIN CAMPAIGN ON CAMPAIGN.CMP_IDENTIFIER = JOB_LOG.CMP_IDENTIFIER
					WHERE 
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(JOB_LOG.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10, 11)) AND UPPER(JOB_COMPONENT.JOB_COMP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @JOB_NUMBER > 0 AND @JOB_COMPONENT_NBR = 0 AND JCD.JOB_NUMBER = @JOB_NUMBER THEN 1 ELSE 0 END = 1
						OR CASE WHEN @JOB_NUMBER > 0 AND @JOB_COMPONENT_NBR > 0 AND JCD.JOB_NUMBER = @JOB_NUMBER AND JCD.JOB_COMPONENT_NUMBER = @JOB_COMPONENT_NBR THEN 1 ELSE 0 END = 1
					--	PROJECT SCHEDULE TASK DOCS
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						REPOSITORY_FILENAME,
						[LEVEL],
						JOB_NUMBER,
						JOB_COMPONENT_NBR,
						FNC_CODE,
						FNC_DESC
					)
					SELECT DISTINCT
						PSTDA.DOCUMENT_ID, 
						PSTDA.[FILENAME], 
						PSTDA.[DESCRIPTION], 
						PSTDA.KEYWORDS, 
						PSTDA.FILE_SIZE, 
						PSTDA.UPLOADED_DATE, 
						PSTDA.MIME_TYPE,
						PSTDA.USER_CODE,
						PSTDA.REPOSITORY_FILENAME,
						'PST', 
						PSTDA.JOB_NUMBER, 
						PSTDA.JOB_COMPONENT_NBR,
						TF.TRF_CODE,
						TF.TRF_DESC
					FROM 
						PROJECT_SCHEDULE_TASK_DOCUMENTS_ALL PSTDA
						INNER JOIN JOB_TRAFFIC_DET JTD ON JTD.JOB_NUMBER = PSTDA.JOB_NUMBER AND JTD.JOB_COMPONENT_NBR = PSTDA.JOB_COMPONENT_NBR AND JTD.SEQ_NBR = PSTDA.SEQ_NBR
						LEFT OUTER JOIN TRAFFIC_FNC TF ON JTD.FNC_CODE = TF.TRF_CODE
						LEFT OUTER JOIN FUNCTIONS F ON TF.FNC_CODE = F.FNC_CODE
						INNER JOIN JOB_COMPONENT ON JOB_COMPONENT.JOB_NUMBER = PSTDA.JOB_NUMBER AND JOB_COMPONENT.JOB_COMPONENT_NBR = PSTDA.JOB_COMPONENT_NBR
						INNER JOIN JOB_LOG JL ON JL.JOB_NUMBER = JOB_COMPONENT.JOB_NUMBER
						INNER JOIN PRODUCT ON PRODUCT.CL_CODE = JL.CL_CODE AND PRODUCT.DIV_CODE = JL.DIV_CODE AND PRODUCT.PRD_CODE = JL.PRD_CODE
						INNER JOIN DIVISION ON DIVISION.CL_CODE = JL.CL_CODE AND DIVISION.DIV_CODE = JL.DIV_CODE
						INNER JOIN CLIENT ON CLIENT.CL_CODE = JL.CL_CODE
						INNER JOIN OFFICE ON OFFICE.OFFICE_CODE = JL.OFFICE_CODE
					WHERE
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(JL.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10, 11)) AND UPPER(JOB_COMPONENT.JOB_COMP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @JOB_NUMBER > 0 AND @JOB_COMPONENT_NBR = 0 AND PSTDA.JOB_NUMBER = @JOB_NUMBER THEN 1 ELSE 0 END = 1
						OR CASE WHEN @JOB_NUMBER > 0 AND @JOB_COMPONENT_NBR > 0 AND PSTDA.JOB_NUMBER = @JOB_NUMBER AND PSTDA.JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR THEN 1 ELSE 0 END = 1
				END
				IF @IsBlockedFromAPLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'VN')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						--OFFICE_CODE,
						--CL_CODE,
						--DIV_CODE,
						--PRD_CODE,
						--JOB_NUMBER,
						--JOB_COMPONENT_NBR,
						[LEVEL],
						--OFFICE_NAME,
						--CLIENT_NAME,
						--DIVISION_NAME,
						--PRODUCT_DESCRIPTION,
						--JOB_DESCRIPTION,
						--JOB_COMP_DESCRIPTION,
						REPOSITORY_FILENAME,
						VENDOR_CODE,
						AP_INVOICE,
						VENDOR_NAME,
						AP_INVOICE_DESC,
						AP_ID
					)
					SELECT DISTINCT 
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						--OFFICE.OFFICE_CODE AS OFFICE_CODE,
						--CLIENT.CL_CODE AS CL_CODE,
						--DIVISION.DIV_CODE AS DIV_CODE,
						--PRODUCT.PRD_CODE AS PRD_CODE,
						--JOB_LOG.JOB_NUMBER AS JOB_NUMBER,
						--JOB_COMPONENT.JOB_COMPONENT_NBR AS JOB_COMPONENT_NBR,
						'VN' AS [LEVEL],
						--OFFICE.OFFICE_NAME AS OFFICE_NAME,
						--CLIENT.CL_NAME AS CLIENT_NAME,
						--DIVISION.DIV_NAME AS DIVISION_NAME,
						--PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						--JOB_LOG.JOB_DESC AS JOB_DESCRIPTION,
						--JOB_COMPONENT.JOB_COMP_DESC AS JOB_COMP_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME,
						AP_HEADER.VN_FRL_EMP_CODE AS VENDOR_CODE,
						AP_HEADER.AP_INV_VCHR AS AP_INVOICE,
						VENDOR.VN_NAME AS VENDOR_NAME,
						AP_HEADER.AP_DESC AS AP_INVOICE_DESC,
						AP_HEADER.AP_ID
					FROM   
						WV_CURRENT_AP_DOCUMENTS
						INNER JOIN AP_HEADER ON AP_HEADER.AP_ID = WV_CURRENT_AP_DOCUMENTS.AP_ID
						LEFT OUTER JOIN AP_PRODUCTION ON AP_PRODUCTION.AP_ID = WV_CURRENT_AP_DOCUMENTS.AP_ID
						LEFT OUTER JOIN JOB_COMPONENT ON JOB_COMPONENT.JOB_NUMBER = AP_PRODUCTION.JOB_NUMBER
						AND JOB_COMPONENT.JOB_COMPONENT_NBR = AP_PRODUCTION.JOB_COMPONENT_NBR
						LEFT OUTER JOIN JOB_LOG ON JOB_LOG.JOB_NUMBER = AP_PRODUCTION.JOB_NUMBER
						INNER JOIN VENDOR ON AP_HEADER.VN_FRL_EMP_CODE = VENDOR.VN_CODE
						LEFT OUTER JOIN CLIENT ON JOB_LOG.CL_CODE = CLIENT.CL_CODE
						LEFT OUTER JOIN DIVISION ON JOB_LOG.DIV_CODE = DIVISION.DIV_CODE
						LEFT OUTER JOIN PRODUCT ON JOB_LOG.PRD_CODE = PRODUCT.PRD_CODE
						LEFT OUTER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
					WHERE  
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(AP_HEADER.VN_FRL_EMP_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(AP_HEADER.AP_INV_VCHR) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 12) AND UPPER(VENDOR.VN_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 12) AND UPPER(VENDOR.VN_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(AP_HEADER.AP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END
				IF @IsBlockedFromAdNumberLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'AN')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CL_CODE,
						[LEVEL],
						CLIENT_NAME,
						REPOSITORY_FILENAME,
						AD_NBR,
						AD_NBR_DESC
					)
					SELECT DISTINCT
						DOCUMENTS.DOCUMENT_ID,
						DOCUMENTS.[FILENAME],
						DOCUMENTS.[DESCRIPTION],
						DOCUMENTS.KEYWORDS,
						DOCUMENTS.FILE_SIZE,
						DOCUMENTS.UPLOADED_DATE,
						DOCUMENTS.MIME_TYPE,
						DOCUMENTS.USER_CODE,
						AD_NUMBER.CL_CODE AS CL_CODE,
						'AN' AS [LEVEL],
						CLIENT.CL_NAME AS CLIENT_NAME,
						DOCUMENTS.REPOSITORY_FILENAME AS REPOSITORY_FILENAME,
						AD_NUMBER.AD_NBR,
						AD_NUMBER.AD_NBR_DESC
					FROM   
						DOCUMENTS
						INNER JOIN AD_NUMBER ON DOCUMENTS.DOCUMENT_ID = AD_NUMBER.DOCUMENT_ID
						LEFT OUTER JOIN CLIENT ON AD_NUMBER.CL_CODE = CLIENT.CL_CODE
						LEFT OUTER JOIN JOB_COMPONENT ON JOB_COMPONENT.AD_NBR = AD_NUMBER.AD_NBR
						LEFT OUTER JOIN JOB_LOG ON JOB_COMPONENT.JOB_NUMBER = JOB_LOG.JOB_NUMBER
						LEFT OUTER JOIN OFFICE ON JOB_LOG.OFFICE_CODE = OFFICE.OFFICE_CODE
					WHERE  
						CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(DOCUMENTS.KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(DOCUMENTS.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(DOCUMENTS.[FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR UPPER(AD_NUMBER.AD_NBR_DESC) LIKE '%' + @SEARCH_TEXT + '%'
						OR UPPER(AD_NUMBER.AD_NBR) LIKE '%' + @SEARCH_TEXT + '%'
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(JOB_LOG.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10, 11)) AND UPPER(JOB_COMPONENT.JOB_COMP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(DOCUMENTS.USER_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END
				IF @IsBlockedFromExpenseReportLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'EXDTL')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						JOB_NUMBER,
						JOB_COMPONENT_NBR,
						[LEVEL],
						OFFICE_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						JOB_DESCRIPTION,
						REPOSITORY_FILENAME,
						EMP_CODE,
						AP_ID,
						EMP_FML,
						EXPENSE_HEADER_DESC
					)
					SELECT DISTINCT 
						DOCUMENTS.DOCUMENT_ID,
						DOCUMENTS.[FILENAME],
						DOCUMENTS.[DESCRIPTION],
						DOCUMENTS.KEYWORDS,
						DOCUMENTS.FILE_SIZE,
						DOCUMENTS.UPLOADED_DATE,
						DOCUMENTS.MIME_TYPE,
						DOCUMENTS.USER_CODE,
						OFFICE.OFFICE_CODE,
						EXPENSE_DETAIL.CL_CODE,
						EXPENSE_DETAIL.DIV_CODE,
						EXPENSE_DETAIL.PRD_CODE,
						EXPENSE_DETAIL.JOB_NBR,
						EXPENSE_DETAIL.JOB_COMP_NBR,
						'EXDTL',
						OFFICE.OFFICE_NAME,
						CLIENT.CL_NAME,
						DIVISION.DIV_NAME,
						PRODUCT.PRD_DESCRIPTION,
						JOB_LOG.JOB_DESC,
						DOCUMENTS.REPOSITORY_FILENAME,
						EXPENSE_HEADER.EMP_CODE,
						EXPENSE_DETAIL.INV_NBR,
						ISNULL(E.EMP_FNAME + ' ','') + ISNULL(E.EMP_MI + '. ', '') + ISNULL(E.EMP_LNAME, ''),
						EXPENSE_HEADER.EXP_DESC
					FROM   
						DOCUMENTS
						INNER JOIN EXPENSE_DETAIL_DOCS ON DOCUMENTS.DOCUMENT_ID = EXPENSE_DETAIL_DOCS.DOCUMENT_ID
						INNER JOIN EXPENSE_DETAIL ON EXPENSE_DETAIL.EXPDETAILID = EXPENSE_DETAIL_DOCS.EXPDETAILID
						INNER JOIN EXPENSE_HEADER ON EXPENSE_HEADER.INV_NBR = EXPENSE_DETAIL.INV_NBR
						INNER JOIN EMPLOYEE E ON EXPENSE_HEADER.EMP_CODE = E.EMP_CODE
						LEFT OUTER JOIN CLIENT ON CLIENT.CL_CODE = EXPENSE_DETAIL.CL_CODE
						LEFT OUTER JOIN DIVISION ON DIVISION.DIV_CODE = EXPENSE_DETAIL.DIV_CODE
						LEFT OUTER JOIN PRODUCT ON PRODUCT.PRD_CODE = EXPENSE_DETAIL.PRD_CODE
						LEFT OUTER JOIN OFFICE ON OFFICE.OFFICE_CODE = PRODUCT.OFFICE_CODE
						LEFT OUTER JOIN JOB_LOG ON JOB_LOG.JOB_NUMBER = EXPENSE_DETAIL.JOB_NBR
						LEFT OUTER JOIN JOB_COMPONENT ON JOB_COMPONENT.JOB_NUMBER = EXPENSE_DETAIL.JOB_NBR AND JOB_COMPONENT.JOB_COMPONENT_NBR = EXPENSE_DETAIL.JOB_COMP_NBR
						LEFT OUTER JOIN FUNCTIONS F ON EXPENSE_DETAIL.FNC_CODE = F.FNC_CODE
					WHERE
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1 
						OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(JOB_LOG.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10, 11)) AND UPPER(JOB_COMPONENT.JOB_COMP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR  CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR UPPER(EXPENSE_HEADER.EXP_DESC) LIKE '%' + @SEARCH_TEXT + '%'
						OR UPPER(E.EMP_CODE) LIKE '%' + @SEARCH_TEXT + '%'
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 6) AND UPPER(E.EMP_FNAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 6) AND UPPER(E.EMP_MI) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 6) AND UPPER(E.EMP_LNAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 9) AND UPPER(F.FNC_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 9) AND UPPER(F.FNC_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END 
				IF @IsBlockedFromContractLevel = 0 AND (@LEVEL = '' OR @LEVEL = 'CT')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						[LEVEL],
						OFFICE_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME,
						CONTRACT_ID,
						CONTRACT_CODE,
						CONTRACT_DESC
					)
					SELECT DISTINCT
						DOCUMENT_ID,
						[FILENAME],
						CONTRACT_DOCUMENTS_ALL.[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE.OFFICE_CODE,
						CLIENT.CL_CODE,
						DIVISION.DIV_CODE,
						PRODUCT.PRD_CODE,
						'CT' AS [LEVEL],
						OFFICE.OFFICE_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME,
						CT.CONTRACT_ID,
						CT.CONTRACT_CODE,
						CT.[DESCRIPTION]
					FROM   
						CONTRACT_DOCUMENTS_ALL
						INNER JOIN CONTRACT CT ON CT.CONTRACT_ID = CONTRACT_DOCUMENTS_ALL.CONTRACT_ID
						INNER JOIN CLIENT ON CLIENT.CL_CODE = CT.CL_CODE
						LEFT OUTER JOIN DIVISION ON CT.CL_CODE = DIVISION.CL_CODE AND CT.DIV_CODE = DIVISION.DIV_CODE
						LEFT OUTER JOIN PRODUCT ON PRODUCT.CL_CODE = CT.CL_CODE AND PRODUCT.DIV_CODE = CT.DIV_CODE AND PRODUCT.PRD_CODE = CT.PRD_CODE
						INNER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
					WHERE  
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(CONTRACT_DOCUMENTS_ALL.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END
				IF @IsBlockedFromContractReportLevel = 0 AND (@LEVEL = '' OR @LEVEL = 'ContractReport')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						[LEVEL],
						OFFICE_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME,
						CONTRACT_ID,
						CONTRACT_CODE,
						CONTRACT_DESC,
						CONTRACT_REPORT_DESC
					)
					SELECT DISTINCT
						DOCUMENT_ID,
						[FILENAME],
						CONTRACT_REPORT_DOCUMENTS_ALL.[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE.OFFICE_CODE,
						CLIENT.CL_CODE,
						DIVISION.DIV_CODE,
						PRODUCT.PRD_CODE,
						'CTR' AS [LEVEL],
						OFFICE.OFFICE_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME,
						CT.CONTRACT_ID,
						CT.CONTRACT_CODE,
						CT.[DESCRIPTION],
						CR.[DESCRIPTION]
					FROM   
						CONTRACT_REPORT_DOCUMENTS_ALL
						INNER JOIN CONTRACT_REPORT CR ON CR.CONTRACT_REPORT_ID = CONTRACT_REPORT_DOCUMENTS_ALL.CONTRACT_REPORT_ID
						INNER JOIN CONTRACT CT ON CT.CONTRACT_ID = CR.CONTRACT_ID
						INNER JOIN CLIENT ON CLIENT.CL_CODE = CT.CL_CODE
						LEFT OUTER JOIN DIVISION ON CT.CL_CODE = DIVISION.CL_CODE AND CT.DIV_CODE = DIVISION.DIV_CODE
						LEFT OUTER JOIN PRODUCT ON PRODUCT.CL_CODE = CT.CL_CODE AND PRODUCT.DIV_CODE = CT.DIV_CODE AND PRODUCT.PRD_CODE = CT.PRD_CODE
						INNER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
					WHERE  
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(CONTRACT_REPORT_DOCUMENTS_ALL.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(CR.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 5)) AND UPPER(CT.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END
				IF @IsBlockedFromARInvoiceLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'AR')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						CMP_CODE,
						OFFICE_CODE,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						JOB_NUMBER,
						JOB_COMPONENT_NBR,
						[LEVEL],
						OFFICE_NAME,
						CAMPAIGN_NAME,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						JOB_DESCRIPTION,
						JOB_COMP_DESCRIPTION,
						REPOSITORY_FILENAME
					)
					SELECT DISTINCT
						AIDA.DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						JOB_LOG.CMP_CODE AS CMP_CODE,
						JOB_LOG.OFFICE_CODE AS OFFICE_CODE,
						JOB_LOG.CL_CODE AS CL_CODE,
						JOB_LOG.DIV_CODE AS DIV_CODE,
						JOB_LOG.PRD_CODE AS PRD_CODE,
						JOB_COMPONENT.JOB_NUMBER AS JOB_NUMBER,
						JOB_COMPONENT.JOB_COMPONENT_NBR AS JOB_COMPONENT_NBR,
						'AR' AS [LEVEL],
						OFFICE_NAME AS OFFICE_NAME,
						CAMPAIGN.CMP_NAME AS CAMPAIGN_NAME,
						CLIENT.CL_NAME AS CLIENT_NAME,
						DIVISION.DIV_NAME AS DIVISION_NAME,
						PRODUCT.PRD_DESCRIPTION AS PRODUCT_DESCRIPTION,
						JOB_LOG.JOB_DESC AS JOB_DESCRIPTION,
						JOB_COMPONENT.JOB_COMP_DESC AS JOB_COMP_DESCRIPTION,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM   
						AR_INVOICE_DOCUMENTS_ALL AIDA
						LEFT OUTER JOIN JOB_LOG ON JOB_LOG.JOB_NUMBER = AIDA.JOB_NUMBER
						LEFT OUTER JOIN JOB_COMPONENT ON JOB_COMPONENT.JOB_NUMBER = AIDA.JOB_NUMBER AND JOB_COMPONENT.JOB_COMPONENT_NBR = AIDA.JOB_COMPONENT_NBR
						INNER JOIN PRODUCT ON PRODUCT.CL_CODE = JOB_LOG.CL_CODE AND PRODUCT.DIV_CODE = JOB_LOG.DIV_CODE AND PRODUCT.PRD_CODE = JOB_LOG.PRD_CODE
						INNER JOIN DIVISION ON DIVISION.CL_CODE = JOB_LOG.CL_CODE AND DIVISION.DIV_CODE = JOB_LOG.DIV_CODE
						INNER JOIN CLIENT ON CLIENT.CL_CODE = JOB_LOG.CL_CODE
						INNER JOIN OFFICE ON OFFICE.OFFICE_CODE = JOB_LOG.OFFICE_CODE
						LEFT OUTER JOIN CAMPAIGN ON CAMPAIGN.CMP_IDENTIFIER = JOB_LOG.CMP_IDENTIFIER
						LEFT OUTER JOIN MEDIA_ORDER_HEADER MOH ON MOH.CL_CODE = CLIENT.CL_CODE AND MOH.DIV_CODE = DIVISION.DIV_CODE AND MOH.PRD_CODE = PRODUCT.PRD_CODE
					WHERE 
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(JOB_LOG.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 10, 11)) AND UPPER(JOB_COMPONENT.JOB_COMP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(MOH.ORDER_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END
				IF @IsBlockedFromVendorLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'VC')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						[LEVEL],
						OFFICE_NAME,
						REPOSITORY_FILENAME,
						VENDOR_CODE,
						VENDOR_NAME
					)
					SELECT 
						DOCUMENT_ID,
						[FILENAME],
						VCDA.[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE.OFFICE_CODE AS OFFICE_CODE,
						'VC' AS [LEVEL],
						OFFICE.OFFICE_NAME AS OFFICE_NAME,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME,
						V.VN_CODE AS VENDOR_CODE,
						V.VN_NAME AS VENDOR_NAME
					FROM   
						VENDOR_CONTRACT_DOCUMENTS_ALL VCDA
						INNER JOIN VENDOR_CONTRACT VC ON VCDA.VENDOR_CONTRACT_ID = VC.VENDOR_CONTRACT_ID
						INNER JOIN VENDOR V ON VC.VN_CODE = V.VN_CODE
						LEFT OUTER JOIN OFFICE ON OFFICE.OFFICE_CODE = V.OFFICE_CODE
					WHERE  
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(VCDA.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR UPPER(VC.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%'
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 15)) AND UPPER(V.VN_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 15)) AND UPPER(V.VN_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END;
				IF @IsBlockedFromAlertLevel = 0 AND(@LEVEL = '' OR @LEVEL = 'ALRT') AND @INCLUDE_ATTACHMENTS = 1
				BEGIN
					SELECT @JOB_NUMBER = JOB_NUMBER, @JOB_COMPONENT_NBR = JOB_COMPONENT_NBR FROM [dbo].[advtf_get_job_component_from_string] (@SEARCH_TEXT);
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						REPOSITORY_FILENAME,
						USER_CODE,
						[LEVEL],
						OFFICE_CODE,
						OFFICE_NAME,
						CL_CODE,
						DIV_CODE,
						PRD_CODE,
						CLIENT_NAME,
						DIVISION_NAME,
						PRODUCT_DESCRIPTION,
						JOB_NUMBER,
						JOB_DESCRIPTION,
						JOB_COMPONENT_NBR,
						JOB_COMP_DESCRIPTION,
						ALERT_SUBJECT,
						CMP_CODE,
						CAMPAIGN_NAME
					)
					SELECT 
						D.DOCUMENT_ID,
						D.[FILENAME],
						D.[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						REPOSITORY_FILENAME,
						D.USER_CODE,
						'ALRT',
						OFFICE.OFFICE_CODE,
						OFFICE.OFFICE_NAME,
						CLIENT.CL_CODE,
						DIVISION.DIV_CODE,
						PRODUCT.PRD_CODE,
						CLIENT.CL_NAME,
						DIVISION.DIV_NAME,
						PRODUCT.PRD_DESCRIPTION,
						J.JOB_NUMBER,
						J.JOB_DESC,
						JC.JOB_COMPONENT_NBR,
						JC.JOB_COMP_DESC,
						A.[SUBJECT],
						C.CMP_CODE,
						C.CMP_NAME
					FROM
						DOCUMENTS D
						INNER JOIN ALERT_ATTACHMENT AA ON D.DOCUMENT_ID = AA.DOCUMENT_ID
						INNER JOIN ALERT A ON A.ALERT_ID = AA.ALERT_ID
						LEFT OUTER JOIN CLIENT ON A.CL_CODE = CLIENT.CL_CODE
						LEFT OUTER JOIN DIVISION ON A.DIV_CODE = DIVISION.DIV_CODE AND A.CL_CODE = DIVISION.CL_CODE
						LEFT OUTER JOIN PRODUCT ON A.CL_CODE = PRODUCT.CL_CODE AND A.DIV_CODE = PRODUCT.DIV_CODE AND A.PRD_CODE = PRODUCT.PRD_CODE
						LEFT OUTER JOIN OFFICE ON PRODUCT.OFFICE_CODE = OFFICE.OFFICE_CODE
						LEFT OUTER JOIN JOB_LOG J ON J.JOB_NUMBER = A.JOB_NUMBER
						LEFT OUTER JOIN JOB_COMPONENT JC ON JC.JOB_NUMBER = A.JOB_NUMBER AND JC.JOB_COMPONENT_NBR = A.JOB_COMPONENT_NBR
						LEFT OUTER JOIN CAMPAIGN C ON C.CMP_IDENTIFIER = A.CMP_IDENTIFIER
					WHERE 
						CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(D.KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(D.[DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(D.[FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_DESCRIPTION) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4)) AND UPPER(CLIENT.CL_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7)) AND UPPER(DIVISION.DIV_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 3, 4, 7, 14)) AND UPPER(PRODUCT.PRD_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(D.USER_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 16)) AND UPPER(A.[SUBJECT]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 16)) AND UPPER(CAST(A.BODY AS VARCHAR(MAX))) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @JOB_NUMBER > 0 AND @JOB_COMPONENT_NBR = 0 AND J.JOB_NUMBER = @JOB_NUMBER THEN 1 ELSE 0 END = 1
						OR CASE WHEN @JOB_NUMBER > 0 AND @JOB_COMPONENT_NBR > 0 AND JC.JOB_NUMBER = @JOB_NUMBER AND JC.JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR THEN 1 ELSE 0 END = 1
						OR CASE WHEN @JOB_NUMBER = 0 AND (@CRITERIA_ENUM_VALUE IN (1, 10)) AND UPPER(J.JOB_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @JOB_NUMBER = 0 AND @JOB_COMPONENT_NBR = 0 AND (@CRITERIA_ENUM_VALUE IN (1, 11)) AND UPPER(JC.JOB_COMP_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 17)) AND UPPER(C.CMP_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END
			END
	    END
		--	LEVELS THAT DO NOT INCLUDE CLIENT RESTRICTIONS (DOESN'T MATTER IF USER HAS CLIENT RESTRICTIONS)
		BEGIN
			IF @OfficeRestrictions > 0
			BEGIN
				IF @IsBlockedFromOfficeLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'OF')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						[LEVEL],
						OFFICE_NAME,
						REPOSITORY_FILENAME
					)
					SELECT 
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE.OFFICE_CODE AS OFFICE_CODE,
						'OF' AS [LEVEL],
						OFFICE.OFFICE_NAME AS OFFICE_NAME,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM   
						WV_CURRENT_OFFICE_DOCUMENTS
						INNER JOIN OFFICE ON OFFICE.OFFICE_CODE = WV_CURRENT_OFFICE_DOCUMENTS.OFFICE_CODE
						INNER JOIN EMP_OFFICE ON OFFICE.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE  
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END;
				IF @IsBlockedFromAgencyDesktopLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'AD')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						[LEVEL],
						OFFICE_NAME,
						REPOSITORY_FILENAME,
						DP_TM_CODE,
						DP_TM_DESC
					)
					SELECT DISTINCT
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE.OFFICE_CODE AS OFFICE_CODE,
						'AD' AS [LEVEL],
						OFFICE.OFFICE_NAME AS OFFICE_NAME,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME,
						DEPT_TEAM.DP_TM_CODE,
						DEPT_TEAM.DP_TM_DESC
					FROM   
						WV_CURRENT_AGENCY_DESKTOP_DOCUMENTS
						LEFT OUTER JOIN OFFICE ON OFFICE.OFFICE_CODE = WV_CURRENT_AGENCY_DESKTOP_DOCUMENTS.OFFICE_CODE
						LEFT OUTER JOIN DEPT_TEAM ON DEPT_TEAM.DP_TM_CODE = WV_CURRENT_AGENCY_DESKTOP_DOCUMENTS.DP_TM_CODE
						INNER JOIN EMP_OFFICE ON OFFICE.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE  
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 4) AND UPPER(DEPT_TEAM.DP_TM_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 4) AND UPPER(DEPT_TEAM.DP_TM_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				         
				END
				IF @IsBlockedFromExecutiveDesktopLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'ED')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						[LEVEL],
						OFFICE_NAME,
						REPOSITORY_FILENAME
					)
					SELECT DISTINCT 
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						WV_CURRENT_EXEC_DESKTOP_DOCUMENTS.USER_CODE,
						OFFICE.OFFICE_CODE AS OFFICE_CODE,
						'ED' AS [LEVEL],
						OFFICE.OFFICE_NAME AS OFFICE_NAME,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM   
						WV_CURRENT_EXEC_DESKTOP_DOCUMENTS
						LEFT OUTER JOIN OFFICE ON OFFICE.OFFICE_CODE = WV_CURRENT_EXEC_DESKTOP_DOCUMENTS.OFFICE_CODE
						INNER JOIN SEC_USER ON WV_CURRENT_EXEC_DESKTOP_DOCUMENTS.USER_CODE = SEC_USER.USER_CODE
						INNER JOIN EMPLOYEE ON SEC_USER.EMP_CODE = EMPLOYEE.EMP_CODE
						INNER JOIN EMP_OFFICE ON OFFICE.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE  
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(WV_CURRENT_EXEC_DESKTOP_DOCUMENTS.USER_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 6) AND UPPER(EMPLOYEE.EMP_FNAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 6) AND UPPER(EMPLOYEE.EMP_MI) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 6) AND UPPER(EMPLOYEE.EMP_LNAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END
				IF @IsBlockedFromEmployeeLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'EM')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						[LEVEL],
						REPOSITORY_FILENAME,
						EMP_CODE,
						EMP_FML
					)
					SELECT 
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						'EM',
						REPOSITORY_FILENAME,
						E.EMP_CODE,
						COALESCE (RTRIM(E.EMP_FNAME) + ' ', '') + COALESCE (E.EMP_MI + '. ', '') + COALESCE (E.EMP_LNAME, '')
					FROM   
						EMPLOYEE_DOCUMENTS_ALL EDA
						INNER JOIN EMPLOYEE E ON EDA.EMP_CODE = E.EMP_CODE
						INNER JOIN EMP_OFFICE ON E.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE  
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 8)) AND UPPER(E.EMP_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 8)) AND UPPER(E.EMP_FNAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 8)) AND UPPER(E.EMP_MI) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 8)) AND UPPER(E.EMP_LNAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END;
				IF @IsBlockedFromVendorLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'VR')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						[LEVEL],
						OFFICE_NAME,
						REPOSITORY_FILENAME,
						VENDOR_CODE,
						VENDOR_NAME
					)
					SELECT 
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE.OFFICE_CODE AS OFFICE_CODE,
						'VN' AS [LEVEL],
						OFFICE.OFFICE_NAME AS OFFICE_NAME,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME,
						V.VN_CODE AS VENDOR_CODE,
						V.VN_NAME AS VENDOR_NAME
					FROM   
						VENDOR_DOCUMENTS_ALL VDA
						INNER JOIN VENDOR V ON VDA.VN_CODE = V.VN_CODE
						LEFT OUTER JOIN OFFICE ON OFFICE.OFFICE_CODE = V.OFFICE_CODE
						INNER JOIN EMP_OFFICE ON OFFICE.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE  
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 15)) AND UPPER(V.VN_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 15)) AND UPPER(V.VN_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END;
				IF @IsBlockedFromExpenseReportLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'EX')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						[LEVEL],
						REPOSITORY_FILENAME,
						EMP_CODE,
						AP_ID,
						EMP_FML,
						EXPENSE_HEADER_DESC
					)
					SELECT DISTINCT 
						DOCUMENTS.DOCUMENT_ID,
						DOCUMENTS.[FILENAME],
						DOCUMENTS.[DESCRIPTION],
						DOCUMENTS.KEYWORDS,
						DOCUMENTS.FILE_SIZE,
						DOCUMENTS.UPLOADED_DATE,
						DOCUMENTS.MIME_TYPE,
						DOCUMENTS.USER_CODE,
						'EX',
						DOCUMENTS.REPOSITORY_FILENAME,
						EXPENSE_HEADER.EMP_CODE,
						EXPENSE_DOCS.INV_NBR,
						ISNULL(E.EMP_FNAME + ' ','') + ISNULL(E.EMP_MI + '. ', '') + ISNULL(E.EMP_LNAME, ''),
						EXPENSE_HEADER.EXP_DESC
					FROM   
						DOCUMENTS
						INNER JOIN EXPENSE_DOCS ON DOCUMENTS.DOCUMENT_ID = EXPENSE_DOCS.DOCUMENT_ID
						INNER JOIN EXPENSE_HEADER ON EXPENSE_HEADER.INV_NBR = EXPENSE_DOCS.INV_NBR
						INNER JOIN EMPLOYEE E ON EXPENSE_HEADER.EMP_CODE = E.EMP_CODE
						INNER JOIN EMP_OFFICE ON E.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
					WHERE
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1 
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR UPPER(EXPENSE_HEADER.EXP_DESC) LIKE '%' + @SEARCH_TEXT + '%'
						OR UPPER(EXPENSE_HEADER.EMP_CODE) LIKE '%' + @SEARCH_TEXT + '%'
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 6) AND UPPER(E.EMP_FNAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 6) AND UPPER(E.EMP_MI) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 6) AND UPPER(E.EMP_LNAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END 
			END
			ELSE
			BEGIN
				IF @IsBlockedFromOfficeLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'OF')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						[LEVEL],
						OFFICE_NAME,
						REPOSITORY_FILENAME
					)
					SELECT 
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE.OFFICE_CODE AS OFFICE_CODE,
						'OF' AS [LEVEL],
						OFFICE.OFFICE_NAME AS OFFICE_NAME,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM   
						WV_CURRENT_OFFICE_DOCUMENTS
						INNER JOIN OFFICE ON OFFICE.OFFICE_CODE = WV_CURRENT_OFFICE_DOCUMENTS.OFFICE_CODE
					WHERE  
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END;
				IF @IsBlockedFromAgencyDesktopLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'AD')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						[LEVEL],
						OFFICE_NAME,
						REPOSITORY_FILENAME,
						DP_TM_CODE,
						DP_TM_DESC
					)
					SELECT DISTINCT
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE.OFFICE_CODE AS OFFICE_CODE,
						'AD' AS [LEVEL],
						OFFICE.OFFICE_NAME AS OFFICE_NAME,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME,
						DEPT_TEAM.DP_TM_CODE,
						DEPT_TEAM.DP_TM_DESC
					FROM   
						WV_CURRENT_AGENCY_DESKTOP_DOCUMENTS
						LEFT OUTER JOIN OFFICE ON OFFICE.OFFICE_CODE = WV_CURRENT_AGENCY_DESKTOP_DOCUMENTS.OFFICE_CODE
						LEFT OUTER JOIN DEPT_TEAM ON DEPT_TEAM.DP_TM_CODE = WV_CURRENT_AGENCY_DESKTOP_DOCUMENTS.DP_TM_CODE
					WHERE  
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 4) AND UPPER(DEPT_TEAM.DP_TM_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 4) AND UPPER(DEPT_TEAM.DP_TM_DESC) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				         
				END
				IF @IsBlockedFromExecutiveDesktopLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'ED')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						[LEVEL],
						OFFICE_NAME,
						REPOSITORY_FILENAME
					)
					SELECT DISTINCT 
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						WV_CURRENT_EXEC_DESKTOP_DOCUMENTS.USER_CODE,
						OFFICE.OFFICE_CODE AS OFFICE_CODE,
						'ED' AS [LEVEL],
						OFFICE.OFFICE_NAME AS OFFICE_NAME,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME
					FROM   
						WV_CURRENT_EXEC_DESKTOP_DOCUMENTS
						LEFT OUTER JOIN OFFICE ON OFFICE.OFFICE_CODE = WV_CURRENT_EXEC_DESKTOP_DOCUMENTS.OFFICE_CODE
						INNER JOIN SEC_USER ON WV_CURRENT_EXEC_DESKTOP_DOCUMENTS.USER_CODE = SEC_USER.USER_CODE
						INNER JOIN EMPLOYEE ON SEC_USER.EMP_CODE = EMPLOYEE.EMP_CODE
					WHERE  
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER(WV_CURRENT_EXEC_DESKTOP_DOCUMENTS.USER_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 6) AND UPPER(EMPLOYEE.EMP_FNAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 6) AND UPPER(EMPLOYEE.EMP_MI) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 6) AND UPPER(EMPLOYEE.EMP_LNAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END
				IF @IsBlockedFromEmployeeLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'EM')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						[LEVEL],
						REPOSITORY_FILENAME,
						EMP_CODE,
						EMP_FML
					)
					SELECT 
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						'EM',
						REPOSITORY_FILENAME,
						E.EMP_CODE,
						COALESCE (RTRIM(E.EMP_FNAME) + ' ', '') + COALESCE (E.EMP_MI + '. ', '') + COALESCE (E.EMP_LNAME, '')
					FROM   
						EMPLOYEE_DOCUMENTS_ALL EDA
						INNER JOIN EMPLOYEE E ON EDA.EMP_CODE = E.EMP_CODE
					WHERE  
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 8)) AND UPPER(E.EMP_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 8)) AND UPPER(E.EMP_FNAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 8)) AND UPPER(E.EMP_MI) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 8)) AND UPPER(E.EMP_LNAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END;
				IF @IsBlockedFromVendorLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'VR')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE_CODE,
						[LEVEL],
						OFFICE_NAME,
						REPOSITORY_FILENAME,
						VENDOR_CODE,
						VENDOR_NAME
					)
					SELECT 
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						OFFICE.OFFICE_CODE AS OFFICE_CODE,
						'VN' AS [LEVEL],
						OFFICE.OFFICE_NAME AS OFFICE_NAME,
						REPOSITORY_FILENAME AS REPOSITORY_FILENAME,
						V.VN_CODE AS VENDOR_CODE,
						V.VN_NAME AS VENDOR_NAME
					FROM   
						VENDOR_DOCUMENTS_ALL VDA
						INNER JOIN VENDOR V ON VDA.VN_CODE = V.VN_CODE
						LEFT OUTER JOIN OFFICE ON OFFICE.OFFICE_CODE = V.OFFICE_CODE
					WHERE  
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 15)) AND UPPER(V.VN_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 15)) AND UPPER(V.VN_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_NAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 13)) AND UPPER(OFFICE.OFFICE_CODE) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END;
				IF @IsBlockedFromExpenseReportLevel = 0  AND (@LEVEL = '' OR @LEVEL = 'EX')
				BEGIN
					INSERT INTO @SEARCH_RESULTS
					(
						DOCUMENT_ID,
						[FILENAME],
						[DESCRIPTION],
						KEYWORDS,
						FILE_SIZE,
						UPLOADED_DATE,
						MIME_TYPE,
						USER_CODE,
						[LEVEL],
						REPOSITORY_FILENAME,
						EMP_CODE,
						AP_ID,
						EMP_FML,
						EXPENSE_HEADER_DESC
					)
					SELECT DISTINCT 
						DOCUMENTS.DOCUMENT_ID,
						DOCUMENTS.[FILENAME],
						DOCUMENTS.[DESCRIPTION],
						DOCUMENTS.KEYWORDS,
						DOCUMENTS.FILE_SIZE,
						DOCUMENTS.UPLOADED_DATE,
						DOCUMENTS.MIME_TYPE,
						DOCUMENTS.USER_CODE,
						'EX',
						DOCUMENTS.REPOSITORY_FILENAME,
						EXPENSE_HEADER.EMP_CODE,
						EXPENSE_DOCS.INV_NBR,
						ISNULL(E.EMP_FNAME + ' ','') + ISNULL(E.EMP_MI + '. ', '') + ISNULL(E.EMP_LNAME, ''),
						EXPENSE_HEADER.EXP_DESC
					FROM   
						DOCUMENTS
						INNER JOIN EXPENSE_DOCS ON DOCUMENTS.DOCUMENT_ID = EXPENSE_DOCS.DOCUMENT_ID
						INNER JOIN EXPENSE_HEADER ON EXPENSE_HEADER.INV_NBR = EXPENSE_DOCS.INV_NBR
						INNER JOIN EMPLOYEE E ON EXPENSE_HEADER.EMP_CODE = E.EMP_CODE
					WHERE
						CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER(KEYWORDS) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([DESCRIPTION]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE IN (1, 2)) AND UPPER([FILENAME]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1 
						OR CASE WHEN @CRITERIA_ENUM_VALUE = 1 AND UPPER([USER_CODE]) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR UPPER(EXPENSE_HEADER.EXP_DESC) LIKE '%' + @SEARCH_TEXT + '%'
						OR UPPER(EXPENSE_HEADER.EMP_CODE) LIKE '%' + @SEARCH_TEXT + '%'
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 6) AND UPPER(E.EMP_FNAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 6) AND UPPER(E.EMP_MI) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
						OR CASE WHEN (@CRITERIA_ENUM_VALUE = 1 OR @CRITERIA_ENUM_VALUE = 6) AND UPPER(E.EMP_LNAME) LIKE '%' + @SEARCH_TEXT + '%' THEN 1 ELSE 0 END = 1
				END 	
			END
	        
		END
	END
	--  NEW/MISSING DATA
	BEGIN
		UPDATE 
			@SEARCH_RESULTS
		SET 
			DOCUMENT_TYPE_ID = DT.DOCUMENT_TYPE_ID, 
			DOCUMENT_TYPE_DESC = DT.DOCUMENT_TYPE_DESC,
			IS_PRIVATE = CAST(ISNULL(D.PRIVATE_FLAG, 0) AS BIT)
		FROM
			@SEARCH_RESULTS SR 
			INNER JOIN DOCUMENTS D ON SR.DOCUMENT_ID = D.DOCUMENT_ID
			INNER JOIN DOCUMENT_TYPE DT ON D.DOCUMENT_TYPE_ID = DT.DOCUMENT_TYPE_ID
			INNER JOIN SEC_USER ON UPPER(D.USER_CODE) = UPPER(SEC_USER.USER_CODE)
			INNER JOIN EMPLOYEE ON SEC_USER.EMP_CODE = EMPLOYEE.EMP_CODE
	END
	-- RESTRICT IF DOING DOC TYPE SEARCH
	IF @DOCUMENT_TYPE_ID > 0
	BEGIN
		DELETE FROM @SEARCH_RESULTS WHERE DOCUMENT_TYPE_ID <> @DOCUMENT_TYPE_ID;
	END
	-- RESTRICT IF DOING LABEL SEARCH
	IF @LABEL_ID > 0
	BEGIN
		DELETE FROM @SEARCH_RESULTS WHERE DOCUMENT_ID NOT IN (SELECT DISTINCT DOCUMENT_ID FROM LABEL_DOCUMENT WHERE LABEL_ID = @LABEL_ID);
	END
	-- FINAL SELECT
	IF @ACCESS_PRIVATE = 1
	BEGIN
		SELECT
			SR.*
		FROM   
			@SEARCH_RESULTS AS SR
		ORDER BY
			--DOCUMENT_ID ASC,
			SR.[FILENAME], 
			SR.UPLOADED_DATE DESC, 
			SR.OFFICE_NAME, 
			SR.CLIENT_NAME, 
			SR.DIVISION_NAME, 
			SR.PRODUCT_DESCRIPTION, 
			SR.JOB_NUMBER, 
			SR.JOB_COMPONENT_NBR DESC;
	END
	ELSE
	BEGIN
		SELECT
			SR.*
		FROM   
			@SEARCH_RESULTS AS SR 
			INNER JOIN DOCUMENTS AS D ON SR.DOCUMENT_ID = D.DOCUMENT_ID
		WHERE  
			D.PRIVATE_FLAG IS NULL OR D.PRIVATE_FLAG = 0
		ORDER BY
			--DOCUMENT_ID ASC,
			SR.[FILENAME], 
			SR.UPLOADED_DATE DESC, 
			SR.OFFICE_NAME, 
			SR.CLIENT_NAME, 
			SR.DIVISION_NAME, 
			SR.PRODUCT_DESCRIPTION, 
			SR.JOB_NUMBER, 
			SR.JOB_COMPONENT_NBR DESC;
	END
/*=========== QUERY ===========*/
END