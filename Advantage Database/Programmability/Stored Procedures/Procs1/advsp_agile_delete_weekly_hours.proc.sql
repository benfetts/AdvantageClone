IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'[dbo].[advsp_agile_delete_weekly_hours]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
    DROP PROCEDURE [dbo].[advsp_agile_delete_weekly_hours]
GO
CREATE PROCEDURE [dbo].[advsp_agile_delete_weekly_hours] 
@ALERT_ID INT
AS
BEGIN
	--  UPDATE EMPLOYEE HOURS BEFORE DELETING WEEKLY RECORDS
	--BEGIN
	--	UPDATE ALERT_RCPT SET HOURS_ALLOWED = S.SUM_HOURS
	--	FROM
	--		(
	--			SELECT 
	--				ALERT_ID, EMP_CODE, SUM(HOURS) AS SUM_HOURS
	--			FROM 
	--				SPRINT_EMPLOYEE SE
	--			WHERE 
	--				SE.ALERT_ID = @ALERT_ID
	--				AND SE.SPRINT_DTL_ID IS NULL
	--			GROUP BY
	--				ALERT_ID, EMP_CODE
	--		) AS S
	--		INNER JOIN ALERT_RCPT AR ON AR.EMP_CODE = S.EMP_CODE AND AR.ALERT_ID = S.ALERT_ID
	--	WHERE
	--		AR.CURRENT_NOTIFY = 1
	--		AND AR.ALERT_ID = @ALERT_ID;
	--END
	--  DELETE WEEKLY RECORDS
	BEGIN
		DELETE FROM SPRINT_EMPLOYEE WITH(ROWLOCK) 
		WHERE ALERT_ID = @ALERT_ID;
	END
	--  MAKE SURE ALERT REC IS SYNC'ED WITH TOTAL (?)
	--BEGIN
	--	UPDATE ALERT SET HRS_ALLOWED = A.SUM_HOURS_ALLOWED
	--	FROM
	--		(
	--			SELECT
	--				ALERT_ID, SUM(AR.HOURS_ALLOWED) AS SUM_HOURS_ALLOWED
	--			FROM 
	--				ALERT_RCPT AR
	--			WHERE
	--				AR.ALERT_ID = @ALERT_ID
	--				AND AR.CURRENT_NOTIFY = 1
	--			GROUP BY
	--				AR.ALERT_ID
	--		) AS A INNER JOIN ALERT AA ON A.ALERT_ID = AA.ALERT_ID
	--	WHERE
	--		AA.ALERT_ID = @ALERT_ID;
	--END
END
GO


