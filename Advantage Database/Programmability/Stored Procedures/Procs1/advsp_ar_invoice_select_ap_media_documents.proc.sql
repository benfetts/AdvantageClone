CREATE PROCEDURE advsp_ar_invoice_select_ap_media_documents @ARInvoiceNumber int, @ARInvoiceSequence smallint, @ARType varchar(3)

AS
BEGIN

SET NOCOUNT ON;

	SELECT DISTINCT 
		[InvoiceNumber] = ARM.AR_INV_NBR, 
		[SequenceNumber] = ARM.AR_INV_SEQ,
		[Type] = ARM.AR_TYPE,
		[AccountPayableID] = APD.AP_ID   
	FROM dbo.ARINV_MEDIA ARM
		INNER JOIN dbo.AP_INTERNET AP ON AP.ORDER_NBR = ARM.ORDER_NBR AND AP.ORDER_LINE_NBR = ARM.LINE_NBR AND ARM.ORDER_TYPE = 'I'
		INNER JOIN dbo.AP_HEADER APH ON AP.AP_ID = APH.AP_ID
		INNER JOIN dbo.AP_DOCUMENTS APD ON APH.AP_ID = APD.AP_ID 
	WHERE	ARM.AR_INV_NBR = @ARInvoiceNumber 
	AND		ARM.AR_INV_SEQ = @ARInvoiceSequence 
	AND		ARM.AR_TYPE = @ARType 
	AND		(AP.MODIFY_DELETE IS NULL OR AP.MODIFY_DELETE = 0)
	AND		(APH.MODIFY_FLAG IS NULL OR APH.MODIFY_FLAG = 0)
	AND		(APH.DELETE_FLAG IS NULL OR APH.DELETE_FLAG = 0)
	
	UNION
	
	SELECT ARM.AR_INV_NBR, ARM.AR_INV_SEQ, ARM.AR_TYPE, APD.AP_ID   
	FROM dbo.ARINV_MEDIA ARM
		INNER JOIN dbo.AP_MAGAZINE AP ON AP.ORDER_NBR = ARM.ORDER_NBR AND AP.ORDER_LINE_NBR = ARM.LINE_NBR AND ARM.ORDER_TYPE = 'M'
		INNER JOIN dbo.AP_HEADER APH ON AP.AP_ID = APH.AP_ID
		INNER JOIN dbo.AP_DOCUMENTS APD ON APH.AP_ID = APD.AP_ID 
	WHERE	ARM.AR_INV_NBR = @ARInvoiceNumber 
	AND		ARM.AR_INV_SEQ = @ARInvoiceSequence 
	AND		ARM.AR_TYPE = @ARType 
	AND		(AP.MODIFY_DELETE IS NULL OR AP.MODIFY_DELETE = 0)
	AND		(APH.MODIFY_FLAG IS NULL OR APH.MODIFY_FLAG = 0)
	AND		(APH.DELETE_FLAG IS NULL OR APH.DELETE_FLAG = 0)
	
	UNION
	
	SELECT ARM.AR_INV_NBR, ARM.AR_INV_SEQ, ARM.AR_TYPE, APD.AP_ID   
	FROM dbo.ARINV_MEDIA ARM
		INNER JOIN dbo.AP_NEWSPAPER AP ON AP.ORDER_NBR = ARM.ORDER_NBR AND AP.ORDER_LINE_NBR = ARM.LINE_NBR AND ARM.ORDER_TYPE = 'N'
		INNER JOIN dbo.AP_HEADER APH ON AP.AP_ID = APH.AP_ID
		INNER JOIN dbo.AP_DOCUMENTS APD ON APH.AP_ID = APD.AP_ID 
	WHERE	ARM.AR_INV_NBR = @ARInvoiceNumber 
	AND		ARM.AR_INV_SEQ = @ARInvoiceSequence 
	AND		(AP.MODIFY_DELETE IS NULL OR AP.MODIFY_DELETE = 0)
	AND		(APH.MODIFY_FLAG IS NULL OR APH.MODIFY_FLAG = 0)
	AND		(APH.DELETE_FLAG IS NULL OR APH.DELETE_FLAG = 0)
	
	UNION
	
	SELECT ARM.AR_INV_NBR, ARM.AR_INV_SEQ, ARM.AR_TYPE, APD.AP_ID   
	FROM dbo.ARINV_MEDIA ARM
		INNER JOIN dbo.AP_OUTDOOR APO ON APO.ORDER_NBR = ARM.ORDER_NBR AND APO.ORDER_LINE_NBR = ARM.LINE_NBR AND ARM.ORDER_TYPE = 'O'
		INNER JOIN dbo.AP_HEADER APH ON APO.AP_ID = APH.AP_ID
		INNER JOIN dbo.AP_DOCUMENTS APD ON APH.AP_ID = APD.AP_ID 
	WHERE	ARM.AR_INV_NBR = @ARInvoiceNumber 
	AND		ARM.AR_INV_SEQ = @ARInvoiceSequence 
	AND		(APO.MODIFY_DELETE IS NULL OR APO.MODIFY_DELETE = 0)
	AND		(APH.MODIFY_FLAG IS NULL OR APH.MODIFY_FLAG = 0)
	AND		(APH.DELETE_FLAG IS NULL OR APH.DELETE_FLAG = 0)
	
	UNION
	
	SELECT ARM.AR_INV_NBR, ARM.AR_INV_SEQ, ARM.AR_TYPE, APD.AP_ID   
	FROM dbo.ARINV_MEDIA ARM
		INNER JOIN dbo.AP_RADIO AP ON AP.ORDER_NBR = ARM.ORDER_NBR AND AP.ORDER_LINE_NBR = ARM.LINE_NBR AND ARM.ORDER_TYPE = 'R'
		INNER JOIN dbo.AP_HEADER APH ON AP.AP_ID = APH.AP_ID
		INNER JOIN dbo.AP_DOCUMENTS APD ON APH.AP_ID = APD.AP_ID 
	WHERE	ARM.AR_INV_NBR = @ARInvoiceNumber 
	AND		ARM.AR_INV_SEQ = @ARInvoiceSequence 
	AND		(AP.MODIFY_DELETE IS NULL OR AP.MODIFY_DELETE = 0)
	AND		(APH.MODIFY_FLAG IS NULL OR APH.MODIFY_FLAG = 0)
	AND		(APH.DELETE_FLAG IS NULL OR APH.DELETE_FLAG = 0)
	
	UNION
	
	SELECT ARM.AR_INV_NBR, ARM.AR_INV_SEQ, ARM.AR_TYPE, APD.AP_ID   
	FROM dbo.ARINV_MEDIA ARM
		INNER JOIN dbo.AP_TV AP ON AP.ORDER_NBR = ARM.ORDER_NBR AND AP.ORDER_LINE_NBR = ARM.LINE_NBR AND ARM.ORDER_TYPE = 'T'
		INNER JOIN dbo.AP_HEADER APH ON AP.AP_ID = APH.AP_ID
		INNER JOIN dbo.AP_DOCUMENTS APD ON APH.AP_ID = APD.AP_ID 
	WHERE	ARM.AR_INV_NBR = @ARInvoiceNumber 
	AND		ARM.AR_INV_SEQ = @ARInvoiceSequence 
	AND		(AP.MODIFY_DELETE IS NULL OR AP.MODIFY_DELETE = 0)
	AND		(APH.MODIFY_FLAG IS NULL OR APH.MODIFY_FLAG = 0)
	AND		(APH.DELETE_FLAG IS NULL OR APH.DELETE_FLAG = 0)
END
GO