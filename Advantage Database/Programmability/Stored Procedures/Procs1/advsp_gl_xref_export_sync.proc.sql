CREATE PROCEDURE [dbo].[advsp_gl_xref_export_sync]
	@RECORD_SOURCE_ID INT
AS
BEGIN

	INSERT INTO dbo.GLACCOUNT_XREF_EXPORT (TARGET_GLACODE, RECORD_SOURCE_ID)
		SELECT
			GLACCOUNT_XREF.SOURCE_GLACODE,
			GLACCOUNT_XREF.RECORD_SOURCE_ID
		FROM
			dbo.GLACCOUNT_XREF 
		LEFT OUTER JOIN
			dbo.GLACCOUNT_XREF_EXPORT ON GLACCOUNT_XREF.SOURCE_GLACODE = GLACCOUNT_XREF_EXPORT.TARGET_GLACODE AND
										 GLACCOUNT_XREF.RECORD_SOURCE_ID = GLACCOUNT_XREF_EXPORT.RECORD_SOURCE_ID
		WHERE
			GLACCOUNT_XREF_EXPORT.TARGET_GLACODE IS NULL AND
			GLACCOUNT_XREF.RECORD_SOURCE_ID = @RECORD_SOURCE_ID
		
	INSERT INTO dbo.GLACCOUNT_XREF_EXPORT_DETAIL (GLACCOUNT_XREF_EXPORT_ID, GLACODE)
		SELECT 
			GLACCOUNT_XREF_EXPORT.GLACCOUNT_XREF_EXPORT_ID,
			GLACCOUNT_XREF.GLACODE
		FROM
			dbo.GLACCOUNT_XREF
		INNER JOIN
			dbo.GLACCOUNT_XREF_EXPORT ON GLACCOUNT_XREF.SOURCE_GLACODE = GLACCOUNT_XREF_EXPORT.TARGET_GLACODE AND
										 GLACCOUNT_XREF.RECORD_SOURCE_ID = GLACCOUNT_XREF_EXPORT.RECORD_SOURCE_ID
		LEFT OUTER JOIN
			dbo.GLACCOUNT_XREF_EXPORT_DETAIL ON GLACCOUNT_XREF.GLACODE = GLACCOUNT_XREF_EXPORT_DETAIL.GLACODE
		WHERE
			GLACCOUNT_XREF_EXPORT_DETAIL.GLACODE IS NULL AND
			GLACCOUNT_XREF.RECORD_SOURCE_ID = @RECORD_SOURCE_ID

END