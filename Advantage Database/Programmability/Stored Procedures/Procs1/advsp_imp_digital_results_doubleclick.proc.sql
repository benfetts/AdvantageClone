CREATE PROCEDURE [dbo].[advsp_imp_digital_results_doubleclick] @BATCH_NAME varchar(50)

AS

BEGIN
	UPDATE 
		dbo.IMP_DIGITAL_RESULTS_STAGING 
	SET
		MEDIA_PLAN_ID = mp.MEDIA_PLAN_ID,
		MEDIA_PLAN_DTL_ID = mp.MEDIA_PLAN_DTL_ID,
		CL_CODE = h.CL_CODE,
		CL_NAME = c.CL_NAME,
		DIV_CODE = h.DIV_CODE,
		PRD_CODE = h.PRD_CODE,
		MEDIA_TYPE = 'I',
		SC_CODE = h.MEDIA_TYPE,
		CMP_IDENTIFIER = h.CMP_IDENTIFIER,
		CMP_CODE = h.CMP_CODE,
		CMP_NAME = cmp.CMP_NAME,
		VN_CODE = h.VN_CODE,
		VN_NAME = v.VN_NAME,
		MARKET_CODE = h.MARKET_CODE,
		MARKET_DESC = m.MARKET_DESC,
		AD_SIZE_CODE = d.SIZE,
		AD_SIZE_DESC = CASE WHEN ads.SIZE_CODE IS NULL THEN d.CREATIVE_SIZE ELSE ads.SIZE_DESC END,
		AD_NBR = d.AD_NUMBER,
		AD_NBR_DESC = an.AD_NBR_DESC,
		INTERNET_TYPE_CODE = d.INTERNET_TYPE,
		TARGET_AUDIENCE = d.TARGET_AUDIENCE,
		PLACEMENT_URL = cw.WEBSITE_ADDRESS,
		NET_GROSS_RATE = CASE WHEN h.NET_GROSS = 1 THEN d.GROSS_RATE ELSE d.NET_RATE END
	FROM
		dbo.IMP_DIGITAL_RESULTS_STAGING s
			INNER JOIN dbo.INTERNET_DETAIL d ON s.PLACEMENT_ID = d.AD_SERVER_PLACEMENT_ID AND d.ACTIVE_REV = 1
			INNER JOIN dbo.INTERNET_HEADER h ON h.ORDER_NBR = d.ORDER_NBR 
			INNER JOIN dbo.CLIENT c ON h.CL_CODE = c.CL_CODE
			LEFT OUTER JOIN dbo.CAMPAIGN cmp ON h.CMP_IDENTIFIER = cmp.CMP_IDENTIFIER 
			LEFT OUTER JOIN dbo.VENDOR v ON h.VN_CODE = v.VN_CODE
			LEFT OUTER JOIN dbo.MARKET m ON h.MARKET_CODE = m.MARKET_CODE 
			LEFT OUTER JOIN dbo.AD_SIZE ads ON d.SIZE = ads.SIZE_CODE 
			LEFT OUTER JOIN dbo.AD_NUMBER an ON d.AD_NUMBER = an.AD_NBR 
			LEFT OUTER JOIN dbo.CL_WEBSITE cw ON cmp.CL_WEBSITE_ID = cw.WEBSITE_ID
			LEFT OUTER JOIN dbo.MEDIA_PLAN_DTL_LEVEL_LINE_DATA mp ON d.ORDER_NBR = mp.ORDER_NBR AND d.LINE_NBR = mp.ORDER_LINE_NBR 
	WHERE
		s.BATCH_NAME = @BATCH_NAME



END
