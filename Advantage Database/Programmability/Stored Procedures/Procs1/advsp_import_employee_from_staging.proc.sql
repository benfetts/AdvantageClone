CREATE PROCEDURE [dbo].[advsp_import_employee_from_staging]
	@IMPORT_ID AS int,
	@USER_CODE AS varchar(30),
	@IS_UPDATING AS bit
AS
BEGIN
	-- =============================================
	-- Author:		Steven Walden
	-- Create date: 02/15/2011
	-- Description:	This will move employee import 
	--				into the employee table
	-- =============================================
	DECLARE @EMP_CODE AS varchar(6)
	DECLARE @DP_TM_CODE AS varchar(4)
	DECLARE @EMP_LNAME AS varchar(30)
	DECLARE @EMP_FNAME AS varchar(30)
	DECLARE @EMP_MI AS varchar(1)
	DECLARE @EMP_COST_RATE AS decimal(9,2)
	DECLARE @EMP_ADDRESS1 AS varchar(30)
	DECLARE @EMP_ADDRESS2 AS varchar(30)
	DECLARE @EMP_CITY AS varchar(20)
	DECLARE @EMP_COUNTY AS varchar(20)
	DECLARE @EMP_PHONE AS varchar(13)
	DECLARE @EMP_STATE AS varchar(10)
	DECLARE @EMP_OTHER_INFO AS varchar(20)
	DECLARE @EMP_ZIP AS varchar(10)
	DECLARE @EMP_TITLE AS varchar(50)
	DECLARE @EMP_DATE AS smalldatetime
	DECLARE @EMP_TERM_DATE AS smalldatetime
	DECLARE @EMP_BIRTH_DATE AS smalldatetime
	DECLARE @EMP_LAST_INCREASE AS smalldatetime
	DECLARE @EMP_NEXT_REVIEW AS smalldatetime
	DECLARE @EMP_ANNUAL_SALARY AS decimal
	DECLARE @EMP_MONTHLY_SALARY AS decimal
	DECLARE @EMP_EMAIL AS varchar(50)
	DECLARE @MTH_HRS_GOAL AS decimal(9,3)
	DECLARE @OFFICE_CODE AS varchar(4)
	DECLARE @SUPERVISOR_CODE AS varchar(6)
	DECLARE @DEF_FNC_CODE AS varchar(6)
	DECLARE @PO_LIMIT AS decimal
	DECLARE @EMP_ACCOUNT_NBR AS varchar(30)
	DECLARE @EMP_PHONE_WORK AS varchar(13)
	DECLARE @EMP_PHONE_CELL AS varchar(13)
	DECLARE @EMP_PHONE_ALT AS varchar(13)
	DECLARE @EMP_PHONE_WORK_EXT AS varchar(10)
	DECLARE @STD_ANNUAL_HRS AS decimal
	DECLARE @DIRECT_HRS_PER AS decimal(9,3)
	DECLARE @DEF_TRF_ROLE AS varchar(6)
	DECLARE @PO_APPR_RULE_CODE AS varchar(6)

	IF @IS_UPDATING = 0 BEGIN
	
		INSERT INTO 
			[dbo].[EMPLOYEE]([EMP_CODE],[DP_TM_CODE],[EMP_LNAME],[EMP_FNAME],[EMP_MI],
							 [EMP_COST_RATE],[EMP_ADDRESS1],[EMP_ADDRESS2],[EMP_CITY],
							 [EMP_COUNTY],[EMP_PHONE],[EMP_STATE],[EMP_OTHER_INFO],[EMP_ZIP],
							 [EMPLOYEE_TITLE_ID],[EMP_DATE],[EMP_TERM_DATE],[EMP_BIRTH_DATE],
							 [EMP_LAST_INCREASE],[EMP_NEXT_REVIEW],[EMP_ANNUAL_SALARY],
							 [EMP_MONTHLY_SALARY],[EMP_EMAIL],[MTH_HRS_GOAL],[OFFICE_CODE],
							 [SUPERVISOR_CODE],[DEF_FNC_CODE],[PO_LIMIT],[EMP_ACCOUNT_NBR],
							 [EMP_PHONE_WORK],[EMP_PHONE_CELL],[EMP_PHONE_ALT],[EMP_PHONE_WORK_EXT],
							 [STD_ANNUAL_HRS],[DIRECT_HRS_PER],[DEF_TRF_ROLE],[PO_APPR_RULE_CODE],
							 [EMP_PAY_TO_ADDR1],[EMP_PAY_TO_ADDR2],[EMP_PAY_TO_CITY],
							 [EMP_PAY_TO_COUNTY],[EMP_PAY_TO_STATE],[EMP_PAY_TO_ZIP],
							 [MON_HRS],[TUE_HRS],[WED_HRS],[THU_HRS],[FRI_HRS], [EMP_WORK_DAYS],
							 [CREATED_BY],[CREATED_DATE],[LAST_MODIFIED_BY],[LAST_MODIFIED_DATE],
							 [METHOD], [IS_ACTIVE_FREELANCE])
		SELECT 
			[EMP_CODE],[DP_TM_CODE],[EMP_LNAME],[EMP_FNAME],[EMP_MI],
			[EMP_COST_RATE],[EMP_ADDRESS1],[EMP_ADDRESS2],[EMP_CITY],
			[EMP_COUNTY],[EMP_PHONE],[EMP_STATE],[EMP_OTHER_INFO],[EMP_ZIP],
			[EMP_TITLE],[EMP_DATE],[EMP_TERM_DATE],[EMP_BIRTH_DATE],
			[EMP_LAST_INCREASE],[EMP_NEXT_REVIEW],[EMP_ANNUAL_SALARY],
			[EMP_MONTHLY_SALARY],[EMP_EMAIL],[MTH_HRS_GOAL],[OFFICE_CODE],
			[SUPERVISOR_CODE],[DEF_FNC_CODE],[PO_LIMIT],[EMP_ACCOUNT_NBR],
			[EMP_PHONE_WORK],[EMP_PHONE_CELL],[EMP_PHONE_ALT],[EMP_PHONE_WORK_EXT],
			[STD_ANNUAL_HRS],[DIRECT_HRS_PER],[DEF_TRF_ROLE],[PO_APPR_RULE_CODE],
			[EMP_ADDRESS1],[EMP_ADDRESS2],[EMP_CITY],
			[EMP_COUNTY],[EMP_STATE],[EMP_ZIP],
			8,8,8,8,8, 'Mon,Tue,Wed,Thu,Fri',
			@USER_CODE,GETDATE(),@USER_CODE,GETDATE(),
			'I', 0
		FROM 
			dbo.IMP_EMP_STAGING
		WHERE
			[IMPORT_ID] = @IMPORT_ID
			
	END ELSE BEGIN
		
		SET @EMP_CODE = NULL
		SET @DP_TM_CODE = NULL
		SET @EMP_LNAME = NULL
		SET @EMP_FNAME = NULL
		SET @EMP_MI = NULL
		SET @EMP_COST_RATE = NULL
		SET @EMP_ADDRESS1 = NULL
		SET @EMP_ADDRESS2 = NULL
		SET @EMP_CITY = NULL
		SET @EMP_COUNTY = NULL
		SET @EMP_PHONE = NULL
		SET @EMP_STATE = NULL
		SET @EMP_OTHER_INFO = NULL
		SET @EMP_ZIP = NULL
		SET @EMP_TITLE = NULL
		SET @EMP_DATE = NULL
		SET @EMP_TERM_DATE = NULL
		SET @EMP_BIRTH_DATE = NULL
		SET @EMP_LAST_INCREASE = NULL
		SET @EMP_NEXT_REVIEW = NULL
		SET @EMP_ANNUAL_SALARY = NULL
		SET @EMP_MONTHLY_SALARY = NULL
		SET @EMP_EMAIL = NULL
		SET @MTH_HRS_GOAL = NULL
		SET @OFFICE_CODE = NULL
		SET @SUPERVISOR_CODE = NULL
		SET @DEF_FNC_CODE = NULL
		SET @PO_LIMIT = NULL
		SET @EMP_ACCOUNT_NBR = NULL
		SET @EMP_PHONE_WORK = NULL
		SET @EMP_PHONE_CELL = NULL
		SET @EMP_PHONE_ALT = NULL
		SET @EMP_PHONE_WORK_EXT = NULL
		SET @STD_ANNUAL_HRS = NULL
		SET @DIRECT_HRS_PER = NULL
		SET @DEF_TRF_ROLE = NULL
		SET @PO_APPR_RULE_CODE = NULL
	
		SELECT
			@EMP_CODE = [EMP_CODE],
			@DP_TM_CODE = [DP_TM_CODE],
			@EMP_LNAME = [EMP_LNAME],
			@EMP_FNAME = [EMP_FNAME],
			@EMP_MI = [EMP_MI],
			@EMP_COST_RATE = [EMP_COST_RATE],
			@EMP_ADDRESS1 = [EMP_ADDRESS1],
			@EMP_ADDRESS2 = [EMP_ADDRESS2],
			@EMP_CITY = [EMP_CITY],
			@EMP_COUNTY = [EMP_COUNTY],
			@EMP_PHONE = [EMP_PHONE],
			@EMP_STATE = [EMP_STATE],
			@EMP_OTHER_INFO = [EMP_OTHER_INFO],
			@EMP_ZIP = [EMP_ZIP],
			@EMP_TITLE = [EMP_TITLE],
			@EMP_DATE = CASE WHEN [EMP_DATE] = '01/01/1900' THEN NULL ELSE [EMP_DATE] END,
			@EMP_TERM_DATE = CASE WHEN [EMP_TERM_DATE] = '01/01/1900' THEN NULL ELSE [EMP_TERM_DATE] END,
			@EMP_BIRTH_DATE = CASE WHEN [EMP_BIRTH_DATE] = '01/01/1900' THEN NULL ELSE [EMP_BIRTH_DATE] END,
			@EMP_LAST_INCREASE = CASE WHEN [EMP_LAST_INCREASE] = '01/01/1900' THEN NULL ELSE [EMP_LAST_INCREASE] END,
			@EMP_NEXT_REVIEW = CASE WHEN [EMP_NEXT_REVIEW] = '01/01/1900' THEN NULL ELSE [EMP_NEXT_REVIEW] END,
			@EMP_ANNUAL_SALARY = [EMP_ANNUAL_SALARY],
			@EMP_MONTHLY_SALARY = [EMP_MONTHLY_SALARY],
			@EMP_EMAIL = [EMP_EMAIL],
			@MTH_HRS_GOAL = [MTH_HRS_GOAL],
			@OFFICE_CODE = [OFFICE_CODE],
			@SUPERVISOR_CODE = [SUPERVISOR_CODE],
			@DEF_FNC_CODE = [DEF_FNC_CODE],
			@PO_LIMIT = [PO_LIMIT],
			@EMP_ACCOUNT_NBR = [EMP_ACCOUNT_NBR],
			@EMP_PHONE_WORK = [EMP_PHONE_WORK],
			@EMP_PHONE_CELL = [EMP_PHONE_CELL],
			@EMP_PHONE_ALT = [EMP_PHONE_ALT],
			@EMP_PHONE_WORK_EXT = [EMP_PHONE_WORK_EXT],
			@STD_ANNUAL_HRS = [STD_ANNUAL_HRS],
			@DIRECT_HRS_PER = [DIRECT_HRS_PER],
			@DEF_TRF_ROLE = [DEF_TRF_ROLE],
			@PO_APPR_RULE_CODE = [PO_APPR_RULE_CODE]
		FROM
			[dbo].[IMP_EMP_STAGING]
		WHERE
			[IMPORT_ID] = @IMPORT_ID
	
		UPDATE
			[dbo].[EMPLOYEE]
		SET
		   	[DP_TM_CODE] = @DP_TM_CODE,
			[EMP_LNAME] = @EMP_LNAME,
			[EMP_FNAME] = @EMP_FNAME,
			[EMP_MI] = @EMP_MI,
			[EMP_COST_RATE] = @EMP_COST_RATE,
			[EMP_ADDRESS1] = @EMP_ADDRESS1,
			[EMP_ADDRESS2] = @EMP_ADDRESS2,
			[EMP_CITY] = @EMP_CITY,
			[EMP_COUNTY] = @EMP_COUNTY,
			[EMP_PHONE] = @EMP_PHONE,
			[EMP_STATE] = @EMP_STATE,
			[EMP_OTHER_INFO] = @EMP_OTHER_INFO,
			[EMP_ZIP] = @EMP_ZIP,
			[EMPLOYEE_TITLE_ID] = @EMP_TITLE,
			[EMP_DATE] = @EMP_DATE,
			[EMP_TERM_DATE] = @EMP_TERM_DATE,
			[EMP_BIRTH_DATE] = @EMP_BIRTH_DATE,
			[EMP_LAST_INCREASE] = @EMP_LAST_INCREASE,
			[EMP_NEXT_REVIEW] = @EMP_NEXT_REVIEW,
			[EMP_ANNUAL_SALARY] = @EMP_ANNUAL_SALARY,
			[EMP_MONTHLY_SALARY] = @EMP_MONTHLY_SALARY,
			[EMP_EMAIL] = @EMP_EMAIL,
			[MTH_HRS_GOAL] = @MTH_HRS_GOAL,
			[OFFICE_CODE] = @OFFICE_CODE,
			[SUPERVISOR_CODE] = @SUPERVISOR_CODE,
			[DEF_FNC_CODE] = @DEF_FNC_CODE,
			[PO_LIMIT] = @PO_LIMIT,
			[EMP_ACCOUNT_NBR] = @EMP_ACCOUNT_NBR,
			[EMP_PHONE_WORK] = @EMP_PHONE_WORK,
			[EMP_PHONE_CELL] = @EMP_PHONE_CELL,
			[EMP_PHONE_ALT] = @EMP_PHONE_ALT,
			[EMP_PHONE_WORK_EXT] = @EMP_PHONE_WORK_EXT,
			[STD_ANNUAL_HRS] = @STD_ANNUAL_HRS,
			[DIRECT_HRS_PER] = @DIRECT_HRS_PER,
			[DEF_TRF_ROLE] = @DEF_TRF_ROLE,
			[PO_APPR_RULE_CODE] = @PO_APPR_RULE_CODE,
			[EMP_PAY_TO_ADDR1] = @EMP_ADDRESS1,
			[EMP_PAY_TO_ADDR2] = @EMP_ADDRESS2,
			[EMP_PAY_TO_CITY] = @EMP_CITY,
			[EMP_PAY_TO_COUNTY] = @EMP_COUNTY,
			[EMP_PAY_TO_STATE] = @EMP_STATE,
			[EMP_PAY_TO_ZIP] = @EMP_ZIP,
			[LAST_MODIFIED_BY] = @USER_CODE,      
			[LAST_MODIFIED_DATE] = GETDATE()	
		WHERE
			[EMP_CODE] = @EMP_CODE
			
	END
	
END