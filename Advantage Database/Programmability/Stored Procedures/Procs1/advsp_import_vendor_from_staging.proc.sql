CREATE PROCEDURE [dbo].[advsp_import_vendor_from_staging]
	@IMPORT_ID AS int,
	@USER_CODE AS varchar(30),
	@IS_UPDATING AS bit
AS
BEGIN
	-- =============================================
	-- Author:		Steven Walden
	-- Create date: 02/15/2011
	-- Description:	This will move vendor import 
	--				into the vendor table
	-- =============================================
	DECLARE @FIELD_NAME AS varchar(MAX)
	DECLARE @VN_CODE AS varchar(6)
	DECLARE @VN_NAME AS varchar(40)
	DECLARE @VN_ADDRESS1 AS varchar(40)
	DECLARE @VN_ADDRESS2 AS varchar(40)
	DECLARE @VN_ADDRESS3 AS varchar(30)
	DECLARE @VN_CITY AS varchar(25)
	DECLARE @VN_COUNTY AS varchar(20)
	DECLARE @VN_STATE AS varchar(10)
	DECLARE @VN_COUNTRY AS varchar(20)
	DECLARE @VN_ZIP AS varchar(10)
	DECLARE @VN_PHONE AS varchar(13)
	DECLARE @VN_PHONE_EXT AS varchar(4)
	DECLARE @VN_FAX_NUMBER AS varchar(13)
	DECLARE @VN_FAX_EXTENTION AS varchar(4)
	DECLARE @VN_PAY_TO_CODE AS varchar(6)
	DECLARE @VN_PAY_TO_NAME AS varchar(40)
	DECLARE @VN_PAY_TO_ADDRESS1 AS varchar(40)
	DECLARE @VN_PAY_TO_ADDRESS2 AS varchar(40)
	DECLARE @VN_PAY_TO_ADDRESS3 AS varchar(30)
	DECLARE @VN_PAY_TO_CITY AS varchar(25)
	DECLARE @VN_PAY_TO_COUNTY AS varchar(20)
	DECLARE @VN_PAY_TO_STATE AS varchar(10)
	DECLARE @VN_PAY_TO_COUNTRY AS varchar(20)
	DECLARE @VN_PAY_TO_ZIP AS varchar(10)
	DECLARE @VN_PAY_TO_PHONE AS varchar(13)
	DECLARE @VN_PAY_TO_EXT AS varchar(4)
	DECLARE @VN_PAY_TO_FAX_NBR AS varchar(13)
	DECLARE @VN_PAY_TO_FAX_EXT AS varchar(4)
	DECLARE @VT_CODE AS varchar(3)
	DECLARE @VN_TAX_ID AS varchar(20)
	DECLARE @VN_1099_FLAG AS smallint
	DECLARE @VN_CATEGORY AS varchar(1)
	DECLARE @GLACODE_AP AS varchar(30)
	DECLARE @VN_NOTES AS varchar(MAX)
	DECLARE @GLACODE_EXP AS varchar(30)
	DECLARE @ASSOC_OFFICE AS smallint
	DECLARE @OFFICE_CODE AS varchar(4)
	DECLARE @VN_1099_ADDRESS1 AS varchar(40)
	DECLARE @VN_1099_ADDRESS2 AS varchar(40)
	DECLARE @VN_1099_ADDRESS3 AS varchar(30)
	DECLARE @VN_1099_CITY AS varchar(25)
	DECLARE @VN_1099_STATE AS varchar(10)
	DECLARE @VN_1099_ZIP AS varchar(10)
	DECLARE @VN_1099_COUNTY AS varchar(20)
	DECLARE @VN_1099_COUNTRY AS varchar(20)
	DECLARE @VN_USE_1099 AS smallint
	DECLARE @VN_ACCT_NBR AS varchar(30)
	DECLARE @DEF_FNC_CODE AS varchar(6)
	DECLARE @EMP_VENDOR AS int
	DECLARE @ONE_CHECK_PER_INV AS smallint
	DECLARE @VN_EMAIL AS varchar(50)
	DECLARE @PYMT_MGR_EMAIL AS varchar(50)
	DECLARE @VN_ACTIVE_FLAG AS smallint

	IF @IS_UPDATING = 0 BEGIN
	
		SELECT
			@VN_CODE = [VN_CODE],
			@VN_CATEGORY = [VN_CATEGORY]
		FROM
			[dbo].[IMP_VENDOR_STAGING]
		WHERE
			[IMPORT_ID] = @IMPORT_ID
			
		INSERT INTO 
			[dbo].[VENDOR]([VN_CODE],[VN_NAME],[VN_ADDRESS1],[VN_ADDRESS2],
						   [VN_ADDRESS3],[VN_CITY],[VN_COUNTY],[VN_STATE],
						   [VN_COUNTRY],[VN_ZIP],[VN_PHONE],[VN_PHONE_EXT],
						   [VN_FAX_NUMBER],[VN_FAX_EXTENTION],[VN_PAY_TO_CODE],[VN_PAY_TO_NAME],
						   [VN_PAY_TO_ADDRESS1],[VN_PAY_TO_ADDRESS2],[VN_PAY_TO_ADDRESS3],[VN_PAY_TO_CITY],
						   [VN_PAY_TO_COUNTY],[VN_PAY_TO_STATE],[VN_PAY_TO_COUNTRY],[VN_PAY_TO_ZIP],
						   [VN_PAY_TO_PHONE],[VN_PAY_TO_EXT],[VN_PAY_TO_FAX_NBR],[VN_PAY_TO_FAX_EXT],
						   [VT_CODE],[VN_TAX_ID],[VN_1099_FLAG],[VN_CATEGORY],
						   [GLACODE_AP],[VN_NOTES],[GLACODE_EXP],[ASSOC_OFFICE],
						   [OFFICE_CODE],[VN_1099_ADDRESS1],[VN_1099_ADDRESS2],[VN_1099_ADDRESS3],
						   [VN_1099_CITY],[VN_1099_STATE],[VN_1099_ZIP],[VN_1099_COUNTY],
						   [VN_1099_COUNTRY],[VN_USE_1099],[VN_ACCT_NBR],[DEF_FNC_CODE],
						   [EMP_VENDOR],[ONE_CHECK_PER_INV],[VN_EMAIL],[PYMT_MGR_EMAIL],
						   [VN_ACTIVE_FLAG], [IS_NIELSEN_SUBSCRIBER], [IS_COMSCORE_SUBSCRIBER])
		SELECT 
			[VN_CODE],[VN_NAME],[VN_ADDRESS1],[VN_ADDRESS2],
		    [VN_ADDRESS3],[VN_CITY],[VN_COUNTY],[VN_STATE],
		    [VN_COUNTRY],[VN_ZIP],[VN_PHONE],[VN_PHONE_EXT],
		    [VN_FAX_NUMBER],[VN_FAX_EXTENTION],[VN_PAY_TO_CODE],[VN_PAY_TO_NAME],
		    [VN_PAY_TO_ADDRESS1],[VN_PAY_TO_ADDRESS2],[VN_PAY_TO_ADDRESS3],[VN_PAY_TO_CITY],
		    [VN_PAY_TO_COUNTY],[VN_PAY_TO_STATE],[VN_PAY_TO_COUNTRY],[VN_PAY_TO_ZIP],
		    [VN_PAY_TO_PHONE],[VN_PAY_TO_EXT],[VN_PAY_TO_FAX_NBR],[VN_PAY_TO_FAX_EXT],
		    [VT_CODE],[VN_TAX_ID],[VN_1099_FLAG],[VN_CATEGORY],
		    [GLACODE_AP],[VN_NOTES],[GLACODE_EXP],[ASSOC_OFFICE],
		    [OFFICE_CODE],[VN_1099_ADDRESS1],[VN_1099_ADDRESS2],[VN_1099_ADDRESS3],
		    [VN_1099_CITY],[VN_1099_STATE],[VN_1099_ZIP],[VN_1099_COUNTY],
		    [VN_1099_COUNTRY],[VN_USE_1099],[VN_ACCT_NBR],[DEF_FNC_CODE],
		    [EMP_VENDOR],[ONE_CHECK_PER_INV],[VN_EMAIL],[PYMT_MGR_EMAIL],
		    [VN_ACTIVE_FLAG],
			[IS_NIELSEN_SUBSCRIBER] = CASE WHEN @VN_CATEGORY = 'T' OR @VN_CATEGORY = 'R' THEN 1 ELSE 0 END,
			[IS_COMSCORE_SUBSCRIBER] = CASE WHEN @VN_CATEGORY = 'T' THEN 1 ELSE 0 END
		FROM 
			[dbo].[IMP_VENDOR_STAGING]
		WHERE
			[IMPORT_ID] = @IMPORT_ID

	END ELSE BEGIN
		
		SET @FIELD_NAME = NULL
		SET @VN_CODE = NULL
		SET @VN_NAME = NULL
		SET @VN_ADDRESS1 = NULL
		SET @VN_ADDRESS2 = NULL
		SET @VN_ADDRESS3 = NULL
		SET @VN_CITY = NULL
		SET @VN_COUNTY = NULL
		SET @VN_STATE = NULL
		SET @VN_COUNTRY = NULL
		SET @VN_ZIP = NULL
		SET @VN_PHONE = NULL
		SET @VN_PHONE_EXT = NULL
		SET @VN_FAX_NUMBER = NULL
		SET @VN_FAX_EXTENTION = NULL
		SET @VN_PAY_TO_CODE = NULL
		SET @VN_PAY_TO_NAME = NULL
		SET @VN_PAY_TO_ADDRESS1 = NULL
		SET @VN_PAY_TO_ADDRESS2 = NULL
		SET @VN_PAY_TO_ADDRESS3 = NULL
		SET @VN_PAY_TO_CITY = NULL
		SET @VN_PAY_TO_COUNTY = NULL
		SET @VN_PAY_TO_STATE = NULL
		SET @VN_PAY_TO_COUNTRY = NULL
		SET @VN_PAY_TO_ZIP = NULL
		SET @VN_PAY_TO_PHONE = NULL
		SET @VN_PAY_TO_EXT = NULL
		SET @VN_PAY_TO_FAX_NBR = NULL
		SET @VN_PAY_TO_FAX_EXT = NULL
		SET @VT_CODE = NULL
		SET @VN_TAX_ID = NULL
		SET @VN_1099_FLAG = NULL
		SET @VN_CATEGORY = NULL
		SET @GLACODE_AP = NULL
		SET @VN_NOTES = NULL
		SET @GLACODE_EXP = NULL
		SET @ASSOC_OFFICE = NULL
		SET @OFFICE_CODE = NULL
		SET @VN_1099_ADDRESS1 = NULL
		SET @VN_1099_ADDRESS2 = NULL
		SET @VN_1099_ADDRESS3 = NULL
		SET @VN_1099_CITY = NULL
		SET @VN_1099_STATE = NULL
		SET @VN_1099_ZIP = NULL
		SET @VN_1099_COUNTY = NULL
		SET @VN_1099_COUNTRY = NULL
		SET @VN_USE_1099 = NULL
		SET @VN_ACCT_NBR = NULL
		SET @DEF_FNC_CODE = NULL
		SET @EMP_VENDOR = NULL
		SET @ONE_CHECK_PER_INV = NULL
		SET @VN_EMAIL = NULL
		SET @PYMT_MGR_EMAIL = NULL
		SET @VN_ACTIVE_FLAG = NULL
	
		SELECT
			@FIELD_NAME = [FIELD_NAME],
			@VN_CODE = [VN_CODE],
			@VN_NAME = [VN_NAME],
			@VN_ADDRESS1 = [VN_ADDRESS1],
			@VN_ADDRESS2 = [VN_ADDRESS2],
			@VN_ADDRESS3 = [VN_ADDRESS3],
			@VN_CITY = [VN_CITY],
			@VN_COUNTY = [VN_COUNTY],
			@VN_STATE = [VN_STATE],
			@VN_COUNTRY = [VN_COUNTRY],
			@VN_ZIP = [VN_ZIP],
			@VN_PHONE = [VN_PHONE],
			@VN_PHONE_EXT = [VN_PHONE_EXT],
			@VN_FAX_NUMBER = [VN_FAX_NUMBER],
			@VN_FAX_EXTENTION = [VN_FAX_EXTENTION],
			@VN_PAY_TO_CODE = [VN_PAY_TO_CODE],
			@VN_PAY_TO_NAME = [VN_PAY_TO_NAME],
			@VN_PAY_TO_ADDRESS1 = [VN_PAY_TO_ADDRESS1],
			@VN_PAY_TO_ADDRESS2 = [VN_PAY_TO_ADDRESS2],
			@VN_PAY_TO_ADDRESS3 = [VN_PAY_TO_ADDRESS3],
			@VN_PAY_TO_CITY = [VN_PAY_TO_CITY],
			@VN_PAY_TO_COUNTY = [VN_PAY_TO_COUNTY],
			@VN_PAY_TO_STATE = [VN_PAY_TO_STATE],
			@VN_PAY_TO_COUNTRY = [VN_PAY_TO_COUNTRY],
			@VN_PAY_TO_ZIP = [VN_PAY_TO_ZIP],
			@VN_PAY_TO_PHONE = [VN_PAY_TO_PHONE],
			@VN_PAY_TO_EXT = [VN_PAY_TO_EXT],
			@VN_PAY_TO_FAX_NBR = [VN_PAY_TO_FAX_NBR],
			@VN_PAY_TO_FAX_EXT = [VN_PAY_TO_FAX_EXT],
			@VT_CODE = [VT_CODE],
			@VN_TAX_ID = [VN_TAX_ID],
			@VN_1099_FLAG = [VN_1099_FLAG],
			@VN_CATEGORY = [VN_CATEGORY],
			@GLACODE_AP = [GLACODE_AP],
			@VN_NOTES = CAST([VN_NOTES] AS varchar(MAX)),
			@GLACODE_EXP = [GLACODE_EXP],
			@ASSOC_OFFICE = [ASSOC_OFFICE],
			@OFFICE_CODE = [OFFICE_CODE],
			@VN_1099_ADDRESS1 = [VN_1099_ADDRESS1],
			@VN_1099_ADDRESS2 = [VN_1099_ADDRESS2],
			@VN_1099_ADDRESS3 = [VN_1099_ADDRESS3],
			@VN_1099_CITY = [VN_1099_CITY],
			@VN_1099_STATE = [VN_1099_STATE],
			@VN_1099_ZIP = [VN_1099_ZIP],
			@VN_1099_COUNTY = [VN_1099_COUNTY],
			@VN_1099_COUNTRY = [VN_1099_COUNTRY],
			@VN_USE_1099 = [VN_USE_1099],
			@VN_ACCT_NBR = [VN_ACCT_NBR],
			@DEF_FNC_CODE = [DEF_FNC_CODE],
			@EMP_VENDOR = [EMP_VENDOR],
			@ONE_CHECK_PER_INV = [ONE_CHECK_PER_INV],
			@VN_EMAIL = [VN_EMAIL],
			@PYMT_MGR_EMAIL = [PYMT_MGR_EMAIL],
			@VN_ACTIVE_FLAG = [VN_ACTIVE_FLAG]
		FROM
			[dbo].[IMP_VENDOR_STAGING]
		WHERE
			[IMPORT_ID] = @IMPORT_ID
	
		INSERT INTO 
			[dbo].[VENDOR_HISTORY](HIST_ACTION,
								   HIST_DATE, 
								   HIST_USER, 
								   VN_CATEGORY,
								   VN_ACTIVE_FLAG,
								   VN_CODE,
								   VN_NAME,
								   VN_ADDRESS1,
								   VN_ADDRESS2,
								   VN_ADDRESS3,
								   VN_CITY,
								   VN_COUNTY,
								   VN_STATE,
								   VN_COUNTRY,
								   VN_ZIP,
								   VN_PHONE,
								   VN_PHONE_EXT,
								   VN_FAX_NUMBER,
								   VN_FAX_EXTENTION,
								   VN_EMAIL,
								   VN_PAY_TO_CODE,
								   VN_PAY_TO_NAME,
								   VN_PAY_TO_ADDRESS1,
								   VN_PAY_TO_ADDRESS2,
								   VN_PAY_TO_ADDRESS3,
								   VN_PAY_TO_CITY,
								   VN_PAY_TO_COUNTY,
								   VN_PAY_TO_STATE,
								   VN_PAY_TO_COUNTRY,
								   VN_PAY_TO_ZIP,
								   VN_PAY_TO_PHONE,
								   VN_PAY_TO_EXT,
								   VN_PAY_TO_FAX_NBR,
								   VN_PAY_TO_FAX_EXT,
								   VN_PAY_TO_EMAIL,
								   VN_1099_ADDRESS1,
								   VN_1099_ADDRESS2,
								   VN_1099_ADDRESS3,
								   VN_1099_CITY,
								   VN_1099_COUNTY,
								   VN_1099_STATE,
								   VN_1099_COUNTRY,
								   VN_1099_ZIP,
								   VN_1099_FLAG,
								   VN_USE_1099,
								   VT_CODE,
								   VN_TAX_ID,
								   VN_ALPHA_SORT,
								   GLACODE_AP,
								   GLACODE_EXP,
								   VN_ACCT_NBR,
								   OFFICE_CODE,
								   DEF_FNC_CODE,
								   EMP_VENDOR,
								   DEF_VN_CONT,
								   ONE_CHECK_PER_INV,
								   WEB_ADDR,
								   CURRENCY_CODE,
								   PYMT_MGR_EMAIL, 
								   HIST_DATETIME, 
								   VN_1099_INC_TYPE) 
		SELECT 
			'FROM', 
			GETDATE(), 
			@USER_CODE, 
			VN_CATEGORY,
			VN_ACTIVE_FLAG,
			VN_CODE,
			VN_NAME,
			VN_ADDRESS1,
			VN_ADDRESS2,
			VN_ADDRESS3,
			VN_CITY,
			VN_COUNTY,
			VN_STATE,
			VN_COUNTRY,
			VN_ZIP,
			VN_PHONE,
			VN_PHONE_EXT,
			VN_FAX_NUMBER,
			VN_FAX_EXTENTION,
			VN_EMAIL,
			VN_PAY_TO_CODE,
			VN_PAY_TO_NAME,
			VN_PAY_TO_ADDRESS1,
			VN_PAY_TO_ADDRESS2,
			VN_PAY_TO_ADDRESS3,
			VN_PAY_TO_CITY,
			VN_PAY_TO_COUNTY,
			VN_PAY_TO_STATE,
			VN_PAY_TO_COUNTRY,
			VN_PAY_TO_ZIP,
			VN_PAY_TO_PHONE,
			VN_PAY_TO_EXT,
			VN_PAY_TO_FAX_NBR,
			VN_PAY_TO_FAX_EXT,
			VN_PAY_TO_EMAIL,
			VN_1099_ADDRESS1,
			VN_1099_ADDRESS2,
			VN_1099_ADDRESS3,
			VN_1099_CITY,
			VN_1099_COUNTY,
			VN_1099_STATE,
			VN_1099_COUNTRY,
			VN_1099_ZIP,
			VN_1099_FLAG,
			VN_USE_1099,
			VT_CODE,
			VN_TAX_ID,
			VN_ALPHA_SORT,
			GLACODE_AP,
			GLACODE_EXP,
			VN_ACCT_NBR,
			OFFICE_CODE,
			DEF_FNC_CODE,
			EMP_VENDOR,
			DEF_VN_CONT,
			ONE_CHECK_PER_INV,
			WEB_ADDR,
			CURRENCY_CODE,
			PYMT_MGR_EMAIL, 
			CONVERT(varchar(100), GETDATE(), 101) + ' ' + CONVERT(varchar(100), GETDATE(), 108), 
			VN_1099_INC_TYPE 
		FROM 
			dbo.VENDOR
		WHERE
			[VN_CODE] = @VN_CODE
			
		UPDATE
			[dbo].[VENDOR]
		SET
			[VN_NAME] = @VN_NAME,
			[VN_ADDRESS1] = @VN_ADDRESS1,
			[VN_ADDRESS2] = @VN_ADDRESS2,
			[VN_ADDRESS3] = @VN_ADDRESS3,
			[VN_CITY] = @VN_CITY,
			[VN_COUNTY] = @VN_COUNTY,
			[VN_STATE] = @VN_STATE,
			[VN_COUNTRY] = @VN_COUNTRY,
			[VN_ZIP] = @VN_ZIP,
			[VN_PHONE] = @VN_PHONE,
			[VN_PHONE_EXT] = @VN_PHONE_EXT,
			[VN_FAX_NUMBER] = @VN_FAX_NUMBER,
			[VN_FAX_EXTENTION] = @VN_FAX_EXTENTION,
			[VN_PAY_TO_CODE] = @VN_PAY_TO_CODE,
			[VN_PAY_TO_NAME] = @VN_PAY_TO_NAME,
			[VN_PAY_TO_ADDRESS1] = @VN_PAY_TO_ADDRESS1,
			[VN_PAY_TO_ADDRESS2] = @VN_PAY_TO_ADDRESS2,
			[VN_PAY_TO_ADDRESS3] = @VN_PAY_TO_ADDRESS3,
			[VN_PAY_TO_CITY] = @VN_PAY_TO_CITY,
			[VN_PAY_TO_COUNTY] = @VN_PAY_TO_COUNTY,
			[VN_PAY_TO_STATE] = @VN_PAY_TO_STATE,
			[VN_PAY_TO_COUNTRY] = @VN_PAY_TO_COUNTRY,
			[VN_PAY_TO_ZIP] = @VN_PAY_TO_ZIP,
			[VN_PAY_TO_PHONE] = @VN_PAY_TO_PHONE,
			[VN_PAY_TO_EXT] = @VN_PAY_TO_EXT,
			[VN_PAY_TO_FAX_NBR] = @VN_PAY_TO_FAX_NBR,
			[VN_PAY_TO_FAX_EXT] = @VN_PAY_TO_FAX_EXT,
			[VT_CODE] = @VT_CODE,
			[VN_TAX_ID] = @VN_TAX_ID,
			[VN_1099_FLAG] = @VN_1099_FLAG,
			[VN_CATEGORY] = @VN_CATEGORY,
			[GLACODE_AP] = @GLACODE_AP,
			[VN_NOTES] = @VN_NOTES,
			[GLACODE_EXP] = @GLACODE_EXP,
			[ASSOC_OFFICE] = @ASSOC_OFFICE,
			[OFFICE_CODE] = @OFFICE_CODE,
			[VN_1099_ADDRESS1] = @VN_1099_ADDRESS1,
			[VN_1099_ADDRESS2] = @VN_1099_ADDRESS2,
			[VN_1099_ADDRESS3] = @VN_1099_ADDRESS3,
			[VN_1099_CITY] = @VN_1099_CITY,
			[VN_1099_STATE] = @VN_1099_STATE,
			[VN_1099_ZIP] = @VN_1099_ZIP,
			[VN_1099_COUNTY] = @VN_1099_COUNTY,
			[VN_1099_COUNTRY] = @VN_1099_COUNTRY,
			[VN_USE_1099] = @VN_USE_1099,
			[VN_ACCT_NBR] = @VN_ACCT_NBR,
			[DEF_FNC_CODE] = @DEF_FNC_CODE,
			[EMP_VENDOR] = @EMP_VENDOR,
			[ONE_CHECK_PER_INV] = @ONE_CHECK_PER_INV,
			[VN_EMAIL] = @VN_EMAIL,
			[PYMT_MGR_EMAIL] = @PYMT_MGR_EMAIL,
			[VN_ACTIVE_FLAG] = @VN_ACTIVE_FLAG	
		WHERE
			[VN_CODE] = @VN_CODE
			
	END
		
	IF @VN_CATEGORY = 'I' BEGIN 
				
		UPDATE 
			[dbo].[VENDOR]
		SET
			[IN_CATEGORY] = 1,
			[MG_CATEGORY] = NULL,
			[NP_CATEGORY] = NULL,
			[OD_CATEGORY] = NULL,
			[PRD_CATEGORY] = NULL,
			[RD_CATEGORY] = NULL,
			[TV_CATEGORY] = NULL
		WHERE 
			[VN_CODE] = @VN_CODE

	END ELSE IF @VN_CATEGORY = 'M' BEGIN
				
		UPDATE 
			[dbo].[VENDOR]
		SET
			[IN_CATEGORY] = NULL,
			[MG_CATEGORY] = 1,
			[NP_CATEGORY] = NULL,
			[OD_CATEGORY] = NULL,
			[PRD_CATEGORY] = NULL,
			[RD_CATEGORY] = NULL,
			[TV_CATEGORY] = NULL
		WHERE 
			[VN_CODE] = @VN_CODE

	END ELSE IF @VN_CATEGORY = 'N' BEGIN
				
		UPDATE 
			[dbo].[VENDOR]
		SET
			[IN_CATEGORY] = NULL,
			[MG_CATEGORY] = NULL,
			[NP_CATEGORY] = 1,
			[OD_CATEGORY] = NULL,
			[PRD_CATEGORY] = NULL,
			[RD_CATEGORY] = NULL,
			[TV_CATEGORY] = NULL
		WHERE 
			[VN_CODE] = @VN_CODE

	END ELSE IF @VN_CATEGORY = 'O' BEGIN
				
		UPDATE 
			[dbo].[VENDOR]
		SET
			[IN_CATEGORY] = NULL,
			[MG_CATEGORY] = NULL,
			[NP_CATEGORY] = NULL,
			[OD_CATEGORY] = 1,
			[PRD_CATEGORY] = NULL,
			[RD_CATEGORY] = NULL,
			[TV_CATEGORY] = NULL
		WHERE 
			[VN_CODE] = @VN_CODE

	END ELSE IF @VN_CATEGORY = 'P' BEGIN
				
		UPDATE 
			[dbo].[VENDOR]
		SET
			[IN_CATEGORY] = NULL,
			[MG_CATEGORY] = NULL,
			[NP_CATEGORY] = NULL,
			[OD_CATEGORY] = NULL,
			[PRD_CATEGORY] = 1,
			[RD_CATEGORY] = NULL,
			[TV_CATEGORY] = NULL
		WHERE 
			[VN_CODE] = @VN_CODE

	END ELSE IF @VN_CATEGORY = 'R' BEGIN
				
		UPDATE 
			[dbo].[VENDOR]
		SET
			[IN_CATEGORY] = NULL,
			[MG_CATEGORY] = NULL,
			[NP_CATEGORY] = NULL,
			[OD_CATEGORY] = NULL,
			[PRD_CATEGORY] = NULL,
			[RD_CATEGORY] = 1,
			[TV_CATEGORY] = NULL
		WHERE 
			[VN_CODE] = @VN_CODE

	END ELSE IF @VN_CATEGORY = 'T' BEGIN
				
		UPDATE 
			[dbo].[VENDOR]
		SET
			[IN_CATEGORY] = NULL,
			[MG_CATEGORY] = NULL,
			[NP_CATEGORY] = NULL,
			[OD_CATEGORY] = NULL,
			[PRD_CATEGORY] = NULL,
			[RD_CATEGORY] = NULL,
			[TV_CATEGORY] = 1
		WHERE 
			[VN_CODE] = @VN_CODE

	END
	
	IF @IS_UPDATING = 0 BEGIN
	
		IF @VN_CATEGORY = 'I' BEGIN 
				
			UPDATE 
				[dbo].[VENDOR]
			SET
				[DEF_NET_GROSS] = 0
			WHERE 
				[VN_CODE] = @VN_CODE

		END ELSE IF @VN_CATEGORY = 'M' BEGIN
				
			UPDATE 
				[dbo].[VENDOR]
			SET
				[DEF_NET_GROSS] = 1
			WHERE 
				[VN_CODE] = @VN_CODE

		END ELSE IF @VN_CATEGORY = 'N' BEGIN
				
			UPDATE 
				[dbo].[VENDOR]
			SET
				[DEF_NET_GROSS] = 0
			WHERE 
				[VN_CODE] = @VN_CODE

		END ELSE IF @VN_CATEGORY = 'O' BEGIN
				
			UPDATE 
				[dbo].[VENDOR]
			SET
				[DEF_NET_GROSS] = 1
			WHERE 
				[VN_CODE] = @VN_CODE

		END ELSE IF @VN_CATEGORY = 'P' BEGIN
				
			UPDATE 
				[dbo].[VENDOR]
			SET
				[DEF_NET_GROSS] = 1
			WHERE 
				[VN_CODE] = @VN_CODE

		END ELSE IF @VN_CATEGORY = 'R' BEGIN
				
			UPDATE 
				[dbo].[VENDOR]
			SET
				[DEF_NET_GROSS] = 1
			WHERE 
				[VN_CODE] = @VN_CODE

		END ELSE IF @VN_CATEGORY = 'T' BEGIN
				
			UPDATE 
				[dbo].[VENDOR]
			SET
				[DEF_NET_GROSS] = 1
			WHERE 
				[VN_CODE] = @VN_CODE

		END
	
	END
		
	IF @IS_UPDATING = 0 BEGIN
		
		INSERT INTO 
			[dbo].[VENDOR_HISTORY](HIST_ACTION,
								   HIST_DATE, 
								   HIST_USER, 
								   VN_CATEGORY,
								   VN_ACTIVE_FLAG,
								   VN_CODE,
								   VN_NAME,
								   VN_ADDRESS1,
								   VN_ADDRESS2,
								   VN_ADDRESS3,
								   VN_CITY,
								   VN_COUNTY,
								   VN_STATE,
								   VN_COUNTRY,
								   VN_ZIP,
								   VN_PHONE,
								   VN_PHONE_EXT,
								   VN_FAX_NUMBER,
								   VN_FAX_EXTENTION,
								   VN_EMAIL,
								   VN_PAY_TO_CODE,
								   VN_PAY_TO_NAME,
								   VN_PAY_TO_ADDRESS1,
								   VN_PAY_TO_ADDRESS2,
								   VN_PAY_TO_ADDRESS3,
								   VN_PAY_TO_CITY,
								   VN_PAY_TO_COUNTY,
								   VN_PAY_TO_STATE,
								   VN_PAY_TO_COUNTRY,
								   VN_PAY_TO_ZIP,
								   VN_PAY_TO_PHONE,
								   VN_PAY_TO_EXT,
								   VN_PAY_TO_FAX_NBR,
								   VN_PAY_TO_FAX_EXT,
								   VN_PAY_TO_EMAIL,
								   VN_1099_ADDRESS1,
								   VN_1099_ADDRESS2,
								   VN_1099_ADDRESS3,
								   VN_1099_CITY,
								   VN_1099_COUNTY,
								   VN_1099_STATE,
								   VN_1099_COUNTRY,
								   VN_1099_ZIP,
								   VN_1099_FLAG,
								   VN_USE_1099,
								   VT_CODE,
								   VN_TAX_ID,
								   VN_ALPHA_SORT,
								   GLACODE_AP,
								   GLACODE_EXP,
								   VN_ACCT_NBR,
								   OFFICE_CODE,
								   DEF_FNC_CODE,
								   EMP_VENDOR,
								   DEF_VN_CONT,
								   ONE_CHECK_PER_INV,
								   WEB_ADDR,
								   CURRENCY_CODE,
								   PYMT_MGR_EMAIL, 
								   HIST_DATETIME, 
								   VN_1099_INC_TYPE) 
		SELECT 
			'NEW', 
			GETDATE(), 
			@USER_CODE, 
			VN_CATEGORY,
			VN_ACTIVE_FLAG,
			VN_CODE,
			VN_NAME,
			VN_ADDRESS1,
			VN_ADDRESS2,
			VN_ADDRESS3,
			VN_CITY,
			VN_COUNTY,
			VN_STATE,
			VN_COUNTRY,
			VN_ZIP,
			VN_PHONE,
			VN_PHONE_EXT,
			VN_FAX_NUMBER,
			VN_FAX_EXTENTION,
			VN_EMAIL,
			VN_PAY_TO_CODE,
			VN_PAY_TO_NAME,
			VN_PAY_TO_ADDRESS1,
			VN_PAY_TO_ADDRESS2,
			VN_PAY_TO_ADDRESS3,
			VN_PAY_TO_CITY,
			VN_PAY_TO_COUNTY,
			VN_PAY_TO_STATE,
			VN_PAY_TO_COUNTRY,
			VN_PAY_TO_ZIP,
			VN_PAY_TO_PHONE,
			VN_PAY_TO_EXT,
			VN_PAY_TO_FAX_NBR,
			VN_PAY_TO_FAX_EXT,
			VN_PAY_TO_EMAIL,
			VN_1099_ADDRESS1,
			VN_1099_ADDRESS2,
			VN_1099_ADDRESS3,
			VN_1099_CITY,
			VN_1099_COUNTY,
			VN_1099_STATE,
			VN_1099_COUNTRY,
			VN_1099_ZIP,
			VN_1099_FLAG,
			VN_USE_1099,
			VT_CODE,
			VN_TAX_ID,
			VN_ALPHA_SORT,
			GLACODE_AP,
			GLACODE_EXP,
			VN_ACCT_NBR,
			OFFICE_CODE,
			DEF_FNC_CODE,
			EMP_VENDOR,
			DEF_VN_CONT,
			ONE_CHECK_PER_INV,
			WEB_ADDR,
			CURRENCY_CODE,
			PYMT_MGR_EMAIL, 
			CONVERT(varchar(100), GETDATE(), 101) + ' ' + CONVERT(varchar(100), GETDATE(), 108), 
			VN_1099_INC_TYPE 
		FROM 
			dbo.VENDOR
		WHERE
			[VN_CODE] = @VN_CODE
			
	END ELSE BEGIN
		
		INSERT INTO 
			[dbo].[VENDOR_HISTORY](HIST_ACTION,
								   HIST_DATE, 
								   HIST_USER, 
								   VN_CATEGORY,
								   VN_ACTIVE_FLAG,
								   VN_CODE,
								   VN_NAME,
								   VN_ADDRESS1,
								   VN_ADDRESS2,
								   VN_ADDRESS3,
								   VN_CITY,
								   VN_COUNTY,
								   VN_STATE,
								   VN_COUNTRY,
								   VN_ZIP,
								   VN_PHONE,
								   VN_PHONE_EXT,
								   VN_FAX_NUMBER,
								   VN_FAX_EXTENTION,
								   VN_EMAIL,
								   VN_PAY_TO_CODE,
								   VN_PAY_TO_NAME,
								   VN_PAY_TO_ADDRESS1,
								   VN_PAY_TO_ADDRESS2,
								   VN_PAY_TO_ADDRESS3,
								   VN_PAY_TO_CITY,
								   VN_PAY_TO_COUNTY,
								   VN_PAY_TO_STATE,
								   VN_PAY_TO_COUNTRY,
								   VN_PAY_TO_ZIP,
								   VN_PAY_TO_PHONE,
								   VN_PAY_TO_EXT,
								   VN_PAY_TO_FAX_NBR,
								   VN_PAY_TO_FAX_EXT,
								   VN_PAY_TO_EMAIL,
								   VN_1099_ADDRESS1,
								   VN_1099_ADDRESS2,
								   VN_1099_ADDRESS3,
								   VN_1099_CITY,
								   VN_1099_COUNTY,
								   VN_1099_STATE,
								   VN_1099_COUNTRY,
								   VN_1099_ZIP,
								   VN_1099_FLAG,
								   VN_USE_1099,
								   VT_CODE,
								   VN_TAX_ID,
								   VN_ALPHA_SORT,
								   GLACODE_AP,
								   GLACODE_EXP,
								   VN_ACCT_NBR,
								   OFFICE_CODE,
								   DEF_FNC_CODE,
								   EMP_VENDOR,
								   DEF_VN_CONT,
								   ONE_CHECK_PER_INV,
								   WEB_ADDR,
								   CURRENCY_CODE,
								   PYMT_MGR_EMAIL, 
								   HIST_DATETIME, 
								   VN_1099_INC_TYPE) 
		SELECT 
			'TO', 
			GETDATE(), 
			@USER_CODE, 
			VN_CATEGORY,
			VN_ACTIVE_FLAG,
			VN_CODE,
			VN_NAME,
			VN_ADDRESS1,
			VN_ADDRESS2,
			VN_ADDRESS3,
			VN_CITY,
			VN_COUNTY,
			VN_STATE,
			VN_COUNTRY,
			VN_ZIP,
			VN_PHONE,
			VN_PHONE_EXT,
			VN_FAX_NUMBER,
			VN_FAX_EXTENTION,
			VN_EMAIL,
			VN_PAY_TO_CODE,
			VN_PAY_TO_NAME,
			VN_PAY_TO_ADDRESS1,
			VN_PAY_TO_ADDRESS2,
			VN_PAY_TO_ADDRESS3,
			VN_PAY_TO_CITY,
			VN_PAY_TO_COUNTY,
			VN_PAY_TO_STATE,
			VN_PAY_TO_COUNTRY,
			VN_PAY_TO_ZIP,
			VN_PAY_TO_PHONE,
			VN_PAY_TO_EXT,
			VN_PAY_TO_FAX_NBR,
			VN_PAY_TO_FAX_EXT,
			VN_PAY_TO_EMAIL,
			VN_1099_ADDRESS1,
			VN_1099_ADDRESS2,
			VN_1099_ADDRESS3,
			VN_1099_CITY,
			VN_1099_COUNTY,
			VN_1099_STATE,
			VN_1099_COUNTRY,
			VN_1099_ZIP,
			VN_1099_FLAG,
			VN_USE_1099,
			VT_CODE,
			VN_TAX_ID,
			VN_ALPHA_SORT,
			GLACODE_AP,
			GLACODE_EXP,
			VN_ACCT_NBR,
			OFFICE_CODE,
			DEF_FNC_CODE,
			EMP_VENDOR,
			DEF_VN_CONT,
			ONE_CHECK_PER_INV,
			WEB_ADDR,
			CURRENCY_CODE,
			PYMT_MGR_EMAIL, 
			CONVERT(varchar(100), GETDATE(), 101) + ' ' + CONVERT(varchar(100), GETDATE(), 108), 
			VN_1099_INC_TYPE 
		FROM 
			dbo.VENDOR
		WHERE
			[VN_CODE] = @VN_CODE
			
	END
	
END



GO


