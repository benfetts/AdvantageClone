CREATE PROCEDURE [dbo].[advsp_makegood_staging_delete_by_order]
	@ORDER_NBR int	
AS

BEGIN TRY

	BEGIN TRAN
		
		DELETE dbo.MEDIA_BROADCAST_WORKSHEET_MARKET_STAGING_DETAIL_DATE
		WHERE MEDIA_BROADCAST_WORKSHEET_MARKET_STAGING_DETAIL_ID IN (
			SELECT MEDIA_BROADCAST_WORKSHEET_MARKET_STAGING_DETAIL_ID
			FROM dbo.MEDIA_BROADCAST_WORKSHEET_MARKET_STAGING_DETAIL 
			WHERE MEDIA_BROADCAST_WORKSHEET_MARKET_DETAIL_ID IN (
				SELECT DISTINCT MEDIA_BROADCAST_WORKSHEET_MARKET_DETAIL_ID
				FROM dbo.MEDIA_BROADCAST_WORKSHEET_MARKET_DETAIL_DATE 
				WHERE ORDER_NBR = @ORDER_NBR
			)
			AND IS_SUBMITTED = 0
		)

		DELETE dbo.MEDIA_BROADCAST_WORKSHEET_MARKET_STAGING_DETAIL 
		WHERE MEDIA_BROADCAST_WORKSHEET_MARKET_DETAIL_ID IN (
			SELECT DISTINCT MEDIA_BROADCAST_WORKSHEET_MARKET_DETAIL_ID
			FROM dbo.MEDIA_BROADCAST_WORKSHEET_MARKET_DETAIL_DATE 
			WHERE ORDER_NBR = @ORDER_NBR
		)
		AND IS_SUBMITTED = 0

	COMMIT TRAN

END TRY
BEGIN CATCH
	
	ROLLBACK TRAN
		
	SELECT 
    --ERROR_NUMBER() as ErrorNumber,
    ERROR_MESSAGE() as ErrorMessage;
        
END CATCH
