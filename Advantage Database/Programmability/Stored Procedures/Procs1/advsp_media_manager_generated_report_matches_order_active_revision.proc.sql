CREATE PROCEDURE [dbo].[advsp_media_manager_generated_report_matches_order_active_revision]
	@ORDER_NBR int,
	@MEDIA_TYPE char(1)
AS

DECLARE @MATCHES bit
SET @MATCHES = 1

IF @MEDIA_TYPE = 'T'
	IF EXISTS (SELECT *
				FROM dbo.TV_DETAIL D
					INNER JOIN (SELECT ORDER_NBR, LINE_NBR, MAX(REV_NBR) AS REV_NBR
								FROM dbo.MEDIA_MGR_GENERATED_REPORT MMGR
									INNER JOIN dbo.MEDIA_MGR_GENERATED_REPORT_DETAIL MMGRD ON MMGR.MEDIA_MGR_GENERATED_REPORT_ID = MMGRD.MEDIA_MGR_GENERATED_REPORT_ID 
								WHERE ORDER_NBR = @ORDER_NBR
								GROUP BY ORDER_NBR, LINE_NBR
								) dtl ON D.ORDER_NBR = dtl.ORDER_NBR AND D.LINE_NBR = dtl.LINE_NBR AND D.ACTIVE_REV = 1
				WHERE dtl.REV_NBR < D.REV_NBR)
	SET @MATCHES = 0
ELSE IF @MEDIA_TYPE = 'R'
	IF EXISTS (SELECT *
				FROM dbo.RADIO_DETAIL D
					INNER JOIN (SELECT ORDER_NBR, LINE_NBR, MAX(REV_NBR) AS REV_NBR
								FROM dbo.MEDIA_MGR_GENERATED_REPORT MMGR
									INNER JOIN dbo.MEDIA_MGR_GENERATED_REPORT_DETAIL MMGRD ON MMGR.MEDIA_MGR_GENERATED_REPORT_ID = MMGRD.MEDIA_MGR_GENERATED_REPORT_ID 
								WHERE ORDER_NBR = @ORDER_NBR
								GROUP BY ORDER_NBR, LINE_NBR
								) dtl ON D.ORDER_NBR = dtl.ORDER_NBR AND D.LINE_NBR = dtl.LINE_NBR AND D.ACTIVE_REV = 1
				WHERE dtl.REV_NBR < D.REV_NBR)
	SET @MATCHES = 0

SELECT @MATCHES
GO