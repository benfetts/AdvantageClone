CREATE PROCEDURE [dbo].[advsp_media_manager_load_internet_order_ad_sizes]
	@AD_SIZE_CODES varchar(MAX),
	@ORDER_NBR int,
	@LINE_NBR smallint
AS

DECLARE @PlacementName varchar(256)

SELECT
	@PlacementName = [dbo].[advfn_ad_server_placement_name]( m.MARKET_DESC, V.VN_NAME, d.COST_TYPE, d.HEADLINE, CASE WHEN ads.SIZE_CODE IS NULL THEN d.CREATIVE_SIZE ELSE ads.SIZE_DESC END, IT.OD_DESC, d.PLACEMENT_1, d.TARGET_AUDIENCE, h.ORDER_NBR, CMP.CMP_NAME, h.[START_DATE], h.END_DATE, d.[URL], SUBSTRING(COALESCE(IC.INSTRUCTIONS,''),1,256), SUBSTRING(COALESCE(IC.MATL_NOTES,''),1,256), SUBSTRING(COALESCE(IC.MISC_INFO,''),1,256) )
FROM dbo.INTERNET_DETAIL d
	INNER JOIN dbo.INTERNET_HEADER h ON d.ORDER_NBR = h.ORDER_NBR
	LEFT OUTER JOIN dbo.INTERNET_COMMENTS IC ON d.ORDER_NBR = IC.ORDER_NBR AND d.LINE_NBR = IC.LINE_NBR
	LEFT OUTER JOIN dbo.MARKET m ON h.MARKET_CODE = m.MARKET_CODE 
	LEFT OUTER JOIN dbo.VENDOR V ON h.VN_CODE = V.VN_CODE
	LEFT OUTER JOIN dbo.AD_SIZE ads ON d.SIZE = ads.SIZE_CODE AND ads.MEDIA_TYPE = 'I'
	LEFT OUTER JOIN dbo.INTERNET_TYPE IT ON d.INTERNET_TYPE = IT.OD_CODE AND IT.INACTIVE_FLAG = 0
	LEFT OUTER JOIN dbo.CAMPAIGN CMP ON h.CMP_IDENTIFIER = CMP.CMP_IDENTIFIER
WHERE
	d.ORDER_NBR = @ORDER_NBR 
AND	d.LINE_NBR = @LINE_NBR 
AND d.ACTIVE_REV = 1

SELECT
	AdSizeDescription = SIZE_DESC,
	PlacementName = @PlacementName	
FROM dbo.AD_SIZE
WHERE MEDIA_TYPE = 'I'
AND SIZE_CODE IN (SELECT items FROM dbo.udf_split_list(@AD_SIZE_CODES, ','))

GO
