CREATE PROCEDURE advsp_media_rfp_header_statuses
	@MEDIA_RFP_HEADER_ID int
AS

SELECT
	[VendorName] = V.VN_NAME,
	[StatusDescription] = MRS.STATUS_DESCRIPTION,
	[CreatedDate] = MRHS.CREATED_DATE,
	[By] = CASE WHEN E.EMP_CODE IS NOT NULL THEN ISNULL(E.EMP_FNAME+' ','') + CASE WHEN NULLIF(E.EMP_MI,'') IS NULL THEN '' ELSE E.EMP_MI + '. ' END +  ISNULL(E.EMP_LNAME,'')
				ELSE MRHS.USER_CREATED END
FROM dbo.MEDIA_RFP_HEADER_STATUS MRHS
	INNER JOIN dbo.MEDIA_RFP_HEADER MRH ON MRH.MEDIA_RFP_HEADER_ID = MRHS.MEDIA_RFP_HEADER_ID  
	INNER JOIN dbo.VENDOR V ON V.VN_CODE = MRH.VN_CODE 
	INNER JOIN dbo.MEDIA_RFP_STATUS MRS ON MRHS.MEDIA_RFP_STATUS_ID = MRS.MEDIA_RFP_STATUS_ID 
	LEFT OUTER JOIN dbo.SEC_USER SU ON MRHS.USER_CREATED = SU.USER_CODE 
	LEFT OUTER JOIN dbo.EMPLOYEE E ON SU.EMP_CODE = E.EMP_CODE
WHERE MRHS.MEDIA_RFP_HEADER_ID = @MEDIA_RFP_HEADER_ID
ORDER BY MRHS.CREATED_DATE DESC
GO