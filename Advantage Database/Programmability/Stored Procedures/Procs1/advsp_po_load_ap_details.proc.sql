CREATE PROCEDURE [dbo].[advsp_po_load_ap_details]
	@PO_NUMBER INT,
	@PO_LINE_NUMBER SMALLINT 
AS
BEGIN

	SELECT	
		[InvoiceNumber] = AP_HEADER.AP_INV_VCHR,
		[InvoiceDate] = AP_HEADER.AP_INV_DATE,
		[InvoiceAmount] = AP_HEADER.AP_INV_AMT,
		[FunctionCode] = AP_PRODUCTION.FNC_CODE,
		[FunctionDescription] = V_FUNCTION.FNC_DESCRIPTION,
		[NonbillableFlag] = V_FUNCTION.FNC_NONBILL_FLAG,
		[GeneralLedgerCode] = AP_PRODUCTION.GLACODE,
		[Quantity] = AP_PRODUCTION.AP_PROD_QUANTITY,
		[Rate] = AP_PRODUCTION.AP_PROD_RATE,
		[Amount] = AP_PRODUCTION.AP_PROD_EXT_AMT
	FROM
		dbo.AP_PRODUCTION
	JOIN 
		dbo.AP_HEADER ON AP_PRODUCTION.AP_ID = AP_HEADER.AP_ID
	JOIN 
		dbo.V_FUNCTION ON AP_PRODUCTION.FNC_CODE = V_FUNCTION.FNC_CODE
	WHERE 
		AP_PRODUCTION.PO_NUMBER = @PO_NUMBER AND 
		AP_PRODUCTION.PO_LINE_NUMBER = @PO_LINE_NUMBER AND
		ISNULL(AP_PRODUCTION.MODIFY_DELETE, 0) = 0 AND
		ISNULL(AP_HEADER.MODIFY_FLAG, 0) = 0
	UNION
	SELECT	
		[InvoiceNumber] = AP_HEADER.AP_INV_VCHR,
		[InvoiceDate] = AP_HEADER.AP_INV_DATE,
		[InvoiceAmount] = AP_HEADER.AP_INV_AMT,
		[FunctionCode] = NULL,
		[FunctionDescription] = NULL,
		[NonbillableFlag] = NULL,
		[GeneralLedgerCode] = AP_GL_DIST.GLACODE,
		[Quantity] = NULL,
		[Rate] = NULL,
		[Amount] = AP_GL_DIST.AP_GL_AMT
	FROM 
		dbo.AP_GL_DIST
	JOIN 
		dbo.AP_HEADER ON AP_GL_DIST.AP_ID = AP_HEADER.AP_ID
	WHERE 
		AP_GL_DIST.PO_NUMBER = @PO_NUMBER AND 
		AP_GL_DIST.PO_LINE_NUMBER = @PO_LINE_NUMBER AND
		ISNULL(AP_GL_DIST.MODIFY_DELETE, 0) = 0 AND
		ISNULL(AP_HEADER.MODIFY_FLAG, 0) = 0

END