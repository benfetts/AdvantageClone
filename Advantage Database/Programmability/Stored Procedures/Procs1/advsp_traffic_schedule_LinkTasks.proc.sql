CREATE PROCEDURE [dbo].[advsp_traffic_schedule_LinkTasks]
	@JOB_NUMBER INT,
	@JOB_COMPONENT_NBR SMALLINT,
	@SEQ_NBR SMALLINT,
	@LINK BIT,
	@LINK_TO_SEQ_NBR SMALLINT = -1
AS
BEGIN

	IF @LINK = 1
	BEGIN
	
		IF @LINK_TO_SEQ_NBR IS NOT NULL 
		BEGIN

			IF NOT EXISTS(SELECT * FROM dbo.JOB_TRAFFIC_DET_PREDS WHERE JOB_NUMBER = @JOB_NUMBER AND JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR AND SEQ_NBR = @SEQ_NBR AND PREDECESSOR_SEQ_NBR = @LINK_TO_SEQ_NBR)
			BEGIN
			
				INSERT INTO dbo.JOB_TRAFFIC_DET_PREDS (JOB_NUMBER, JOB_COMPONENT_NBR, SEQ_NBR, PREDECESSOR_SEQ_NBR) VALUES (@JOB_NUMBER, @JOB_COMPONENT_NBR, @SEQ_NBR, @LINK_TO_SEQ_NBR)

			END

			-- PREVENTS CIRCULAR PREDECESSORS
			DELETE FROM 
				dbo.JOB_TRAFFIC_DET_PREDS
			WHERE
				JOB_NUMBER = @JOB_NUMBER AND 
				JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR AND 
				SEQ_NBR = @LINK_TO_SEQ_NBR AND
				PREDECESSOR_SEQ_NBR = @SEQ_NBR

		END

	END
	ELSE
	BEGIN

		DELETE FROM 
			dbo.JOB_TRAFFIC_DET_PREDS 
		WHERE 
			JOB_NUMBER = @JOB_NUMBER AND 
			JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR AND 
			SEQ_NBR = @SEQ_NBR

	END
	
END