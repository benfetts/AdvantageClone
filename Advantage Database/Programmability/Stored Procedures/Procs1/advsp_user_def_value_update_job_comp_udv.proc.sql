CREATE PROCEDURE [dbo].[advsp_user_def_value_update_job_comp_udv]
	@USER_DEF_TYPE_ID AS int,
	@LEVEL AS int
AS
BEGIN

	IF @LEVEL = 1 BEGIN
	
		UPDATE [dbo].[JOB_CMP_UDV1] SET [INACTIVE_FLAG] = 1 WHERE UDV_CODE NOT IN ('0000', '0001')
		
		INSERT INTO [dbo].[JOB_CMP_UDV1]([UDV_CODE], [UDV_DESC], [INACTIVE_FLAG])
		SELECT 
			[USER_DEF_TYPE_VALUE_ID], LEFT(UDTV.[CODE] + '|' + UDTV.[DESCRIPTION], 40), CASE WHEN [ENABLED] = 1 THEN NULL ELSE 1 END 
		FROM 
			[dbo].[USER_DEF_TYPE_VALUE] UDTV 
		WHERE 
			UDTV.USER_DEF_TYPE_ID = @USER_DEF_TYPE_ID AND 
			UDTV.USER_DEF_TYPE_VALUE_ID NOT IN (SELECT CAST([UDV_CODE] AS int) FROM [dbo].[JOB_CMP_UDV1] WHERE ISNUMERIC([UDV_CODE]) = 1)

		UPDATE [dbo].[JOB_CMP_UDV1] SET [INACTIVE_FLAG] = NULL WHERE UDV_CODE <> '0000' AND UDV_CODE <> '0001' AND ISNUMERIC([UDV_CODE]) = 1 AND CAST([UDV_CODE] AS int) IN (SELECT USER_DEF_TYPE_VALUE_ID FROM [dbo].[USER_DEF_TYPE_VALUE] WHERE [USER_DEF_TYPE_ID] = @USER_DEF_TYPE_ID AND [ENABLED] = 1)
		
	END ELSE IF @LEVEL = 2 BEGIN
	
		UPDATE [dbo].[JOB_CMP_UDV2] SET [INACTIVE_FLAG] = 1 WHERE UDV_CODE NOT IN ('0000', '0001')
		
		INSERT INTO [dbo].[JOB_CMP_UDV2]([UDV_CODE], [UDV_DESC], [INACTIVE_FLAG])
		SELECT 
			[USER_DEF_TYPE_VALUE_ID], LEFT(UDTV.[CODE] + '|' + UDTV.[DESCRIPTION], 40), CASE WHEN [ENABLED] = 1 THEN NULL ELSE 1 END 
		FROM 
			[dbo].[USER_DEF_TYPE_VALUE] UDTV 
		WHERE 
			UDTV.USER_DEF_TYPE_ID = @USER_DEF_TYPE_ID AND 
			UDTV.USER_DEF_TYPE_VALUE_ID NOT IN (SELECT CAST([UDV_CODE] AS int) FROM [dbo].[JOB_CMP_UDV2] WHERE ISNUMERIC([UDV_CODE]) = 1)

		UPDATE [dbo].[JOB_CMP_UDV2] SET [INACTIVE_FLAG] = NULL WHERE UDV_CODE <> '0000' AND UDV_CODE <> '0001' AND ISNUMERIC([UDV_CODE]) = 1 AND CAST([UDV_CODE] AS int) IN (SELECT USER_DEF_TYPE_VALUE_ID FROM [dbo].[USER_DEF_TYPE_VALUE] WHERE [USER_DEF_TYPE_ID] = @USER_DEF_TYPE_ID AND [ENABLED] = 1)
		
	END ELSE IF @LEVEL = 3 BEGIN
	
		UPDATE [dbo].[JOB_CMP_UDV3] SET [INACTIVE_FLAG] = 1 WHERE UDV_CODE NOT IN ('0000', '0001')
		
		INSERT INTO [dbo].[JOB_CMP_UDV3]([UDV_CODE], [UDV_DESC], [INACTIVE_FLAG])
		SELECT 
			[USER_DEF_TYPE_VALUE_ID], LEFT(UDTV.[CODE] + '|' + UDTV.[DESCRIPTION], 40), CASE WHEN [ENABLED] = 1 THEN NULL ELSE 1 END 
		FROM 
			[dbo].[USER_DEF_TYPE_VALUE] UDTV 
		WHERE 
			UDTV.USER_DEF_TYPE_ID = @USER_DEF_TYPE_ID AND 
			UDTV.USER_DEF_TYPE_VALUE_ID NOT IN (SELECT CAST([UDV_CODE] AS int) FROM [dbo].[JOB_CMP_UDV3] WHERE ISNUMERIC([UDV_CODE]) = 1)

		UPDATE [dbo].[JOB_CMP_UDV3] SET [INACTIVE_FLAG] = NULL WHERE UDV_CODE <> '0000' AND UDV_CODE <> '0001' AND ISNUMERIC([UDV_CODE]) = 1 AND CAST([UDV_CODE] AS int) IN (SELECT USER_DEF_TYPE_VALUE_ID FROM [dbo].[USER_DEF_TYPE_VALUE] WHERE [USER_DEF_TYPE_ID] = @USER_DEF_TYPE_ID AND [ENABLED] = 1)
		
	END ELSE IF @LEVEL = 4 BEGIN
	
		UPDATE [dbo].[JOB_CMP_UDV4] SET [INACTIVE_FLAG] = 1 WHERE UDV_CODE NOT IN ('0000', '0001')
		
		INSERT INTO [dbo].[JOB_CMP_UDV4]([UDV_CODE], [UDV_DESC], [INACTIVE_FLAG])
		SELECT 
			[USER_DEF_TYPE_VALUE_ID], LEFT(UDTV.[CODE] + '|' + UDTV.[DESCRIPTION], 40), CASE WHEN [ENABLED] = 1 THEN NULL ELSE 1 END 
		FROM 
			[dbo].[USER_DEF_TYPE_VALUE] UDTV 
		WHERE 
			UDTV.USER_DEF_TYPE_ID = @USER_DEF_TYPE_ID AND 
			UDTV.USER_DEF_TYPE_VALUE_ID NOT IN (SELECT CAST([UDV_CODE] AS int) FROM [dbo].[JOB_CMP_UDV4] WHERE ISNUMERIC([UDV_CODE]) = 1)

		UPDATE [dbo].[JOB_CMP_UDV4] SET [INACTIVE_FLAG] = NULL WHERE UDV_CODE <> '0000' AND UDV_CODE <> '0001' AND ISNUMERIC([UDV_CODE]) = 1 AND CAST([UDV_CODE] AS int) IN (SELECT USER_DEF_TYPE_VALUE_ID FROM [dbo].[USER_DEF_TYPE_VALUE] WHERE [USER_DEF_TYPE_ID] = @USER_DEF_TYPE_ID AND [ENABLED] = 1)
		
	END ELSE IF @LEVEL = 5 BEGIN
	
		UPDATE [dbo].[JOB_CMP_UDV5] SET [INACTIVE_FLAG] = 1 WHERE UDV_CODE NOT IN ('0000', '0001')
		
		INSERT INTO [dbo].[JOB_CMP_UDV5]([UDV_CODE], [UDV_DESC], [INACTIVE_FLAG])
		SELECT 
			[USER_DEF_TYPE_VALUE_ID], LEFT(UDTV.[CODE] + '|' + UDTV.[DESCRIPTION], 40), CASE WHEN [ENABLED] = 1 THEN NULL ELSE 1 END 
		FROM 
			[dbo].[USER_DEF_TYPE_VALUE] UDTV 
		WHERE 
			UDTV.USER_DEF_TYPE_ID = @USER_DEF_TYPE_ID AND 
			UDTV.USER_DEF_TYPE_VALUE_ID NOT IN (SELECT CAST([UDV_CODE] AS int) FROM [dbo].[JOB_CMP_UDV5] WHERE ISNUMERIC([UDV_CODE]) = 1)

		UPDATE [dbo].[JOB_CMP_UDV5] SET [INACTIVE_FLAG] = NULL WHERE UDV_CODE <> '0000' AND UDV_CODE <> '0001' AND ISNUMERIC([UDV_CODE]) = 1 AND CAST([UDV_CODE] AS int) IN (SELECT USER_DEF_TYPE_VALUE_ID FROM [dbo].[USER_DEF_TYPE_VALUE] WHERE [USER_DEF_TYPE_ID] = @USER_DEF_TYPE_ID AND [ENABLED] = 1)
		
	END

END
GO