
CREATE PROCEDURE [dbo].[usp_wv_AD_NUMBER_GET_BY_DATE_OR_JC] /*WITH ENCRYPTION*/
	@START_DATE SMALLDATETIME,
	@END_DATE SMALLDATETIME,
	@JOB_NUMBER INT,
	@JOB_COMPONENT_NBR SMALLINT
AS
/*=========== QUERY ===========*/
	SET @START_DATE = CONVERT(
			DATETIME,
			CONVERT(CHAR(10), DATEPART(yyyy, @START_DATE), 101) 
			+
			'-' +
			CONVERT(CHAR(10), DATEPART(mm, @START_DATE), 101) +
			'-' +
			CONVERT(CHAR(10), DATEPART(dd, @START_DATE), 101) +
			' 00:00:00'
		);
 
	SET @END_DATE = CONVERT(
			DATETIME,
			CONVERT(CHAR(10), DATEPART(yyyy, @END_DATE), 101) 
			+
			'-' +
			CONVERT(CHAR(10), DATEPART(mm, @END_DATE), 101) +
			'-' +
			CONVERT(CHAR(10), DATEPART(dd, @END_DATE), 101) +
			' 23:59:00'
		); 

	--DATE RANGE ONLY
	IF ((NOT (@START_DATE IS NULL)) AND (NOT (@END_DATE IS NULL)))
	   AND (@JOB_NUMBER = 0 OR @JOB_COMPONENT_NBR = 0)
	BEGIN
		SELECT DISTINCT 
			   ISNULL(EVENT.AD_NUMBER, '[None]') AS AD_NUMBER,
			   ISNULL(AD_NUMBER.AD_NBR + ' - ' + AD_NUMBER.AD_NBR_DESC, '[None]') AS 
			   AD_NBR_DESC
		FROM   EVENT WITH (NOLOCK)
			   LEFT OUTER JOIN AD_NUMBER
					ON  EVENT.AD_NUMBER = AD_NUMBER.AD_NBR
		WHERE  ((AD_NUMBER.ACTIVE IS NULL) OR (AD_NUMBER.ACTIVE = 1))
			   AND [EVENT].EVENT_DATE BETWEEN @START_DATE AND @END_DATE
		ORDER BY
			   AD_NUMBER;
	END
	--DATE RANGE AND JOB/COMP
	IF ((NOT (@START_DATE IS NULL)) AND (NOT (@END_DATE IS NULL)))
	   AND (@JOB_NUMBER > 0 AND @JOB_COMPONENT_NBR > 0)
	BEGIN
		SELECT DISTINCT 
			   ISNULL(EVENT.AD_NUMBER, '[None]') AS AD_NUMBER,
			   ISNULL(AD_NUMBER.AD_NBR + ' - ' + AD_NUMBER.AD_NBR_DESC, '[None]') AS 
			   AD_NBR_DESC
		FROM   EVENT WITH (NOLOCK)
			   LEFT OUTER JOIN AD_NUMBER
					ON  EVENT.AD_NUMBER = AD_NUMBER.AD_NBR
		WHERE  ((AD_NUMBER.ACTIVE IS NULL) OR (AD_NUMBER.ACTIVE = 1))
			   AND [EVENT].EVENT_DATE BETWEEN @START_DATE AND @END_DATE
			   AND [EVENT].JOB_NUMBER = @JOB_NUMBER
		ORDER BY
			   AD_NUMBER;
	END
	--JOB/COMPONENT ONLY
	IF @JOB_NUMBER > 0
	   AND @JOB_COMPONENT_NBR > 0
	BEGIN
		SELECT DISTINCT 
			   ISNULL(EVENT.AD_NUMBER, '[None]') AS AD_NUMBER,
			   ISNULL(AD_NUMBER.AD_NBR + ' - ' + AD_NUMBER.AD_NBR_DESC, '[None]') AS 
			   AD_NBR_DESC
		FROM   EVENT WITH (NOLOCK)
			   LEFT OUTER JOIN AD_NUMBER
					ON  EVENT.AD_NUMBER = AD_NUMBER.AD_NBR
		WHERE  ((AD_NUMBER.ACTIVE IS NULL) OR (AD_NUMBER.ACTIVE = 1))
			   AND [EVENT].JOB_NUMBER = @JOB_NUMBER
		ORDER BY
			   AD_NUMBER;
	END
/*=========== QUERY ===========*/
