SET QUOTED_IDENTIFIER ON 
GO
SET ANSI_NULLS OFF 
GO

if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[usp_wv_ALERT_COMMENTS_BY_JOB]') and OBJECTPROPERTY(id, N'IsProcedure') = 1)
drop procedure [dbo].[usp_wv_ALERT_COMMENTS_BY_JOB]
GO

CREATE PROCEDURE [dbo].[usp_wv_ALERT_COMMENTS_BY_JOB] /*WITH ENCRYPTION*/
	@JOB_NUMBER INT,
	@JOB_COMPONENT_NBR SMALLINT
AS
/*=========== QUERY ===========*/
	SELECT ALERT_COMMENT.COMMENT,
		   ALERT_COMMENT.COMMENT_ID,
		   ALERT_COMMENT.ALERT_ID,
		   ALERT_COMMENT.USER_CODE,
		   ALERT_COMMENT.GENERATED_DATE,
		   ALERT.JOB_NUMBER,
		   ALERT.JOB_COMPONENT_NBR,
		   ALERT.SUBJECT,
		   dbo.udf_get_empl_name(SEC_USER.EMP_CODE,'FML') AS EMP_FML
	FROM   ALERT_COMMENT WITH(NOLOCK)
		   INNER JOIN ALERT WITH(NOLOCK)
				ON  ALERT_COMMENT.ALERT_ID = ALERT.ALERT_ID
		   INNER JOIN SEC_USER WITH(NOLOCK)
				ON  UPPER(ALERT_COMMENT.USER_CODE) = UPPER(SEC_USER.USER_CODE)
	WHERE  (ALERT.JOB_NUMBER = @JOB_NUMBER)
	ORDER BY
		   ALERT_COMMENT.GENERATED_DATE DESC,
           ALERT_COMMENT.COMMENT_ID DESC;
/*=========== QUERY ===========*/
GO
SET QUOTED_IDENTIFIER ON 
GO
SET ANSI_NULLS ON 
GO


