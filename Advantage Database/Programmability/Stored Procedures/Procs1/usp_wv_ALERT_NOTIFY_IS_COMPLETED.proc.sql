
CREATE PROCEDURE [dbo].[usp_wv_ALERT_NOTIFY_IS_COMPLETED] /*WITH ENCRYPTION*/
@ALERT_ID INT
AS
/*=========== QUERY ===========*/
	DECLARE @IS_COMPLETED TINYINT
	SET @IS_COMPLETED = 0
	
	SELECT @IS_COMPLETED  = @IS_COMPLETED + ISNULL(COUNT(1), 0)
	FROM   ALERT WITH(NOLOCK)
		   INNER JOIN ALERT_RCPT WITH(NOLOCK)
				ON  ALERT.ALERT_ID = ALERT_RCPT.ALERT_ID
	WHERE  ALERT.ALERT_ID = @ALERT_ID
		   AND ALERT_RCPT.CURRENT_NOTIFY = 1
		   AND (NOT(ALERT_RCPT.PROCESSED IS NULL));
		   
	SELECT @IS_COMPLETED  = @IS_COMPLETED + ISNULL(COUNT(1), 0)
	FROM   ALERT WITH(NOLOCK)
		   INNER JOIN ALERT_RCPT_DISMISSED WITH(NOLOCK)
				ON  ALERT.ALERT_ID = ALERT_RCPT_DISMISSED.ALERT_ID
	WHERE  ALERT.ALERT_ID = @ALERT_ID
		   AND ALERT_RCPT_DISMISSED.CURRENT_NOTIFY = 1
		   AND (NOT(ALERT_RCPT_DISMISSED.PROCESSED IS NULL));
		   
	SELECT @IS_COMPLETED;	   
/*=========== QUERY ===========*/
