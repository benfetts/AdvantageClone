
CREATE PROCEDURE [dbo].[usp_wv_BA_APPROVAL_JC_DELETE_ALL] 
	@BA_HDR_ID AS INTEGER
AS
			DECLARE
				@BA_ID AS INTEGER,
				@JOB_NUMBER AS INTEGER,
				@JOB_COMPONENT_NBR AS SMALLINT

			SELECT
				@BA_ID = BA_ID,
				@JOB_NUMBER = JOB_NUMBER,
				@JOB_COMPONENT_NBR = JOB_COMPONENT_NBR
			FROM
				BILL_APPR_HDR WITH(NOLOCK)
			WHERE
				BA_HDR_ID = @BA_HDR_ID;
				
				
			UPDATE EMP_TIME_DTL WITH(ROWLOCK) SET BA_ID = NULL WHERE BA_ID = @BA_ID;
			UPDATE INCOME_ONLY WITH(ROWLOCK) SET BA_ID = NULL WHERE BA_ID = @BA_ID;
			UPDATE AP_PRODUCTION WITH(ROWLOCK) SET BA_ID = NULL WHERE BA_ID = @BA_ID;
			UPDATE PURCHASE_ORDER_DET WITH(ROWLOCK) SET BA_ID = NULL WHERE BA_ID = @BA_ID;
			
			DELETE FROM BILL_APPR_ITEM WITH(ROWLOCK) WHERE BA_DTL_ID IN
			(
				SELECT
					BA_DTL_ID 
				FROM
					BILL_APPR_DTL WITH(NOLOCK)
				WHERE
					BA_ID = @BA_ID
					AND JOB_NUMBER = @JOB_NUMBER
					AND JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR
			)

			DELETE FROM BILL_APPR_DTL WITH(ROWLOCK) 
			WHERE
				BA_ID = @BA_ID
				AND JOB_NUMBER = @JOB_NUMBER
				AND JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR;

			DELETE FROM BILL_APPR_HDR WITH(ROWLOCK) WHERE BA_HDR_ID = @BA_HDR_ID;


