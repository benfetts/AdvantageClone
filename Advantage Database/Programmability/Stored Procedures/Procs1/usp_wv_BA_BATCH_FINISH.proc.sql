
CREATE PROCEDURE [dbo].[usp_wv_BA_BATCH_FINISH] 
--VARS FOR BATCH:
	@BA_BATCH_ID INT
AS


DECLARE
	@CURR_FINISHED AS BIT

SELECT @CURR_FINISHED = FINISHED FROM BILL_APPR_BATCH WITH(NOLOCK) WHERE BA_BATCH_ID = @BA_BATCH_ID;

IF @CURR_FINISHED = 1 --UNFINISH IT:
	BEGIN
		UPDATE BILL_APPR_BATCH WITH(ROWLOCK) SET FINISHED = 0 WHERE BA_BATCH_ID = @BA_BATCH_ID;
		--RE-APPLY CRITERIA TO JOB/COMPS:
		EXEC dbo.usp_wv_BA_BATCH_APPLY_CRITERIA @BA_BATCH_ID
	END
ELSE --FINISH IT
	BEGIN
		UPDATE BILL_APPR_BATCH WITH(ROWLOCK) SET FINISHED = 1 WHERE BA_BATCH_ID = @BA_BATCH_ID;
		--RELEASE CRITERIA FROM JOB/COMPS:
		EXEC dbo.usp_wv_BA_BATCH_CLEAR_SEL @BA_BATCH_ID,0
	END





