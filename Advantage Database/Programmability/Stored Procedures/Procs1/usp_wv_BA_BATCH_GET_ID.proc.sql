
CREATE PROCEDURE [dbo].[usp_wv_BA_BATCH_GET_ID] 
	@JOB_NUMBER INT,
	@JOB_COMPONENT_NBR SMALLINT

AS

        SELECT     
            JOB_PROC_CONTROLS.JOB_PROCESS_CONTRL, 
            ISNULL(JOB_PROC_CONTROLS.JOB_PROCESS_DESC,'') AS JOB_PROCESS_DESC, 
            ISNULL(
            RIGHT(REPLICATE('0', 6) 
            + CONVERT(VARCHAR(20), BILL_APPR_BATCH.BA_BATCH_ID), 6) + ' - ' + ISNULL(BILL_APPR_BATCH.BA_BATCH_DESC, '') 
            ,'') AS DISPLAY_BATCH, 
            ISNULL(BILL_APPR_BATCH.BA_BATCH_ID,0) AS BA_BATCH_ID, 
            ISNULL(BILL_APPR_BATCH.BA_BATCH_DESC,'') AS BA_BATCH_DESC, 
             ISNULL(BILL_APPR_BATCH.CREATE_USER,'') AS BA_BATCH_CREATE_USER, 
            BILL_APPR_BATCH.BATCH_DATE AS BA_BATCH_BATCH_DATE, 
           ISNULL(JOB_COMPONENT.BILLING_USER,'') AS BILLING_USER, 
            JOB_COMPONENT.AB_FLAG, 
            CASE 
                WHEN JOB_COMPONENT.AB_FLAG = 0 OR JOB_COMPONENT.AB_FLAG IS NULL THEN 'No' 
                ELSE 'Yes' 
            END AS DISPLAY_AB
        FROM         
            JOB_COMPONENT WITH (NOLOCK) INNER JOIN
            JOB_PROC_CONTROLS WITH (NOLOCK) ON 
            JOB_COMPONENT.JOB_PROCESS_CONTRL = JOB_PROC_CONTROLS.JOB_PROCESS_CONTRL LEFT OUTER JOIN
            BILL_APPR_BATCH WITH (NOLOCK) ON JOB_COMPONENT.BA_BATCH_ID = BILL_APPR_BATCH.BA_BATCH_ID
        WHERE     
	        (JOB_COMPONENT.JOB_NUMBER = @JOB_NUMBER) 
	        AND (JOB_COMPONENT.JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR);



        --SELECT 
	    --    ISNULL(BA_BATCH_ID,0) 
        --FROM 
	    --    JOB_COMPONENT WITH(NOLOCK) 
        --WHERE 
	    --    JOB_NUMBER = @JOB_NUMBER 
	    --    AND JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR;	
	
	
