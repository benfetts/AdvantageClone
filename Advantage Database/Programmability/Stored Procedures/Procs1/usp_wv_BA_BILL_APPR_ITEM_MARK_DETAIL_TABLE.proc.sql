
CREATE PROCEDURE [dbo].[usp_wv_BA_BILL_APPR_ITEM_MARK_DETAIL_TABLE] 
	@REC_TYPE AS VARCHAR(1),
	@REC_ID AS INTEGER,
	@BA_ID AS INTEGER,
	@INSTR AS TINYINT,
	@JOB_NUMBER AS INTEGER,
	@JOB_COMPONENT_NBR AS SMALLINT,
	@FNC_CODE AS VARCHAR(6),
	@IS_PO AS SMALLINT,
	@PO_NUMBER AS INTEGER,
	@PO_LINE_NUMBER AS INTEGER

AS

	--IF INSTR IS ZERO, UNMARK THE DETAIL RECORD

	IF @REC_TYPE = 'E'
	BEGIN
		IF @INSTR > 0 
			BEGIN
				UPDATE EMP_TIME_DTL WITH(ROWLOCK) SET BA_ID = @BA_ID WHERE ET_ID = @REC_ID AND JOB_NUMBER = @JOB_NUMBER AND JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR AND FNC_CODE = @FNC_CODE;
			END
		ELSE
			BEGIN --UN-MARK:
				UPDATE EMP_TIME_DTL WITH(ROWLOCK) SET BA_ID = NULL WHERE ET_ID = @REC_ID AND JOB_NUMBER = @JOB_NUMBER AND JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR AND FNC_CODE = @FNC_CODE;
			END
	END

	IF @REC_TYPE = 'I'
	BEGIN
		IF @INSTR > 0 
			BEGIN
				UPDATE INCOME_ONLY WITH(ROWLOCK) SET BA_ID = @BA_ID WHERE IO_ID = @REC_ID AND JOB_NUMBER = @JOB_NUMBER AND JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR AND FNC_CODE = @FNC_CODE;
			END
		ELSE
			BEGIN --UN-MARK:
				UPDATE INCOME_ONLY WITH(ROWLOCK) SET BA_ID = NULL WHERE IO_ID = @REC_ID AND JOB_NUMBER = @JOB_NUMBER AND JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR AND FNC_CODE = @FNC_CODE;
			END
	END

	IF (@REC_TYPE = 'V' AND @IS_PO = 0)
	BEGIN
		IF @INSTR > 0 
			BEGIN
				UPDATE AP_PRODUCTION WITH(ROWLOCK) SET BA_ID = @BA_ID WHERE AP_ID = @REC_ID AND JOB_NUMBER = @JOB_NUMBER AND JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR AND FNC_CODE = @FNC_CODE;
			END
		ELSE
			BEGIN --UN-MARK:
				UPDATE AP_PRODUCTION WITH(ROWLOCK) SET BA_ID = NULL WHERE AP_ID = @REC_ID AND JOB_NUMBER = @JOB_NUMBER AND JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR AND FNC_CODE = @FNC_CODE;
			END
	END
	
	IF (@REC_TYPE = 'V' AND @IS_PO = 1)
	BEGIN
		IF @INSTR > 0 
			BEGIN
				UPDATE PURCHASE_ORDER_DET WITH(ROWLOCK) SET BA_ID = @BA_ID WHERE PO_NUMBER = @PO_NUMBER AND LINE_NUMBER = @PO_LINE_NUMBER AND JOB_NUMBER = @JOB_NUMBER AND JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR AND FNC_CODE = @FNC_CODE;
			END
		ELSE
			BEGIN --UN-MARK:
				UPDATE PURCHASE_ORDER_DET WITH(ROWLOCK) SET BA_ID = NULL WHERE  PO_NUMBER = @PO_NUMBER AND LINE_NUMBER = @PO_LINE_NUMBER AND JOB_NUMBER = @JOB_NUMBER AND JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR AND FNC_CODE = @FNC_CODE;
			END
	END
	
	
