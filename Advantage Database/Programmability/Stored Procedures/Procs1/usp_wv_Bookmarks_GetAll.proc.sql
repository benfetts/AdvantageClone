SET QUOTED_IDENTIFIER ON 
GO
SET ANSI_NULLS OFF 
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'[dbo].[usp_wv_Bookmarks_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
DROP PROCEDURE [dbo].[usp_wv_Bookmarks_GetAll]
GO
CREATE PROCEDURE [dbo].[usp_wv_Bookmarks_GetAll] /*WITH ENCRYPTION*/
@USER_CODE VARCHAR(100)
AS
/*=========== QUERY ===========*/

	SELECT * 
	FROM 
		WV_BOOKMARK_FOLDERS WITH(NOLOCK) 
	WHERE 
		UPPER(USER_CODE) = UPPER(@USER_CODE);

	SELECT        
		WV_BOOKMARKS.ID AS ID, WV_BOOKMARKS.BOOKMARK_TYPE_ID, WV_BOOKMARKS.USER_CODE, WV_BOOKMARKS.NAME, 
		WV_BOOKMARKS.DESCRIPTION, WV_BOOKMARKS.PAGE_URL, WV_BOOKMARKS.SEQ_NBR, WV_BOOKMARK_FOLDERS.ID AS BOOKMARK_FOLDER_ID, 
		WV_BOOKMARK_FOLDERS.NAME AS BOOKMARK_FOLDER_NAME, WV_BOOKMARK_FOLDERS.DESCRIPTION AS BOOKMARK_FOLDER_DESCRIPTION
	FROM           
		WV_BOOKMARK_FOLDERS WITH(NOLOCK) INNER JOIN
		WV_BOOKMARKS_BOOKMARK_FOLDERS WITH(NOLOCK) ON 
		WV_BOOKMARK_FOLDERS.ID = WV_BOOKMARKS_BOOKMARK_FOLDERS.BOOKMARK_FOLDER_ID RIGHT OUTER JOIN
		WV_BOOKMARKS ON WV_BOOKMARKS_BOOKMARK_FOLDERS.BOOKMARK_ID = WV_BOOKMARKS.ID
	WHERE 
		UPPER(WV_BOOKMARKS.USER_CODE) = UPPER(@USER_CODE);

/*=========== QUERY ===========*/
GO
SET QUOTED_IDENTIFIER ON 
GO
SET ANSI_NULLS ON 
GO