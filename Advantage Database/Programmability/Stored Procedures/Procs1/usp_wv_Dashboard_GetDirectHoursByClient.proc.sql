

CREATE PROCEDURE [dbo].[usp_wv_Dashboard_GetDirectHoursByClient]
(
	@EmpCode varchar(6),
	@StartDate varchar(12),
	@EndDate varchar(12)
)
AS
DECLARE @TotalDirect as decimal(12,2)
if @EmpCode <> ''
Begin
	if @StartDate <> '' and @EndDate <> ''
		Begin
			SELECT @TotalDirect = SUM(DIRECT_HOURS)
			FROM DASH_DATA_EMP_TIME 
			WHERE DASH_DATA_EMP_TIME.EMP_CODE = @EmpCode AND DASH_DATA_EMP_TIME.EMP_DATE >= @StartDate AND DASH_DATA_EMP_TIME.EMP_DATE <= @EndDate
			SELECT DASH_DATA_EMP_TIME.CLIENT, CLIENT.CL_NAME, SUM(DIRECT_HOURS) AS HOURS, (SUM(DIRECT_HOURS)/@TotalDirect) * 100 AS PERC
			FROM DASH_DATA_EMP_TIME INNER JOIN
				 CLIENT ON DASH_DATA_EMP_TIME.CLIENT = CLIENT.CL_CODE
			WHERE DASH_DATA_EMP_TIME.EMP_CODE = @EmpCode AND DASH_DATA_EMP_TIME.EMP_DATE >= @StartDate AND DASH_DATA_EMP_TIME.EMP_DATE <= @EndDate
			GROUP BY DASH_DATA_EMP_TIME.CLIENT, CLIENT.CL_NAME
		End
	Else
		Begin
			SELECT @TotalDirect = SUM(DIRECT_HOURS)
			FROM DASH_DATA_EMP_TIME 
			WHERE DASH_DATA_EMP_TIME.EMP_CODE = @EmpCode 
			SELECT DASH_DATA_EMP_TIME.CLIENT, CLIENT.CL_NAME, SUM(DIRECT_HOURS) AS HOURS, (SUM(DIRECT_HOURS)/@TotalDirect) * 100 AS PERC
			FROM DASH_DATA_EMP_TIME INNER JOIN
				 CLIENT ON DASH_DATA_EMP_TIME.CLIENT = CLIENT.CL_CODE
			WHERE DASH_DATA_EMP_TIME.EMP_CODE = @EmpCode
			GROUP BY DASH_DATA_EMP_TIME.CLIENT, CLIENT.CL_NAME
		End	
End
Else
Begin
	if @StartDate <> '' and @EndDate <> ''
		Begin
			SELECT @TotalDirect = SUM(DIRECT_HOURS)
			FROM DASH_DATA_EMP_TIME 
			WHERE DASH_DATA_EMP_TIME.EMP_DATE >= @StartDate AND DASH_DATA_EMP_TIME.EMP_DATE <= @EndDate
			SELECT DASH_DATA_EMP_TIME.CLIENT, CLIENT.CL_NAME, SUM(DIRECT_HOURS) AS HOURS, (SUM(DIRECT_HOURS)/@TotalDirect) * 100 AS PERC
			FROM DASH_DATA_EMP_TIME INNER JOIN
				 CLIENT ON DASH_DATA_EMP_TIME.CLIENT = CLIENT.CL_CODE
			WHERE DASH_DATA_EMP_TIME.EMP_DATE >= @StartDate AND DASH_DATA_EMP_TIME.EMP_DATE <= @EndDate
			GROUP BY DASH_DATA_EMP_TIME.CLIENT, CLIENT.CL_NAME
		End
	Else
		Begin
			SELECT @TotalDirect = SUM(DIRECT_HOURS)
			FROM DASH_DATA_EMP_TIME 
			SELECT DASH_DATA_EMP_TIME.CLIENT, CLIENT.CL_NAME, SUM(DIRECT_HOURS) AS HOURS, (SUM(DIRECT_HOURS)/@TotalDirect) * 100 AS PERC
			FROM DASH_DATA_EMP_TIME INNER JOIN
				 CLIENT ON DASH_DATA_EMP_TIME.CLIENT = CLIENT.CL_CODE
			GROUP BY DASH_DATA_EMP_TIME.CLIENT, CLIENT.CL_NAME
		End		
End



