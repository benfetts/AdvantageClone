

CREATE PROCEDURE [dbo].[usp_wv_Dashboard_GetNonDirectHoursWithTotal]
(
	@EmpCode varchar(6)
)
AS
if @EmpCode <> ''
Begin
	SELECT DASH_DATA_EMP_TIME.EMP_CODE, isnull(EMP_FNAME,'') + ' ' + isnull(EMP_MI,'') + case when EMP_MI is not null then '. ' else '' end +  isnull(EMP_LNAME,'') AS EMP_DESC, SUM(NON_PROD_HOURS) AS NONDIRECT, SUM(DIRECT_HOURS) + SUM(NON_PROD_HOURS) AS TOTAL_HOURS
	FROM DASH_DATA_EMP_TIME INNER JOIN
				 EMPLOYEE ON DASH_DATA_EMP_TIME.EMP_CODE = EMPLOYEE.EMP_CODE 
	WHERE DASH_DATA_EMP_TIME.EMP_CODE = @EmpCode
	GROUP BY DASH_DATA_EMP_TIME.EMP_CODE, EMP_FNAME, EMP_MI, EMP_LNAME
End
Else
Begin
	SELECT DASH_DATA_EMP_TIME.EMP_CODE, isnull(EMP_FNAME,'') + ' ' + isnull(EMP_MI,'') + case when EMP_MI is not null then '. ' else '' end +  isnull(EMP_LNAME,'') AS EMP_DESC, SUM(NON_PROD_HOURS) AS NONDIRECT, SUM(DIRECT_HOURS) + SUM(NON_PROD_HOURS) AS TOTAL_HOURS
	FROM DASH_DATA_EMP_TIME INNER JOIN
				 EMPLOYEE ON DASH_DATA_EMP_TIME.EMP_CODE = EMPLOYEE.EMP_CODE
	GROUP BY DASH_DATA_EMP_TIME.EMP_CODE, EMP_FNAME, EMP_MI, EMP_LNAME
End



