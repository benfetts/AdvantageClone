IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'[dbo].[usp_wv_Dashboard_GetPostPeriodDates]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
DROP PROCEDURE [dbo].[usp_wv_Dashboard_GetPostPeriodDates]
GO

CREATE PROCEDURE [dbo].[usp_wv_Dashboard_GetPostPeriodDates]
(
	@PP varchar(6),
	@Year varchar(5)
)
AS
Declare @Restrictions Int,
		@sql nvarchar(4000),
		@paramlist nvarchar(4000)


SELECT PPSRTDATE, PPENDDATE
FROM POSTPERIOD 
WHERE PPPERIOD = @PP

IF EXISTS (SELECT PPSRTDATE FROM POSTPERIOD WHERE PPGLMONTH = 1 AND PPGLYEAR  = @Year)
BEGIN
	SELECT PPSRTDATE 
	FROM POSTPERIOD
	WHERE PPGLMONTH = 1 AND PPGLYEAR  = @Year
END
ELSE
BEGIN
	SELECT CONVERT(smalldatetime, '01/01/' + CAST( @Year AS varchar(4)) ) AS PPSRTDATE
END

IF EXISTS (SELECT PPENDDATE FROM POSTPERIOD WHERE PPGLMONTH = 12 AND PPGLYEAR  = @Year)
BEGIN
	SELECT PPENDDATE 
	FROM POSTPERIOD 
	WHERE PPGLMONTH = 12 AND PPGLYEAR  = @Year
END
ELSE
BEGIN
	SELECT MAX(PPENDDATE) AS PPENDDATE
	FROM POSTPERIOD 
	WHERE PPGLYEAR  = @Year
END


