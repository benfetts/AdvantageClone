
CREATE PROCEDURE [dbo].[usp_wv_DayPilot_Task_UpdateDates] 
	@JOB_NUMBER INT,
	@JOB_COMPONENT_NBR SMALLINT,
	@SEQ_NBR SMALLINT,
	@NEW_START SMALLDATETIME,
	@NEW_END SMALLDATETIME,
	@USER_CODE VARCHAR(100),
	@JOB_DAYS SMALLINT

AS

        IF @JOB_NUMBER > 0 AND @JOB_COMPONENT_NBR > 0 AND @SEQ_NBR >= 0
        BEGIN
	        DECLARE @DUE_DATE_LOCK SMALLINT
        	
	        SELECT @DUE_DATE_LOCK = ISNULL(DUE_DATE_LOCK,0) FROM JOB_TRAFFIC_DET WITH(NOLOCK) 
	        WHERE	
	        JOB_NUMBER = @JOB_NUMBER AND
	        JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR AND
	        SEQ_NBR = @SEQ_NBR;
        	
	        IF @DUE_DATE_LOCK = 0
	        BEGIN
		        UPDATE JOB_TRAFFIC_DET WITH(ROWLOCK)
		        SET
			        TASK_START_DATE = @NEW_START, --THE START DATE
			        JOB_REVISED_DATE = @NEW_END, --THE DUE DATE
					JOB_DAYS = @JOB_DAYS
		        WHERE	
			        JOB_NUMBER = @JOB_NUMBER AND
			        JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR AND
			        SEQ_NBR = @SEQ_NBR;
	        END
        END	


