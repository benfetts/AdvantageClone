/****** Object:  StoredProcedure [dbo].[usp_wv_Estimating_Update_Function]    Script Date: 10/8/2017 12:36:07 PM ******/
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[usp_wv_Estimating_Update_Function]') AND type in (N'P', N'PC'))
	DROP PROCEDURE [dbo].[usp_wv_Estimating_Update_Function]
GO

SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[usp_wv_Estimating_Update_Function]
(
	@ESTIMATE_NUMBER INT,
	@EST_COMPONENT_NBR INT,
	@EST_QUOTE_NBR INT,
    @EST_REV_NBR INT,
	@SEQ_NBR INT,
	@FNC_CODE VARCHAR(6),
	@EST_REV_COMM_PCT DECIMAL(9,3),
	@EST_REV_CONT_PCT DECIMAL(7,3),
	@EST_REV_QUANTITY DECIMAL(15,2),
	@EST_REV_RATE DECIMAL(15,4),
	@EST_REV_SUP_BY_CDE VARCHAR(6),
	@EST_REV_SUP_BY_NTE TEXT,
	@EST_REV_EXT_AMT DECIMAL(15,2),
	@TAX_CODE VARCHAR(4),
	@EST_FNC_COMMENT TEXT,
    @EXT_MARKUP_AMT DECIMAL(14,2),
	@EXT_CONTINGENCY DECIMAL(14,2),
	@LINE_TOTAL DECIMAL(14,2),
    @INCL_CPU INT,
	@USER_ID VARCHAR(100),
	@EST_FNC_TYPE VARCHAR(1),
    @EST_CPM_FLAG SMALLINT,
	@TAX_STATE_PCT DECIMAL(7,4),
	@TAX_COUNTY_PCT DECIMAL(7,4),
	@TAX_CITY_PCT DECIMAL(7,4),
    @TAX_COMM SMALLINT,
	@TAX_COMM_ONLY SMALLINT,
	@TAX_RESALE SMALLINT,
	@EST_COMM_FLAG SMALLINT,
	@EST_TAX_FLAG SMALLINT,
	@EST_NONBILL_FLAG SMALLINT,
	@EXT_NONRESALE_TAX DECIMAL(14,2),
	@EXT_STATE_RESALE DECIMAL(14,2),
	@EXT_COUNTY_RESALE DECIMAL(14,2),
	@EXT_CITY_RESALE DECIMAL(14,2),
	@EXT_MU_CONT DECIMAL(14,2),
	@EXT_STATE_CONT DECIMAL(14,2),
	@EXT_COUNTY_CONT DECIMAL(14,2),
	@EXT_CITY_CONT DECIMAL(14,2),
	@EXT_NR_CONT DECIMAL(14,2),
	@LINE_TOTAL_CONT DECIMAL(14,2),
	@FEE_TIME SMALLINT
)
AS
BEGIN
	SET NOCOUNT OFF

	DECLARE @ERR INT		 

    UPDATE [ESTIMATE_REV_DET] SET
			[EST_REV_COMM_PCT] = @EST_REV_COMM_PCT,
			[EST_REV_CONT_PCT] = @EST_REV_CONT_PCT,
			[EST_REV_QUANTITY] = @EST_REV_QUANTITY,
			[EST_REV_RATE] = @EST_REV_RATE,
			[EST_REV_SUP_BY_CDE] = @EST_REV_SUP_BY_CDE,
			[EST_REV_SUP_BY_NTE] = @EST_REV_SUP_BY_NTE,
			[EST_REV_EXT_AMT] = @EST_REV_EXT_AMT ,
			[TAX_CODE] = @TAX_CODE,
			[EST_FNC_COMMENT] = @EST_FNC_COMMENT,
			[EXT_MARKUP_AMT] = @EXT_MARKUP_AMT,
			[EXT_CONTINGENCY] = @EXT_CONTINGENCY,
			[LINE_TOTAL] = @LINE_TOTAL,
			[INCL_CPU] = @INCL_CPU,
			[EST_FNC_TYPE] = @EST_FNC_TYPE,
			[EST_CPM_FLAG] = @EST_CPM_FLAG,
			[TAX_STATE_PCT] = @TAX_STATE_PCT,
			[TAX_COUNTY_PCT] = @TAX_COUNTY_PCT,
			[TAX_CITY_PCT] = @TAX_CITY_PCT,
			[TAX_COMM] = @TAX_COMM,
			[TAX_COMM_ONLY] = @TAX_COMM_ONLY,
			[TAX_RESALE] = @TAX_RESALE,
			[EST_COMM_FLAG] = @EST_COMM_FLAG,
			[EST_TAX_FLAG] = @EST_TAX_FLAG,
			[EST_NONBILL_FLAG] = @EST_NONBILL_FLAG,
			[EXT_NONRESALE_TAX] = @EXT_NONRESALE_TAX,
			[EXT_STATE_RESALE] = @EXT_STATE_RESALE,
			[EXT_COUNTY_RESALE] = @EXT_COUNTY_RESALE,
			[EXT_CITY_RESALE] = @EXT_CITY_RESALE,
			[EXT_MU_CONT] = @EXT_MU_CONT,
			[EXT_STATE_CONT] = @EXT_STATE_CONT,
			[EXT_COUNTY_CONT] = @EXT_COUNTY_CONT,
			[EXT_CITY_CONT] = @EXT_CITY_CONT,
			[EXT_NR_CONT] = @EXT_NR_CONT,
			[LINE_TOTAL_CONT] = @LINE_TOTAL_CONT,
			[FEE_TIME] = @FEE_TIME,
			[EST_FNC_COMMENT_HTML] = @EST_FNC_COMMENT --PJH 05/11/18 - added
		WHERE 	[ESTIMATE_NUMBER] = @ESTIMATE_NUMBER AND
			[EST_COMPONENT_NBR] = @EST_COMPONENT_NBR AND
			[EST_QUOTE_NBR] = @EST_QUOTE_NBR AND
			[EST_REV_NBR] = @EST_REV_NBR AND
			[SEQ_NBR] = @SEQ_NBR AND
			[FNC_CODE] = @FNC_CODE

	SET @ERR = @@Error

END

GO


