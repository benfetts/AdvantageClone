
CREATE PROCEDURE [dbo].[usp_wv_alert_GetList] 
	@EMP_CODE VARCHAR(6)
AS

    SELECT     
	    TOP 5 WV_MYALERTSLIST.*
    FROM         
	    WV_MYALERTSLIST
    WHERE 
	    WV_MYALERTSLIST.EMP_CODE = @EMP_CODE
	    AND WV_MYALERTSLIST.PROCESSED IS NULL
	    AND WV_MYALERTSLIST.NEW_ALERT IS NULL
	    AND WV_MYALERTSLIST.READ_ALERT IS NULL
    ORDER BY GENERATED DESC;

    UPDATE 
	    ALERT_RCPT WITH(ROWLOCK) 
    SET 
	    NEW_ALERT = 1 
    --SELECT * FROM ALERT_RCPT 
    WHERE 
	    EMP_CODE = @EMP_CODE
	    AND PROCESSED IS NULL
	    AND NEW_ALERT IS NULL
	    AND READ_ALERT IS NULL
	    --AND ALERT_ID NOT IN 
	    --(
		--    SELECT     
		--	    TOP 5 ALERT_ID
		--    FROM         
		--	    WV_MYALERTSLIST
		--    WHERE 
		--	    WV_MYALERTSLIST.EMP_CODE = @EMP_CODE
		--	    AND WV_MYALERTSLIST.PROCESSED IS NULL
		--	    AND WV_MYALERTSLIST.NEW_ALERT IS NULL
		--	    AND WV_MYALERTSLIST.READ_ALERT IS NULL
	    --)

