





CREATE PROCEDURE [dbo].[usp_wv_calendar_ddNewspaper]
@OrderNumber Int,
@LineNumber Int,
@RevNumber Int
AS

 --Newspaper Media Data   
	                                                  
SELECT 'N' AS TYPE, 'A' AS EST_ACT, NH.OFFICE_CODE, NH.ORDER_NBR, 
		NH.ORDER_DESC, NH.MEDIA_TYPE, NH.CL_CODE, 
		NH.DIV_CODE, NH.PRD_CODE, NH.CMP_IDENTIFIER, 
		NH.CMP_CODE, C.CMP_NAME, NH.VN_CODE, V.VN_NAME, NH.BUYER, NH.CLIENT_PO, 
		NH.MARKET_CODE, M.MARKET_DESC, NH.ORDER_ACCEPTED, ND.LINE_NBR, 
		ND.ACTIVE_REV,'' AS FLIGHT_DATES, ND.START_DATE, ND.END_DATE, 
		'' AS MEDIA_MONTH, '' AS MEDIA_YEAR,
		ND.CLOSE_DATE, ND.MATL_CLOSE_DATE, ND.EXT_CLOSE_DATE, 
		ND.EXT_MATL_DATE, ND.SIZE,
		ND.PRINT_COLUMNS, ND.PRINT_INCHES, ND.PRINT_LINES,
		ND.AD_NUMBER,	ND.HEADLINE,'' AS INTERNET_TYPE, '' AS OUTDOOR_TYPE,
		ND.MATERIAL, ND.EDITION_ISSUE, 
		ND.SECTION, '' AS START_TIME, '' AS END_TIME,'' AS LENGTH, '' AS TAG, '' AS PROGRAMMING,'' AS MATL_NOTES, '' AS REMARKS,
		ND.JOB_NUMBER, ND.JOB_COMPONENT_NBR, 
		ND.PRODUCTION_SIZE, ND.EST_NBR, ND.EST_LINE_NBR, 
		ND.EST_REV_NBR, ND.LINE_TOTAL,0 AS COST_PER, 0 AS IMPRESSIONS, ND.LINE_CANCELLED,
		CL.CL_NAME, D.DIV_NAME, P.PRD_DESCRIPTION, ND.BILLING_AMT, NH.LINK_ID,VR.VR_FNAME, VR.VR_LNAME, 
        VR.VR_MI, VR.VR_CODE, VR2.VR_FNAME AS VR_FNAME2, VR2.VR_LNAME AS VR_LNAME2, 
        VR2.VR_MI AS VR_MI2, VR2.VR_CODE AS VR_CODE2, JC.JOB_COMP_DESC, JL.JOB_DESC,  NH.ORDER_DATE, ND.REV_NBR, SC.SC_DESCRIPTION, ND.MAT_COMP, AD.AD_NBR_DESC, ND.SIZE_CODE, ND.COST_TYPE
	FROM NEWSPAPER_HEADER NH INNER JOIN NEWSPAPER_DETAIL ND ON NH.ORDER_NBR = ND.ORDER_NBR
						  INNER JOIN VENDOR V ON NH.VN_CODE = V.VN_CODE
						  INNER JOIN CLIENT AS CL ON NH.CL_CODE = CL.CL_CODE INNER JOIN
						  DIVISION AS D ON CL.CL_CODE = D.CL_CODE INNER JOIN
						  PRODUCT AS P ON NH.CL_CODE = P.CL_CODE AND NH.DIV_CODE = P.DIV_CODE AND 
						  NH.PRD_CODE = P.PRD_CODE AND D.CL_CODE = P.CL_CODE AND 
						  D.DIV_CODE = P.DIV_CODE LEFT OUTER JOIN 
						  JOB_LOG JL ON ND.JOB_NUMBER = JL.JOB_NUMBER LEFT OUTER JOIN
                          SALES_CLASS SC ON NH.MEDIA_TYPE = SC.SC_CODE LEFT OUTER JOIN
						  JOB_COMPONENT JC ON ND.JOB_NUMBER = JC.JOB_NUMBER AND 
						  ND.JOB_COMPONENT_NBR = JC.JOB_COMPONENT_NBR LEFT OUTER JOIN
						  VEN_REP VR ON NH.VN_CODE = VR.VN_CODE AND 
						  NH.VR_CODE = VR.VR_CODE LEFT OUTER JOIN
						  VEN_REP VR2 ON NH.VN_CODE = VR2.VN_CODE AND NH.VR_CODE2 = VR2.VR_CODE
						  LEFT OUTER JOIN CAMPAIGN C ON NH.CMP_IDENTIFIER = C.CMP_IDENTIFIER
						  LEFT OUTER JOIN MARKET M ON NH.MARKET_CODE = M.MARKET_CODE LEFT OUTER JOIN
                          AD_NUMBER AD ON ND.AD_NUMBER = AD.AD_NBR
	WHERE ACTIVE_REV = 1 AND NH.ORDER_NBR = @OrderNumber and ND.LINE_NBR = @LineNumber AND ND.REV_NBR = @RevNumber


