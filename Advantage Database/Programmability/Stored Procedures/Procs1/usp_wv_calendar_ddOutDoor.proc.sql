

if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[usp_wv_calendar_ddOutDoor]') and OBJECTPROPERTY(id, N'IsProcedure') = 1)
drop procedure [dbo].[usp_wv_calendar_ddOutDoor]
GO





CREATE PROCEDURE [dbo].[usp_wv_calendar_ddOutDoor]
@OrderNumber Int,
@LineNumber Int,
@RevNumber Int
AS

 --Outdoor Media Data   
	                                                  
SELECT 'O' AS TYPE, 'A' AS EST_ACT, OH.OFFICE_CODE, OH.ORDER_NBR, 
		OH.ORDER_DESC, OH.MEDIA_TYPE, OH.CL_CODE, OH.DIV_CODE, 
		OH.PRD_CODE, OH.CMP_IDENTIFIER, OH.CMP_CODE, C.CMP_NAME, OH.VN_CODE, V.VN_NAME, OH.BUYER,
		OH.CLIENT_PO, OH.MARKET_CODE, M.MARKET_DESC, OH.ORDER_ACCEPTED, 
		OD.LINE_NBR, OD.ACTIVE_REV,'' AS FLIGHT_DATES, OD.POST_DATE AS START_DATE,
		OD.END_DATE,'' AS MEDIA_MONTH, '' AS MEDIA_YEAR,
		OD.CLOSE_DATE, OD.MATL_CLOSE_DATE, OD.EXT_CLOSE_DATE, 
		OD.EXT_MATL_DATE, OD.SIZE,
		0 AS PRINT_COLUMNS, 0 AS PRINT_INCHES, 0 AS PRINT_LINES,	OD.AD_NUMBER,
		OD.HEADLINE, '' AS INTERNET_TYPE, OD.OUTDOOR_TYPE,'' AS MATERIAL,
		'' AS EDITION_ISSUE,'' AS SECTION, '' AS START_TIME, '' AS END_TIME,'' AS LENGTH, '' AS TAG, '' AS PROGRAMMING,
		'' AS MATL_NOTES, '' AS REMARKS, OD.JOB_NUMBER, 
		OD.JOB_COMPONENT_NBR,'' AS PRODUCTION_SIZE, OD.EST_NBR, OD.EST_LINE_NBR, 
		OD.EST_REV_NBR, OD.LINE_TOTAL, 0 AS COST_PER, 0 AS IMPRESSIONS, OD.LINE_CANCELLED, CL.CL_NAME, D.DIV_NAME, P.PRD_DESCRIPTION,
		OD.BILLING_AMT, OH.LINK_ID,VR.VR_FNAME, VR.VR_LNAME, 
        VR.VR_MI, VR.VR_CODE, VR2.VR_FNAME AS VR_FNAME2, VR2.VR_LNAME AS VR_LNAME2, 
        VR2.VR_MI AS VR_MI2, VR2.VR_CODE AS VR_CODE2, JC.JOB_COMP_DESC, JL.JOB_DESC,  OH.ORDER_DATE, OD.REV_NBR, OD.LOCATION, OD.COPY_AREA,
		OT.OD_DESC, OS.SIZE_DESC AS OD_SIZE, SC.SC_DESCRIPTION, OD.MAT_COMP, AD.AD_NBR_DESC
	FROM OUTDOOR_HEADER OH INNER JOIN OUTDOOR_DETAIL OD ON OH.ORDER_NBR = OD.ORDER_NBR
						INNER JOIN VENDOR V ON OH.VN_CODE = V.VN_CODE
						INNER JOIN CLIENT AS CL ON OH.CL_CODE = CL.CL_CODE INNER JOIN
						DIVISION AS D ON CL.CL_CODE = D.CL_CODE INNER JOIN
					    PRODUCT AS P ON OH.CL_CODE = P.CL_CODE AND OH.DIV_CODE = P.DIV_CODE AND 
						OH.PRD_CODE = P.PRD_CODE AND D.CL_CODE = P.CL_CODE AND 
						D.DIV_CODE = P.DIV_CODE LEFT OUTER JOIN 
						JOB_LOG JL ON OD.JOB_NUMBER = JL.JOB_NUMBER LEFT OUTER JOIN
						JOB_COMPONENT JC ON OD.JOB_NUMBER = JC.JOB_NUMBER AND 
					    OD.JOB_COMPONENT_NBR = JC.JOB_COMPONENT_NBR LEFT OUTER JOIN
                        SALES_CLASS SC ON OH.MEDIA_TYPE = SC.SC_CODE LEFT OUTER JOIN
						VEN_REP VR ON OH.VN_CODE = VR.VN_CODE AND 
						OH.VR_CODE = VR.VR_CODE LEFT OUTER JOIN
						VEN_REP VR2 ON OH.VN_CODE = VR2.VN_CODE AND OH.VR_CODE2 = VR2.VR_CODE
						LEFT OUTER JOIN CAMPAIGN C ON OH.CMP_IDENTIFIER = C.CMP_IDENTIFIER
						LEFT OUTER JOIN MARKET M ON OH.MARKET_CODE = M.MARKET_CODE LEFT OUTER JOIN
                        OUTDOOR_TYPE OT ON OD.OUTDOOR_TYPE = OT.OD_CODE LEFT OUTER JOIN
                        AD_SIZE OS ON OD.SIZE = OS.SIZE_CODE LEFT OUTER JOIN
                        AD_NUMBER AD ON OD.AD_NUMBER = AD.AD_NBR
	WHERE ACTIVE_REV = 1 AND OH.ORDER_NBR = @OrderNumber AND OD.LINE_NBR = @LineNumber AND OD.REV_NBR = @RevNumber


