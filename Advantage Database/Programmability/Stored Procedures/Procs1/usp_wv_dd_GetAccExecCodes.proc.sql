

if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[usp_wv_dd_GetAccExecCodes]') and OBJECTPROPERTY(id, N'IsProcedure') = 1)
drop procedure [dbo].[usp_wv_dd_GetAccExecCodes]
GO







/*****************************************************************
Gets All Account Executives for Drop Downs
******************************************************************/
CREATE PROCEDURE [dbo].[usp_wv_dd_GetAccExecCodes] 

@UserID VarChar(100) ,
@SHOW_ALL SMALLINT
AS
Declare @ClientRestrictions Int
DECLARE @OfficeRestrictions AS INTEGER	
DECLARE @EMP_CODE AS varchar(6)

SELECT @EMP_CODE = EMP_CODE FROM [dbo].[SEC_USER] WHERE UPPER([USER_CODE]) = UPPER(@UserID)
SELECT @OfficeRestrictions = COUNT(*) FROM EMP_OFFICE WHERE EMP_CODE = @EMP_CODE

Set NoCount on

Select @ClientRestrictions = Count(*) FROM SEC_CLIENT WHERE UPPER(USER_ID) = UPPER(@UserID)

IF @SHOW_ALL IS NULL
BEGIN
    SET @SHOW_ALL = 0;
END

if @OfficeRestrictions > 0
Begin
	if @ClientRestrictions > 0
	Begin
		IF @SHOW_ALL = 0
		BEGIN
				SELECT DISTINCT ACCOUNT_EXECUTIVE.EMP_CODE as Code, dbo.udf_get_empl_name(EMPLOYEE.EMP_CODE, 'FML') AS Description
				FROM      ACCOUNT_EXECUTIVE INNER JOIN
							  EMPLOYEE ON ACCOUNT_EXECUTIVE.EMP_CODE = EMPLOYEE.EMP_CODE
							INNER JOIN PRODUCT P ON ACCOUNT_EXECUTIVE.CL_CODE = P.CL_CODE AND ACCOUNT_EXECUTIVE.DIV_CODE = P.DIV_CODE AND ACCOUNT_EXECUTIVE.PRD_CODE = P.PRD_CODE
							INNER JOIN EMP_OFFICE EO ON P.OFFICE_CODE = EO.OFFICE_CODE AND EO.EMP_CODE = @EMP_CODE
							INNER JOIN SEC_CLIENT ON SEC_CLIENT.CL_CODE = ACCOUNT_EXECUTIVE.CL_CODE AND SEC_CLIENT.DIV_CODE = ACCOUNT_EXECUTIVE.DIV_CODE AND SEC_CLIENT.PRD_CODE = ACCOUNT_EXECUTIVE.PRD_CODE
				Where EMP_TERM_DATE is NULL AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@UserID) AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				Order By ACCOUNT_EXECUTIVE.EMP_CODE
		END

		IF @SHOW_ALL = 1
		BEGIN
   				SELECT DISTINCT ACCOUNT_EXECUTIVE.EMP_CODE as Code, dbo.udf_get_empl_name(EMPLOYEE.EMP_CODE, 'FML') AS Description
				FROM        ACCOUNT_EXECUTIVE INNER JOIN
							  EMPLOYEE ON ACCOUNT_EXECUTIVE.EMP_CODE = EMPLOYEE.EMP_CODE
							INNER JOIN PRODUCT P ON ACCOUNT_EXECUTIVE.CL_CODE = P.CL_CODE AND ACCOUNT_EXECUTIVE.DIV_CODE = P.DIV_CODE AND ACCOUNT_EXECUTIVE.PRD_CODE = P.PRD_CODE
							INNER JOIN EMP_OFFICE EO ON P.OFFICE_CODE = EO.OFFICE_CODE AND EO.EMP_CODE = @EMP_CODE
							INNER JOIN SEC_CLIENT ON SEC_CLIENT.CL_CODE = ACCOUNT_EXECUTIVE.CL_CODE AND SEC_CLIENT.DIV_CODE = ACCOUNT_EXECUTIVE.DIV_CODE AND SEC_CLIENT.PRD_CODE = ACCOUNT_EXECUTIVE.PRD_CODE
				WHERE UPPER(SEC_CLIENT.USER_ID) = UPPER(@UserID) AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				Order By ACCOUNT_EXECUTIVE.EMP_CODE
		END
	End
	Else
	Begin
		IF @SHOW_ALL = 0
		BEGIN
				SELECT DISTINCT ACCOUNT_EXECUTIVE.EMP_CODE as Code, dbo.udf_get_empl_name(EMPLOYEE.EMP_CODE, 'FML') AS Description
				FROM      ACCOUNT_EXECUTIVE INNER JOIN
							  EMPLOYEE ON ACCOUNT_EXECUTIVE.EMP_CODE = EMPLOYEE.EMP_CODE
							INNER JOIN PRODUCT P ON ACCOUNT_EXECUTIVE.CL_CODE = P.CL_CODE AND ACCOUNT_EXECUTIVE.DIV_CODE = P.DIV_CODE AND ACCOUNT_EXECUTIVE.PRD_CODE = P.PRD_CODE
							INNER JOIN EMP_OFFICE EO ON P.OFFICE_CODE = EO.OFFICE_CODE AND EO.EMP_CODE = @EMP_CODE
				Where EMP_TERM_DATE is NULL AND (INACTIVE_FLAG <> 1 OR INACTIVE_FLAG IS NULL OR INACTIVE_FLAG = 0)
				Order By ACCOUNT_EXECUTIVE.EMP_CODE
		END

		IF @SHOW_ALL = 1
		BEGIN
   				SELECT DISTINCT ACCOUNT_EXECUTIVE.EMP_CODE as Code, dbo.udf_get_empl_name(EMPLOYEE.EMP_CODE, 'FML') AS Description
				FROM        ACCOUNT_EXECUTIVE INNER JOIN
							  EMPLOYEE ON ACCOUNT_EXECUTIVE.EMP_CODE = EMPLOYEE.EMP_CODE
							INNER JOIN PRODUCT P ON ACCOUNT_EXECUTIVE.CL_CODE = P.CL_CODE AND ACCOUNT_EXECUTIVE.DIV_CODE = P.DIV_CODE AND ACCOUNT_EXECUTIVE.PRD_CODE = P.PRD_CODE
							INNER JOIN EMP_OFFICE EO ON P.OFFICE_CODE = EO.OFFICE_CODE AND EO.EMP_CODE = @EMP_CODE
				Order By ACCOUNT_EXECUTIVE.EMP_CODE
		END
	End
	
End
Else
Begin
	if @ClientRestrictions > 0
	Begin
		IF @SHOW_ALL = 0
		BEGIN
				SELECT DISTINCT ACCOUNT_EXECUTIVE.EMP_CODE as Code, dbo.udf_get_empl_name(EMPLOYEE.EMP_CODE, 'FML') AS Description
				FROM      ACCOUNT_EXECUTIVE INNER JOIN
							  EMPLOYEE ON ACCOUNT_EXECUTIVE.EMP_CODE = EMPLOYEE.EMP_CODE
							  INNER JOIN SEC_CLIENT ON SEC_CLIENT.CL_CODE = ACCOUNT_EXECUTIVE.CL_CODE AND SEC_CLIENT.DIV_CODE = ACCOUNT_EXECUTIVE.DIV_CODE AND SEC_CLIENT.PRD_CODE = ACCOUNT_EXECUTIVE.PRD_CODE
				Where EMP_TERM_DATE is NULL AND UPPER(SEC_CLIENT.USER_ID) = UPPER(@UserID) AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				Order By ACCOUNT_EXECUTIVE.EMP_CODE
		END

		IF @SHOW_ALL = 1
		BEGIN
   				SELECT DISTINCT ACCOUNT_EXECUTIVE.EMP_CODE as Code, dbo.udf_get_empl_name(EMPLOYEE.EMP_CODE, 'FML') AS Description
				FROM        ACCOUNT_EXECUTIVE INNER JOIN
							  EMPLOYEE ON ACCOUNT_EXECUTIVE.EMP_CODE = EMPLOYEE.EMP_CODE
							  INNER JOIN SEC_CLIENT ON SEC_CLIENT.CL_CODE = ACCOUNT_EXECUTIVE.CL_CODE AND SEC_CLIENT.DIV_CODE = ACCOUNT_EXECUTIVE.DIV_CODE AND SEC_CLIENT.PRD_CODE = ACCOUNT_EXECUTIVE.PRD_CODE
				WHERE UPPER(SEC_CLIENT.USER_ID) = UPPER(@UserID) AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				Order By ACCOUNT_EXECUTIVE.EMP_CODE
		END
	End
	Else
	Begin
		IF @SHOW_ALL = 0
		BEGIN
				SELECT DISTINCT ACCOUNT_EXECUTIVE.EMP_CODE as Code, dbo.udf_get_empl_name(EMPLOYEE.EMP_CODE, 'FML') AS Description
				FROM      ACCOUNT_EXECUTIVE INNER JOIN
							  EMPLOYEE ON ACCOUNT_EXECUTIVE.EMP_CODE = EMPLOYEE.EMP_CODE
				Where EMP_TERM_DATE is NULL
				Order By ACCOUNT_EXECUTIVE.EMP_CODE
		END

		IF @SHOW_ALL = 1
		BEGIN
   				SELECT DISTINCT ACCOUNT_EXECUTIVE.EMP_CODE as Code, dbo.udf_get_empl_name(EMPLOYEE.EMP_CODE, 'FML') AS Description
				FROM        ACCOUNT_EXECUTIVE INNER JOIN
							  EMPLOYEE ON ACCOUNT_EXECUTIVE.EMP_CODE = EMPLOYEE.EMP_CODE
				Order By ACCOUNT_EXECUTIVE.EMP_CODE
		END
	End
	
End






















