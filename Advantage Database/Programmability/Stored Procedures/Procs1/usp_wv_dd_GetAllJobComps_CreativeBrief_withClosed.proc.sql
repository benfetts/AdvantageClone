
















CREATE PROCEDURE [dbo].[usp_wv_dd_GetAllJobComps_CreativeBrief_withClosed] 
@UserID VarChar(100)
AS
Declare @Rescrictions Int

Set NoCount On

Select @Rescrictions = Count(*) 
FROM SEC_CLIENT
WHERE UPPER(USER_ID) = UPPER(@UserID)

If @Rescrictions > 0
	SELECT DISTINCT     ltrim(str(JOB_LOG.JOB_NUMBER)) + '-' +   ltrim(STR(JOB_COMPONENT.JOB_COMPONENT_NBR)) AS Code, 
		ltrim(str(JOB_LOG.JOB_NUMBER)) + '-' +   ltrim(STR(JOB_COMPONENT.JOB_COMPONENT_NBR)) 
		+ ' | ' + JOB_COMPONENT.JOB_COMP_DESC
	     + ' | ' + JOB_LOG.CL_CODE + ' - ' + JOB_LOG.DIV_CODE + ' - ' + JOB_LOG.PRD_CODE + '' AS Description, JOB_LOG.JOB_NUMBER, JOB_COMPONENT.JOB_COMPONENT_NBR
	FROM         JOB_LOG INNER JOIN
	                      JOB_COMPONENT ON JOB_LOG.JOB_NUMBER = JOB_COMPONENT.JOB_NUMBER INNER JOIN
						  CRTV_BRF_DTL ON JOB_COMPONENT.JOB_NUMBER = CRTV_BRF_DTL.JOB_NUMBER AND 
							  JOB_COMPONENT.JOB_COMPONENT_NBR = CRTV_BRF_DTL.JOB_COMPONENT_NBR INNER JOIN
	                      SEC_CLIENT ON JOB_LOG.CL_CODE = SEC_CLIENT.CL_CODE AND JOB_LOG.DIV_CODE = SEC_CLIENT.DIV_CODE AND 
	                      JOB_LOG.PRD_CODE = SEC_CLIENT.PRD_CODE
	WHERE   --  (JOB_COMPONENT.JOB_PROCESS_CONTRL NOT IN (6,12)) AND 
(UPPER(SEC_CLIENT.USER_ID) = UPPER(@UserID)) AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
	ORDER BY JOB_LOG.JOB_NUMBER DESC, JOB_COMPONENT.JOB_COMPONENT_NBR ASC
ELSE
	SELECT DISTINCT     ltrim(str(JOB_LOG.JOB_NUMBER)) + '-' +   ltrim(STR(JOB_COMPONENT.JOB_COMPONENT_NBR)) AS Code, 
		ltrim(str(JOB_LOG.JOB_NUMBER)) + '-' +   ltrim(STR(JOB_COMPONENT.JOB_COMPONENT_NBR)) 
		+ ' | ' + JOB_COMPONENT.JOB_COMP_DESC
	     + ' | ' + JOB_LOG.CL_CODE + ' - ' + JOB_LOG.DIV_CODE + ' - ' + JOB_LOG.PRD_CODE + '' AS Description, JOB_LOG.JOB_NUMBER, JOB_COMPONENT.JOB_COMPONENT_NBR
	FROM         JOB_LOG 
			 INNER JOIN
	                      JOB_COMPONENT ON JOB_LOG.JOB_NUMBER = JOB_COMPONENT.JOB_NUMBER INNER JOIN
						  CRTV_BRF_DTL ON JOB_COMPONENT.JOB_NUMBER = CRTV_BRF_DTL.JOB_NUMBER AND 
							  JOB_COMPONENT.JOB_COMPONENT_NBR = CRTV_BRF_DTL.JOB_COMPONENT_NBR 
	--WHERE     (JOB_COMPONENT.JOB_PROCESS_CONTRL NOT IN (6,12)) 
	ORDER BY JOB_LOG.JOB_NUMBER DESC, JOB_COMPONENT.JOB_COMPONENT_NBR ASC











