IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'[dbo].[usp_wv_dd_GetClients]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
    DROP PROCEDURE [dbo].[usp_wv_dd_GetClients]
GO
SET QUOTED_IDENTIFIER ON
GO
/*****************************************************************
Gets Clients for Drop Down s

	exec usp_wv_dd_GetClients 'ama','','',0,'ABC'
******************************************************************/
CREATE PROCEDURE [dbo].[usp_wv_dd_GetClients] 
			@UserID VarChar(100),
			@FromApp VarChar(6),
			@OfficeCode   VarChar(6) = null,
			@SprintID int = 0,
			@Text VARCHAR(100) = ''
AS
	Declare @Restrictions Int

	Set NoCount on

	DECLARE @EMP_CODE AS VARCHAR(6)
	DECLARE @OfficeCount AS INTEGER

	SELECT @EMP_CODE = EMP_CODE FROM SEC_USER WITH(NOLOCK) WHERE UPPER(USER_CODE) = UPPER(@UserID);

	SELECT @OfficeCount = COUNT(1) FROM EMP_OFFICE WITH(NOLOCK) WHERE EMP_CODE = @EMP_CODE;

	SELECT @Restrictions = COUNT(1) FROM SEC_CLIENT WITH(NOLOCK) WHERE UPPER(USER_ID) = UPPER(@UserID);

	IF @OfficeCode = ''
	BEGIN
		SET @OfficeCode = null;
	END

	IF @FromApp = 'ts'
	BEGIN
		IF @OfficeCount = 0
		BEGIN
			IF @Restrictions > 0
			BEGIN
				SELECT DISTINCT TOP 100
					[Code] = C.CL_CODE,
					[Description] = C.CL_CODE + ' - ' + ISNULL(C.CL_NAME, ''),
					[Name] = C.CL_NAME
				FROM         
					CLIENT C WITH(NOLOCK)
					INNER JOIN SEC_CLIENT SE WITH(NOLOCK) ON C.CL_CODE = SE.CL_CODE
				WHERE     
					C.ACTIVE_FLAG = 1
					AND UPPER(SE.[USER_ID]) = UPPER(@UserID)
					AND (UPPER(C.CL_CODE) LIKE '%' + UPPER(@Text) + '%' OR UPPER(C.CL_NAME) LIKE '%' + UPPER(@Text) + '%')
				ORDER BY  
					C.CL_NAME;
			END
			ELSE
			BEGIN
				SELECT DISTINCT TOP 100
					[Code] = C.CL_CODE,
					[Description] = C.CL_CODE + ' - ' + ISNULL(C.CL_NAME, ''),
					[Name] = C.CL_NAME
				FROM         
					CLIENT C WITH(NOLOCK)
				WHERE     
					C.ACTIVE_FLAG = 1
					AND (UPPER(C.CL_CODE) LIKE '%' + UPPER(@Text) + '%' OR UPPER(C.CL_NAME) LIKE '%' + UPPER(@Text) + '%')
				ORDER BY  
					C.CL_NAME;
			END
		END
		ELSE
		BEGIN
			IF @Restrictions > 0
			BEGIN
				SELECT DISTINCT TOP 100
					[Code] = C.CL_CODE,
					[Description] = C.CL_CODE + ' - ' + ISNULL(C.CL_NAME, ''),
					[Name] = C.CL_NAME
				FROM         
					CLIENT C WITH(NOLOCK)
					INNER JOIN SEC_CLIENT SE WITH(NOLOCK) ON C.CL_CODE = SE.CL_CODE
					INNER JOIN DIVISION	ON  C.CL_CODE = DIVISION.CL_CODE
					INNER JOIN PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE 					
					INNER JOIN EMP_OFFICE ON PRODUCT.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
				WHERE     
					C.ACTIVE_FLAG = 1
					AND UPPER(SE.[USER_ID]) = UPPER(@UserID)
					AND (UPPER(C.CL_CODE) LIKE '%' + UPPER(@Text) + '%' OR UPPER(C.CL_NAME) LIKE '%' + UPPER(@Text) + '%')
				ORDER BY  
					C.CL_NAME;
			END
			ELSE
			BEGIN
				SELECT DISTINCT TOP 100
					[Code] = C.CL_CODE,
					[Description] = C.CL_CODE + ' - ' + ISNULL(C.CL_NAME, ''),
					[Name] = C.CL_NAME
				FROM         
					CLIENT C WITH(NOLOCK)
					INNER JOIN DIVISION	ON  C.CL_CODE = DIVISION.CL_CODE
					INNER JOIN PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE 					
					INNER JOIN EMP_OFFICE ON PRODUCT.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
				WHERE     
					C.ACTIVE_FLAG = 1
					AND (UPPER(C.CL_CODE) LIKE '%' + UPPER(@Text) + '%' OR UPPER(C.CL_NAME) LIKE '%' + UPPER(@Text) + '%')
				ORDER BY  
					C.CL_NAME;
			END
		END
	END
	Else if @FromApp = 'util'
	Begin 
		IF @SprintID = 0
	BEGIN
		If @Restrictions > 0
		Begin
			If @OfficeCount = 0
			Begin
				SELECT DISTINCT TOP 100 CLIENT.CL_CODE AS Code, CLIENT.CL_CODE + ' - ' + isnull(CLIENT.CL_NAME, '') AS Description
						,CLIENT.CL_NAME as Name
				FROM         CLIENT INNER JOIN
								  SEC_CLIENT ON CLIENT.CL_CODE = SEC_CLIENT.CL_CODE
						   INNER JOIN DIVISION
								ON  CLIENT.CL_CODE = DIVISION.CL_CODE
						   INNER JOIN
								   PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE 
				WHERE     (CLIENT.ACTIVE_FLAG = 1) AND (UPPER(SEC_CLIENT.USER_ID) = UPPER(@UserID)) AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL) 
				 AND PRODUCT.OFFICE_CODE = ISNULL( @OfficeCode,PRODUCT.OFFICE_CODE)
				 AND LOWER(CLIENT.CL_NAME + ' (' + CLIENT.CL_CODE + ')') LIKE '%' + LOWER(@Text) + '%'
				ORDER BY  CLIENT.CL_NAME
			End
			Else
			Begin
				SELECT DISTINCT TOP 100 CLIENT.CL_CODE AS Code, CLIENT.CL_CODE + ' - ' + isnull(CLIENT.CL_NAME, '') AS Description
						,CLIENT.CL_NAME as Name
				FROM         CLIENT INNER JOIN
							  DIVISION ON CLIENT.CL_CODE = DIVISION.CL_CODE INNER JOIN
							   PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE INNER JOIN
								  SEC_CLIENT ON CLIENT.CL_CODE = SEC_CLIENT.CL_CODE INNER JOIN EMP_OFFICE ON PRODUCT.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
				WHERE     (CLIENT.ACTIVE_FLAG = 1) AND (UPPER(SEC_CLIENT.USER_ID) = UPPER(@UserID)) AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				 AND PRODUCT.OFFICE_CODE = ISNULL( @OfficeCode,PRODUCT.OFFICE_CODE)
				 AND LOWER(CLIENT.CL_NAME + ' (' + CLIENT.CL_CODE + ')') LIKE '%' + LOWER(@Text) + '%'
				ORDER BY  CLIENT.CL_NAME
			End		
		End
		ELSE
		Begin
			If @OfficeCount = 0
			Begin
				SELECT DISTINCT TOP 100 CLIENT.CL_CODE AS Code, CLIENT.CL_CODE + ' - ' + isnull(CL_NAME, '') AS Description
						,CLIENT.CL_NAME as Name
				FROM         CLIENT INNER JOIN
							  DIVISION ON CLIENT.CL_CODE = DIVISION.CL_CODE INNER JOIN
							   PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE
				WHERE     (CLIENT.ACTIVE_FLAG = 1)
				 AND PRODUCT.OFFICE_CODE = ISNULL( @OfficeCode,PRODUCT.OFFICE_CODE)
				 AND LOWER(CLIENT.CL_NAME + ' (' + CLIENT.CL_CODE + ')') LIKE '%' + LOWER(@Text) + '%'
				ORDER BY  CLIENT.CL_NAME
			End
			Else
			Begin
				SELECT DISTINCT TOP 100 CLIENT.CL_CODE AS Code, CLIENT.CL_CODE + ' - ' + isnull(CL_NAME, '') AS Description
						,CLIENT.CL_NAME as Name
				FROM         CLIENT INNER JOIN
							  DIVISION ON CLIENT.CL_CODE = DIVISION.CL_CODE INNER JOIN
							   PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE INNER JOIN 
							   EMP_OFFICE ON PRODUCT.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
				WHERE     (CLIENT.ACTIVE_FLAG = 1)
				 AND PRODUCT.OFFICE_CODE = ISNULL( @OfficeCode,PRODUCT.OFFICE_CODE)
				 AND LOWER(CLIENT.CL_NAME + ' (' + CLIENT.CL_CODE + ')') LIKE '%' + LOWER(@Text) + '%'
				ORDER BY  CLIENT.CL_NAME
			End
		
		End
	END
	ELSE
	BEGIN
		If @Restrictions > 0
		Begin
			If @OfficeCount = 0
			Begin
				SELECT DISTINCT TOP 100 CLIENT.CL_CODE AS Code, CLIENT.CL_CODE + ' - ' + isnull(CLIENT.CL_NAME, '') AS Description
						,CLIENT.CL_NAME as Name
				FROM SPRINT_HDR
					inner JOIN BOARD on BOARD.ID = SPRINT_HDR.BOARD_ID
					inner join BOARD_JOB on BOARD.ID = BOARD_JOB.BOARD_ID
					inner join JOB_LOG on JOB_LOG.JOB_NUMBER = BOARD_JOB.JOB_NUMBER
					inner join CLIENT ON JOB_LOG.CL_CODE = CLIENT.CL_CODE
					INNER JOIN  SEC_CLIENT ON CLIENT.CL_CODE = SEC_CLIENT.CL_CODE
					INNER JOIN DIVISION ON  CLIENT.CL_CODE = DIVISION.CL_CODE
					INNER JOIN PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE 
				WHERE     (CLIENT.ACTIVE_FLAG = 1) AND (UPPER(SEC_CLIENT.USER_ID) = UPPER(@UserID)) AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL) 
				 AND PRODUCT.OFFICE_CODE = ISNULL( @OfficeCode,PRODUCT.OFFICE_CODE)
				 AND SPRINT_HDR.ID = @SprintID
				 AND LOWER(CLIENT.CL_NAME + ' (' + CLIENT.CL_CODE + ')') LIKE '%' + LOWER(@Text) + '%'
				ORDER BY  CLIENT.CL_NAME
			End
			Else
			Begin
				SELECT DISTINCT TOP 100 CLIENT.CL_CODE AS Code, CLIENT.CL_CODE + ' - ' + isnull(CLIENT.CL_NAME, '') AS Description
						,CLIENT.CL_NAME as Name
				FROM    SPRINT_HDR
					inner JOIN BOARD on BOARD.ID = SPRINT_HDR.BOARD_ID
					inner join BOARD_JOB on BOARD.ID = BOARD_JOB.BOARD_ID
					inner join JOB_LOG on JOB_LOG.JOB_NUMBER = BOARD_JOB.JOB_NUMBER
					inner join CLIENT ON JOB_LOG.CL_CODE = CLIENT.CL_CODE
						INNER JOIN DIVISION ON CLIENT.CL_CODE = DIVISION.CL_CODE
						INNER JOIN PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE
						INNER JOIN SEC_CLIENT ON CLIENT.CL_CODE = SEC_CLIENT.CL_CODE 
						INNER JOIN EMP_OFFICE ON PRODUCT.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
				WHERE (CLIENT.ACTIVE_FLAG = 1) AND (UPPER(SEC_CLIENT.USER_ID) = UPPER(@UserID)) AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				 AND PRODUCT.OFFICE_CODE = ISNULL( @OfficeCode,PRODUCT.OFFICE_CODE)
				 AND SPRINT_HDR.ID = @SprintID
				 AND LOWER(CLIENT.CL_NAME + ' (' + CLIENT.CL_CODE + ')') LIKE '%' + LOWER(@Text) + '%'
				ORDER BY  CLIENT.CL_NAME
			End		
		End
		ELSE
		Begin
			If @OfficeCount = 0
			Begin
				SELECT DISTINCT TOP 100 CLIENT.CL_CODE AS Code, CLIENT.CL_CODE + ' - ' + isnull(CL_NAME, '') AS Description
						,CLIENT.CL_NAME as Name
				FROM  SPRINT_HDR
					inner JOIN BOARD on BOARD.ID = SPRINT_HDR.BOARD_ID
					inner join BOARD_JOB on BOARD.ID = BOARD_JOB.BOARD_ID
					inner join JOB_LOG on JOB_LOG.JOB_NUMBER = BOARD_JOB.JOB_NUMBER
					inner join CLIENT ON JOB_LOG.CL_CODE = CLIENT.CL_CODE
					INNER JOIN DIVISION ON CLIENT.CL_CODE = DIVISION.CL_CODE
					INNER JOIN PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE
				WHERE     (CLIENT.ACTIVE_FLAG = 1)
				 AND PRODUCT.OFFICE_CODE = ISNULL( @OfficeCode,PRODUCT.OFFICE_CODE)
				 AND SPRINT_HDR.ID = @SprintID
				 AND LOWER(CLIENT.CL_NAME + ' (' + CLIENT.CL_CODE + ')') LIKE '%' + LOWER(@Text) + '%'
				ORDER BY  CLIENT.CL_NAME
			End
			Else
			Begin
				SELECT DISTINCT TOP 100 CLIENT.CL_CODE AS Code, CLIENT.CL_CODE + ' - ' + isnull(CL_NAME, '') AS Description
						,CLIENT.CL_NAME as Name
				FROM  SPRINT_HDR
					inner JOIN BOARD on BOARD.ID = SPRINT_HDR.BOARD_ID
					inner join BOARD_JOB on BOARD.ID = BOARD_JOB.BOARD_ID
					inner join JOB_LOG on JOB_LOG.JOB_NUMBER = BOARD_JOB.JOB_NUMBER
					inner join CLIENT ON JOB_LOG.CL_CODE = CLIENT.CL_CODE
					INNER JOIN DIVISION ON CLIENT.CL_CODE = DIVISION.CL_CODE
					INNER JOIN PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE
					INNER JOIN EMP_OFFICE ON PRODUCT.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
				WHERE     (CLIENT.ACTIVE_FLAG = 1)
				 AND PRODUCT.OFFICE_CODE = ISNULL( @OfficeCode,PRODUCT.OFFICE_CODE)
				 AND SPRINT_HDR.ID = @SprintID
				 AND LOWER(CLIENT.CL_NAME + ' (' + CLIENT.CL_CODE + ')') LIKE '%' + LOWER(@Text) + '%'
				ORDER BY  CLIENT.CL_NAME
			End
		
		End
	END
	End
	Else
	Begin
		IF @SprintID = 0
	BEGIN
		If @Restrictions > 0
		Begin
			If @OfficeCount = 0
			Begin
				SELECT DISTINCT CLIENT.CL_CODE AS Code, CLIENT.CL_CODE + ' - ' + isnull(CLIENT.CL_NAME, '') AS Description
						,CLIENT.CL_NAME as Name
				FROM         CLIENT INNER JOIN
								  SEC_CLIENT ON CLIENT.CL_CODE = SEC_CLIENT.CL_CODE
						   INNER JOIN DIVISION
								ON  CLIENT.CL_CODE = DIVISION.CL_CODE
						   INNER JOIN
								   PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE 
				WHERE     (CLIENT.ACTIVE_FLAG = 1) AND (UPPER(SEC_CLIENT.USER_ID) = UPPER(@UserID)) AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL) 
				 AND PRODUCT.OFFICE_CODE = ISNULL( @OfficeCode,PRODUCT.OFFICE_CODE)
				 AND LOWER(CLIENT.CL_NAME + ' (' + CLIENT.CL_CODE + ')') LIKE '%' + LOWER(@Text) + '%'
				ORDER BY  CLIENT.CL_NAME
			End
			Else
			Begin
				SELECT DISTINCT CLIENT.CL_CODE AS Code, CLIENT.CL_CODE + ' - ' + isnull(CLIENT.CL_NAME, '') AS Description
						,CLIENT.CL_NAME as Name
				FROM         CLIENT INNER JOIN
							  DIVISION ON CLIENT.CL_CODE = DIVISION.CL_CODE INNER JOIN
							   PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE INNER JOIN
								  SEC_CLIENT ON CLIENT.CL_CODE = SEC_CLIENT.CL_CODE INNER JOIN EMP_OFFICE ON PRODUCT.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
				WHERE     (CLIENT.ACTIVE_FLAG = 1) AND (UPPER(SEC_CLIENT.USER_ID) = UPPER(@UserID)) AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				 AND PRODUCT.OFFICE_CODE = ISNULL( @OfficeCode,PRODUCT.OFFICE_CODE)
				 AND LOWER(CLIENT.CL_NAME + ' (' + CLIENT.CL_CODE + ')') LIKE '%' + LOWER(@Text) + '%'
				ORDER BY  CLIENT.CL_NAME
			End		
		End
		ELSE
		Begin
			If @OfficeCount = 0
			Begin
				SELECT DISTINCT CLIENT.CL_CODE AS Code, CLIENT.CL_CODE + ' - ' + isnull(CL_NAME, '') AS Description
						,CLIENT.CL_NAME as Name
				FROM         CLIENT INNER JOIN
							  DIVISION ON CLIENT.CL_CODE = DIVISION.CL_CODE INNER JOIN
							   PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE
				WHERE     (CLIENT.ACTIVE_FLAG = 1)
				 AND PRODUCT.OFFICE_CODE = ISNULL( @OfficeCode,PRODUCT.OFFICE_CODE)
				 AND LOWER(CLIENT.CL_NAME + ' (' + CLIENT.CL_CODE + ')') LIKE '%' + LOWER(@Text) + '%'
				ORDER BY  CLIENT.CL_NAME
			End
			Else
			Begin
				SELECT DISTINCT CLIENT.CL_CODE AS Code, CLIENT.CL_CODE + ' - ' + isnull(CL_NAME, '') AS Description
						,CLIENT.CL_NAME as Name
				FROM         CLIENT INNER JOIN
							  DIVISION ON CLIENT.CL_CODE = DIVISION.CL_CODE INNER JOIN
							   PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE INNER JOIN 
							   EMP_OFFICE ON PRODUCT.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
				WHERE     (CLIENT.ACTIVE_FLAG = 1)
				 AND PRODUCT.OFFICE_CODE = ISNULL( @OfficeCode,PRODUCT.OFFICE_CODE)
				 AND LOWER(CLIENT.CL_NAME + ' (' + CLIENT.CL_CODE + ')') LIKE '%' + LOWER(@Text) + '%'
				ORDER BY  CLIENT.CL_NAME
			End
		
		End
	END
	ELSE
	BEGIN
		If @Restrictions > 0
		Begin
			If @OfficeCount = 0
			Begin
				SELECT DISTINCT CLIENT.CL_CODE AS Code, CLIENT.CL_CODE + ' - ' + isnull(CLIENT.CL_NAME, '') AS Description
						,CLIENT.CL_NAME as Name
				FROM SPRINT_HDR
					inner JOIN BOARD on BOARD.ID = SPRINT_HDR.BOARD_ID
					inner join BOARD_JOB on BOARD.ID = BOARD_JOB.BOARD_ID
					inner join JOB_LOG on JOB_LOG.JOB_NUMBER = BOARD_JOB.JOB_NUMBER
					inner join CLIENT ON JOB_LOG.CL_CODE = CLIENT.CL_CODE
					INNER JOIN  SEC_CLIENT ON CLIENT.CL_CODE = SEC_CLIENT.CL_CODE
					INNER JOIN DIVISION ON  CLIENT.CL_CODE = DIVISION.CL_CODE
					INNER JOIN PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE 
				WHERE     (CLIENT.ACTIVE_FLAG = 1) AND (UPPER(SEC_CLIENT.USER_ID) = UPPER(@UserID)) AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL) 
				 AND PRODUCT.OFFICE_CODE = ISNULL( @OfficeCode,PRODUCT.OFFICE_CODE)
				 AND SPRINT_HDR.ID = @SprintID
				 AND LOWER(CLIENT.CL_NAME + ' (' + CLIENT.CL_CODE + ')') LIKE '%' + LOWER(@Text) + '%'
				ORDER BY  CLIENT.CL_NAME
			End
			Else
			Begin
				SELECT DISTINCT CLIENT.CL_CODE AS Code, CLIENT.CL_CODE + ' - ' + isnull(CLIENT.CL_NAME, '') AS Description
						,CLIENT.CL_NAME as Name
				FROM    SPRINT_HDR
					inner JOIN BOARD on BOARD.ID = SPRINT_HDR.BOARD_ID
					inner join BOARD_JOB on BOARD.ID = BOARD_JOB.BOARD_ID
					inner join JOB_LOG on JOB_LOG.JOB_NUMBER = BOARD_JOB.JOB_NUMBER
					inner join CLIENT ON JOB_LOG.CL_CODE = CLIENT.CL_CODE
						INNER JOIN DIVISION ON CLIENT.CL_CODE = DIVISION.CL_CODE
						INNER JOIN PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE
						INNER JOIN SEC_CLIENT ON CLIENT.CL_CODE = SEC_CLIENT.CL_CODE 
						INNER JOIN EMP_OFFICE ON PRODUCT.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
				WHERE (CLIENT.ACTIVE_FLAG = 1) AND (UPPER(SEC_CLIENT.USER_ID) = UPPER(@UserID)) AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
				 AND PRODUCT.OFFICE_CODE = ISNULL( @OfficeCode,PRODUCT.OFFICE_CODE)
				 AND SPRINT_HDR.ID = @SprintID
				 AND LOWER(CLIENT.CL_NAME + ' (' + CLIENT.CL_CODE + ')') LIKE '%' + LOWER(@Text) + '%'
				ORDER BY  CLIENT.CL_NAME
			End		
		End
		ELSE
		Begin
			If @OfficeCount = 0
			Begin
				SELECT DISTINCT CLIENT.CL_CODE AS Code, CLIENT.CL_CODE + ' - ' + isnull(CL_NAME, '') AS Description
						,CLIENT.CL_NAME as Name
				FROM  SPRINT_HDR
					inner JOIN BOARD on BOARD.ID = SPRINT_HDR.BOARD_ID
					inner join BOARD_JOB on BOARD.ID = BOARD_JOB.BOARD_ID
					inner join JOB_LOG on JOB_LOG.JOB_NUMBER = BOARD_JOB.JOB_NUMBER
					inner join CLIENT ON JOB_LOG.CL_CODE = CLIENT.CL_CODE
					INNER JOIN DIVISION ON CLIENT.CL_CODE = DIVISION.CL_CODE
					INNER JOIN PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE
				WHERE     (CLIENT.ACTIVE_FLAG = 1)
				 AND PRODUCT.OFFICE_CODE = ISNULL( @OfficeCode,PRODUCT.OFFICE_CODE)
				 AND SPRINT_HDR.ID = @SprintID
				 AND LOWER(CLIENT.CL_NAME + ' (' + CLIENT.CL_CODE + ')') LIKE '%' + LOWER(@Text) + '%'
				ORDER BY  CLIENT.CL_NAME
			End
			Else
			Begin
				SELECT DISTINCT CLIENT.CL_CODE AS Code, CLIENT.CL_CODE + ' - ' + isnull(CL_NAME, '') AS Description
						,CLIENT.CL_NAME as Name
				FROM  SPRINT_HDR
					inner JOIN BOARD on BOARD.ID = SPRINT_HDR.BOARD_ID
					inner join BOARD_JOB on BOARD.ID = BOARD_JOB.BOARD_ID
					inner join JOB_LOG on JOB_LOG.JOB_NUMBER = BOARD_JOB.JOB_NUMBER
					inner join CLIENT ON JOB_LOG.CL_CODE = CLIENT.CL_CODE
					INNER JOIN DIVISION ON CLIENT.CL_CODE = DIVISION.CL_CODE
					INNER JOIN PRODUCT ON DIVISION.CL_CODE = PRODUCT.CL_CODE AND DIVISION.DIV_CODE = PRODUCT.DIV_CODE
					INNER JOIN EMP_OFFICE ON PRODUCT.OFFICE_CODE = EMP_OFFICE.OFFICE_CODE AND EMP_OFFICE.EMP_CODE = @EMP_CODE
				WHERE     (CLIENT.ACTIVE_FLAG = 1)
				 AND PRODUCT.OFFICE_CODE = ISNULL( @OfficeCode,PRODUCT.OFFICE_CODE)
				 AND SPRINT_HDR.ID = @SprintID
				 AND LOWER(CLIENT.CL_NAME + ' (' + CLIENT.CL_CODE + ')') LIKE '%' + LOWER(@Text) + '%'
				ORDER BY  CLIENT.CL_NAME
			End
		
		End
	END
	End



GO


