SET QUOTED_IDENTIFIER ON 
GO
SET ANSI_NULLS OFF 
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'[dbo].[usp_wv_DeleteClientPortalImage]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
DROP PROCEDURE [dbo].[usp_wv_DeleteClientPortalImage]
GO
CREATE PROCEDURE [dbo].[usp_wv_DeleteClientPortalImage] /*WITH ENCRYPTION*/
@CL_CODE VARCHAR(6),
@IMAGE_TYPE TINYINT -- 0 = LOGO, 1 = WALLPAPER, SOLID COLOR = 2, CUSTOM = 3, ICON = 4
AS
/*=========== QUERY ===========*/
DECLARE @FILENAME VARCHAR(500)

IF @IMAGE_TYPE = 0
BEGIN
	
	UPDATE CP_BINARY_IMAGES WITH(ROWLOCK) SET BINARY_IMAGE_LOGO = NULL WHERE BINARY_IMAGE_CLIENT = @CL_CODE;
	SELECT @FILENAME = CP_THEME_SETTINGS.WV_BRND_LOGO FROM CP_THEME_SETTINGS WITH(NOLOCK) WHERE CP_THEME_SETTINGS.CL_CODE = @CL_CODE;
	UPDATE CP_THEME_SETTINGS WITH(ROWLOCK) SET WV_BRND_LOGO = NULL WHERE CL_CODE = @CL_CODE;
		
END
IF @IMAGE_TYPE = 2
BEGIN

	UPDATE CP_THEME_SETTINGS SET WV_BRND_BGCLR = NULL WHERE CL_CODE = @CL_CODE;

END
IF @IMAGE_TYPE = 1 OR @IMAGE_TYPE = 3
BEGIN

	UPDATE CP_BINARY_IMAGES WITH(ROWLOCK) SET BINARY_IMAGE_WP = NULL WHERE BINARY_IMAGE_CLIENT = @CL_CODE;
	SELECT @FILENAME = CP_THEME_SETTINGS.WV_BRND_BG FROM CP_THEME_SETTINGS WITH(NOLOCK) WHERE CP_THEME_SETTINGS.CL_CODE = @CL_CODE;
	UPDATE CP_THEME_SETTINGS WITH(ROWLOCK) SET WV_BRND_BG = NULL WHERE CL_CODE = @CL_CODE;
	
END
IF @IMAGE_TYPE = 4
BEGIN

	UPDATE CP_BINARY_IMAGES WITH(ROWLOCK) SET BINARY_IMAGE_ICON = NULL WHERE BINARY_IMAGE_CLIENT = @CL_CODE;
	SELECT @FILENAME = CP_THEME_SETTINGS.WV_BRND_ICON FROM CP_THEME_SETTINGS WITH(NOLOCK) WHERE CP_THEME_SETTINGS.CL_CODE = @CL_CODE;
	UPDATE CP_THEME_SETTINGS WITH(ROWLOCK) SET WV_BRND_ICON = NULL WHERE CL_CODE = @CL_CODE;
	
END

SELECT ISNULL(@FILENAME, '') AS [FILENAME];

/*=========== QUERY ===========*/
GO
SET QUOTED_IDENTIFIER ON 
GO
SET ANSI_NULLS ON 
GO