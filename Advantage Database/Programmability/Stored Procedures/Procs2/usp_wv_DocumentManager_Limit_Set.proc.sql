
CREATE PROCEDURE [dbo].[usp_wv_DocumentManager_Limit_Set] 
@TYPE AS SMALLINT,
@LIMIT AS VARCHAR(8000)
AS


DECLARE 
	@KEY_CODE VARCHAR(20),
	@KEY_DESC VARCHAR (100)

IF @TYPE = 0 --REPOSITORY 
BEGIN
	SET @KEY_CODE = 'REPOSITORY_LIMIT';
	SET @KEY_DESC = 'Max repository in bytes';
END	
IF @TYPE = 1 --FILE SIZE
BEGIN
	SET @KEY_CODE = 'FILE_UPLOAD_LIMIT';
	SET @KEY_DESC = 'Max file size for uploads in bytes';
END
--IF CAST(@LIMIT AS INT) < 0 
--BEGIN
--    SET @LIMIT = - 1;
--END

IF NOT EXISTS(
       SELECT *
       FROM   AGY_SETTINGS WITH(NOLOCK)
       WHERE  AGY_SETTINGS_CODE = @KEY_CODE
   )
	BEGIN
		INSERT INTO AGY_SETTINGS WITH
		  (
			ROWLOCK
		  )(
			   AGY_SETTINGS_CODE,
			   AGY_SETTINGS_DESC,
			   AGY_SETTINGS_VALUE,
			   AGY_SETTINGS_DEF,
			   AGY_SETTINGS_MIN,
			   AGY_SETTINGS_MAX,
			   AGY_SETTINGS_APP,
			   AGY_SETTINGS_TAB,
			   AGY_SETTINGS_GRP,
			   AGY_SETTINGS_ORDER,
			   DTYPE_ID
		   )
		VALUES
		  (
			@KEY_CODE,
			@KEY_DESC,
			@LIMIT,
			0,
			0,
			0,
			NULL,
			NULL,
			NULL,
			NULL,
			11
		  );
	END
ELSE
	BEGIN
		UPDATE AGY_SETTINGS WITH(ROWLOCK)
		SET    AGY_SETTINGS_VALUE = @LIMIT
		WHERE  AGY_SETTINGS_CODE = @KEY_CODE;
	END





