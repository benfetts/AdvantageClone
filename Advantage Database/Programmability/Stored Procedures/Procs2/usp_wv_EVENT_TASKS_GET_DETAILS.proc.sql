
CREATE PROCEDURE [dbo].[usp_wv_EVENT_TASKS_GET_DETAILS] 
	@JOB_NUMBER INT,
	@JOB_COMPONENT_NBR SMALLINT

AS

	SELECT EVENT.EVENT_ID,
		   EVENT.EVENT_LABEL,
		   EVENT.EVENT_DESC_LONG,
		   EVENT_TASK.EVENT_TASK_ID,
		   EVENT_TASK.TASK_CODE,
		   TRAFFIC_FNC.TRF_DESC,
		   EVENT_TASK.EMP_CODE,
		   ISNULL(EMPLOYEE.EMP_FNAME+' ','')+ISNULL(EMPLOYEE.EMP_MI+'. ','')+ISNULL(EMPLOYEE.EMP_LNAME,'') AS EMP_FML,
		   EVENT_TASK.START_DATE,
		   EVENT_TASK.END_DATE,
		   EVENT_TASK.START_TIME,
		   EVENT_TASK.END_TIME,
		   EVENT_TASK.TEMP_COMP_DATE,
		   EVENT_TASK.HOURS_ALLOWED,
		   EVENT_TASK.COMMENTS,
		   EVENT_TASK.COMPLETED_COMMENTS,
		   EVENT.JOB_NUMBER,
		   EVENT.JOB_COMPONENT_NBR
	FROM   EVENT_TASK WITH(NOLOCK)
		   INNER JOIN EVENT WITH(NOLOCK)
				ON  EVENT_TASK.EVENT_ID = EVENT.EVENT_ID
		   INNER JOIN TRAFFIC_FNC WITH(NOLOCK)
				ON  EVENT_TASK.TASK_CODE = TRAFFIC_FNC.TRF_CODE
		   LEFT OUTER JOIN EMPLOYEE WITH(NOLOCK)
				ON  EVENT_TASK.EMP_CODE = EMPLOYEE.EMP_CODE
	WHERE  (EVENT.JOB_NUMBER = @JOB_NUMBER)
		   AND (EVENT.JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR)
	ORDER BY
		   EVENT_TASK.START_TIME,
		   EVENT_TASK.END_TIME;
		   
