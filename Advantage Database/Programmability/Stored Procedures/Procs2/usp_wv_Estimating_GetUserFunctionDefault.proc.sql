
CREATE PROCEDURE [dbo].[usp_wv_Estimating_GetUserFunctionDefault] 
	@FNC_CODE AS VARCHAR(6),
	@JOB_NUMBER AS INT,
	@JOB_COMPONENT_NBR AS SMALLINT,
	@CL_CODE AS VARCHAR(6),
	@DIV_CODE AS VARCHAR(6),
	@PRD_CODE AS VARCHAR(6),
	@SC_CODE AS VARCHAR(6),
	@EMP_CODE AS VARCHAR(6),
	@EMP_TITLE_ID AS INTEGER


AS

DECLARE
	@ROW_BILLING_RATE AS DECIMAL(9,2),
	@ROW_RATE_LEVEL AS SMALLINT,
	@ROW_TAX_CODE AS VARCHAR(4),
	@ROW_TAX_LEVEL SMALLINT,
	@ROW_NOBILL_FLAG SMALLINT,
	@ROW_NOBILL_LEVEL SMALLINT,
	@ROW_COMM DECIMAL(9,3),
	@ROW_COMM_LEVEL SMALLINT,
	@ROW_TAX_COMM SMALLINT,
	@ROW_TAX_COMM_ONLY SMALLINT,
	@ROW_TAX_COMM_FLAGS_LEVEL SMALLINT,
	@ROW_FEE_TIME_FLAG SMALLINT,
	@ROW_FEE_TIME_LEVEL SMALLINT,
	@ROW_STATE_PERCENT DECIMAL(8,4),
	@ROW_COUNTY_PERCENT DECIMAL(8,4),
	@ROW_CITY_PERCENT DECIMAL(8,4),
	@ROW_TAX_RESALE SMALLINT,
	@ROW_TAX_RESALE_NUMBER VARCHAR(20),
	@ROW_FNC_DESCRIPTION VARCHAR(30),
    @ROW_FNC_TYPE VARCHAR(1)
	



EXECUTE dbo.usp_wv_Estimating_GetBillingRates
				@THIS_FNC_CODE = @FNC_CODE,
				@THIS_JOB_NUMBER = @JOB_NUMBER,
				@THIS_JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR,
				@THIS_CL_CODE = @CL_CODE,
				@THIS_DIV_CODE = @DIV_CODE,
				@THIS_PRD_CODE = @PRD_CODE,
				@THIS_SC_CODE = @SC_CODE,
				@THIS_EMP_CODE = @EMP_CODE,
				@THIS_EMP_TITLE_ID = @EMP_TITLE_ID,
				@THIS_BILLING_RATE = @ROW_BILLING_RATE OUTPUT,
				@THIS_RATE_LEVEL = @ROW_RATE_LEVEL OUTPUT,
				@THIS_TAX_CODE = @ROW_TAX_CODE OUTPUT,
				@THIS_TAX_LEVEL = @ROW_TAX_LEVEL OUTPUT,
				@THIS_NOBILL_FLAG = @ROW_NOBILL_FLAG OUTPUT,
				@THIS_NOBILL_LEVEL = @ROW_NOBILL_LEVEL OUTPUT,
				@THIS_COMM = @ROW_COMM OUTPUT,
				@THIS_COMM_LEVEL = @ROW_COMM_LEVEL OUTPUT,
				@THIS_TAX_COMM = @ROW_TAX_COMM OUTPUT,
				@THIS_TAX_COMM_ONLY = @ROW_TAX_COMM_ONLY OUTPUT,
				@THIS_TAX_COMM_FLAGS_LEVEL = @ROW_TAX_COMM_FLAGS_LEVEL OUTPUT,
				@THIS_FEE_TIME_FLAG = @ROW_FEE_TIME_FLAG OUTPUT,
				@THIS_FEE_TIME_LEVEL = @ROW_FEE_TIME_LEVEL OUTPUT;
				
				
IF (NOT (@ROW_TAX_CODE IS NULL))			
BEGIN
	SELECT
		@ROW_STATE_PERCENT = TAX_STATE_PERCENT,
		@ROW_COUNTY_PERCENT = TAX_COUNTY_PERCENT,
		@ROW_CITY_PERCENT = TAX_CITY_PERCENT,
		@ROW_TAX_RESALE = TAX_RESALE,
		@ROW_TAX_RESALE_NUMBER = TAX_RESALE_NUMBER
	FROM
		SALES_TAX WITH(NOLOCK)
	WHERE
		TAX_CODE = @ROW_TAX_CODE;	
			

	
END	

IF (NOT (@FNC_CODE IS NULL))			
BEGIN
	SELECT
		@ROW_FNC_DESCRIPTION = FNC_DESCRIPTION,
		@ROW_FNC_TYPE = FNC_TYPE
	FROM
		FUNCTIONS WITH(NOLOCK)
	WHERE
		FNC_CODE = @FNC_CODE;	
			

	
END				
				
SELECT 
	@ROW_BILLING_RATE AS BILLING_RATE,
	@ROW_RATE_LEVEL AS RATE_LEVEL,
	@ROW_TAX_CODE AS TAX_CODE,
	@ROW_TAX_LEVEL AS TAX_LEVEL,
	@ROW_NOBILL_FLAG AS NOBILL_FLAG,
	@ROW_NOBILL_LEVEL AS NOBILL_LEVEL,
	@ROW_COMM AS COMM,
	@ROW_COMM_LEVEL AS COMM_LEVEL,
	@ROW_TAX_COMM AS TAX_COMM,
	@ROW_TAX_COMM_ONLY AS TAX_COMM_ONLY,
	@ROW_TAX_COMM_FLAGS_LEVEL AS TAX_COMM_FLAGS_LEVEL,
	@ROW_FEE_TIME_FLAG AS FEE_TIME_FLAG,
	@ROW_FEE_TIME_LEVEL AS FEE_TIME_LEVEL,
	ISNULL(@ROW_STATE_PERCENT,0.00) AS TAX_STATE_PERCENT,
	ISNULL(@ROW_COUNTY_PERCENT,0.00) AS TAX_COUNTY_PERCENT,
	ISNULL(@ROW_CITY_PERCENT,0.00) AS TAX_CITY_PERCENT,
	@ROW_TAX_RESALE AS TAX_RESALE,
	@ROW_TAX_RESALE_NUMBER AS TAX_RESALE_NUMBER,
	@ROW_FNC_DESCRIPTION AS FNC_DESCRIPTION,
	@ROW_FNC_TYPE AS FNC_TYPE;
