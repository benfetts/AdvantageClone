if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[usp_wv_Estimating_Quote_Info]') and OBJECTPROPERTY(id, N'IsProcedure') = 1)
drop procedure [dbo].[usp_wv_Estimating_Quote_Info]
GO



CREATE PROCEDURE [dbo].[usp_wv_Estimating_Quote_Info] 
@EstNo Int,
@EstCompNo Int,
@QuoteNo Int,
@RevNo Int
AS
SELECT     ESTIMATE_QUOTE.ESTIMATE_NUMBER, ESTIMATE_LOG.EST_LOG_DESC, ESTIMATE_QUOTE.EST_COMPONENT_NBR, 
                      ESTIMATE_COMPONENT.EST_COMP_DESC, ESTIMATE_QUOTE.EST_QUOTE_NBR, ISNULL(ESTIMATE_QUOTE.EST_QUOTE_DESC,'') AS EST_QUOTE_DESC, 
                      ESTIMATE_REV.EST_REV_NBR, ISNULL(ESTIMATE_REV.SPEC_VER,0) AS SPEC_VER, ISNULL(ESTIMATE_REV.SPEC_REV,0) AS SPEC_REV, ISNULL(ESTIMATE_REV.SPEC_QTY_SEQ_NBR,-1) AS SPEC_QTY_SEQ_NBR, 
                      ISNULL(ESTIMATE_REV.JOB_QTY,0) AS JOB_QTY, ISNULL(JOB_COMPONENT.JOB_NUMBER,0) AS JOB_NUMBER, ISNULL(JOB_COMPONENT.JOB_COMPONENT_NBR,0) AS JOB_COMPONENT_NBR, ISNULL(ESTIMATE_QUOTE.EST_QTE_COMMENT,'') AS EST_QTE_COMMENT,
					  ISNULL(ESTIMATE_REV.EST_REV_COMMENT,'') AS EST_REV_COMMENT, ESTIMATE_LOG.CL_CODE, CLIENT.CL_NAME, ESTIMATE_LOG.DIV_CODE, 
                      DIVISION.DIV_NAME, ESTIMATE_LOG.PRD_CODE, PRODUCT.PRD_DESCRIPTION, ISNULL(ESTIMATE_COMPONENT.FNC_SORT_ORDER, 0) AS FNC_SORT_ORDER, ESTIMATE_LOG.SC_CODE,
                      JOB_COMPONENT.JOB_COMP_DESC, JOB_LOG.JOB_DESC, ISNULL(JOB_COMPONENT.JOB_COMP_BUDGET_AM,0) AS JOB_COMP_BUDGET_AM, ISNULL(PRODUCT.PRD_CONT_PCT,0) AS PRD_CONT_PCT, 
                      ISNULL(ESTIMATE_LOG.EST_MARKUP_PCT,0.0) AS EST_MARKUP_PCT, ISNULL(JOB_COMPONENT.JOB_MARKUP_PCT,0.0) AS JOB_MARKUP_PCT, BLENDED_TIME_RATE, ISNULL(SPEC_VER_DESC,'') AS SPEC_VER_DESC,
					  ISNULL(ESTIMATE_QUOTE.EST_QTE_COMMENT_HTML,'') AS EST_QTE_COMMENT_HTML, ISNULL(ESTIMATE_REV.EST_REV_COMMENT_HTML,'') AS EST_REV_COMMENT_HTML,
					  ISNULL(ESTIMATE_LOG.CMP_IDENTIFIER,0) AS CMP_IDENTIFIER
FROM         ESTIMATE_QUOTE WITH(NOLOCK) INNER JOIN
                      ESTIMATE_REV WITH(NOLOCK) ON ESTIMATE_QUOTE.ESTIMATE_NUMBER = ESTIMATE_REV.ESTIMATE_NUMBER AND 
                      ESTIMATE_QUOTE.EST_COMPONENT_NBR = ESTIMATE_REV.EST_COMPONENT_NBR AND 
                      ESTIMATE_QUOTE.EST_QUOTE_NBR = ESTIMATE_REV.EST_QUOTE_NBR INNER JOIN
                      ESTIMATE_COMPONENT WITH(NOLOCK) ON ESTIMATE_QUOTE.ESTIMATE_NUMBER = ESTIMATE_COMPONENT.ESTIMATE_NUMBER AND 
                      ESTIMATE_QUOTE.EST_COMPONENT_NBR = ESTIMATE_COMPONENT.EST_COMPONENT_NBR INNER JOIN
                      ESTIMATE_LOG WITH(NOLOCK) ON ESTIMATE_COMPONENT.ESTIMATE_NUMBER = ESTIMATE_LOG.ESTIMATE_NUMBER LEFT OUTER JOIN
                      JOB_COMPONENT WITH(NOLOCK) ON ESTIMATE_COMPONENT.ESTIMATE_NUMBER = JOB_COMPONENT.ESTIMATE_NUMBER AND 
                      ESTIMATE_COMPONENT.EST_COMPONENT_NBR = JOB_COMPONENT.EST_COMPONENT_NBR INNER JOIN
                      PRODUCT WITH(NOLOCK) ON ESTIMATE_LOG.CL_CODE = PRODUCT.CL_CODE AND ESTIMATE_LOG.DIV_CODE = PRODUCT.DIV_CODE AND 
                      ESTIMATE_LOG.PRD_CODE = PRODUCT.PRD_CODE INNER JOIN
                      DIVISION WITH(NOLOCK) ON PRODUCT.CL_CODE = DIVISION.CL_CODE AND PRODUCT.DIV_CODE = DIVISION.DIV_CODE INNER JOIN
                      CLIENT WITH(NOLOCK) ON DIVISION.CL_CODE = CLIENT.CL_CODE LEFT OUTER JOIN
                      JOB_LOG WITH(NOLOCK) ON JOB_COMPONENT.JOB_NUMBER = JOB_LOG.JOB_NUMBER LEFT OUTER JOIN
                      JOB_SPECS WITH(NOLOCK) ON JOB_COMPONENT.JOB_NUMBER = JOB_SPECS.JOB_NUMBER AND 
                      JOB_COMPONENT.JOB_COMPONENT_NBR = JOB_SPECS.JOB_COMPONENT_NBR AND
                      ESTIMATE_REV.SPEC_VER = JOB_SPECS.SPEC_VER AND
                      ESTIMATE_REV.SPEC_REV = JOB_SPECS.SPEC_REV
WHERE     (ESTIMATE_QUOTE.ESTIMATE_NUMBER = @EstNo) AND (ESTIMATE_QUOTE.EST_COMPONENT_NBR = @EstCompNo) AND 
                      (ESTIMATE_QUOTE.EST_QUOTE_NBR = @QuoteNo) AND (ESTIMATE_REV.EST_REV_NBR = @RevNo)






















