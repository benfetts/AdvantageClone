if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[usp_wv_Estimating_Update_Quote]') and OBJECTPROPERTY(id, N'IsProcedure') = 1)
drop procedure [dbo].[usp_wv_Estimating_Update_Quote]
GO

CREATE PROCEDURE [dbo].[usp_wv_Estimating_Update_Quote]
(
	@ESTIMATE_NUMBER INT,
	@EST_COMPONENT_NBR INT,
	@EST_QUOTE_NBR INT,
	@EST_QTE_COMMENT TEXT,
	@EST_QTE_COMMENT_HTML TEXT,
	@EST_QUOTE_DESC VARCHAR(60),
	@EST_REV_NBR INT,
	@EST_REV_COMMENT TEXT,
	@EST_REV_COMMENT_HTML TEXT,
	@SPEC_VER INT,
	@SPEC_REV INT,
	@SPEC_QTY_SEQ_NBR INT,
	@JOB_QTY INT,
	@SPEC_RTF TEXT,
	@USER_ID VARCHAR(100),
	@BLENDED_TIME_RATE DECIMAL(9,2),
	@QTE_NUM INT OUTPUT
)
AS
BEGIN
	SET NOCOUNT OFF
	DECLARE 
	@ERR INT,
	@NEXT_EST_NBR INT
	
    --SELECT @NEXT_EST_NBR = ISNULL(MAX(ESTIMATE_NUMBER),-1) + 1 FROM ESTIMATE_LOG 
    
    UPDATE [ESTIMATE_QUOTE]
	SET	[EST_QTE_COMMENT] = @EST_QTE_COMMENT,
		[EST_QUOTE_DESC] = @EST_QUOTE_DESC,
		[EST_QTE_COMMENT_HTML] = @EST_QTE_COMMENT_HTML
	WHERE	
		[ESTIMATE_NUMBER] = @ESTIMATE_NUMBER AND
		[EST_COMPONENT_NBR] = @EST_COMPONENT_NBR AND
		[EST_QUOTE_NBR] = @EST_QUOTE_NBR
			
	UPDATE [ESTIMATE_REV]
	SET	[EST_REV_COMMENT] = @EST_REV_COMMENT,
		[SPEC_VER] = @SPEC_VER,
		[SPEC_REV] = @SPEC_REV,
		[SPEC_QTY_SEQ_NBR] = @SPEC_QTY_SEQ_NBR,
		[JOB_QTY] = @JOB_QTY,
		[SPEC_RTF] = @SPEC_RTF,
		[BLENDED_TIME_RATE] = @BLENDED_TIME_RATE,
		[EST_REV_COMMENT_HTML] = @EST_REV_COMMENT_HTML
	WHERE [ESTIMATE_NUMBER] = @ESTIMATE_NUMBER AND
		  [EST_COMPONENT_NBR] = @EST_COMPONENT_NBR AND
		  [EST_QUOTE_NBR] = @EST_QUOTE_NBR AND
		  [EST_REV_NBR] = @EST_REV_NBR
			
			
			

	SET @ERR = @@Error

	--RETURN @ERR
END

--SELECT @QTE_NUM = @NEXT_EST_NBR


