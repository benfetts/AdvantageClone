


CREATE PROCEDURE [dbo].[usp_wv_GetJobSpecs_ByJobandComp] 
	@JOB_NUMBER INT,
	@JOB_COMPONENT_NBR INT
AS
DECLARE 	
	
	-- Vars for field values:
	@JOB_SPECS_QTY1 VARCHAR(50),
	@JOB_SPECS_QTY2 VARCHAR(50),
	@JOB_SPECS_QTY3 VARCHAR(50),
	@JOB_SPECS_QTY4 VARCHAR(50),
	@JOB_SPECS_QTY5 VARCHAR(50),
	@JOB_SPECS_CHAR1_1 VARCHAR(1),
	@JOB_SPECS_CHAR1_2 VARCHAR(1),
	@JOB_SPECS_CHAR1_3 VARCHAR(1),
	@JOB_SPECS_CHAR1_4 VARCHAR(1),
	@JOB_SPECS_CHAR1_5 VARCHAR(1),
	@JOB_SPECS_CHAR10_1 VARCHAR(10),
	@JOB_SPECS_CHAR10_2 VARCHAR(10),
	@JOB_SPECS_CHAR10_3 VARCHAR(10),
	@JOB_SPECS_CHAR10_4 VARCHAR(10),
	@JOB_SPECS_CHAR10_5 VARCHAR(10),
	@JOB_SPECS_CHAR50_1 VARCHAR(50),
	@JOB_SPECS_CHAR50_2 VARCHAR(50),
	@JOB_SPECS_CHAR50_3 VARCHAR(50),
	@JOB_SPECS_CHAR50_4 VARCHAR(50),
	@JOB_SPECS_CHAR50_5 VARCHAR(50),
	@JOB_SPECS_CHAR50_6 VARCHAR(50),
	@JOB_SPECS_CHAR50_7 VARCHAR(50),
	@JOB_SPECS_CHAR254_1 VARCHAR(254),
	@JOB_SPECS_CHAR254_2 VARCHAR(254),
	@JOB_SPECS_CHAR254_3 VARCHAR(254),
	@JOB_SPECS_CHAR254_4 VARCHAR(254),
	@JOB_SPECS_SMALLINT_1 VARCHAR(50),
	@JOB_SPECS_SMALLINT_2 VARCHAR(50),
	@JOB_SPECS_SMALLINT_3 VARCHAR(50),
	@JOB_SPECS_SMALLINT_4 VARCHAR(50),
	@JOB_SPECS_SMALLINT_5 VARCHAR(50),
	@JOB_SPECS_SMALLINT_6 VARCHAR(50),
	@JOB_SPECS_SMALLINT_7 VARCHAR(50),
	@JOB_SPECS_SMALLINT_8 VARCHAR(50),
	@JOB_SPECS_INT_1 VARCHAR(50),
	@JOB_SPECS_INT_2 VARCHAR(50),
	@JOB_SPECS_INT_3 VARCHAR(50),
	@JOB_SPECS_INT_4 VARCHAR(50),
	@JOB_SPECS_INT_5 VARCHAR(50),
	@JOB_SPECS_INT_6 VARCHAR(50),
	@JOB_SPECS_INT_7 VARCHAR(50),
	@JOB_SPECS_INT_8 VARCHAR(50),
	@JOB_SPECS_INT_9 VARCHAR(50),
	@JOB_SPECS_INT_10 VARCHAR(50),	
	@JOB_SPECS_TEXT_1 VARCHAR(4000),
	@JOB_SPECS_TEXT_2 VARCHAR(4000),
	@JOB_SPECS_TEXT_3 VARCHAR(4000),
	@JOB_SPECS_TEXT_4 VARCHAR(4000),
	@JOB_SPECS_TEXT_5 VARCHAR(4000),
	@JOB_SPECS_TEXT_6 VARCHAR(4000),
	@JOB_SPECS_TEXT_7 VARCHAR(4000),
	@JOB_SPECS_TEXT_8 VARCHAR(4000),
	@JOB_SPECS_CHAR1_6 VARCHAR(1),
	@JOB_SPECS_CHAR1_7 VARCHAR(1),
	@JOB_SPECS_CHAR1_8 VARCHAR(1),
	@JOB_SPECS_CHAR1_9 VARCHAR(1),
	@JOB_SPECS_CHAR1_10 VARCHAR(1),
	@JOB_SPECS_CHAR1_11 VARCHAR(1),
	@JOB_SPECS_CHAR1_12 VARCHAR(1),
	@JOB_SPECS_CHAR1_13 VARCHAR(1),
	@JOB_SPECS_CHAR1_14 VARCHAR(1),
	@JOB_SPECS_CHAR1_15 VARCHAR(1),
	@JOB_SPECS_CHAR1_16 VARCHAR(1),
	@JOB_SPECS_CHAR1_17 VARCHAR(1),
	@JOB_SPECS_CHAR1_18 VARCHAR(1),
	@JOB_SPECS_CHAR1_19 VARCHAR(1),
	@JOB_SPECS_CHAR1_20 VARCHAR(1),
	@JOB_SPECS_CHAR10_6 VARCHAR(10),
	@JOB_SPECS_CHAR10_7 VARCHAR(10),
	@JOB_SPECS_CHAR10_8 VARCHAR(10),
	@JOB_SPECS_CHAR10_9 VARCHAR(10),
	@JOB_SPECS_CHAR10_10 VARCHAR(10),
	@JOB_SPECS_CHAR10_11 VARCHAR(10),
	@JOB_SPECS_CHAR10_12 VARCHAR(10),
	@JOB_SPECS_CHAR10_13 VARCHAR(10),
	@JOB_SPECS_CHAR10_14 VARCHAR(10),
	@JOB_SPECS_CHAR10_15 VARCHAR(10),
	@JOB_SPECS_CHAR10_16 VARCHAR(10),
	@JOB_SPECS_CHAR10_17 VARCHAR(10),
	@JOB_SPECS_CHAR10_18 VARCHAR(10),
	@JOB_SPECS_CHAR10_19 VARCHAR(10),
	@JOB_SPECS_CHAR10_20 VARCHAR(10),
	@JOB_SPECS_CHAR50_8 VARCHAR(50),
	@JOB_SPECS_CHAR50_9 VARCHAR(50),
	@JOB_SPECS_CHAR50_10 VARCHAR(50),
	@JOB_SPECS_CHAR50_11 VARCHAR(50),
	@JOB_SPECS_CHAR50_12 VARCHAR(50),
	@JOB_SPECS_CHAR50_13 VARCHAR(50),
	@JOB_SPECS_CHAR50_14 VARCHAR(50),
	@JOB_SPECS_CHAR50_15 VARCHAR(50),
	@JOB_SPECS_CHAR50_16 VARCHAR(50),
	@JOB_SPECS_CHAR50_17 VARCHAR(50),
	@JOB_SPECS_CHAR50_18 VARCHAR(50),
	@JOB_SPECS_CHAR50_19 VARCHAR(50),
	@JOB_SPECS_CHAR50_20 VARCHAR(50),
	@JOB_SPECS_CHAR254_5 VARCHAR(254),
	@JOB_SPECS_CHAR254_6 VARCHAR(254),
	@JOB_SPECS_CHAR254_7 VARCHAR(254),
	@JOB_SPECS_CHAR254_8 VARCHAR(254),
	@JOB_SPECS_CHAR254_9 VARCHAR(254),
	@JOB_SPECS_CHAR254_10 VARCHAR(254),
	@JOB_SPECS_SMALLINT_9 VARCHAR(50),
	@JOB_SPECS_SMALLINT_10 VARCHAR(50),
	@JOB_SPECS_SMALLINT_11 VARCHAR(50),
	@JOB_SPECS_SMALLINT_12 VARCHAR(50),
	@JOB_SPECS_SMALLINT_13 VARCHAR(50),
	@JOB_SPECS_SMALLINT_14 VARCHAR(50),
	@JOB_SPECS_SMALLINT_15 VARCHAR(50),
	@JOB_SPECS_SMALLINT_16 VARCHAR(50),
	@JOB_SPECS_SMALLINT_17 VARCHAR(50),
	@JOB_SPECS_SMALLINT_18 VARCHAR(50),
	@JOB_SPECS_SMALLINT_19 VARCHAR(50),
	@JOB_SPECS_SMALLINT_20 VARCHAR(50),
	@JOB_SPECS_INT_11 VARCHAR(50),
	@JOB_SPECS_INT_12 VARCHAR(50),
	@JOB_SPECS_INT_13 VARCHAR(50),
	@JOB_SPECS_INT_14 VARCHAR(50),
	@JOB_SPECS_INT_15 VARCHAR(50),
	@JOB_SPECS_INT_16 VARCHAR(50),
	@JOB_SPECS_INT_17 VARCHAR(50),
	@JOB_SPECS_INT_18 VARCHAR(50),
	@JOB_SPECS_INT_19 VARCHAR(50),
	@JOB_SPECS_INT_20 VARCHAR(50),
	@JOB_SPECS_TEXT_9 VARCHAR(4000),
	@JOB_SPECS_TEXT_10 VARCHAR(4000),
	@JOB_SPECS_TEXT_11 VARCHAR(4000),
	@JOB_SPECS_TEXT_12 VARCHAR(4000),
	@JOB_SPECS_TEXT_13 VARCHAR(4000),
	@JOB_SPECS_TEXT_14 VARCHAR(4000),
	@JOB_SPECS_TEXT_15 VARCHAR(4000),
	@JOB_SPECS_TEXT_16 VARCHAR(4000),
	@JOB_SPECS_TEXT_17 VARCHAR(4000),
	@JOB_SPECS_TEXT_18 VARCHAR(4000),
	@JOB_SPECS_TEXT_19 VARCHAR(4000),
	@JOB_SPECS_TEXT_20 VARCHAR(4000)

CREATE TABLE #SPECS_ALL (
SPEC_VER 	INT,
FIELD_NAME	VARCHAR(18),
SHORT_DESC	VARCHAR(34),
CATEGORY_ID	INT,
ITEM_ORDER	INT,
REQUIRED	SMALLINT,
FIELD_VALUE	VARCHAR(4000),
CONTROL_TYPE	INTEGER,
SPEC_VER_DESC	VARCHAR(60),
SPEC_REV_REASON	varchar(254),
CATEGORY_DESC	VARCHAR(32),
QUANTITY	VARCHAR(50),
APPROVED	VARCHAR(10),
SPEC_REV	INTEGER,
SEPARATOR_LINE SMALLINT,
CATEGORY_SEQ SMALLINT
)

DECLARE @SPEC_VER INTEGER
DECLARE @SPEC_REV INTEGER

DECLARE CUR CURSOR FOR
SELECT SPEC_VER, MAX(JOB_SPECS.SPEC_REV) AS SPEC_REV
FROM JOB_SPECS
WHERE JOB_NUMBER = @JOB_NUMBER AND JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR
GROUP BY SPEC_VER

OPEN CUR


FETCH NEXT FROM CUR
INTO @SPEC_VER, @SPEC_REV
   
WHILE @@FETCH_STATUS = 0
BEGIN

--Get Job Specs data:
SELECT  @JOB_SPECS_QTY1 = QTY1,
		@JOB_SPECS_QTY2 = QTY2,
		@JOB_SPECS_QTY3 = QTY3, 
		@JOB_SPECS_QTY4 = QTY4, 
		@JOB_SPECS_QTY5 = QTY5, 
		@JOB_SPECS_CHAR1_1 = CHAR1_1,	
		@JOB_SPECS_CHAR1_2 = CHAR1_2, 
		@JOB_SPECS_CHAR1_3 = CHAR1_3, 
		@JOB_SPECS_CHAR1_4 = CHAR1_4, 
		@JOB_SPECS_CHAR1_5 = CHAR1_5, 
		@JOB_SPECS_CHAR10_1 = CHAR10_1, 
		@JOB_SPECS_CHAR10_2 = CHAR10_2, 
		@JOB_SPECS_CHAR10_3 = CHAR10_3, 
		@JOB_SPECS_CHAR10_4 = CHAR10_4, 
		@JOB_SPECS_CHAR10_5 = CHAR10_5, 
        @JOB_SPECS_CHAR50_1 = CHAR50_1, 
		@JOB_SPECS_CHAR50_2 = CHAR50_2, 
		@JOB_SPECS_CHAR50_3 = CHAR50_3, 
		@JOB_SPECS_CHAR50_4 = CHAR50_4, 
		@JOB_SPECS_CHAR50_5 = CHAR50_5, 
		@JOB_SPECS_CHAR50_6 = CHAR50_6, 
		@JOB_SPECS_CHAR50_7 = CHAR50_7, 
		@JOB_SPECS_CHAR254_1 = CHAR254_1, 
		@JOB_SPECS_CHAR254_2 = CHAR254_2, 
		@JOB_SPECS_CHAR254_3 = CHAR254_3, 
		@JOB_SPECS_CHAR254_4 = CHAR254_4, 
		@JOB_SPECS_SMALLINT_1 = SMALLINT_1, 
        @JOB_SPECS_SMALLINT_2 = SMALLINT_2, 
		@JOB_SPECS_SMALLINT_3 = SMALLINT_3, 
		@JOB_SPECS_SMALLINT_4 = SMALLINT_4, 
		@JOB_SPECS_SMALLINT_5 = SMALLINT_5, 
		@JOB_SPECS_SMALLINT_6 = SMALLINT_6, 
		@JOB_SPECS_SMALLINT_7 = SMALLINT_7, 
		@JOB_SPECS_SMALLINT_8 = SMALLINT_8, 
		@JOB_SPECS_INT_1 = INT_1, 
		@JOB_SPECS_INT_2 = INT_2, 
		@JOB_SPECS_INT_3 = INT_3, 
		@JOB_SPECS_INT_4 = INT_4, 
		@JOB_SPECS_INT_5 = INT_5, 
		@JOB_SPECS_INT_6 = INT_6, 
		@JOB_SPECS_INT_7 = INT_7, 
        @JOB_SPECS_INT_8 = INT_8, 
		@JOB_SPECS_INT_9 = INT_9, 
		@JOB_SPECS_INT_10 = INT_10, 
		@JOB_SPECS_TEXT_1 = TEXT_1, 
		@JOB_SPECS_TEXT_2 = TEXT_2, 
		@JOB_SPECS_TEXT_3 = TEXT_3, 
		@JOB_SPECS_TEXT_4 = TEXT_4, 
		@JOB_SPECS_TEXT_5 = TEXT_5, 
		@JOB_SPECS_TEXT_6 = TEXT_6, 
		@JOB_SPECS_TEXT_7 = TEXT_7, 
		@JOB_SPECS_TEXT_8 = TEXT_8, 
		@JOB_SPECS_CHAR1_6 = CHAR1_6, 
		@JOB_SPECS_CHAR1_7 = CHAR1_7, 
		@JOB_SPECS_CHAR1_8 = CHAR1_8, 
		@JOB_SPECS_CHAR1_9 = CHAR1_9, 
		@JOB_SPECS_CHAR1_10 = CHAR1_10, 
        @JOB_SPECS_CHAR1_11 = CHAR1_11, 
		@JOB_SPECS_CHAR1_12 = CHAR1_12, 
		@JOB_SPECS_CHAR1_13 = CHAR1_13, 
		@JOB_SPECS_CHAR1_14 = CHAR1_14, 
		@JOB_SPECS_CHAR1_15 = CHAR1_15, 
		@JOB_SPECS_CHAR1_16 = CHAR1_16, 
		@JOB_SPECS_CHAR1_17 = CHAR1_17, 
		@JOB_SPECS_CHAR1_18 = CHAR1_18, 
		@JOB_SPECS_CHAR1_19 = CHAR1_19, 
		@JOB_SPECS_CHAR1_20 = CHAR1_20, 
		@JOB_SPECS_CHAR10_6 = CHAR10_6, 
		@JOB_SPECS_CHAR10_7 = CHAR10_7, 
        @JOB_SPECS_CHAR10_8 = CHAR10_8, 
		@JOB_SPECS_CHAR10_9 = CHAR10_9, 
		@JOB_SPECS_CHAR10_10 = CHAR10_10, 
		@JOB_SPECS_CHAR10_11 = CHAR10_11, 
		@JOB_SPECS_CHAR10_12 = CHAR10_12, 
		@JOB_SPECS_CHAR10_13 = CHAR10_13, 
		@JOB_SPECS_CHAR10_14 = CHAR10_14, 
		@JOB_SPECS_CHAR10_15 = CHAR10_15, 
		@JOB_SPECS_CHAR10_16 = CHAR10_16, 
		@JOB_SPECS_CHAR10_17 = CHAR10_17, 
		@JOB_SPECS_CHAR10_18 = CHAR10_18, 
        @JOB_SPECS_CHAR10_19 = CHAR10_19, 
		@JOB_SPECS_CHAR10_20 = CHAR10_20, 
		@JOB_SPECS_CHAR50_8 = CHAR50_8, 
		@JOB_SPECS_CHAR50_9 = CHAR50_9, 
		@JOB_SPECS_CHAR50_10 = CHAR50_10, 
		@JOB_SPECS_CHAR50_11 = CHAR50_11, 
		@JOB_SPECS_CHAR50_12 = CHAR50_12, 
		@JOB_SPECS_CHAR50_13 = CHAR50_13, 
		@JOB_SPECS_CHAR50_14 = CHAR50_14, 
		@JOB_SPECS_CHAR50_15 = CHAR50_15, 
		@JOB_SPECS_CHAR50_16 = CHAR50_16, 
        @JOB_SPECS_CHAR50_17 = CHAR50_17, 
		@JOB_SPECS_CHAR50_18 = CHAR50_18, 
		@JOB_SPECS_CHAR50_19 = CHAR50_19, 
		@JOB_SPECS_CHAR50_20 = CHAR50_20, 
		@JOB_SPECS_CHAR254_5 = CHAR254_5, 
		@JOB_SPECS_CHAR254_6 = CHAR254_6, 
		@JOB_SPECS_CHAR254_7 = CHAR254_7, 
		@JOB_SPECS_CHAR254_8 = CHAR254_8, 
		@JOB_SPECS_CHAR254_9 = CHAR254_9, 
		@JOB_SPECS_CHAR254_10 = CHAR254_10, 
		@JOB_SPECS_SMALLINT_9 = SMALLINT_9, 
        @JOB_SPECS_SMALLINT_10 = SMALLINT_10, 
		@JOB_SPECS_SMALLINT_11 = SMALLINT_11, 
		@JOB_SPECS_SMALLINT_12 = SMALLINT_12, 
		@JOB_SPECS_SMALLINT_13 = SMALLINT_13, 
		@JOB_SPECS_SMALLINT_14 = SMALLINT_14, 
		@JOB_SPECS_SMALLINT_15 = SMALLINT_15, 
		@JOB_SPECS_SMALLINT_16 = SMALLINT_16, 
		@JOB_SPECS_SMALLINT_17 = SMALLINT_17, 
		@JOB_SPECS_SMALLINT_18 = SMALLINT_18, 
        @JOB_SPECS_SMALLINT_19 = SMALLINT_19, 
		@JOB_SPECS_SMALLINT_20 = SMALLINT_20, 
		@JOB_SPECS_INT_11 = INT_11, 
		@JOB_SPECS_INT_12 = INT_12, 
		@JOB_SPECS_INT_13 = INT_13, 
		@JOB_SPECS_INT_14 = INT_14, 
		@JOB_SPECS_INT_15 = INT_15, 
		@JOB_SPECS_INT_16 = INT_16, 
		@JOB_SPECS_INT_17 = INT_17, 
		@JOB_SPECS_INT_18 = INT_18, 
		@JOB_SPECS_INT_19 = INT_19, 
		@JOB_SPECS_INT_20 = INT_20, 
		@JOB_SPECS_TEXT_9 = TEXT_9, 
		@JOB_SPECS_TEXT_10 = TEXT_10, 
		@JOB_SPECS_TEXT_11 = TEXT_11, 
        @JOB_SPECS_TEXT_12 = TEXT_12, 
		@JOB_SPECS_TEXT_13 = TEXT_13, 
		@JOB_SPECS_TEXT_14 = TEXT_14, 
		@JOB_SPECS_TEXT_15 = TEXT_15, 
		@JOB_SPECS_TEXT_16 = TEXT_16, 
		@JOB_SPECS_TEXT_17 = TEXT_17, 
		@JOB_SPECS_TEXT_18 = TEXT_18, 
		@JOB_SPECS_TEXT_19 = TEXT_19, 
		@JOB_SPECS_TEXT_20 = TEXT_20

FROM    JOB_SPECS 
WHERE JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR 
	AND JOB_NUMBER = @JOB_NUMBER
	AND SPEC_VER = @SPEC_VER
	AND SPEC_REV = @SPEC_REV
	


-- INSERT INTO #SPEC_ALL
INSERT INTO #SPECS_ALL
SELECT    JOB_SPECS.SPEC_VER, 
	JOB_SPEC_FIELDS.FIELD_NAME
	, JOB_SPEC_FIELDS.FIELD_DESC + ':' AS SHORT_DESC
	, JOB_SPEC_FIELDS.CATEGORY_ID
	, JOB_SPEC_FIELDS.FIELD_SEQ AS ITEM_ORDER
	, JOB_SPEC_FIELDS.REQUIRED	
	,CASE JOB_SPEC_FIELDS.FIELD_NAME
		WHEN 'CHAR1_1' THEN (SELECT ISNULL(@JOB_SPECS_CHAR1_1,''))
		WHEN 'CHAR1_2' THEN (SELECT ISNULL(@JOB_SPECS_CHAR1_2,''))
		WHEN 'CHAR1_3' THEN (SELECT ISNULL(@JOB_SPECS_CHAR1_3,''))
		WHEN 'CHAR1_4' THEN (SELECT ISNULL(@JOB_SPECS_CHAR1_4,''))
		WHEN 'CHAR1_5' THEN (SELECT ISNULL(@JOB_SPECS_CHAR1_5,''))
		WHEN 'CHAR10_1' THEN (SELECT ISNULL(@JOB_SPECS_CHAR10_1,''))
		WHEN 'CHAR10_2' THEN (SELECT ISNULL(@JOB_SPECS_CHAR10_2,''))
		WHEN 'CHAR10_3' THEN (SELECT ISNULL(@JOB_SPECS_CHAR10_3,''))
		WHEN 'CHAR10_4' THEN (SELECT ISNULL(@JOB_SPECS_CHAR10_4,''))
		WHEN 'CHAR10_5' THEN (SELECT ISNULL(@JOB_SPECS_CHAR10_5,''))
		WHEN 'CHAR50_1' THEN (SELECT ISNULL(@JOB_SPECS_CHAR50_1,''))
		WHEN 'CHAR50_2' THEN (SELECT ISNULL(@JOB_SPECS_CHAR50_2,''))
		WHEN 'CHAR50_3' THEN (SELECT ISNULL(@JOB_SPECS_CHAR50_3,''))
		WHEN 'CHAR50_4' THEN (SELECT ISNULL(@JOB_SPECS_CHAR50_4,''))
		WHEN 'CHAR50_5' THEN (SELECT ISNULL(@JOB_SPECS_CHAR50_5,''))
		WHEN 'CHAR50_6' THEN (SELECT ISNULL(@JOB_SPECS_CHAR50_6,''))
		WHEN 'CHAR50_7' THEN (SELECT ISNULL(@JOB_SPECS_CHAR50_7,''))
		WHEN 'CHAR254_1' THEN (SELECT ISNULL(@JOB_SPECS_CHAR254_1,''))
		WHEN 'CHAR254_2' THEN (SELECT ISNULL(@JOB_SPECS_CHAR254_2,''))
		WHEN 'CHAR254_3' THEN (SELECT ISNULL(@JOB_SPECS_CHAR254_3,''))
		WHEN 'CHAR254_4' THEN (SELECT ISNULL(@JOB_SPECS_CHAR254_4,''))
		WHEN 'SMALLINT_1' THEN (SELECT ISNULL(@JOB_SPECS_SMALLINT_1,''))
		WHEN 'SMALLINT_2' THEN (SELECT ISNULL(@JOB_SPECS_SMALLINT_2,''))
		WHEN 'SMALLINT_3' THEN (SELECT ISNULL(@JOB_SPECS_SMALLINT_3,''))
		WHEN 'SMALLINT_4' THEN (SELECT ISNULL(@JOB_SPECS_SMALLINT_4,''))
		WHEN 'SMALLINT_5' THEN (SELECT ISNULL(@JOB_SPECS_SMALLINT_5,''))
		WHEN 'SMALLINT_6' THEN (SELECT ISNULL(@JOB_SPECS_SMALLINT_6,''))
		WHEN 'SMALLINT_7' THEN (SELECT ISNULL(@JOB_SPECS_SMALLINT_7,''))
		WHEN 'SMALLINT_8' THEN (SELECT ISNULL(@JOB_SPECS_SMALLINT_8,''))			
		WHEN 'INT_1' THEN (SELECT ISNULL(@JOB_SPECS_INT_1,''))
		WHEN 'INT_2' THEN (SELECT ISNULL(@JOB_SPECS_INT_2,''))
		WHEN 'INT_3' THEN (SELECT ISNULL(@JOB_SPECS_INT_3,''))
		WHEN 'INT_4' THEN (SELECT ISNULL(@JOB_SPECS_INT_4,''))
		WHEN 'INT_5' THEN (SELECT ISNULL(@JOB_SPECS_INT_5,''))
		WHEN 'INT_6' THEN (SELECT ISNULL(@JOB_SPECS_INT_6,''))
		WHEN 'INT_7' THEN (SELECT ISNULL(@JOB_SPECS_INT_7,''))
		WHEN 'INT_8' THEN (SELECT ISNULL(@JOB_SPECS_INT_8,''))
		WHEN 'INT_9' THEN (SELECT ISNULL(@JOB_SPECS_INT_9,''))
		WHEN 'INT_10' THEN (SELECT ISNULL(@JOB_SPECS_INT_10,''))
		WHEN 'TEXT_1' THEN (SELECT ISNULL(@JOB_SPECS_TEXT_1,''))
		WHEN 'TEXT_2' THEN (SELECT ISNULL(@JOB_SPECS_TEXT_2,''))
		WHEN 'TEXT_3' THEN (SELECT ISNULL(@JOB_SPECS_TEXT_3,''))
		WHEN 'TEXT_4' THEN (SELECT ISNULL(@JOB_SPECS_TEXT_4,''))
		WHEN 'TEXT_5' THEN (SELECT ISNULL(@JOB_SPECS_TEXT_5,''))
		WHEN 'TEXT_6' THEN (SELECT ISNULL(@JOB_SPECS_TEXT_6,''))
		WHEN 'TEXT_7' THEN (SELECT ISNULL(@JOB_SPECS_TEXT_7,''))
		WHEN 'TEXT_8' THEN (SELECT ISNULL(@JOB_SPECS_TEXT_8,''))
		WHEN 'CHAR1_6' THEN (SELECT ISNULL(@JOB_SPECS_CHAR1_6,''))
		WHEN 'CHAR1_7' THEN (SELECT ISNULL(@JOB_SPECS_CHAR1_7,''))
		WHEN 'CHAR1_8' THEN (SELECT ISNULL(@JOB_SPECS_CHAR1_8,''))
		WHEN 'CHAR1_9' THEN (SELECT ISNULL(@JOB_SPECS_CHAR1_9,''))
		WHEN 'CHAR1_10' THEN (SELECT ISNULL(@JOB_SPECS_CHAR1_10,''))
		WHEN 'CHAR1_11' THEN (SELECT ISNULL(@JOB_SPECS_CHAR1_11,''))
		WHEN 'CHAR1_12' THEN (SELECT ISNULL(@JOB_SPECS_CHAR1_12,''))
		WHEN 'CHAR1_13' THEN (SELECT ISNULL(@JOB_SPECS_CHAR1_13,''))
		WHEN 'CHAR1_14' THEN (SELECT ISNULL(@JOB_SPECS_CHAR1_14,''))
		WHEN 'CHAR1_15' THEN (SELECT ISNULL(@JOB_SPECS_CHAR1_15,''))
		WHEN 'CHAR1_16' THEN (SELECT ISNULL(@JOB_SPECS_CHAR1_16,''))
		WHEN 'CHAR1_17' THEN (SELECT ISNULL(@JOB_SPECS_CHAR1_17,''))
		WHEN 'CHAR1_18' THEN (SELECT ISNULL(@JOB_SPECS_CHAR1_18,''))
		WHEN 'CHAR1_19' THEN (SELECT ISNULL(@JOB_SPECS_CHAR1_19,''))
		WHEN 'CHAR1_20' THEN (SELECT ISNULL(@JOB_SPECS_CHAR1_20,''))
		WHEN 'CHAR10_6' THEN (SELECT ISNULL(@JOB_SPECS_CHAR10_6,''))
		WHEN 'CHAR10_7' THEN (SELECT ISNULL(@JOB_SPECS_CHAR10_7,''))
		WHEN 'CHAR10_8' THEN (SELECT ISNULL(@JOB_SPECS_CHAR10_8,''))
		WHEN 'CHAR10_9' THEN (SELECT ISNULL(@JOB_SPECS_CHAR10_9,''))
		WHEN 'CHAR10_10' THEN (SELECT ISNULL(@JOB_SPECS_CHAR10_10,''))
		WHEN 'CHAR10_11' THEN (SELECT ISNULL(@JOB_SPECS_CHAR10_11,''))
		WHEN 'CHAR10_12' THEN (SELECT ISNULL(@JOB_SPECS_CHAR10_12,''))
		WHEN 'CHAR10_13' THEN (SELECT ISNULL(@JOB_SPECS_CHAR10_13,''))
		WHEN 'CHAR10_14' THEN (SELECT ISNULL(@JOB_SPECS_CHAR10_14,''))
		WHEN 'CHAR10_15' THEN (SELECT ISNULL(@JOB_SPECS_CHAR10_15,''))
		WHEN 'CHAR10_16' THEN (SELECT ISNULL(@JOB_SPECS_CHAR10_16,''))
		WHEN 'CHAR10_17' THEN (SELECT ISNULL(@JOB_SPECS_CHAR10_17,''))
		WHEN 'CHAR10_18' THEN (SELECT ISNULL(@JOB_SPECS_CHAR10_18,''))
		WHEN 'CHAR10_19' THEN (SELECT ISNULL(@JOB_SPECS_CHAR10_19,''))
		WHEN 'CHAR10_20' THEN (SELECT ISNULL(@JOB_SPECS_CHAR10_20,''))
		WHEN 'CHAR50_8' THEN (SELECT ISNULL(@JOB_SPECS_CHAR50_8,''))
		WHEN 'CHAR50_9' THEN (SELECT ISNULL(@JOB_SPECS_CHAR50_9,''))
		WHEN 'CHAR50_10' THEN (SELECT ISNULL(@JOB_SPECS_CHAR50_10,''))
		WHEN 'CHAR50_11' THEN (SELECT ISNULL(@JOB_SPECS_CHAR50_11,''))
		WHEN 'CHAR50_12' THEN (SELECT ISNULL(@JOB_SPECS_CHAR50_12,''))
		WHEN 'CHAR50_13' THEN (SELECT ISNULL(@JOB_SPECS_CHAR50_13,''))
		WHEN 'CHAR50_14' THEN (SELECT ISNULL(@JOB_SPECS_CHAR50_14,''))
		WHEN 'CHAR50_15' THEN (SELECT ISNULL(@JOB_SPECS_CHAR50_15,''))
		WHEN 'CHAR50_16' THEN (SELECT ISNULL(@JOB_SPECS_CHAR50_16,''))
		WHEN 'CHAR50_17' THEN (SELECT ISNULL(@JOB_SPECS_CHAR50_17,''))
		WHEN 'CHAR50_18' THEN (SELECT ISNULL(@JOB_SPECS_CHAR50_18,''))
		WHEN 'CHAR50_19' THEN (SELECT ISNULL(@JOB_SPECS_CHAR50_19,''))
		WHEN 'CHAR50_20' THEN (SELECT ISNULL(@JOB_SPECS_CHAR50_20,''))
		WHEN 'CHAR254_5' THEN (SELECT ISNULL(@JOB_SPECS_CHAR254_5,''))
		WHEN 'CHAR254_6' THEN (SELECT ISNULL(@JOB_SPECS_CHAR254_6,''))
		WHEN 'CHAR254_7' THEN (SELECT ISNULL(@JOB_SPECS_CHAR254_7,''))
		WHEN 'CHAR254_8' THEN (SELECT ISNULL(@JOB_SPECS_CHAR254_8,''))
		WHEN 'CHAR254_9' THEN (SELECT ISNULL(@JOB_SPECS_CHAR254_9,''))
		WHEN 'CHAR254_10' THEN (SELECT ISNULL(@JOB_SPECS_CHAR254_10,''))
		WHEN 'SMALLINT_9' THEN (SELECT ISNULL(@JOB_SPECS_SMALLINT_9,''))
		WHEN 'SMALLINT_10' THEN (SELECT ISNULL(@JOB_SPECS_SMALLINT_10,''))
		WHEN 'SMALLINT_11' THEN (SELECT ISNULL(@JOB_SPECS_SMALLINT_11,''))
		WHEN 'SMALLINT_12' THEN (SELECT ISNULL(@JOB_SPECS_SMALLINT_12,''))
		WHEN 'SMALLINT_13' THEN (SELECT ISNULL(@JOB_SPECS_SMALLINT_13,''))
		WHEN 'SMALLINT_14' THEN (SELECT ISNULL(@JOB_SPECS_SMALLINT_14,''))
		WHEN 'SMALLINT_15' THEN (SELECT ISNULL(@JOB_SPECS_SMALLINT_15,''))
		WHEN 'SMALLINT_16' THEN (SELECT ISNULL(@JOB_SPECS_SMALLINT_16,''))
		WHEN 'SMALLINT_17' THEN (SELECT ISNULL(@JOB_SPECS_SMALLINT_17,''))
		WHEN 'SMALLINT_18' THEN (SELECT ISNULL(@JOB_SPECS_SMALLINT_18,''))
		WHEN 'SMALLINT_19' THEN (SELECT ISNULL(@JOB_SPECS_SMALLINT_19,''))
		WHEN 'SMALLINT_20' THEN (SELECT ISNULL(@JOB_SPECS_SMALLINT_20,''))
		WHEN 'INT_11' THEN (SELECT ISNULL(@JOB_SPECS_INT_11,''))
		WHEN 'INT_12' THEN (SELECT ISNULL(@JOB_SPECS_INT_12,''))
		WHEN 'INT_13' THEN (SELECT ISNULL(@JOB_SPECS_INT_13,''))
		WHEN 'INT_14' THEN (SELECT ISNULL(@JOB_SPECS_INT_14,''))
		WHEN 'INT_15' THEN (SELECT ISNULL(@JOB_SPECS_INT_15,''))
		WHEN 'INT_16' THEN (SELECT ISNULL(@JOB_SPECS_INT_16,''))
		WHEN 'INT_17' THEN (SELECT ISNULL(@JOB_SPECS_INT_17,''))
		WHEN 'INT_18' THEN (SELECT ISNULL(@JOB_SPECS_INT_18,''))
		WHEN 'INT_19' THEN (SELECT ISNULL(@JOB_SPECS_INT_19,''))
		WHEN 'INT_20' THEN (SELECT ISNULL(@JOB_SPECS_INT_20,''))
		WHEN 'TEXT_9' THEN (SELECT ISNULL(@JOB_SPECS_TEXT_9,''))
		WHEN 'TEXT_10' THEN (SELECT ISNULL(@JOB_SPECS_TEXT_10,''))
		WHEN 'TEXT_11' THEN (SELECT ISNULL(@JOB_SPECS_TEXT_11,''))
		WHEN 'TEXT_12' THEN (SELECT ISNULL(@JOB_SPECS_TEXT_12,''))
		WHEN 'TEXT_13' THEN (SELECT ISNULL(@JOB_SPECS_TEXT_13,''))
		WHEN 'TEXT_14' THEN (SELECT ISNULL(@JOB_SPECS_TEXT_14,''))
		WHEN 'TEXT_15' THEN (SELECT ISNULL(@JOB_SPECS_TEXT_15,''))
		WHEN 'TEXT_16' THEN (SELECT ISNULL(@JOB_SPECS_TEXT_16,''))
		WHEN 'TEXT_17' THEN (SELECT ISNULL(@JOB_SPECS_TEXT_17,''))
		WHEN 'TEXT_18' THEN (SELECT ISNULL(@JOB_SPECS_TEXT_18,''))
		WHEN 'TEXT_19' THEN (SELECT ISNULL(@JOB_SPECS_TEXT_19,''))
		WHEN 'TEXT_20' THEN (SELECT ISNULL(@JOB_SPECS_TEXT_20,'')) ELSE ''
	END AS FIELD_VALUE
	,CASE JOB_SPEC_FIELDS.FIELD_NAME
		WHEN 'CHAR1_1' THEN 1
		WHEN 'CHAR1_2' THEN 1
		WHEN 'CHAR1_3' THEN 1
		WHEN 'CHAR1_4' THEN 1
		WHEN 'CHAR1_5' THEN 1
		WHEN 'CHAR10_1' THEN 2
		WHEN 'CHAR10_2' THEN 2
		WHEN 'CHAR10_3' THEN 2
		WHEN 'CHAR10_4' THEN 2
		WHEN 'CHAR10_5' THEN 2
		WHEN 'CHAR50_1' THEN 3
		WHEN 'CHAR50_2' THEN 3
		WHEN 'CHAR50_3' THEN 3
		WHEN 'CHAR50_4' THEN 3
		WHEN 'CHAR50_5' THEN 3
		WHEN 'CHAR50_6' THEN 3
		WHEN 'CHAR50_7' THEN 3
		WHEN 'CHAR254_1' THEN 4
		WHEN 'CHAR254_2' THEN 4
		WHEN 'CHAR254_3' THEN 4
		WHEN 'CHAR254_4' THEN 4
		WHEN 'SMALLINT_1' THEN 6
		WHEN 'SMALLINT_2' THEN 6
		WHEN 'SMALLINT_3' THEN 6
		WHEN 'SMALLINT_4' THEN 6
		WHEN 'SMALLINT_5' THEN 6
		WHEN 'SMALLINT_6' THEN 6
		WHEN 'SMALLINT_7' THEN 6
		WHEN 'SMALLINT_8' THEN 6			
		WHEN 'INT_1' THEN 7
		WHEN 'INT_2' THEN 7
		WHEN 'INT_3' THEN 7
		WHEN 'INT_4' THEN 7
		WHEN 'INT_5' THEN 7
		WHEN 'INT_6' THEN 7
		WHEN 'INT_7' THEN 7
		WHEN 'INT_8' THEN 7
		WHEN 'INT_9' THEN 7
		WHEN 'INT_10' THEN 7
		WHEN 'TEXT_1' THEN 5
		WHEN 'TEXT_2' THEN 5
		WHEN 'TEXT_3' THEN 5
		WHEN 'TEXT_4' THEN 5
		WHEN 'TEXT_5' THEN 5
		WHEN 'TEXT_6' THEN 5
		WHEN 'TEXT_7' THEN 5
		WHEN 'TEXT_8' THEN 5
		WHEN 'CHAR1_6' THEN 1
		WHEN 'CHAR1_7' THEN 1
		WHEN 'CHAR1_8' THEN 1
		WHEN 'CHAR1_9' THEN 1
		WHEN 'CHAR1_10' THEN 1
		WHEN 'CHAR1_11' THEN 1
		WHEN 'CHAR1_12' THEN 1
		WHEN 'CHAR1_13' THEN 1
		WHEN 'CHAR1_14' THEN 1
		WHEN 'CHAR1_15' THEN 1
		WHEN 'CHAR1_16' THEN 1
		WHEN 'CHAR1_17' THEN 1
		WHEN 'CHAR1_18' THEN 1
		WHEN 'CHAR1_19' THEN 1
		WHEN 'CHAR1_20' THEN 1
		WHEN 'CHAR10_6' THEN 2
		WHEN 'CHAR10_7' THEN 2
		WHEN 'CHAR10_8' THEN 2
		WHEN 'CHAR10_9' THEN 2
		WHEN 'CHAR10_10' THEN 2
		WHEN 'CHAR10_11' THEN 2
		WHEN 'CHAR10_12' THEN 2
		WHEN 'CHAR10_13' THEN 2
		WHEN 'CHAR10_14' THEN 2
		WHEN 'CHAR10_15' THEN 2
		WHEN 'CHAR10_16' THEN 2
		WHEN 'CHAR10_17' THEN 2
		WHEN 'CHAR10_18' THEN 2
		WHEN 'CHAR10_19' THEN 2
		WHEN 'CHAR10_20' THEN 2
		WHEN 'CHAR50_8' THEN 3
		WHEN 'CHAR50_9' THEN 3
		WHEN 'CHAR50_10' THEN 3
		WHEN 'CHAR50_11' THEN 3
		WHEN 'CHAR50_12' THEN 3
		WHEN 'CHAR50_13' THEN 3
		WHEN 'CHAR50_14' THEN 3
		WHEN 'CHAR50_15' THEN 3
		WHEN 'CHAR50_16' THEN 3
		WHEN 'CHAR50_17' THEN 3
		WHEN 'CHAR50_18' THEN 3
		WHEN 'CHAR50_19' THEN 3
		WHEN 'CHAR50_20' THEN 3
		WHEN 'CHAR254_5' THEN 4
		WHEN 'CHAR254_6' THEN 4
		WHEN 'CHAR254_7' THEN 4
		WHEN 'CHAR254_8' THEN 4
		WHEN 'CHAR254_9' THEN 4
		WHEN 'CHAR254_10' THEN 4
		WHEN 'SMALLINT_9' THEN 6
		WHEN 'SMALLINT_10' THEN 6
		WHEN 'SMALLINT_11' THEN 6
		WHEN 'SMALLINT_12' THEN 6
		WHEN 'SMALLINT_13' THEN 6
		WHEN 'SMALLINT_14' THEN 6
		WHEN 'SMALLINT_15' THEN 6
		WHEN 'SMALLINT_16' THEN 6
		WHEN 'SMALLINT_17' THEN 6
		WHEN 'SMALLINT_18' THEN 6
		WHEN 'SMALLINT_19' THEN 6
		WHEN 'SMALLINT_20' THEN 6
		WHEN 'INT_11' THEN 7
		WHEN 'INT_12' THEN 7
		WHEN 'INT_13' THEN 7
		WHEN 'INT_14' THEN 7
		WHEN 'INT_15' THEN 7
		WHEN 'INT_16' THEN 7
		WHEN 'INT_17' THEN 7
		WHEN 'INT_18' THEN 7
		WHEN 'INT_19' THEN 7
		WHEN 'INT_20' THEN 7
		WHEN 'TEXT_9' THEN 7
		WHEN 'TEXT_10' THEN 5
		WHEN 'TEXT_11' THEN 5
		WHEN 'TEXT_12' THEN 5
		WHEN 'TEXT_13' THEN 5
		WHEN 'TEXT_14' THEN 5
		WHEN 'TEXT_15' THEN 5
		WHEN 'TEXT_16' THEN 5
		WHEN 'TEXT_17' THEN 5
		WHEN 'TEXT_18' THEN 5
		WHEN 'TEXT_19' THEN 5
		WHEN 'TEXT_20' THEN 5 ELSE ''
	END AS CONTROL_TYPE,
	
	dbo.udf_get_spec_ver_desc(@JOB_NUMBER, @JOB_COMPONENT_NBR, JOB_SPECS.SPEC_VER) AS SPEC_VER_DESC,
	(SELECT SPEC_REV_REASON FROM JOB_SPECS JS WHERE JOB_NUMBER = @JOB_NUMBER AND JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR AND JS.SPEC_VER = JOB_SPECS.SPEC_VER AND JS.SPEC_REV = JOB_SPECS.SPEC_REV) AS SPEC_REV_REASON, 
	ISNULL(JOB_SPEC_CATEGORY.CATEGORY_DESC,'') AS CATEGORY_DESC, 
	
	ISNULL(dbo.udf_get_job_spec_qty(@JOB_NUMBER, @JOB_COMPONENT_NBR, JOB_SPECS.SPEC_VER),'') AS QUANTITY, 
	
	CASE @SPEC_VER --JOB_SPECS.SPEC_VER 
		WHEN dbo.udf_get_approved_spec_version(JOB_SPECS.JOB_NUMBER, JOB_SPECS.JOB_COMPONENT_NBR) THEN 'Approved'
		ELSE ''
		END AS APPROVED,
	--MAX(JOB_SPECS.SPEC_REV) AS SPEC_REV
	  @SPEC_REV,
	ISNULL(JOB_SPEC_FIELDS.SEPARATOR_LINE,0) AS SEPARATOR_LINE,
	JOB_SPEC_CATEGORY.CATEGORY_SEQ
	
FROM  JOB_SPECS 
	INNER JOIN JOB_SPEC_FIELDS ON JOB_SPECS.SPEC_TYPE_CODE = JOB_SPEC_FIELDS.SPEC_TYPE_CODE
    INNER JOIN JOB_SPEC_TYPE ON JOB_SPECS.SPEC_TYPE_CODE = JOB_SPEC_TYPE.SPEC_TYPE_CODE
    INNER JOIN JOB_SPEC_CATEGORY ON JOB_SPECS.SPEC_TYPE_CODE = JOB_SPEC_CATEGORY.SPEC_TYPE_CODE
						  AND JOB_SPEC_FIELDS.CATEGORY_ID = JOB_SPEC_CATEGORY.CATEGORY_ID

WHERE JOB_SPECS.JOB_NUMBER = @JOB_NUMBER 
	AND JOB_SPECS.JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR
	AND JOB_SPECS.SPEC_VER = @SPEC_VER
	AND JOB_SPECS.SPEC_REV = @SPEC_REV
	AND JOB_SPEC_FIELDS.INACTIVE_FLAG = 0

GROUP BY JOB_SPECS.SPEC_VER, JOB_SPEC_FIELDS.FIELD_NAME, JOB_SPEC_FIELDS.FIELD_DESC, JOB_SPEC_FIELDS.CATEGORY_ID,
	 JOB_SPEC_FIELDS.FIELD_SEQ, JOB_SPEC_FIELDS.REQUIRED, JOB_SPEC_FIELDS.FIELD_NAME, JOB_SPEC_FIELDS.FIELD_NAME, 
	 dbo.udf_get_spec_ver_desc(@JOB_NUMBER, @JOB_COMPONENT_NBR, JOB_SPECS.SPEC_VER), 
	 JOB_SPEC_CATEGORY.CATEGORY_DESC,
	 dbo.udf_get_job_spec_qty(@JOB_NUMBER, @JOB_COMPONENT_NBR, JOB_SPECS.SPEC_VER),
	 dbo.udf_get_approved_spec_version(JOB_SPECS.JOB_NUMBER, JOB_SPECS.JOB_COMPONENT_NBR),
	 JOB_SPEC_FIELDS.SEPARATOR_LINE,
	 JOB_SPEC_CATEGORY.CATEGORY_SEQ, JOB_SPECS.SPEC_REV


ORDER BY JOB_SPECS.SPEC_VER, MAX(JOB_SPECS.SPEC_REV), JOB_SPEC_CATEGORY.CATEGORY_SEQ, JOB_SPEC_FIELDS.CATEGORY_ID, JOB_SPEC_FIELDS.FIELD_SEQ


	FETCH NEXT FROM CUR
	INTO @SPEC_VER, @SPEC_REV
END

CLOSE CUR
DEALLOCATE CUR

--MAIN SELECT RETURN:
SELECT * FROM #SPECS_ALL




