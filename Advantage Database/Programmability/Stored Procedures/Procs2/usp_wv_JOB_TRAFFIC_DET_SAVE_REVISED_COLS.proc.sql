--DROP PROCEDURE [dbo].[usp_wv_JOB_TRAFFIC_DET_SAVE_REVISED_COLS]
CREATE PROCEDURE [dbo].[usp_wv_JOB_TRAFFIC_DET_SAVE_REVISED_COLS] /*WITH ENCRYPTION*/
@TYPE               SMALLINT,
@JOB_REVISED_DATE   SMALLDATETIME,
@DUE_TIME           VARCHAR(10),
@JOB_NUMBER         INT,
@JOB_COMPONENT_NBR  SMALLINT,
@SEQ_NBR            SMALLINT
AS
/*=========== QUERY ===========*/
	DECLARE @CURR_JOB_DUE_DATE  SMALLDATETIME,
			@CURR_DUE_TIME      VARCHAR(10)
	
	SELECT @CURR_JOB_DUE_DATE = JOB_DUE_DATE,
		   @CURR_DUE_TIME = DUE_TIME
	FROM   JOB_TRAFFIC_DET WITH(ROWLOCK)
	WHERE  JOB_NUMBER = @JOB_NUMBER
		   AND JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR
		   AND SEQ_NBR = @SEQ_NBR;

	
	IF @TYPE = 0 --CHECK JOB_DUE_DATE
	BEGIN
		IF @CURR_JOB_DUE_DATE IS NULL
		BEGIN
			UPDATE JOB_TRAFFIC_DET
			SET    JOB_DUE_DATE = @JOB_REVISED_DATE,
				   JOB_REVISED_DATE = @JOB_REVISED_DATE
			WHERE  JOB_NUMBER = @JOB_NUMBER
				   AND JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR
				   AND SEQ_NBR = @SEQ_NBR;
		END
	END	

	IF @TYPE = 1 --CHECK DUE_TIME
	BEGIN
		IF @CURR_DUE_TIME IS NULL
		BEGIN
			UPDATE JOB_TRAFFIC_DET
			SET    DUE_TIME = @DUE_TIME,
				   REVISED_DUE_TIME = @DUE_TIME
			WHERE  JOB_NUMBER = @JOB_NUMBER
				   AND JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR
				   AND SEQ_NBR = @SEQ_NBR;
		END
	END

/*=========== QUERY ===========*/
