

CREATE PROCEDURE [dbo].[usp_wv_Job_Template_GetJobProcessLog] 
@JOB_NUMBER AS int,
@JOB_COMPONENT_NBR AS int


AS
DECLARE @ID int, @NumberRecords int, @RowCount int, @jp int, @maxdate datetime, @maxid int
SET NOCOUNT ON

SELECT @maxid = MAX(JOB_PROCESS_LOG_ID)
FROM         JOB_PROCESS_LOG JPL LEFT OUTER JOIN JOB_PROC_CONTROLS JPC ON JPL.ORIG_PROCESS_CNTRL = JPC.JOB_PROCESS_CONTRL
WHERE     (JOB_NUMBER = @JOB_NUMBER) AND (JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR)


SELECT     JOB_PROCESS_LOG_ID, ORIG_PROCESS_CNTRL, NEW_PROCESS_CNTRL, PROCESS_DATE AS PROCESS_DATE, PROCESS_USER, JPC.JOB_PROCESS_DESC, ISNULL(PROCESS_COMMENT,'') AS PROCESS_COMMENT
FROM         JOB_PROCESS_LOG JPL LEFT OUTER JOIN JOB_PROC_CONTROLS JPC ON JPL.ORIG_PROCESS_CNTRL = JPC.JOB_PROCESS_CONTRL
WHERE     (JOB_NUMBER = @JOB_NUMBER) AND (JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR) AND JOB_PROCESS_LOG_ID = @maxid


