
CREATE PROCEDURE [dbo].[usp_wv_RESOURCES_FIND] 
	@RESOURCE_TYPE_CODE AS VARCHAR(6),
	@RANGE_START AS DATETIME,
	@RANGE_END AS DATETIME
AS


    --THIS RETURNS RESOURCES THAT ARE FULLY AVAILABLE WITHIN THE RANGE	
    SELECT     
	    RESOURCE.RESOURCE_CODE, RESOURCE_DESC, RESOURCE.RESOURCE_PRIORITY
    FROM         
	    RESOURCE WITH(NOLOCK)
    WHERE     
	    (RESOURCE_TYPE_CODE = @RESOURCE_TYPE_CODE)
	    AND RESOURCE_CODE NOT IN(
		    SELECT     
			    RESOURCE.RESOURCE_CODE
		    FROM         
			    RESOURCE WITH(NOLOCK) LEFT OUTER JOIN
			    EVENT WITH(NOLOCK) ON RESOURCE.RESOURCE_CODE = EVENT.RESOURCE_CODE
		    WHERE     
			    (RESOURCE.RESOURCE_TYPE_CODE = @RESOURCE_TYPE_CODE)
			    AND EVENT.EVENT_DATE BETWEEN @RANGE_START AND @RANGE_END
	    )	
    ORDER BY
	    RESOURCE.RESOURCE_PRIORITY;
	
	   
