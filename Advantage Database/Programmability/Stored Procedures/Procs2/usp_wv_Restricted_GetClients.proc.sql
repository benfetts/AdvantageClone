
CREATE PROCEDURE [dbo].[usp_wv_Restricted_GetClients]
@UserID VARCHAR(100), @OFFICE_CODE VARCHAR(6)
AS
DECLARE @Restricted INT

SELECT @Restricted = Count(*) FROM SEC_CLIENT WHERE UPPER(USER_ID) = UPPER(@UserID)
IF @Restricted > 0
    BEGIN
		SELECT     
			DISTINCT CLIENT.CL_CODE+' - '+ISNULL(CLIENT.CL_NAME,'') AS Text,
			CLIENT.CL_CODE AS Value,
			'CL' AS Level,
			'Client:  '+CLIENT.CL_CODE+' - '+ISNULL(CLIENT.CL_NAME,'') AS Crumb,
			CLIENT.CL_CODE AS FK,
			CLIENT.CL_CODE+' - '+ISNULL(CLIENT.CL_NAME,'') AS ToolTip,
			'Images/client.png' AS ImageURL,
			'Images/client.png' AS ImageExpandedUrl
		FROM         
			OFFICE INNER JOIN
			PRODUCT ON OFFICE.OFFICE_CODE = PRODUCT.OFFICE_CODE INNER JOIN
			DIVISION ON PRODUCT.CL_CODE = DIVISION.CL_CODE AND PRODUCT.DIV_CODE = DIVISION.DIV_CODE INNER JOIN
			CLIENT ON DIVISION.CL_CODE = CLIENT.CL_CODE INNER JOIN
			SEC_CLIENT ON PRODUCT.CL_CODE = SEC_CLIENT.CL_CODE AND PRODUCT.DIV_CODE = SEC_CLIENT.DIV_CODE AND 
			PRODUCT.PRD_CODE = SEC_CLIENT.PRD_CODE
		WHERE     
			(OFFICE.OFFICE_CODE = @OFFICE_CODE) 
			AND (UPPER(SEC_CLIENT.USER_ID) = UPPER(@UserID)) AND (SEC_CLIENT.TIME_ENTRY = 0 OR SEC_CLIENT.TIME_ENTRY IS NULL)
    END
ELSE
    BEGIN
		SELECT     
			DISTINCT CLIENT.CL_CODE+' - '+ISNULL(CLIENT.CL_NAME,'') AS Text,
			CLIENT.CL_CODE AS Value,
			'CL' AS Level,
			'Client:  '+CLIENT.CL_CODE+' - '+ISNULL(CLIENT.CL_NAME,'') AS Crumb,
			CLIENT.CL_CODE AS FK,
			CLIENT.CL_CODE+' - '+ISNULL(CLIENT.CL_NAME,'') AS ToolTip,
			'Images/client.png' AS ImageURL,
			'Images/client.png' AS ImageExpandedUrl
		FROM         
			OFFICE INNER JOIN
			PRODUCT ON OFFICE.OFFICE_CODE = PRODUCT.OFFICE_CODE INNER JOIN
			DIVISION ON PRODUCT.CL_CODE = DIVISION.CL_CODE AND PRODUCT.DIV_CODE = DIVISION.DIV_CODE INNER JOIN
			CLIENT ON DIVISION.CL_CODE = CLIENT.CL_CODE
		WHERE
			OFFICE.OFFICE_CODE = @OFFICE_CODE
	END

