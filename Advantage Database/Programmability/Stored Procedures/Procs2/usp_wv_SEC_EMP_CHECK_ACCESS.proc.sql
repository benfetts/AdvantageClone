--DROP PROCEDURE [dbo].[usp_wv_SEC_EMP_CHECK_ACCESS]
CREATE PROCEDURE [dbo].[usp_wv_SEC_EMP_CHECK_ACCESS] /*WITH ENCRYPTION*/
@USER_ID  VARCHAR(100),
@EMP_CODE VARCHAR(6)
AS
BEGIN
	DECLARE 
		@RESTRICTED INT, 
		@HAS_ACCESS_TO_EMPLOYEE TINYINT,
		@USER_EMP_CODE VARCHAR(6)
	
	SET @HAS_ACCESS_TO_EMPLOYEE = 0;
	
	SELECT @RESTRICTED = COUNT(1) FROM SEC_EMP WITH(NOLOCK) WHERE  UPPER(SEC_EMP.[USER_ID]) = UPPER(@USER_ID);

	SET @RESTRICTED = ISNULL(@RESTRICTED, 0);

	IF @RESTRICTED = 0
	BEGIN
		SET @HAS_ACCESS_TO_EMPLOYEE = 1;
	END
	ELSE
	BEGIN
		SELECT @USER_EMP_CODE = EMP_CODE FROM [dbo].[SEC_USER] WHERE UPPER([USER_CODE]) = UPPER(@USER_ID);
		IF @USER_EMP_CODE = @EMP_CODE
		BEGIN
			SET @HAS_ACCESS_TO_EMPLOYEE = 1;
		END
		ELSE
		BEGIN
			IF EXISTS (SELECT * FROM SEC_EMP WITH(NOLOCK) WHERE  UPPER(SEC_EMP.[USER_ID]) = UPPER(@USER_ID) AND SEC_EMP.EMP_CODE = @EMP_CODE )
			BEGIN
				SET @HAS_ACCESS_TO_EMPLOYEE = 1;
			END
		END

	END

	SELECT ISNULL(@HAS_ACCESS_TO_EMPLOYEE, 0);

END

