SET QUOTED_IDENTIFIER ON 
GO
SET ANSI_NULLS OFF 
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'[dbo].[usp_wv_SaveClientPortalBranding]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
DROP PROCEDURE [dbo].[usp_wv_SaveClientPortalBranding]
GO
CREATE PROCEDURE [dbo].[usp_wv_SaveClientPortalBranding] /*WITH ENCRYPTION*/
@CL_CODE VARCHAR(6),
@WV_BRND_ENABLE BIT,
@WV_BRND_BG_TYPE TINYINT,
@WV_BRND_BG VARCHAR(500),
@WV_BRND_BGCLR VARCHAR(50),
@WV_BRND_CLK_APP BIT,
@WV_BRND_CLK_USR BIT,
@WV_BRND_FLT_DTO BIT,
@WV_BRND_ICON VARCHAR(500),
@WV_BRND_LOGO VARCHAR(500),
@WV_BRND_SHRT_MNU BIT,
@WV_BRND_USR_BG BIT,
@WV_BRND_USR_THM BIT,
@WV_BRND_THEME VARCHAR(50),
@WV_BRND_WKSPCLR VARCHAR(50),
@WV_BRND_SBCLR VARCHAR(50),
@WV_BRND_ICON_STYLE TINYINT
AS
/*=========== QUERY ===========*/
DECLARE
	@CP_THEME_ID INT

IF (@CL_CODE IS NULL OR @CL_CODE = '') --LOOK FOR THE DEFAULT CP THEME
BEGIN

	SET @CP_THEME_ID = (SELECT TOP 1 CP_THEME_ID 
						FROM CP_THEME_SETTINGS WITH(NOLOCK) 
						WHERE CL_CODE IS NULL);

END
ELSE
BEGIN

	SET @CP_THEME_ID = (SELECT TOP 1 CP_THEME_ID 
						FROM CP_THEME_SETTINGS WITH(NOLOCK) 
						WHERE CL_CODE = @CL_CODE);

END
  
IF NOT @CP_THEME_ID IS NULL
BEGIN

	UPDATE CP_THEME_SETTINGS WITH(ROWLOCK)
	SET 
		[WV_BRND_ENABLE] = @WV_BRND_ENABLE
		,[WV_BRND_BG_TYPE] = @WV_BRND_BG_TYPE
		,[WV_BRND_BG] = @WV_BRND_BG
		,[WV_BRND_BGCLR] = @WV_BRND_BGCLR
		,[WV_BRND_CLK_APP] = @WV_BRND_CLK_APP
		,[WV_BRND_CLK_USR]= @WV_BRND_CLK_USR
		,[WV_BRND_FLT_DTO] = @WV_BRND_FLT_DTO
		,[WV_BRND_ICON] = @WV_BRND_ICON
		--,[WV_BRND_LOGO] = @WV_BRND_LOGO
		,[WV_BRND_SHRT_MNU] = @WV_BRND_SHRT_MNU
		,[WV_BRND_USR_BG] = @WV_BRND_USR_BG
		,[WV_BRND_USR_THM]  = @WV_BRND_USR_THM
		,[WV_BRND_THEME] = @WV_BRND_THEME
		,[WV_BRND_WKSPCLR] = @WV_BRND_WKSPCLR
		,[WV_BRND_SBCLR] = @WV_BRND_SBCLR
		,[WV_BRND_ICON_STYLE] = @WV_BRND_ICON_STYLE
	WHERE
		CP_THEME_ID = @CP_THEME_ID;

END
ELSE
BEGIN

	INSERT INTO CP_THEME_SETTINGS ( 
		[CL_CODE]
		,[WV_BRND_ENABLE]
		,[WV_BRND_BG_TYPE]
		,[WV_BRND_BG]
		,[WV_BRND_BGCLR]
		,[WV_BRND_CLK_APP]
		,[WV_BRND_CLK_USR]
		,[WV_BRND_FLT_DTO]
		,[WV_BRND_ICON]
		--,[WV_BRND_LOGO]
		,[WV_BRND_SHRT_MNU]
		,[WV_BRND_USR_BG]
		,[WV_BRND_USR_THM]
		,[WV_BRND_THEME]
		,[WV_BRND_WKSPCLR]
		,[WV_BRND_SBCLR]
		,[WV_BRND_ICON_STYLE]
	) VALUES (
		@CL_CODE
		,@WV_BRND_ENABLE
		,@WV_BRND_BG_TYPE
		,@WV_BRND_BG
		,@WV_BRND_BGCLR
		,@WV_BRND_CLK_APP
		,@WV_BRND_CLK_USR
		,@WV_BRND_FLT_DTO
		,@WV_BRND_ICON
		--,@WV_BRND_LOGO
		,@WV_BRND_SHRT_MNU
		,@WV_BRND_USR_BG
		,@WV_BRND_USR_THM
		,@WV_BRND_THEME
		,@WV_BRND_WKSPCLR
		,@WV_BRND_SBCLR
		,@WV_BRND_ICON_STYLE
	);

END
/*=========== QUERY ===========*/
GO
SET QUOTED_IDENTIFIER ON 
GO
SET ANSI_NULLS ON 
GO