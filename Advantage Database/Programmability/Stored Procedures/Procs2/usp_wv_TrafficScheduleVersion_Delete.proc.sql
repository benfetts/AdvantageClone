if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[usp_wv_TrafficScheduleVersion_Delete]') and OBJECTPROPERTY(id, N'IsProcedure') = 1)
drop procedure [dbo].[usp_wv_TrafficScheduleVersion_Delete]
GO

CREATE PROCEDURE [dbo].[usp_wv_TrafficScheduleVersion_Delete] /*WITH ENCRYPTION*/
@VERSION_ID INT
AS
/*=========== QUERY ===========*/

	DELETE FROM JOB_TRAFFIC_VER_DET_PREDS WITH(ROWLOCK) 
	WHERE DETAIL_ID IN 
					(SELECT DISTINCT ID 
					 FROM JOB_TRAFFIC_VER_DET WITH(NOLOCK) 
					 WHERE VERSION_ID = @VERSION_ID);

	DELETE FROM JOB_TRAFFIC_VER_DET_DOCS WITH(ROWLOCK) 
	WHERE DETAIL_ID IN 
					(SELECT DISTINCT ID 
					 FROM JOB_TRAFFIC_VER_DET WITH(NOLOCK) 
					 WHERE VERSION_ID = @VERSION_ID);

	DELETE FROM JOB_TRAFFIC_VER_DET_CNTS WITH(ROWLOCK) 
	WHERE DETAIL_ID IN 
					(SELECT DISTINCT ID 
					 FROM JOB_TRAFFIC_VER_DET WITH(NOLOCK) 
					 WHERE VERSION_ID = @VERSION_ID);

	DELETE FROM JOB_TRAFFIC_VER_DET_EMPS WITH(ROWLOCK) 
	WHERE DETAIL_ID IN 
					(SELECT DISTINCT ID 
					 FROM JOB_TRAFFIC_VER_DET WITH(NOLOCK) 
					 WHERE VERSION_ID = @VERSION_ID);

	DELETE FROM JOB_TRAFFIC_VER_DET WITH(ROWLOCK) 
	WHERE VERSION_ID = @VERSION_ID;

	DELETE FROM JOB_TRAFFIC_VER_LOG WITH(ROWLOCK) 
	WHERE VERSION_ID = @VERSION_ID;

	DELETE FROM JOB_TRAFFIC_VER_PREDS WITH(ROWLOCK) 
	WHERE VERSION_ID = @VERSION_ID;

	DELETE FROM JOB_TRAFFIC_VER WITH(ROWLOCK) 
	WHERE ID = @VERSION_ID;

/*=========== QUERY ===========*/
GO
SET QUOTED_IDENTIFIER ON 
GO
SET ANSI_NULLS ON 
GO