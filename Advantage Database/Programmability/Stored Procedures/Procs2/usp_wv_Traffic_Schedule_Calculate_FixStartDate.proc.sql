

CREATE PROCEDURE [dbo].[usp_wv_Traffic_Schedule_Calculate_FixStartDate] 
@JOB_NUMBER INT,
@JOB_COMPONENT_NBR SMALLINT
AS

DECLARE @MIN_START_DATE AS SMALLDATETIME
DECLARE @CURR_START_DATE AS SMALLDATETIME

SELECT @MIN_START_DATE = MIN(TASK_START_DATE) 
FROM JOB_TRAFFIC_DET WITH(NOLOCK)
WHERE JOB_NUMBER = @JOB_NUMBER AND JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR;

SELECT @CURR_START_DATE = START_DATE 
FROM JOB_COMPONENT WITH(NOLOCK)
WHERE JOB_NUMBER = @JOB_NUMBER AND JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR;

--SELECT @MIN_START_DATE
--SELECT @CURR_START_DATE

IF (@MIN_START_DATE <> @CURR_START_DATE) OR (@CURR_START_DATE IS NULL)
	BEGIN
		UPDATE JOB_COMPONENT WITH(ROWLOCK) SET START_DATE = @MIN_START_DATE
		WHERE JOB_NUMBER = @JOB_NUMBER AND JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR;
	END


