
CREATE PROCEDURE [dbo].[usp_wv_Traffic_Schedule_Calendar] 
@JOB_NUMBER AS INT,
@JOB_COMPONENT_NBR AS SMALLINT,
@Milestone int,
@Completed AS INT
AS

if @Milestone = 1
Begin
	IF @Completed = 0
	BEGIN
		SELECT JOB_NUMBER, JOB_COMPONENT_NBR, TASK_DESCRIPTION, TASK_START_DATE, JOB_REVISED_DATE
		FROM dbo.JOB_TRAFFIC_DET
		WHERE JOB_NUMBER = @JOB_NUMBER
		 AND JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR AND (JOB_TRAFFIC_DET.MILESTONE = 1) AND (JOB_TRAFFIC_DET.TASK_START_DATE IS NOT NULL OR JOB_TRAFFIC_DET.JOB_REVISED_DATE IS NOT NULL) AND (JOB_TRAFFIC_DET.JOB_COMPLETED_DATE IS NULL)
		ORDER BY TASK_START_DATE
	END
	ELSE	
	BEGIN
		SELECT JOB_NUMBER, JOB_COMPONENT_NBR, TASK_DESCRIPTION, TASK_START_DATE, JOB_REVISED_DATE
		FROM dbo.JOB_TRAFFIC_DET
		WHERE JOB_NUMBER = @JOB_NUMBER
		 AND JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR AND (JOB_TRAFFIC_DET.MILESTONE = 1) AND (JOB_TRAFFIC_DET.TASK_START_DATE IS NOT NULL OR JOB_TRAFFIC_DET.JOB_REVISED_DATE IS NOT NULL)
		ORDER BY TASK_START_DATE
	END	
End
Else
Begin
	IF @Completed = 0
	BEGIN
		SELECT JOB_NUMBER, JOB_COMPONENT_NBR, TASK_DESCRIPTION, TASK_START_DATE, JOB_REVISED_DATE
		FROM dbo.JOB_TRAFFIC_DET
		WHERE JOB_NUMBER = @JOB_NUMBER
		 AND JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR AND (JOB_TRAFFIC_DET.TASK_START_DATE IS NOT NULL OR JOB_TRAFFIC_DET.JOB_REVISED_DATE IS NOT NULL) AND (JOB_TRAFFIC_DET.JOB_COMPLETED_DATE IS NULL)
		ORDER BY TASK_START_DATE
	END
	ELSE
	BEGIN
		SELECT JOB_NUMBER, JOB_COMPONENT_NBR, TASK_DESCRIPTION, TASK_START_DATE, JOB_REVISED_DATE
		FROM dbo.JOB_TRAFFIC_DET
		WHERE JOB_NUMBER = @JOB_NUMBER
		 AND JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR AND (JOB_TRAFFIC_DET.TASK_START_DATE IS NOT NULL OR JOB_TRAFFIC_DET.JOB_REVISED_DATE IS NOT NULL)
		ORDER BY TASK_START_DATE
	END
	
End


