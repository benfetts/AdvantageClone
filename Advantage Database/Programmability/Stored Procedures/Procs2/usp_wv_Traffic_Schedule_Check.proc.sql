
CREATE PROCEDURE [dbo].[usp_wv_Traffic_Schedule_Check] 
@JOB_NUMBER INT,
@JOB_COMPONENT_NBR SMALLINT

AS
DECLARE
@RETURN_VALUE SMALLINT,
@REC_COUNTER SMALLINT

-- DEFAULT VALUE, NO PROBLEMS
SET @RETURN_VALUE = 0
-- NO SCHEDULE
SELECT @REC_COUNTER = ISNULL(COUNT(1),0) FROM JOB_TRAFFIC WHERE JOB_NUMBER =  @JOB_NUMBER AND JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR
IF @REC_COUNTER = 0
	BEGIN
		SET @RETURN_VALUE = -1
	END
-- SCHEDULE CLOSED
SELECT @REC_COUNTER = ISNULL(COUNT(1),0) FROM JOB_TRAFFIC WHERE JOB_NUMBER =  @JOB_NUMBER AND JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR AND (NOT (COMPLETED_DATE IS NULL))
IF @REC_COUNTER > 0
	BEGIN
		SET @RETURN_VALUE = -2
	END
-- RETURN:
SELECT @RETURN_VALUE



