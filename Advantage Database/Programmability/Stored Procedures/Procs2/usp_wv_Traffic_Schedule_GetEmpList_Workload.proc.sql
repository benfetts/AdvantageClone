
CREATE PROCEDURE [dbo].[usp_wv_Traffic_Schedule_GetEmpList_Workload] 
	@JOB_COMP_LIST VARCHAR(4000)
--pass in a string in the format of: jobnumber,jobcompnumber|jobnumber,jobcompnumber|jobnumber,jobcompnumber
AS

			DECLARE
				@POS INT,
				@POS2 INT,
				@JOB_AND_COMP VARCHAR(100),
				@JOB_NUMBER VARCHAR(100),
				@JOB_COMPONENT_NBR VARCHAR(100),
				@SQL_SELECT VARCHAR(80),
				@SQL_WHERE VARCHAR(4000)	

			SET @SQL_SELECT = 'SELECT DISTINCT EMP_CODE FROM JOB_TRAFFIC_DET_EMPS WITH(NOLOCK) '
			SET @SQL_WHERE = ''
			SET @JOB_NUMBER = ''
			SET @JOB_COMPONENT_NBR = ''

			SET @JOB_COMP_LIST = LTRIM(RTRIM(@JOB_COMP_LIST)) + '|'
			SET @POS = CHARINDEX('|',@JOB_COMP_LIST,1)

			IF REPLACE(@JOB_COMP_LIST,'|','') <> ''
			BEGIN
				WHILE @POS > 0
					BEGIN
						SET @JOB_AND_COMP = LTRIM(RTRIM(LEFT(@JOB_COMP_LIST, @POS - 1)))
						IF @JOB_AND_COMP <> ''
							BEGIN
								SET @POS2 = CHARINDEX(',',@JOB_AND_COMP,1)
								SET @JOB_NUMBER = LTRIM(RTRIM(LEFT(@JOB_AND_COMP, @POS2 - 1)))
								SET @JOB_COMPONENT_NBR = RIGHT(@JOB_AND_COMP,LEN(@JOB_AND_COMP) - @POS2)
								SET @SQL_WHERE = @SQL_WHERE + '((JOB_NUMBER = '+ @JOB_NUMBER +') AND (JOB_COMPONENT_NBR = '+ @JOB_COMPONENT_NBR +')) OR '
							END
						SET @JOB_COMP_LIST = RIGHT(@JOB_COMP_LIST,LEN(@JOB_COMP_LIST) - @POS);
						SET @POS = CHARINDEX('|',@JOB_COMP_LIST,1);
					END
			END

			SET @SQL_WHERE = RTRIM(LTRIM(@SQL_WHERE))
			DECLARE @LEN AS INTEGER

			SET @LEN = LEN(@SQL_WHERE)

			IF @LEN > 0
			BEGIN
				SET @SQL_SELECT = @SQL_SELECT + 'WHERE
				'
				SET @SQL_WHERE = LEFT(@SQL_WHERE, @LEN - 2)
			END

			EXEC (@SQL_SELECT + @SQL_WHERE)
			
