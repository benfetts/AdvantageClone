
CREATE PROCEDURE [dbo].[usp_wv_Traffic_Schedule_NotifyGetDefaultGroup]
@JOB_NUMBER INT,
@JOB_COMPONENT_NBR SMALLINT,
@EMAIL_GR_CODE VARCHAR(50),
@GET_SCHEDULE_EMPLOYEES SMALLINT


AS
--default for the job/comp (all in an email group)
IF @JOB_COMPONENT_NBR > 0 AND @JOB_NUMBER > 0 AND @GET_SCHEDULE_EMPLOYEES <> 1
BEGIN
	SELECT     JOB_COMPONENT.EMAIL_GR_CODE, EMAIL_GROUP.EMP_CODE, 
	                      EMPLOYEE.EMP_EMAIL
	FROM         EMPLOYEE INNER JOIN
	                      EMAIL_GROUP ON EMPLOYEE.EMP_CODE = EMAIL_GROUP.EMP_CODE RIGHT OUTER JOIN
	                      JOB_COMPONENT ON EMAIL_GROUP.EMAIL_GR_CODE = JOB_COMPONENT.EMAIL_GR_CODE
	WHERE     (JOB_COMPONENT.JOB_NUMBER = @JOB_NUMBER) AND (JOB_COMPONENT.JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR)
END

--else get based on email_gr_code
IF @JOB_COMPONENT_NBR = 0 AND @JOB_NUMBER = 0 AND @EMAIL_GR_CODE <> ''
BEGIN
	SELECT     EMAIL_GROUP.EMAIL_GR_CODE, EMAIL_GROUP.EMP_CODE, EMPLOYEE.EMP_EMAIL
	FROM         EMAIL_GROUP LEFT OUTER JOIN
	              EMPLOYEE ON EMAIL_GROUP.EMP_CODE = EMPLOYEE.EMP_CODE
	WHERE     (EMAIL_GROUP.EMAIL_GR_CODE = @EMAIL_GR_CODE)
END


--else get based on emps on the *sched*:
IF @JOB_COMPONENT_NBR > 0 AND @JOB_NUMBER > 0 AND @GET_SCHEDULE_EMPLOYEES = 1
BEGIN
	    SELECT DISTINCT JOB_TRAFFIC_DET_EMPS.EMP_CODE, EMPLOYEE.EMP_EMAIL
	    FROM         JOB_TRAFFIC_DET_EMPS INNER JOIN
	                          EMPLOYEE ON JOB_TRAFFIC_DET_EMPS.EMP_CODE = EMPLOYEE.EMP_CODE
	    WHERE     (JOB_TRAFFIC_DET_EMPS.JOB_NUMBER = @JOB_NUMBER) AND (JOB_TRAFFIC_DET_EMPS.JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR)
--    UNION
--	    SELECT 
--		       JOB_COMPONENT.EMP_CODE AS EMPCODE,
--		       EMPLOYEE.EMP_EMAIL
--	    FROM   JOB_COMPONENT WITH(NOLOCK)
--		       INNER JOIN EMPLOYEE WITH(NOLOCK)
--				    ON  JOB_COMPONENT.EMP_CODE = EMPLOYEE.EMP_CODE
--	    WHERE  (JOB_COMPONENT.JOB_NUMBER = @JOB_NUMBER)
--		       AND (JOB_COMPONENT.JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR)
END

