SET QUOTED_IDENTIFIER ON 
GO
SET ANSI_NULLS OFF 
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'[dbo].[usp_wv_Traffic_Schedule_UpdateManager]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
DROP PROCEDURE [dbo].[usp_wv_Traffic_Schedule_UpdateManager]
GO
CREATE PROCEDURE [dbo].[usp_wv_Traffic_Schedule_UpdateManager] /*WITH ENCRYPTION*/
@JOB_NUMBER INT,
@JOB_COMPONENT_NBR SMALLINT,
@TRAFFIC_MGR_CODE VARCHAR(6)
AS
/*=========== QUERY ===========*/
	DECLARE
		@TRAFFIC_MGR_COL VARCHAR(20)
	
	--GET MANAGER COLUMN
	SELECT @TRAFFIC_MGR_COL = CAST(AGY_SETTINGS_VALUE AS varchar(20))
	FROM AGY_SETTINGS WITH(NOLOCK) 
	WHERE AGY_SETTINGS.AGY_SETTINGS_CODE = 'TRAFFIC_MGR_COL';

	SET @TRAFFIC_MGR_COL = ISNULL(@TRAFFIC_MGR_COL, '');
	
	IF @TRAFFIC_MGR_COL = 'TR_TITLE1'
	BEGIN
	
		UPDATE JOB_TRAFFIC WITH(ROWLOCK) SET JOB_TRAFFIC.ASSIGN_1 = @TRAFFIC_MGR_CODE
		WHERE JOB_TRAFFIC.JOB_NUMBER = @JOB_NUMBER AND JOB_TRAFFIC.JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR;
	
	END	
	IF @TRAFFIC_MGR_COL = 'TR_TITLE2'
	BEGIN
	
		UPDATE JOB_TRAFFIC WITH(ROWLOCK) SET JOB_TRAFFIC.ASSIGN_2 = @TRAFFIC_MGR_CODE
		WHERE JOB_TRAFFIC.JOB_NUMBER = @JOB_NUMBER AND JOB_TRAFFIC.JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR;
	
	END	
	IF @TRAFFIC_MGR_COL = 'TR_TITLE3'
	BEGIN
	
		UPDATE JOB_TRAFFIC WITH(ROWLOCK) SET JOB_TRAFFIC.ASSIGN_3 = @TRAFFIC_MGR_CODE
		WHERE JOB_TRAFFIC.JOB_NUMBER = @JOB_NUMBER AND JOB_TRAFFIC.JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR;
	
	END	
	IF @TRAFFIC_MGR_COL = 'TR_TITLE4'
	BEGIN
	
		UPDATE JOB_TRAFFIC WITH(ROWLOCK) SET JOB_TRAFFIC.ASSIGN_4 = @TRAFFIC_MGR_CODE
		WHERE JOB_TRAFFIC.JOB_NUMBER = @JOB_NUMBER AND JOB_TRAFFIC.JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR;
	
	END	
	IF @TRAFFIC_MGR_COL = 'TR_TITLE5'
	BEGIN
	
		UPDATE JOB_TRAFFIC WITH(ROWLOCK) SET JOB_TRAFFIC.ASSIGN_5 = @TRAFFIC_MGR_CODE
		WHERE JOB_TRAFFIC.JOB_NUMBER = @JOB_NUMBER AND JOB_TRAFFIC.JOB_COMPONENT_NBR = @JOB_COMPONENT_NBR;
	
	END	
/*=========== QUERY ===========*/
GO
SET QUOTED_IDENTIFIER ON 
GO
SET ANSI_NULLS ON 
GO