

























CREATE PROCEDURE [dbo].[usp_wv_dto_GetMyProject_DrillDown_Header] 
@EmpCode as VarChar(6),
@JobNo Int, 
@JobComp Int
AS

Set NoCount On
 
SELECT TOP 1 '(' + JOB_LOG.CL_CODE + ') ' + CLIENT.CL_NAME as CLIENT,
       '(' + JOB_LOG.DIV_CODE + ') ' + DIVISION.DIV_NAME as DIVISION,
       '(' + JOB_LOG.PRD_CODE + ') ' + PRODUCT.PRD_DESCRIPTION as PRODUCT,
       '(' + Cast(JOB_LOG.JOB_NUMBER as VarChar(10)) + ') ' + JOB_LOG.JOB_DESC as Job,
       '(' + Cast(JOB_COMPONENT.JOB_COMPONENT_NBR as VarChar(10)) + ') ' + JOB_COMPONENT.JOB_COMP_DESC as JobComp,
       JOB_COMPONENT.START_DATE as JobStartDate, 
       JOB_COMPONENT.JOB_FIRST_USE_DATE as JobDueDate, 
       '(' + isnull(TRAFFIC.TRF_CODE, '') + ') ' + isnull(TRAFFIC.TRF_DESCRIPTION, '') as TrafficStatus, 
       JOB_TRAFFIC.TRF_COMMENTS as TrafficComments,
       EMPLOYEE.EMP_FNAME + ' ' + EMPLOYEE.EMP_LNAME  AS AE
FROM   JOB_TRAFFIC_DET 
	INNER JOIN JOB_TRAFFIC 
		ON JOB_TRAFFIC_DET.JOB_NUMBER = JOB_TRAFFIC.JOB_NUMBER 
		AND JOB_TRAFFIC_DET.JOB_COMPONENT_NBR = JOB_TRAFFIC.JOB_COMPONENT_NBR 
	INNER JOIN JOB_LOG 
		ON JOB_TRAFFIC.JOB_NUMBER = JOB_LOG.JOB_NUMBER 
	INNER JOIN JOB_COMPONENT 
		ON JOB_TRAFFIC.JOB_NUMBER = JOB_COMPONENT.JOB_NUMBER 
		AND JOB_TRAFFIC.JOB_COMPONENT_NBR = JOB_COMPONENT.JOB_COMPONENT_NBR 
	INNER JOIN TRAFFIC 
		ON JOB_TRAFFIC.TRF_CODE = TRAFFIC.TRF_CODE 
	LEFT OUTER JOIN EMPLOYEE 
		ON JOB_TRAFFIC_DET.EMP_CODE = EMPLOYEE.EMP_CODE 
	INNER JOIN CLIENT 
		ON JOB_LOG.CL_CODE = CLIENT.CL_CODE 
	INNER JOIN DIVISION 
		ON JOB_LOG.DIV_CODE = DIVISION.DIV_CODE 
		AND JOB_LOG.CL_CODE = DIVISION.CL_CODE 
	INNER JOIN PRODUCT 
		ON JOB_LOG.CL_CODE = PRODUCT.CL_CODE 
		AND JOB_LOG.DIV_CODE = PRODUCT.DIV_CODE 
		AND JOB_LOG.PRD_CODE = PRODUCT.PRD_CODE
WHERE  ((NOT (JOB_COMPONENT.JOB_PROCESS_CONTRL IN (6, 12)))
       AND (JOB_TRAFFIC_DET.JOB_COMPLETED_DATE IS NULL))
      -- AND JOB_TRAFFIC_DET.EMP_CODE = @EmpCode
       AND JOB_LOG.JOB_NUMBER = @JobNo
       AND JOB_COMPONENT.JOB_COMPONENT_NBR = @JobComp


















