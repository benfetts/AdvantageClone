--DROP PROCEDURE [dbo].[usp_wv_employee_get_alert_email_flag]
CREATE PROCEDURE [dbo].[usp_wv_employee_get_alert_email_flag] 
@EmpCode AS VARCHAR(6)
AS

DECLARE
	@RETURN SMALLINT

SET @RETURN = 0;	
	
SELECT @RETURN = ISNULL(ALERT_EMAIL,0) 
FROM EMPLOYEE WITH(NOLOCK)
WHERE EMP_CODE = @EmpCode;

IF @RETURN <> 0
BEGIN
	IF EXISTS (SELECT EMP_CODE 
			   FROM EMPLOYEE WITH(NOLOCK) 
			   WHERE (NOT EMP_TERM_DATE IS NULL) AND EMP_TERM_DATE <= GETDATE() AND EMP_CODE = @EmpCode)
	BEGIN
		SET @RETURN = 0;
	END
END

SELECT ISNULL(@RETURN, 0) AS ALERT_EMAIL;