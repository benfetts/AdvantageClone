
CREATE PROCEDURE usp_wv_get_inv_dtl 
	@emp_code 	varchar(6),
	@inv_nbr	integer
AS

SET NOCOUNT ON


SELECT
	APID = APH.AP_ID, 
    APCHKNBR = AP_CHK_NBR, 
    APCHKDATE = AP_CHK_DATE, 
    CHKAMT = SUM(APH.AP_CHK_AMT)
FROM AP_PMT_HIST APH
WHERE APH.AP_ID = ( SELECT DISTINCT AH.AP_ID 
	FROM AP_HEADER AH, EXPENSE_HEADER EH
	WHERE AH.VN_FRL_EMP_CODE = EH.VN_CODE
	AND AH.AP_INV_VCHR = cast(EH.INV_NBR AS varchar(20))
	AND EH.EMP_CODE = @emp_code
	AND EH.INV_NBR = @inv_nbr
)
GROUP BY APH.AP_ID, AP_CHK_NBR, AP_CHK_DATE
HAVING SUM(APH.AP_CHK_AMT) > 0



SET QUOTED_IDENTIFIER ON 
