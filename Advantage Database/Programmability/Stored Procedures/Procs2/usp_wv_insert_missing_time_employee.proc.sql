
CREATE PROCEDURE [dbo].[usp_wv_insert_missing_time_employee] 
@EMP_CODE		VARCHAR(6),
@WORK_DATE		SmallDateTime,
@HOURS_WORKED	Decimal(4,2)
AS

DECLARE @WK_TIME AS INT
DECLARE @SUPERVISOR_CODE AS VARCHAR(6), @StdHours decimal(9,3)

SELECT @SUPERVISOR_CODE = SUPERVISOR_CODE FROM EMPLOYEE WHERE EMP_CODE = @EMP_CODE

SELECT @StdHours = CASE WHEN DATENAME(WEEKDAY, @WORK_DATE) = 'Sunday' THEN ISNULL(SUN_HRS,0) 
						WHEN DATENAME(WEEKDAY, @WORK_DATE) = 'Monday' THEN ISNULL(MON_HRS,0)
						WHEN DATENAME(WEEKDAY, @WORK_DATE) = 'Tuesday' THEN ISNULL(TUE_HRS,0)
						WHEN DATENAME(WEEKDAY, @WORK_DATE) = 'Wednesday' THEN ISNULL(WED_HRS,0)
						WHEN DATENAME(WEEKDAY, @WORK_DATE) = 'Thursday' THEN ISNULL(THU_HRS,0)
						WHEN DATENAME(WEEKDAY, @WORK_DATE) = 'Friday' THEN ISNULL(FRI_HRS,0)
						WHEN DATENAME(WEEKDAY, @WORK_DATE) = 'Saturday' THEN ISNULL(SAT_HRS,0) ELSE 0 END
FROM EMPLOYEE WHERE EMP_CODE = @EMP_CODE

SELECT @WK_TIME = ISNULL(WEEKLY_TIME,2) FROM EMPLOYEE WHERE EMP_CODE = @EMP_CODE

IF @WK_TIME = 2
	SELECT @WK_TIME = ISNULL(WEEKLY_TIME,0) FROM AGENCY

IF @WK_TIME = 0	--Daily
  BEGIN
	 INSERT INTO [MISSING_TIME_DTL]
		(
			[EMP_CODE],
			[SUPERVISOR_CODE],
			[WORKDATE],
			[DAYOFWEEK],
			[WEEKOFDATE],
			[STANDARD_HRS],
			[HOURS_WORKED],
			[VARIANCE]
		)
		VALUES
		(
			@EMP_CODE,
			@SUPERVISOR_CODE,
			@WORK_DATE,
			SUBSTRING(UPPER(DATENAME(WEEKDAY, @WORK_DATE)),1,3),
			DATEADD(wk, DATEDIFF(wk, 6, @WORK_DATE), 6),
			@StdHours,
			@HOURS_WORKED,
			@StdHours - @HOURS_WORKED
		)
  END
IF @WK_TIME = 1	--Weekly 
  BEGIN 
		INSERT INTO [MISSING_TIME_DTL]
		(
			[EMP_CODE],
			[SUPERVISOR_CODE],
			[WORKDATE],
			[DAYOFWEEK],
			[WEEKOFDATE],
			[STANDARD_HRS],
			[HOURS_WORKED],
			[VARIANCE]
		)
		VALUES
		(
			@EMP_CODE,
			@SUPERVISOR_CODE,
			@WORK_DATE,
			SUBSTRING(UPPER(DATENAME(WEEKDAY, @WORK_DATE)),1,3),
			DATEADD(wk, DATEDIFF(wk, 6, @WORK_DATE), 6),
			@StdHours,
			@HOURS_WORKED,
			@StdHours - @HOURS_WORKED
		)
  END




