





CREATE PROCEDURE [dbo].[usp_wv_job_GetTrafficSchedule]
@JobNum int,
@JobCompNum int,
@EmpCode varchar(6)
--@DueDateOnly bit,
--@MilestoneOnly bit,
--@EmployeeAssigned bit
AS


SELECT     JOB_TRAFFIC_DET.JOB_NUMBER, JOB_TRAFFIC_DET.JOB_COMPONENT_NBR, JOB_TRAFFIC_DET.FNC_CODE AS Task, 
                      JOB_TRAFFIC_DET.FNC_EST AS [Function], JOB_TRAFFIC_DET.EMP_CODE, JOB_TRAFFIC_DET.TASK_DESCRIPTION, 
                      JOB_TRAFFIC_DET.TASK_START_DATE, JOB_TRAFFIC_DET.JOB_REVISED_DATE, JOB_TRAFFIC_DET.MILESTONE, 
                      EMPLOYEE.EMP_FNAME, EMPLOYEE.EMP_MI, EMPLOYEE.EMP_LNAME, ISNULL(V_JOB_TRAFFIC_DET_EMPS.EMP_LNAME_LIST,'') AS EMP_LNAME_LIST,
                      ISNULL(JOB_TRAFFIC_DET.REVISED_DUE_TIME,'') AS REVISED_DUE_TIME, ISNULL(JOB_TRAFFIC.TRF_COMMENTS,'') AS TRF_COMMENTS
FROM         JOB_TRAFFIC_DET INNER JOIN
                      JOB_TRAFFIC ON JOB_TRAFFIC_DET.JOB_NUMBER = JOB_TRAFFIC.JOB_NUMBER AND 
                      JOB_TRAFFIC_DET.JOB_COMPONENT_NBR = JOB_TRAFFIC.JOB_COMPONENT_NBR LEFT OUTER JOIN
                      EMPLOYEE ON JOB_TRAFFIC_DET.EMP_CODE = EMPLOYEE.EMP_CODE INNER JOIN 
					  V_JOB_TRAFFIC_DET_EMPS ON JOB_TRAFFIC_DET.JOB_NUMBER = V_JOB_TRAFFIC_DET_EMPS.JOB_NUMBER AND
						JOB_TRAFFIC_DET.JOB_COMPONENT_NBR = V_JOB_TRAFFIC_DET_EMPS.JOB_COMPONENT_NBR AND JOB_TRAFFIC_DET.SEQ_NBR = V_JOB_TRAFFIC_DET_EMPS.SEQ_NBR
WHERE     (JOB_TRAFFIC_DET.JOB_NUMBER = @JobNum) AND (JOB_TRAFFIC_DET.JOB_COMPONENT_NBR = @JobCompNum)
ORDER BY JOB_TRAFFIC_DET.JOB_ORDER, JOB_TRAFFIC_DET.JOB_REVISED_DATE, JOB_TRAFFIC_DET.SEQ_NBR
                                                 




