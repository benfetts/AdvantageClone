
CREATE PROCEDURE [dbo].[usp_wv_jobspecs_GetJobSpecsData] 
@JobNumber Int,
@JobCompNumber Int,
@Version Int,
@Revision Int
AS
Declare @Rescrictions Int,
		@sql nvarchar(4000),
		@sql2 nvarchar(4000),
		@paramlist nvarchar(4000)
Set NoCount On

SELECT @sql = 'SELECT JOB_SPECS.JOB_NUMBER, JOB_SPECS.JOB_COMPONENT_NBR, JOB_SPECS.SPEC_VER, JOB_SPECS.SPEC_REV, 
                      ISNULL(JOB_SPECS.SPEC_REV_REASON, 0) AS SPEC_REV_REASON, JOB_SPECS.SPEC_REV_AUTH, JOB_SPECS.SPEC_REV_USER_ID, 
                      JOB_SPECS.SPEC_REV_USER_DATE, JOB_SPECS.SPEC_TYPE_CODE, ISNULL(JOB_SPECS.SPEC_VER_DESC, 0) AS SPEC_VER_DESC, JOB_SPECS.QTY1, 
                      JOB_SPECS.QTY2, JOB_SPECS.QTY3, JOB_SPECS.QTY4, JOB_SPECS.QTY5, JOB_SPECS.CHAR1_1, 
                      JOB_SPECS.CHAR1_2, JOB_SPECS.CHAR1_3, JOB_SPECS.CHAR1_4, JOB_SPECS.CHAR1_5, JOB_SPECS.CHAR10_1, 
                      JOB_SPECS.CHAR10_2, JOB_SPECS.CHAR10_3, JOB_SPECS.CHAR10_4, JOB_SPECS.CHAR10_5, JOB_SPECS.CHAR50_1, 
                      JOB_SPECS.CHAR50_2, JOB_SPECS.CHAR50_3, JOB_SPECS.CHAR50_4, JOB_SPECS.CHAR50_5, JOB_SPECS.CHAR50_6, 
                      JOB_SPECS.CHAR50_7, JOB_SPECS.CHAR254_1, JOB_SPECS.CHAR254_2, JOB_SPECS.CHAR254_3, JOB_SPECS.CHAR254_4, 
                      JOB_SPECS.SMALLINT_1, JOB_SPECS.SMALLINT_2, JOB_SPECS.SMALLINT_3, JOB_SPECS.SMALLINT_4, 
                      JOB_SPECS.SMALLINT_5, JOB_SPECS.SMALLINT_6, JOB_SPECS.SMALLINT_7, JOB_SPECS.SMALLINT_8, JOB_SPECS.INT_1, 
                      JOB_SPECS.INT_2, JOB_SPECS.INT_3, JOB_SPECS.INT_4, JOB_SPECS.INT_5, JOB_SPECS.INT_6, JOB_SPECS.INT_7, 
                      JOB_SPECS.INT_8, JOB_SPECS.INT_9, JOB_SPECS.INT_10, JOB_SPECS.TEXT_1, JOB_SPECS.TEXT_2, 
                      JOB_SPECS.TEXT_3, JOB_SPECS.TEXT_4, JOB_SPECS.TEXT_5, JOB_SPECS.TEXT_6, JOB_SPECS.TEXT_7, 
                      JOB_SPECS.TEXT_8, JOB_SPECS.CHAR1_6, JOB_SPECS.CHAR1_7, JOB_SPECS.CHAR1_8, JOB_SPECS.CHAR1_9, 
                      JOB_SPECS.CHAR1_10, JOB_SPECS.CHAR1_11, JOB_SPECS.CHAR1_12, JOB_SPECS.CHAR1_13, JOB_SPECS.CHAR1_14, 
                      JOB_SPECS.CHAR1_15, JOB_SPECS.CHAR1_16, JOB_SPECS.CHAR1_17, JOB_SPECS.CHAR1_18, JOB_SPECS.CHAR1_19, 
                      JOB_SPECS.CHAR1_20, JOB_SPECS.CHAR10_6, JOB_SPECS.CHAR10_7, JOB_SPECS.CHAR10_8, JOB_SPECS.CHAR10_9, 
                      JOB_SPECS.CHAR10_10, JOB_SPECS.CHAR10_11, JOB_SPECS.CHAR10_12, JOB_SPECS.CHAR10_13, JOB_SPECS.CHAR10_14,
                       JOB_SPECS.CHAR10_15, JOB_SPECS.CHAR10_16, JOB_SPECS.CHAR10_17, JOB_SPECS.CHAR10_18, 
                      JOB_SPECS.CHAR10_19, JOB_SPECS.CHAR10_20, JOB_SPECS.CHAR50_8, JOB_SPECS.CHAR50_9, JOB_SPECS.CHAR50_10, 
                      JOB_SPECS.CHAR50_11, JOB_SPECS.CHAR50_12, JOB_SPECS.CHAR50_13, JOB_SPECS.CHAR50_14, JOB_SPECS.CHAR50_15,
                       JOB_SPECS.CHAR50_16, JOB_SPECS.CHAR50_17, JOB_SPECS.CHAR50_18, JOB_SPECS.CHAR50_19, 
                      JOB_SPECS.CHAR50_20, JOB_SPECS.CHAR254_5, JOB_SPECS.CHAR254_6, JOB_SPECS.CHAR254_7, JOB_SPECS.CHAR254_8,
                       JOB_SPECS.CHAR254_9, JOB_SPECS.CHAR254_10, JOB_SPECS.SMALLINT_9, JOB_SPECS.SMALLINT_10, 
                      JOB_SPECS.SMALLINT_11, JOB_SPECS.SMALLINT_12, JOB_SPECS.SMALLINT_13, JOB_SPECS.SMALLINT_14, 
                      JOB_SPECS.SMALLINT_15, JOB_SPECS.SMALLINT_16, JOB_SPECS.SMALLINT_17, JOB_SPECS.SMALLINT_18, 
                      JOB_SPECS.SMALLINT_19, JOB_SPECS.SMALLINT_20, JOB_SPECS.INT_11, JOB_SPECS.INT_12, JOB_SPECS.INT_13, 
                      JOB_SPECS.INT_14, JOB_SPECS.INT_15, JOB_SPECS.INT_16, JOB_SPECS.INT_17, JOB_SPECS.INT_18, 
                      JOB_SPECS.INT_19, JOB_SPECS.INT_20, JOB_SPECS.TEXT_9, JOB_SPECS.TEXT_10, JOB_SPECS.TEXT_11, 
                      JOB_SPECS.TEXT_12, JOB_SPECS.TEXT_13, JOB_SPECS.TEXT_14, JOB_SPECS.TEXT_15, JOB_SPECS.TEXT_16, 
                      JOB_SPECS.TEXT_17, JOB_SPECS.TEXT_18, JOB_SPECS.TEXT_19, JOB_SPECS.TEXT_20, JOB_SPEC_TYPE.USE_QTY, 
                      JOB_SPEC_TYPE.USE_VENDOR_TAB, JOB_SPEC_TYPE.INACTIVE_FLAG, JOB_SPEC_TYPE.SPEC_TYPE_DESC'
SELECT @sql2 = ' FROM  JOB_SPECS INNER JOIN
                      JOB_SPEC_TYPE ON JOB_SPECS.SPEC_TYPE_CODE = JOB_SPEC_TYPE.SPEC_TYPE_CODE
				   WHERE JOB_SPECS.JOB_NUMBER = @JobNumber AND JOB_SPECS.JOB_COMPONENT_NBR = @JobCompNumber'
			if @Version > 0 
				   SELECT @sql2 = @sql2 + ' AND (JOB_SPECS.SPEC_VER = @Version)'
			if @Revision >= 0 
				   SELECT @sql2 = @sql2 + ' AND (JOB_SPECS.SPEC_REV = @Revision)'
			
			

SELECT @paramlist = '@JobNumber Int, @JobCompNumber Int, @Version Int, @Revision Int'

EXEC('EXEC sp_executesql N''' + @sql + @sql2 + ''',
						 N''' + @paramlist + ''',
						 @JobNumber = ''' + @JobNumber + ''',
						 @JobCompNumber = ''' + @JobCompNumber + ''',
						 @Version = ''' + @Version + ''',
						 @Revision = ''' + @Revision + '''')
 

PRINT @sql

	
