--DROP  PROCEDURE [dbo].[usp_wv_update_media_attachments] 
CREATE PROCEDURE [dbo].[usp_wv_update_media_attachments] 
@Type AS Varchar(3),
@CMP_ID AS INTEGER,
@ORDER_NBR AS INTEGER
AS

DECLARE @sql AS VARCHAR(4000)
DECLARE @CMP_CODE AS VARCHAR(6)

IF @CMP_ID > 0
	SELECT @CMP_CODE = CMP_CODE FROM CAMPAIGN WHERE CMP_IDENTIFIER = @CMP_ID

IF @Type = 'INT'
	IF @CMP_ID = 0 
		UPDATE INTERNET_HEADER SET CMP_CODE = NULL, CMP_IDENTIFIER = NULL
		WHERE ORDER_NBR = @ORDER_NBR
	ELSE
		UPDATE INTERNET_HEADER SET CMP_CODE = @CMP_CODE, CMP_IDENTIFIER = @CMP_ID
		WHERE ORDER_NBR = @ORDER_NBR


If @Type = 'MAG'
	IF @CMP_ID = 0 
		UPDATE MAGAZINE_HEADER SET CMP_CODE = NULL, CMP_IDENTIFIER = NULL
		WHERE ORDER_NBR = @ORDER_NBR
	ELSE
		UPDATE MAGAZINE_HEADER SET CMP_CODE = @CMP_CODE, CMP_IDENTIFIER = @CMP_ID
		WHERE ORDER_NBR = @ORDER_NBR

		
If @Type = 'NEW'
	IF @CMP_ID = 0 
		UPDATE NEWSPAPER_HEADER SET CMP_CODE = NULL, CMP_IDENTIFIER = NULL
		WHERE ORDER_NBR = @ORDER_NBR
	ELSE
		UPDATE NEWSPAPER_HEADER SET CMP_CODE = @CMP_CODE, CMP_IDENTIFIER = @CMP_ID
		WHERE ORDER_NBR = @ORDER_NBR

		
If @Type = 'OOH'
	IF @CMP_ID = 0 
		UPDATE OUTDOOR_HEADER SET CMP_CODE = NULL, CMP_IDENTIFIER = NULL
		WHERE ORDER_NBR = @ORDER_NBR
	ELSE
		UPDATE OUTDOOR_HEADER SET CMP_CODE = @CMP_CODE, CMP_IDENTIFIER = @CMP_ID
		WHERE ORDER_NBR = @ORDER_NBR

		
If @Type = 'RAD'
	IF @CMP_ID = 0 
		UPDATE RADIO_HDR SET CMP_CODE = NULL,  CMP_IDENTIFIER = NULL
		WHERE ORDER_NBR = @ORDER_NBR
		--AND RADIO_HDR.REV_NBR = (SELECT MAX(XX2.REV_NBR) FROM RADIO_HEADER XX2 WHERE XX2.ORDER_NBR = @ORDER_NBR)
	ELSE
		UPDATE RADIO_HDR SET CMP_CODE = @CMP_CODE, CMP_IDENTIFIER = @CMP_ID
		WHERE RADIO_HDR.ORDER_NBR = @ORDER_NBR
		--AND RADIO_HEADER.REV_NBR = (SELECT MAX(XX2.REV_NBR) FROM RADIO_HEADER XX2 WHERE XX2.ORDER_NBR = @ORDER_NBR)

		
If @Type = 'TV'
	IF @CMP_ID = 0 
		UPDATE TV_HDR SET CMP_CODE = NULL, CMP_IDENTIFIER = NULL
		WHERE ORDER_NBR = @ORDER_NBR
		--AND TV_HEADER.REV_NBR = (SELECT MAX(XX2.REV_NBR) FROM TV_HEADER XX2 WHERE XX2.ORDER_NBR = @ORDER_NBR)
	ELSE
		UPDATE TV_HDR SET CMP_CODE = @CMP_CODE, CMP_IDENTIFIER = @CMP_ID
		WHERE TV_HDR.ORDER_NBR = @ORDER_NBR
		--AND TV_HEADER.REV_NBR = (SELECT MAX(XX2.REV_NBR) FROM TV_HEADER XX2 WHERE XX2.ORDER_NBR = @ORDER_NBR)

		
If @Type = 'JOB'
	IF @CMP_ID = 0 
		UPDATE JOB_LOG SET CMP_CODE = NULL, CMP_IDENTIFIER = NULL
		WHERE JOB_NUMBER = @ORDER_NBR
	ELSE
		UPDATE JOB_LOG SET CMP_CODE = @CMP_CODE, CMP_IDENTIFIER = @CMP_ID
		WHERE JOB_NUMBER = @ORDER_NBR



