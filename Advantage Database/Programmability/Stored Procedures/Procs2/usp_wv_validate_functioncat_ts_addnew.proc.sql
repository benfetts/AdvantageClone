--DROP PROCEDURE [dbo].[usp_wv_validate_functioncat_ts_addnew]
CREATE PROCEDURE [dbo].[usp_wv_validate_functioncat_ts_addnew]
@EmpCode VARCHAR(6),
@FuncCode VARCHAR(10)
AS
BEGIN
	DECLARE 
	@LIMIT_TS_FNC BIT,
	@IsValid INT, 
	@SEC_USER_ID INT

	SET @LIMIT_TS_FNC = 0;
	SELECT @SEC_USER_ID = (SELECT TOP 1 SEC_USER_ID FROM [dbo].[SEC_USER] WHERE UPPER(EMP_CODE) = UPPER(@EmpCode));
		
	IF EXISTS(SELECT * FROM [dbo].[SEC_USER_SETTING] WHERE SEC_USER_ID = @SEC_USER_ID AND SETTING_CODE = 'EMP_TS_FNC' AND STRING_VALUE = 'Y') 
	BEGIN

		SET @LIMIT_TS_FNC = 1;

	END
	IF @LIMIT_TS_FNC = 1
	BEGIN
		SELECT @IsValid = COUNT(1) 
		FROM         FUNCTIONS WITH (NOLOCK) INNER JOIN
						EMP_TS_FNC WITH (NOLOCK) ON FUNCTIONS.FNC_CODE = EMP_TS_FNC.FNC_CODE
		WHERE     ((FUNCTIONS.FNC_INACTIVE = 0) OR(FUNCTIONS.FNC_INACTIVE IS NULL)) AND  EMP_TS_FNC.FNC_CODE = @FuncCode AND EMP_TS_FNC.EMP_CODE = @EmpCode
	END
	ELSE
	BEGIN
		SELECT @IsValid = COUNT(1) FROM FUNCTIONS WITH (NOLOCK) WHERE FNC_CODE = @FuncCode AND  (FNC_INACTIVE = 0) OR  (FNC_INACTIVE IS NULL);
	END

	IF @IsValid > 0 
	BEGIN
		SELECT CAST(1 AS BIT);
	END
	ELSE
	BEGIN
		SELECT CAST(0 AS BIT);
	END
END