--PJH 03/15/13 add table AR_COOP_EST_SPLITS for Estimate COOP split calculations from Newspaper Quantities
IF EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_AR_COOP_EST_SPLITS_EST]') AND parent_object_id = OBJECT_ID(N'[dbo].[AR_COOP_EST_SPLITS]'))
	ALTER TABLE [dbo].[AR_COOP_EST_SPLITS] DROP CONSTRAINT [FK_AR_COOP_EST_SPLITS_EST]
GO

IF EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_AR_COOP_EST_SPLITS_JOB]') AND parent_object_id = OBJECT_ID(N'[dbo].[AR_COOP_EST_SPLITS]'))
	ALTER TABLE [dbo].[AR_COOP_EST_SPLITS] DROP CONSTRAINT [FK_AR_COOP_EST_SPLITS_JOB]
GO

IF EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_AR_COOP_EST_SPLITS_PROD]') AND parent_object_id = OBJECT_ID(N'[dbo].[AR_COOP_EST_SPLITS]'))
	ALTER TABLE [dbo].[AR_COOP_EST_SPLITS] DROP CONSTRAINT [FK_AR_COOP_EST_SPLITS_PROD]
GO

IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[AR_COOP_EST_SPLITS]') AND type in (N'U'))
	DROP TABLE [dbo].[AR_COOP_EST_SPLITS]
GO

SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

SET ANSI_PADDING OFF
GO

CREATE TABLE [dbo].[AR_COOP_EST_SPLITS](
	[CL_CODE]				[varchar](6) NOT NULL,
	[DIV_CODE]				[varchar](6) NOT NULL,
	[PRD_CODE]				[varchar](6) NOT NULL,
	[JOB_NUMBER]			[int] NULL,
	[JOB_COMPONENT_NBR]		[smallint] NULL,
	[ESTIMATE_NUMBER]		[int] NOT NULL,
	[EST_COMPONENT_NBR]		[smallint] NOT NULL,
	[SEQ_NBR]				[int] NOT NULL,
	[FNC_CODE]				[varchar](6) NULL,
	[CMP_IDENTIFIER]		[int] NOT NULL,
	[FOLD_FLAG]				[smallint] NULL,
	[FNC_CPM_FLAG]			[smallint] NULL,
	[EST_NONBILL_FLAG]		[smallint] NULL,
	[EST_REV_QUANTITY]		[decimal](15, 2) NULL,
	[EST_REV_EXT_AMT]		[decimal](15, 2) NULL,
	[TOT_MARKUP_AMT]		[decimal](14, 2) NULL,
	[TOT_TAX_AMT]			[decimal](15, 2) NULL,
	[LINE_TOTAL]			[decimal](15, 2) NULL,
	[TOT_CONT_AMT]			[decimal](15, 2) NULL,
	[LINE_TOTAL_CONT]		[decimal](15, 2) NULL,
	[CREATED_BY]			[varchar](100) NULL,
	[CREATE_DATE]			[smalldatetime] NULL,
 CONSTRAINT [PK_AR_COOP_EST_SPLITS] PRIMARY KEY CLUSTERED 
	( [CL_CODE] ASC, [DIV_CODE] ASC, [PRD_CODE] ASC, [ESTIMATE_NUMBER] ASC, [EST_COMPONENT_NBR] ASC, [SEQ_NBR] ASC, [CMP_IDENTIFIER] ASC ) 
		WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
)
GO

ALTER TABLE [dbo].[AR_COOP_EST_SPLITS] WITH CHECK ADD CONSTRAINT [FK_AR_COOP_EST_SPLITS_EST] 
	FOREIGN KEY( [ESTIMATE_NUMBER], [EST_COMPONENT_NBR] )
	REFERENCES [dbo].[ESTIMATE_COMPONENT] ( [ESTIMATE_NUMBER], [EST_COMPONENT_NBR] )
GO

ALTER TABLE [dbo].[AR_COOP_EST_SPLITS] CHECK CONSTRAINT [FK_AR_COOP_EST_SPLITS_EST]
GO

ALTER TABLE [dbo].[AR_COOP_EST_SPLITS] WITH CHECK ADD  CONSTRAINT [FK_AR_COOP_EST_SPLITS_JOB] 
	FOREIGN KEY( [JOB_NUMBER], [JOB_COMPONENT_NBR] )
	REFERENCES [dbo].[JOB_COMPONENT] ( [JOB_NUMBER], [JOB_COMPONENT_NBR] )
GO

ALTER TABLE [dbo].[AR_COOP_EST_SPLITS] CHECK CONSTRAINT [FK_AR_COOP_EST_SPLITS_JOB]
GO

ALTER TABLE [dbo].[AR_COOP_EST_SPLITS]  WITH CHECK ADD CONSTRAINT [FK_AR_COOP_EST_SPLITS_PROD] 
	FOREIGN KEY( [CL_CODE], [DIV_CODE], [PRD_CODE] )
	REFERENCES [dbo].[PRODUCT] ([CL_CODE], [DIV_CODE], [PRD_CODE])
GO

ALTER TABLE [dbo].[AR_COOP_EST_SPLITS] CHECK CONSTRAINT [FK_AR_COOP_EST_SPLITS_PROD]
GO

GRANT SELECT, INSERT, UPDATE, DELETE ON [AR_COOP_EST_SPLITS] TO PUBLIC AS dbo
GO


