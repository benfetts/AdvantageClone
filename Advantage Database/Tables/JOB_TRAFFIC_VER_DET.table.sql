IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[JOB_TRAFFIC_VER_DET]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1)
BEGIN
	DROP TABLE [dbo].[JOB_TRAFFIC_VER_DET]
END

/****** Object:  Table [dbo].[JOB_TRAFFIC_VER_DET]    Script Date: 8/9/2013 8:58:39 AM ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

SET ANSI_PADDING ON
GO

CREATE TABLE [dbo].[JOB_TRAFFIC_VER_DET](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[JOB_NUMBER] [int] NOT NULL,
	[JOB_COMPONENT_NBR] [smallint] NOT NULL,
	[SEQ_NBR] [smallint] NOT NULL,
	[FNC_CODE] [varchar](10) NULL,
	[FNC_EST] [varchar](6) NULL,
	[TASK_DESCRIPTION] [varchar](40) NULL,
	[TASK_START_DATE] [smalldatetime] NULL,
	[JOB_DUE_DATE] [smalldatetime] NULL,
	[JOB_REVISED_DATE] [smalldatetime] NULL,
	[DUE_DATE_LOCK] [smallint] NULL,
	[JOB_COMPLETED_DATE] [smalldatetime] NULL,
	[JOB_ORDER] [smallint] NULL,
	[JOB_DAYS] [smallint] NULL,
	[PARENT_TASK] [varchar](10) NULL,
	[FNC_COMMENTS] [text] NULL,
	[DUE_DATE_COMMENTS] [text] NULL,
	[REV_DATE_COMMENTS] [text] NULL,
	[JOB_HRS] [decimal](8, 2) NULL,
	[DUE_TIME] [varchar](10) NULL,
	[REVISED_DUE_TIME] [varchar](10) NULL,
	[TASK_STATUS] [varchar](1) NULL,
	[MILESTONE] [smallint] NULL,
	[TRAFFIC_PHASE_ID] [int] NULL,
	[TEMP_SEQ] [smallint] NULL,
	[TRF_ROLE] [varchar](6) NULL,
	[HOURS_ASSIGNED]  AS ([dbo].[udf_get_task_hours]([JOB_NUMBER],[JOB_COMPONENT_NBR],[SEQ_NBR])),
	[EMP_CODE]  AS ([dbo].[udf_get_task_employee]([JOB_NUMBER],[JOB_COMPONENT_NBR],[SEQ_NBR])),
	[TEMP_COMP_DATE]  AS ([dbo].[udf_get_temp_comp_date]([JOB_NUMBER],[JOB_COMPONENT_NBR],[SEQ_NBR])),
	[VERSION_ID] [int] NOT NULL,
 CONSTRAINT [PK_JOB_TRAFFIC_VER_DET] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO

SET ANSI_PADDING OFF
GO

ALTER TABLE [dbo].[JOB_TRAFFIC_VER_DET]  WITH CHECK ADD  CONSTRAINT [FK_JOB_TRAFFIC_VER_DET_JOB_TRAFFIC_VER] FOREIGN KEY([VERSION_ID])
REFERENCES [dbo].[JOB_TRAFFIC_VER] ([ID])
GO

ALTER TABLE [dbo].[JOB_TRAFFIC_VER_DET] CHECK CONSTRAINT [FK_JOB_TRAFFIC_VER_DET_JOB_TRAFFIC_VER]
GO

ALTER TABLE [dbo].[JOB_TRAFFIC_VER_DET]  WITH CHECK ADD  CONSTRAINT [FK_JOB_TRAFFIC_VER_DET_ROLE] FOREIGN KEY([TRF_ROLE])
REFERENCES [dbo].[TRAFFIC_ROLE] ([ROLE_CODE])
GO

ALTER TABLE [dbo].[JOB_TRAFFIC_VER_DET] CHECK CONSTRAINT [FK_JOB_TRAFFIC_VER_DET_ROLE]
GO

ALTER TABLE [dbo].[JOB_TRAFFIC_VER_DET]  WITH CHECK ADD  CONSTRAINT [FK_JOB_TRAFFIC_VER_DET_TASK] FOREIGN KEY([FNC_CODE])
REFERENCES [dbo].[TRAFFIC_FNC] ([TRF_CODE])
GO

ALTER TABLE [dbo].[JOB_TRAFFIC_VER_DET] CHECK CONSTRAINT [FK_JOB_TRAFFIC_VER_DET_TASK]
GO

ALTER TABLE [dbo].[JOB_TRAFFIC_VER_DET]  WITH CHECK ADD  CONSTRAINT [FK_JOB_TRAFFIC_VER_DET_TASK_PHASE] FOREIGN KEY([TRAFFIC_PHASE_ID])
REFERENCES [dbo].[TRAFFIC_PHASE] ([TRAFFIC_PHASE_ID])
GO

ALTER TABLE [dbo].[JOB_TRAFFIC_VER_DET] CHECK CONSTRAINT [FK_JOB_TRAFFIC_VER_DET_TASK_PHASE]
GO

ALTER TABLE [dbo].[JOB_TRAFFIC_VER_DET]  WITH CHECK ADD  CONSTRAINT [FK_JOB_TRAFFIC_VER_DET_TRF_FNC_EST] FOREIGN KEY([FNC_EST])
REFERENCES [dbo].[FUNCTIONS] ([FNC_CODE])
GO

ALTER TABLE [dbo].[JOB_TRAFFIC_VER_DET] CHECK CONSTRAINT [FK_JOB_TRAFFIC_VER_DET_TRF_FNC_EST]
GO

ALTER TABLE [dbo].[JOB_TRAFFIC_VER_DET]  WITH CHECK ADD  CONSTRAINT [FK_JOB_TRAFFIC_VER_DET_TRF_PARENT_TASK] FOREIGN KEY([PARENT_TASK])
REFERENCES [dbo].[TRAFFIC_FNC] ([TRF_CODE])
GO

ALTER TABLE [dbo].[JOB_TRAFFIC_VER_DET] CHECK CONSTRAINT [FK_JOB_TRAFFIC_VER_DET_TRF_PARENT_TASK]
GO