/****** Object:  View [dbo].[WV_CURRENT_JOB_DOCUMENTS]    Script Date: 5/6/2016 3:12:21 PM ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE VIEW [dbo].[AR_INVOICE_DOCUMENTS_ALL]
AS


    SELECT DISTINCT A.*
    FROM (
	SELECT TOP 100 PERCENT  
						  2 AS SORT, 'AR Invoice' AS LEVEL, dbo.ARINV_JOB.JOB_NUMBER, dbo.ARINV_JOB.JOB_COMPONENT_NBR, dbo.DOCUMENTS.DOCUMENT_ID, dbo.DOCUMENTS.FILENAME, dbo.DOCUMENTS.MIME_TYPE, 
						  dbo.DOCUMENTS.DESCRIPTION, dbo.DOCUMENTS.KEYWORDS, dbo.DOCUMENTS.UPLOADED_DATE, dbo.DOCUMENTS.USER_CODE, dbo.DOCUMENTS.FILE_SIZE, 
						   dbo.DOCUMENTS.USER_CODE AS [USER_NAME], 
						  dbo.DOCUMENTS.REPOSITORY_FILENAME, dbo.DOCUMENT_TYPE.DOCUMENT_TYPE_DESC, 
						  ISNULL(dbo.DOCUMENTS.PRIVATE_FLAG, 0) AS PRIVATE_FLAG, 
                      dbo.DOCUMENTS.PROOFHQ_URL
	FROM         dbo.DOCUMENTS INNER JOIN
						  dbo.DOCUMENT_TYPE ON dbo.DOCUMENTS.DOCUMENT_TYPE_ID = dbo.DOCUMENT_TYPE.DOCUMENT_TYPE_ID INNER JOIN
						  dbo.ARINV_DOCUMENT ON dbo.DOCUMENTS.DOCUMENT_ID = dbo.ARINV_DOCUMENT.DOCUMENT_ID INNER JOIN
						  dbo.ACCT_REC ON dbo.ARINV_DOCUMENT.AR_INV_NBR = dbo.ACCT_REC.AR_INV_NBR AND dbo.ARINV_DOCUMENT.AR_INV_SEQ = dbo.ACCT_REC.AR_INV_SEQ AND 
						  dbo.ARINV_DOCUMENT.AR_TYPE = dbo.ACCT_REC.AR_TYPE INNER JOIN
						  dbo.ARINV_JOB ON dbo.ARINV_DOCUMENT.AR_INV_NBR = dbo.ARINV_JOB.AR_INV_NBR
	WHERE     (dbo.ACCT_REC.AR_INV_SEQ <> 99) AND (dbo.ACCT_REC.VOID_FLAG = 0 OR
						  dbo.ACCT_REC.VOID_FLAG IS NULL)
	ORDER BY dbo.ARINV_JOB.AR_INV_NBR DESC   ) AS A
	WHERE A.DOCUMENT_ID IN (
							SELECT TOP 100 PERCENT MAX(dbo.ARINV_DOCUMENT.DOCUMENT_ID) 
							FROM         dbo.DOCUMENTS INNER JOIN
											  dbo.ARINV_DOCUMENT ON dbo.DOCUMENTS.DOCUMENT_ID = dbo.ARINV_DOCUMENT.DOCUMENT_ID
							GROUP BY dbo.ARINV_DOCUMENT.AR_INV_NBR, dbo.DOCUMENTS.FILENAME
							)

	

GO


