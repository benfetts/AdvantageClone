CREATE VIEW [dbo].[CURRENT_ARINVOICE_DOCUMENTS]

AS

	SELECT   
		'AR Invoice' AS [LEVEL], 
		dbo.ARINV_DOCUMENT.AR_INV_NBR, 
		dbo.ARINV_DOCUMENT.AR_INV_SEQ, 
		dbo.ARINV_DOCUMENT.AR_TYPE, 
		dbo.DOCUMENTS.DOCUMENT_ID, 
		dbo.DOCUMENTS.[FILENAME], 
		dbo.DOCUMENTS.MIME_TYPE, 
		dbo.DOCUMENTS.[DESCRIPTION], 
		dbo.DOCUMENTS.KEYWORDS, 
		dbo.DOCUMENTS.UPLOADED_DATE, 
		dbo.DOCUMENTS.USER_CODE, 
		dbo.DOCUMENTS.FILE_SIZE, 
		 dbo.DOCUMENTS.USER_CODE AS [USER_NAME], 
		dbo.DOCUMENTS.REPOSITORY_FILENAME, 
		dbo.DOCUMENT_TYPE.DOCUMENT_TYPE_DESC, 
		ISNULL(dbo.DOCUMENTS.PRIVATE_FLAG, 0) AS PRIVATE_FLAG
	FROM         
		dbo.DOCUMENTS INNER JOIN
		dbo.ARINV_DOCUMENT ON dbo.DOCUMENTS.DOCUMENT_ID = dbo.ARINV_DOCUMENT.DOCUMENT_ID INNER JOIN
		dbo.DOCUMENT_TYPE ON dbo.DOCUMENTS.DOCUMENT_TYPE_ID = dbo.DOCUMENT_TYPE.DOCUMENT_TYPE_ID
	WHERE     
		dbo.DOCUMENTS.DOCUMENT_ID IN (SELECT     
											MAX(ARD.DOCUMENT_ID) AS DOCUMENT_ID
									  FROM          
											dbo.ARINV_DOCUMENT AS ARD INNER JOIN
											dbo.DOCUMENTS AS D ON D.DOCUMENT_ID = ARD.DOCUMENT_ID
									  GROUP BY 
											ARD.AR_INV_NBR, 
											ARD.AR_INV_SEQ, 
											ARD.AR_TYPE, 
											D.[FILENAME])

GO


