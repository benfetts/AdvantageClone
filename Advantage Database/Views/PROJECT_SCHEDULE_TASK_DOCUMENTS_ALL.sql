CREATE VIEW [dbo].[PROJECT_SCHEDULE_TASK_DOCUMENTS_ALL]
AS

	SELECT DISTINCT
		DOCUMENTS.DOCUMENT_ID, 
		DOCUMENTS.[FILENAME], 
		DOCUMENTS.[DESCRIPTION], 
		DOCUMENTS.KEYWORDS, 
		DOCUMENTS.FILE_SIZE, 
		DOCUMENTS.UPLOADED_DATE, 
		DOCUMENTS.MIME_TYPE,
		DOCUMENTS.USER_CODE,
		DOCUMENTS.REPOSITORY_FILENAME,
		'PST' AS [LEVEL],
		JTDD.JOB_NUMBER,
		JTDD.JOB_COMPONENT_NBR,
		JTDD.SEQ_NBR
	FROM 
		DOCUMENTS 
		INNER JOIN JOB_TRAFFIC_DET_DOCS JTDD ON DOCUMENTS.DOCUMENT_ID = JTDD.DOCUMENT_ID
	WHERE
		DOCUMENTS.DOCUMENT_ID IN (SELECT
										MAX(JOB_TRAFFIC_DET_DOCS_1.DOCUMENT_ID) AS DOCUMENT_ID
									FROM 
										JOB_TRAFFIC_DET_DOCS AS JOB_TRAFFIC_DET_DOCS_1 
										INNER JOIN DOCUMENTS AS DOCUMENTS_1 ON JOB_TRAFFIC_DET_DOCS_1.DOCUMENT_ID = DOCUMENTS_1.DOCUMENT_ID
									GROUP BY 
										JOB_TRAFFIC_DET_DOCS_1.JOB_NUMBER,
										JOB_TRAFFIC_DET_DOCS_1.JOB_COMPONENT_NBR,
										JOB_TRAFFIC_DET_DOCS_1.SEQ_NBR, 
										DOCUMENTS_1.[FILENAME])

GO


