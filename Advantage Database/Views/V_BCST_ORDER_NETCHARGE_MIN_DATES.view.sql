
CREATE VIEW dbo.V_BCST_ORDER_NETCHARGE_MIN_DATES(ORDER_TYPE, ORDER_NBR, MAX_REV, MAX_SEQ, CLOSE_DATE, EXT_CLOSE_DATE, MATL_CLOSE_DATE, EXT_MATL_DATE, 
	MAT_COMP, JOB_NUMBER, JOB_COMPONENT_NBR, LINE_CANCELLED ) 
AS

SELECT 'R' AS ORDER_TYPE, ms.ORDER_NBR, ms.MAX_REV, ms.MAX_SEQ, MIN(d.CLOSE_DATE), MIN(d.EXT_CLOSE_DATE), MIN(d.MATL_CLOSE_DATE), 
	MIN(d.EXT_MATL_DATE), MIN(d.MAT_COMP), MIN(d.JOB_NUMBER), MIN(d.JOB_COMPONENT_NBR), MIN(d.LINE_CANCELLED)
FROM dbo.RADIO_DETAIL1 AS d
JOIN dbo.V_MEDIA_ORDER_MAX_REV_SEQ AS ms
	ON d.ORDER_NBR = ms.ORDER_NBR
	AND d.LINE_NBR = ms.LINE_NBR
	AND d.REV_NBR = ms.MAX_REV
	AND d.SEQ_NBR = ms.MAX_SEQ
GROUP BY ms.ORDER_NBR, ms.MAX_REV, ms.MAX_SEQ

UNION ALL SELECT 'T' AS ORDER_TYPE, ms.ORDER_NBR, ms.MAX_REV, ms.MAX_SEQ, MIN(d.CLOSE_DATE), MIN(d.EXT_CLOSE_DATE), MIN(d.MATL_CLOSE_DATE), 
	MIN(d.EXT_MATL_DATE), MIN(d.MAT_COMP), MIN(d.JOB_NUMBER), MIN(d.JOB_COMPONENT_NBR), MIN(d.LINE_CANCELLED)
FROM dbo.TV_DETAIL1 AS d
JOIN dbo.V_MEDIA_ORDER_MAX_REV_SEQ AS ms
	ON d.ORDER_NBR = ms.ORDER_NBR
	AND d.LINE_NBR = ms.LINE_NBR
	AND d.REV_NBR = ms.MAX_REV
	AND d.SEQ_NBR = ms.MAX_SEQ
GROUP BY ms.ORDER_NBR, ms.MAX_REV, ms.MAX_SEQ

