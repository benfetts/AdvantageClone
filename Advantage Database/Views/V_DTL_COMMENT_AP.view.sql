-- V_DTL_COMMENT_AP
-- #00 08/17/12 - initial version

SET QUOTED_IDENTIFIER ON 
GO

SET ANSI_NULLS ON 
GO

SET ANSI_PADDING OFF
GO

IF EXISTS ( SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID( N'[dbo].[V_DTL_COMMENT_AP]' ) AND OBJECTPROPERTY( id, N'IsView' ) = 1 )
	DROP VIEW [dbo].[V_DTL_COMMENT_AP]
GO

CREATE VIEW dbo.V_DTL_COMMENT_AP 
AS

SELECT DISTINCT
		ac.AP_ID,
		ac.LINE_NUMBER,
		ac.JOB_NUMBER,
		ac.JOB_COMPONENT_NBR,
		ac.FNC_CODE,
		ah.VN_FRL_EMP_CODE,
		ah.AP_INV_DATE,
		ah.AP_INV_VCHR,
		CAST(ac.AP_COMMENT AS varchar(max)) AS AP_COMMENT
	FROM dbo.AP_PROD_COMMENTS ac
	JOIN dbo.AP_HEADER ah
		ON ac.AP_ID = ah.AP_ID
	WHERE ac.AP_COMMENT IS NOT NULL	
		AND ah.AP_SEQ = (SELECT MAX(ah2.AP_SEQ) FROM dbo.AP_HEADER ah2
		WHERE ah.AP_ID = ah2.AP_ID)

GO

IF ( @@ERROR = 0 )
	GRANT ALL ON [V_DTL_COMMENT_AP] TO PUBLIC AS dbo
GO	