-- V_DTL_COMMENT_IO
-- #00 08/17/12 - initial version

SET QUOTED_IDENTIFIER ON 
GO

SET ANSI_NULLS ON 
GO

SET ANSI_PADDING OFF
GO

IF EXISTS ( SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID( N'[dbo].[V_DTL_COMMENT_IO]' ) AND OBJECTPROPERTY( id, N'IsView' ) = 1 )
	DROP VIEW [dbo].[V_DTL_COMMENT_IO]
GO

CREATE VIEW dbo.V_DTL_COMMENT_IO 
AS

SELECT
		io.IO_ID,
		io.JOB_NUMBER,
		io.JOB_COMPONENT_NBR,
		io.FNC_CODE,
		io.IO_INV_DATE,
		io.IO_INV_NBR,
		CAST(io.IO_COMMENT AS varchar(max)) AS IO_COMMENT
	FROM dbo.INCOME_ONLY io
	WHERE io.IO_COMMENT IS NOT NULL	AND io.SEQ_NBR = (SELECT MAX(io2.SEQ_NBR) FROM dbo.INCOME_ONLY io2
		WHERE io.IO_ID = io2.IO_ID)

GO

IF ( @@ERROR = 0 )
	GRANT ALL ON [V_DTL_COMMENT_IO] TO PUBLIC AS dbo
GO	
