CREATE VIEW [dbo].[V_ESTIMATE_COMMENT]
WITH SCHEMABINDING
AS

	SELECT 
		[EstimateNumber] = EL.ESTIMATE_NUMBER,
		[EstimateDesc] = EL.EST_LOG_DESC,
		[EstimateComponentNumber] = EC.EST_COMPONENT_NBR,
		[EstimateCompDesc] = EC.EST_COMP_DESC,
		[QuoteNumber] = EQ.EST_QUOTE_NBR,
		[QuoteDesc] = EQ.EST_QUOTE_DESC,
		[Comment] = EL.EST_LOG_COMMENT,
		[CompComment] = EC.EST_COMP_COMMENT,
		[QuoteComment] = EQ.EST_QTE_COMMENT
	FROM  
		[dbo].ESTIMATE_COMPONENT EC INNER JOIN
		[dbo].ESTIMATE_LOG EL ON EC.ESTIMATE_NUMBER = EL.ESTIMATE_NUMBER INNER JOIN
		[dbo].ESTIMATE_QUOTE EQ ON EC.ESTIMATE_NUMBER = EQ.ESTIMATE_NUMBER AND 
		EC.EST_COMPONENT_NBR = EQ.EST_COMPONENT_NBR LEFT OUTER JOIN
		[dbo].JOB_COMPONENT JC ON JC.EST_COMPONENT_NBR = EC.EST_COMPONENT_NBR AND JC.ESTIMATE_NUMBER = EC.ESTIMATE_NUMBER
	WHERE 
		(JC.[JOB_PROCESS_CONTRL] NOT IN (6,12) OR JC.ESTIMATE_NUMBER IS NULL)
GO


