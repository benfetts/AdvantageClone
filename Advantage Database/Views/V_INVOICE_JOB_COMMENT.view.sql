CREATE VIEW [dbo].[V_INVOICE_JOB_COMMENT]
WITH SCHEMABINDING
AS

	SELECT 
		[InvoiceNumber] = ARS.AR_INV_NBR,
		[JobNumber] = ARS.JOB_NUMBER,
		[JobDescription] = J.JOB_DESC,
		[JobComponentNumber] = ARS.JOB_COMPONENT_NBR,
		[JobComponentDescription] = JC.JOB_COMP_DESC,
		[Comment] = BCJ.JOB_COMMENT,
		[CommentSource] = BCJ.COMMENT_SOURCE
	FROM 
		(SELECT 
				ARS.AR_INV_NBR, 
				ARS.JOB_NUMBER, 
				ARS.JOB_COMPONENT_NBR 
			FROM 
				[dbo].[AR_SUMMARY] AS ARS 
			WHERE
				ARS.JOB_NUMBER IS NOT NULL AND
				ARS.JOB_COMPONENT_NBR IS NOT NULL AND
				ARS.AR_TYPE <> 'VO'
			GROUP BY 
				ARS.AR_INV_NBR, 
				ARS.JOB_NUMBER, 
				ARS.JOB_COMPONENT_NBR) AS ARS INNER JOIN
		[dbo].[JOB_COMPONENT] AS JC ON JC.JOB_NUMBER = ARS.JOB_NUMBER AND
									   JC.JOB_COMPONENT_NBR = ARS.JOB_COMPONENT_NBR INNER JOIN
		[dbo].[JOB_LOG] AS J ON J.JOB_NUMBER = ARS.JOB_NUMBER LEFT OUTER JOIN
		[dbo].[BILL_COMMENTS_JOB] AS BCJ ON BCJ.INV_NBR = ARS.AR_INV_NBR AND
											BCJ.JOB_NUMBER = JC.JOB_NUMBER AND
											BCJ.JOB_COMPONENT_NBR = JC.JOB_COMPONENT_NBR

GO


