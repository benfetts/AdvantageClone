if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[V_MEDIA_DTL]') and OBJECTPROPERTY(id, N'IsView') = 1)
drop view [dbo].[V_MEDIA_DTL]
GO

CREATE VIEW [dbo].[V_MEDIA_DTL]( ORDER_TYPE, VER_ID, ORDER_NBR, LINE_NBR, REV_NBR, PERIOD, [MONTH], [YEAR], [START_DATE], END_DATE, 
	CLOSE_DATE, MATL_CLOSE_DATE, EXT_CLOSE_DATE, EXT_MATL_DATE, HEADLINE_PROGRAM, SIZE_CODE, SIZE, EDITION_ISSUE, SECTION, MATERIAL,
	REMARKS, MAT_COMP, URL, COPY_AREA, AD_NUMBER,
	JOB_NUMBER, JOB_COMPONENT_NBR, JOB_COMPONENT, PRINT_QUANTITY, GUARANTEED_IMPRESS,TOTAL_SPOTS,
	[LENGTH], LINE_CANCELLED, CIRCULATION, INTERNET_TYPE, INTERNET_TYPE_DESC, OUTDOOR_TYPE, OUTDOOR_TYPE_DESC, OUTDOOR_LOCATION, PLACEMENT_1, PLACEMENT_2) 
AS

-- ==========================================================================
 -- v_media_dtl
 -- #00 09/10/14 - v660 initial - v6.60.04.00 for media spec dataset (2543-1) 
 -- ==========================================================================

	--Magazine
	 SELECT 'M', 2, ORDER_NBR, LINE_NBR, REV_NBR, YEAR([START_DATE]) * 100 + MONTH([START_DATE]), MONTH([START_DATE]), YEAR([START_DATE]), 
		[START_DATE], END_DATE, CLOSE_DATE, MATL_CLOSE_DATE, EXT_CLOSE_DATE, EXT_MATL_DATE, HEADLINE, SIZE_CODE, SIZE, 
		EDITION_ISSUE, SECTION, MATERIAL, NULL, MAT_COMP, NULL, NULL, AD_NUMBER, JOB_NUMBER, JOB_COMPONENT_NBR, 
		RIGHT('000000' + CAST(JOB_NUMBER AS varchar(6)), 6) + '-' + RIGHT('000' + CAST(JOB_COMPONENT_NBR AS varchar(3)), 3), 
		0, 0, 0, NULL, LINE_CANCELLED, 0, NULL, NULL, NULL, NULL, NULL, NULL, NULL
	   FROM dbo.MAGAZINE_DETAIL
	   WHERE ACTIVE_REV = 1

	UNION
	--Newspaper
	 SELECT 'N', 2, ORDER_NBR, LINE_NBR, REV_NBR, YEAR([START_DATE]) * 100 + MONTH([START_DATE]), MONTH([START_DATE]), YEAR([START_DATE]), 
		[START_DATE], END_DATE, CLOSE_DATE, MATL_CLOSE_DATE, EXT_CLOSE_DATE, EXT_MATL_DATE, HEADLINE, SIZE_CODE, SIZE, 
		EDITION_ISSUE, SECTION, MATERIAL, NULL, MAT_COMP, NULL, NULL, AD_NUMBER, JOB_NUMBER, JOB_COMPONENT_NBR, 
		RIGHT('000000' + CAST(JOB_NUMBER AS varchar(6)), 6) + '-' + RIGHT('000' + CAST(JOB_COMPONENT_NBR AS varchar(3)), 3), 
		PRINT_QUANTITY, 0, 0, NULL, LINE_CANCELLED, NP_CIRCULATION, NULL, NULL, NULL, NULL, NULL, NULL, NULL
	   FROM dbo.NEWSPAPER_DETAIL
	   WHERE ACTIVE_REV = 1

	UNION
	--Outdoor
	 SELECT 'O', 2, ORDER_NBR, LINE_NBR, REV_NBR, YEAR([POST_DATE]) * 100 + MONTH([POST_DATE]), MONTH([POST_DATE]), YEAR([POST_DATE]), 
		[POST_DATE], END_DATE, CLOSE_DATE, MATL_CLOSE_DATE, EXT_CLOSE_DATE, EXT_MATL_DATE, HEADLINE, SIZE, SIZE_DESC, 
		NULL, NULL, NULL, NULL, MAT_COMP, NULL, COPY_AREA, AD_NUMBER, JOB_NUMBER, JOB_COMPONENT_NBR, 
		RIGHT('000000' + CAST(JOB_NUMBER AS varchar(6)), 6) + '-' + RIGHT('000' + CAST(JOB_COMPONENT_NBR AS varchar(3)), 3), 
		0, 0, 0, NULL, LINE_CANCELLED, 0, NULL, NULL, OUTDOOR_TYPE, OD_DESC, [LOCATION], NULL, NULL
	   FROM dbo.OUTDOOR_DETAIL LEFT OUTER JOIN
			dbo.OUTDOOR_TYPE AS OT ON OT.OD_CODE = OUTDOOR_DETAIL.OUTDOOR_TYPE
			LEFT OUTER JOIN AD_SIZE AS AD ON AD.SIZE_CODE = SIZE AND MEDIA_TYPE = 'O'
	   WHERE ACTIVE_REV = 1

	UNION
	--Internet
	 SELECT 'I', 2, ORDER_NBR, LINE_NBR, REV_NBR, YEAR([START_DATE]) * 100 + MONTH([START_DATE]), MONTH([START_DATE]), YEAR([START_DATE]), 
		[START_DATE], END_DATE, CLOSE_DATE, MATL_CLOSE_DATE, EXT_CLOSE_DATE, EXT_MATL_DATE, HEADLINE, SIZE, CASE WHEN SIZE IS NOT NULL THEN SIZE_DESC ELSE CREATIVE_SIZE END, 
		NULL, NULL, NULL, NULL, MAT_COMP, URL, COPY_AREA, AD_NUMBER, JOB_NUMBER, JOB_COMPONENT_NBR, 
		RIGHT('000000' + CAST(JOB_NUMBER AS varchar(6)), 6) + '-' + RIGHT('000' + CAST(JOB_COMPONENT_NBR AS varchar(3)), 3), 
		0, GUARANTEED_IMPRESS, 0, NULL, LINE_CANCELLED, 0, INTERNET_TYPE, OD_DESC, NULL, NULL, NULL, PLACEMENT_1, PLACEMENT_2
	   FROM dbo.INTERNET_DETAIL LEFT OUTER JOIN
			dbo.INTERNET_TYPE AS IT ON IT.OD_CODE = INTERNET_DETAIL.INTERNET_TYPE
			LEFT OUTER JOIN AD_SIZE AS AD ON AD.SIZE_CODE = SIZE AND MEDIA_TYPE = 'I'
	   WHERE ACTIVE_REV = 1

	--UNION
	----Old Mag
	-- SELECT 'M', 1, ORDER_NBR, LINE_NBR, REV_NBR, YEAR([INSERT_DATE]) * 100 + MONTH([INSERT_DATE]), MONTH([INSERT_DATE]), YEAR([INSERT_DATE]), 
	--	[INSERT_DATE], NULL, CLOSE_DATE, MATL_CLOSE_DATE, EXT_CLOSE_DATE, EXT_MATL_DATE, HEADLINE, NULL, AD_SIZE, 
	--	ISSUE, NULL, MATERIAL, NULL, NULL, NULL, NULL, NULL, JOB_NUMBER, JOB_COMPONENT_NBR, 
	--	RIGHT('000000' + CAST(JOB_NUMBER AS varchar(6)), 6) + '-' + RIGHT('000' + CAST(JOB_COMPONENT_NBR AS varchar(3)), 3), 
	--	0, 0, 0, NULL, LINE_CANCELLED, 0
	--   FROM dbo.MAG_DETAIL

	--UNION
	----Old News
	-- SELECT 'N', 1, ORDER_NBR, LINE_NBR, REV_NBR, YEAR([INSERT_DATE]) * 100 + MONTH([INSERT_DATE]), MONTH([INSERT_DATE]), YEAR([INSERT_DATE]), 
	--	[INSERT_DATE], NULL, CLOSE_DATE, MATL_CLOSE_DATE, EXT_CLOSE_DATE, EXT_MATL_DATE, HEADLINE, NULL, NULL, 
	--	EDITION, SECTION, MATERIAL, NULL, NULL, NULL, NULL, NULL, JOB_NUMBER, JOB_COMPONENT_NBR, 
	--	RIGHT('000000' + CAST(JOB_NUMBER AS varchar(6)), 6) + '-' + RIGHT('000' + CAST(JOB_COMPONENT_NBR AS varchar(3)), 3), 
	--	0, 0, 0, NULL, LINE_CANCELLED, 0
	--   FROM dbo.NEWS_DETAIL

	--UNION
	----Old Radio

	--UNION
	----Old TV

	UNION
	--New TV
	 SELECT 'T', 2, ORDER_NBR, LINE_NBR, REV_NBR, YEAR([START_DATE]) * 100 + MONTH([START_DATE]), MONTH([START_DATE]), YEAR([START_DATE]), 
		[START_DATE], END_DATE, CLOSE_DATE, MATL_CLOSE_DATE, EXT_CLOSE_DATE, EXT_MATL_DATE, PROGRAMMING, NULL, NULL, 
		NULL, NULL, NULL, NULL, MAT_COMP, NULL, NULL, AD_NUMBER, JOB_NUMBER, JOB_COMPONENT_NBR, 
		RIGHT('000000' + CAST(JOB_NUMBER AS varchar(6)), 6) + '-' + RIGHT('000' + CAST(JOB_COMPONENT_NBR AS varchar(3)), 3), 
		0, 0, TOTAL_SPOTS, [LENGTH], LINE_CANCELLED, 0, NULL, NULL, NULL, NULL, NULL, NULL, NULL
	   FROM dbo.TV_DETAIL
	   WHERE ACTIVE_REV = 1

	UNION
	--New Radio
	 SELECT 'R', 2, ORDER_NBR, LINE_NBR, REV_NBR, YEAR([START_DATE]) * 100 + MONTH([START_DATE]), MONTH([START_DATE]), YEAR([START_DATE]), 
		[START_DATE], END_DATE, CLOSE_DATE, MATL_CLOSE_DATE, EXT_CLOSE_DATE, EXT_MATL_DATE, PROGRAMMING, NULL, NULL, 
		NULL, NULL, NULL, NULL, MAT_COMP, NULL, NULL, AD_NUMBER, JOB_NUMBER, JOB_COMPONENT_NBR, 
		RIGHT('000000' + CAST(JOB_NUMBER AS varchar(6)), 6) + '-' + RIGHT('000' + CAST(JOB_COMPONENT_NBR AS varchar(3)), 3), 
		0, 0, TOTAL_SPOTS, [LENGTH], LINE_CANCELLED, 0, NULL, NULL, NULL, NULL, NULL, NULL, NULL
	   FROM dbo.RADIO_DETAIL
	   WHERE ACTIVE_REV = 1

GO




