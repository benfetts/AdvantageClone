SET QUOTED_IDENTIFIER ON 
GO

SET ANSI_NULLS ON 
GO

SET ANSI_PADDING OFF
GO

IF EXISTS ( SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID( N'[dbo].[V_MEDIA_HDR]') AND OBJECTPROPERTY(id, N'IsView') = 1 )
	DROP VIEW [dbo].[V_MEDIA_HDR]
GO

CREATE VIEW [dbo].[V_MEDIA_HDR]( ORDER_TYPE, VER_ID, ORDER_NBR, ORDER_DESC, OFFICE_CODE, CL_CODE, DIV_CODE, PRD_CODE, MARKET_CODE, 
	CMP_CODE, VN_CODE, VR_CODE, VR_CODE2, CLIENT_PO, ORDER_DATE, MEDIA_TYPE, ORD_PROCESS_CONTRL, CMP_ID, MEDIA_FROM, BCC_ID, LINK_ID, UNITS,
	[START_DATE], [END_DATE], BUYER, ORDER_ACCEPTED, ORDER_COMMENT_LTD, ORDER_COMMENT ) 
AS

-- ==========================================================================
 -- v_media_hdr
 -- #00 00/00/00 - v660 initial - unknown
 -- #01 06/30/14 - added START_DATE and END_DATE (735-548)
 -- #02 07/10/14 - added new fields for use in media spec dataset (2543-1)
 -- ==========================================================================

	--Magazine
	 SELECT 'M', 2, ORDER_NBR, ORDER_DESC, OFFICE_CODE, CL_CODE, DIV_CODE, PRD_CODE, MARKET_CODE, CMP_CODE, VN_CODE, VR_CODE, VR_CODE2,
			CLIENT_PO, ORDER_DATE, MEDIA_TYPE, ORD_PROCESS_CONTRL, CMP_IDENTIFIER, 'Mag2', BCC_ID, LINK_ID, NULL,
			[START_DATE], [END_DATE], BUYER, ORDER_ACCEPTED, CAST(ORDER_COMMENT AS varchar), CAST(ORDER_COMMENT AS varchar(MAX))
	   FROM dbo.MAGAZINE_HEADER

	UNION
	--Newspaper
	 SELECT 'N', 2, ORDER_NBR, ORDER_DESC, OFFICE_CODE, CL_CODE, DIV_CODE, PRD_CODE, MARKET_CODE, CMP_CODE, VN_CODE, VR_CODE, VR_CODE2, 
			CLIENT_PO, ORDER_DATE, MEDIA_TYPE, ORD_PROCESS_CONTRL, CMP_IDENTIFIER, 'News2', BCC_ID, LINK_ID, NULL,
			[START_DATE], [END_DATE], BUYER, ORDER_ACCEPTED, CAST(ORDER_COMMENT AS varchar), CAST(ORDER_COMMENT AS varchar(MAX))
	   FROM dbo.NEWSPAPER_HEADER

	UNION
	--Outdoor
	 SELECT	'O', 2, ORDER_NBR, ORDER_DESC, OFFICE_CODE, CL_CODE, DIV_CODE, PRD_CODE, MARKET_CODE, CMP_CODE, VN_CODE, VR_CODE, VR_CODE2, 
			CLIENT_PO, ORDER_DATE, MEDIA_TYPE, ORD_PROCESS_CONTRL, CMP_IDENTIFIER, 'Outdoor', BCC_ID, LINK_ID, NULL,
			[START_DATE], [END_DATE], BUYER, ORDER_ACCEPTED, CAST(ORDER_COMMENT AS varchar), CAST(ORDER_COMMENT AS varchar(MAX))
	   FROM dbo.OUTDOOR_HEADER

	UNION
	--Internet
	 SELECT	'I', 2, ORDER_NBR, ORDER_DESC, OFFICE_CODE, CL_CODE, DIV_CODE, PRD_CODE, MARKET_CODE, CMP_CODE, VN_CODE, VR_CODE, VR_CODE2, 
			CLIENT_PO, ORDER_DATE, MEDIA_TYPE, ORD_PROCESS_CONTRL, CMP_IDENTIFIER, 'Internet', BCC_ID, LINK_ID, NULL,
			[START_DATE], [END_DATE], BUYER, ORDER_ACCEPTED, CAST(ORDER_COMMENT AS varchar), CAST(ORDER_COMMENT AS varchar(MAX))
	   FROM dbo.INTERNET_HEADER

	UNION
	--Mag
	 SELECT 'M', 1, ORDER_NBR, ORDER_DESC, OFFICE_CODE, CL_CODE, DIV_CODE, PRD_CODE, NULL, CMP_CODE, VN_CODE, VR_CODE, VR_CODE2, 
			CLIENT_PO, ORDER_DATE, MEDIA_TYPE, ORD_PROCESS_CONTRL, CMP_IDENTIFIER, 'Mag', NULL, LINK_ID, NULL,
			NULL, NULL, BUYER, NULL, CAST(ORDER_COMMENT AS varchar), CAST(ORDER_COMMENT AS varchar(MAX))
	   FROM dbo.MAG_HEADER

	UNION
	--News
	 SELECT	'N', 1, ORDER_NBR, ORDER_DESC, OFFICE_CODE, CL_CODE, DIV_CODE, PRD_CODE, NULL, CMP_CODE, VN_CODE, VR_CODE, VR_CODE2, 
			CLIENT_PO, ORDER_DATE, MEDIA_TYPE, ORD_PROCESS_CONTRL, CMP_IDENTIFIER, 'News', NULL, LINK_ID, NULL,
			NULL, NULL, BUYER, NULL, CAST(ORDER_COMMENT AS varchar), CAST(ORDER_COMMENT AS varchar(MAX))
	   FROM dbo.NEWS_HEADER

	UNION
	--Radio
	 SELECT	'R', 1, ORDER_NBR, ORDER_DESC, OFFICE_CODE, CL_CODE, DIV_CODE, PRD_CODE, MARKET_CODE, NULL, VN_CODE, VR_CODE, VR_CODE2, 
			CLIENT_PO, ORDER_DATE, MEDIA_TYPE, ORD_PROCESS_CONTRL, CMP_IDENTIFIER, 'Radio', BCC_ID, LINK_ID, 'BM',
			[FLIGHT_FROM], [FLIGHT_TO], BUYER, NULL, CAST(ORDER_COMMENT AS varchar), CAST(ORDER_COMMENT AS varchar(MAX))
	   FROM	dbo.RADIO_HEADER
	  WHERE REV_NBR = ( SELECT MAX(REV_NBR) FROM dbo.RADIO_HEADER AS h1 WHERE dbo.RADIO_HEADER.ORDER_NBR = h1.ORDER_NBR )

	UNION
	--TV
	 SELECT 'T', 1, ORDER_NBR, ORDER_DESC, OFFICE_CODE, CL_CODE, DIV_CODE, PRD_CODE, MARKET_CODE, NULL, VN_CODE, VR_CODE, VR_CODE2, 
			CLIENT_PO, ORDER_DATE, MEDIA_TYPE, ORD_PROCESS_CONTRL, CMP_IDENTIFIER, 'TV', BCC_ID, LINK_ID, 'BM',
			[FLIGHT_FROM], [FLIGHT_TO], BUYER, NULL, CAST(ORDER_COMMENT AS varchar), CAST(ORDER_COMMENT AS varchar(MAX))
	   FROM dbo.TV_HEADER
	  WHERE REV_NBR = ( SELECT MAX(REV_NBR) FROM dbo.TV_HEADER AS h1 WHERE dbo.TV_HEADER.ORDER_NBR = h1.ORDER_NBR )

	UNION
	--New TV
	 SELECT 'T', 2, ORDER_NBR, ORDER_DESC, OFFICE_CODE, CL_CODE, DIV_CODE, PRD_CODE,	MARKET_CODE, CMP_CODE, VN_CODE, VR_CODE, VR_CODE2, 
			CLIENT_PO, ORDER_DATE, MEDIA_TYPE, ORD_PROCESS_CONTRL, CMP_IDENTIFIER, 'TV2', BCC_ID, LINK_ID, UNITS,
			[START_DATE], [END_DATE], BUYER, ORDER_ACCEPTED, CAST(ORDER_COMMENT AS varchar), CAST(ORDER_COMMENT AS varchar(MAX))
	   FROM dbo.TV_HDR

	UNION
	--New Radio
	 SELECT 'R', 2, ORDER_NBR, ORDER_DESC, OFFICE_CODE, CL_CODE, DIV_CODE, PRD_CODE,	MARKET_CODE, CMP_CODE, VN_CODE, VR_CODE, VR_CODE2, 
			CLIENT_PO, ORDER_DATE, MEDIA_TYPE, ORD_PROCESS_CONTRL, CMP_IDENTIFIER, 'Radio2', BCC_ID, LINK_ID, UNITS,
			[START_DATE], [END_DATE], BUYER, ORDER_ACCEPTED, CAST(ORDER_COMMENT AS varchar), CAST(ORDER_COMMENT AS varchar(MAX))
	   FROM dbo.RADIO_HDR
GO

	GRANT SELECT ON V_MEDIA_HDR TO PUBLIC AS dbo

GO	



