
CREATE VIEW dbo.V_MEDIA_ORDER_MAX_REV_SEQ( ORDER_NBR, LINE_NBR, MAX_REV, MAX_SEQ, JOB_NUMBER, JOB_COMPONENT_NBR )
AS

--Magazine
	SELECT d.ORDER_NBR, d.LINE_NBR, d.REV_NBR, d.SEQ_NBR, d.JOB_NUMBER, d.JOB_COMPONENT_NBR
	  FROM dbo.MAGAZINE_DETAIL AS d
	 WHERE d.ACTIVE_REV = 1 
	   AND d.SEQ_NBR = ( SELECT MAX(d2.SEQ_NBR) 
	                       FROM dbo.MAGAZINE_DETAIL AS d2
						  WHERE d.ORDER_NBR = d2.ORDER_NBR 
						    AND d.LINE_NBR = d2.LINE_NBR 
						    AND d.REV_NBR = d2.REV_NBR )

--Newspaper
UNION 
	SELECT d.ORDER_NBR, d.LINE_NBR, d.REV_NBR, d.SEQ_NBR, d.JOB_NUMBER, d.JOB_COMPONENT_NBR
	  FROM dbo.NEWSPAPER_DETAIL AS d
	 WHERE d.ACTIVE_REV = 1 
	   AND d.SEQ_NBR = ( SELECT MAX(d2.SEQ_NBR) 
	                       FROM dbo.NEWSPAPER_DETAIL AS d2
						  WHERE d.ORDER_NBR = d2.ORDER_NBR 
						    AND d.LINE_NBR = d2.LINE_NBR 
						    AND d.REV_NBR = d2.REV_NBR )

--Internet
UNION 
	SELECT d.ORDER_NBR, d.LINE_NBR, d.REV_NBR, d.SEQ_NBR, d.JOB_NUMBER, d.JOB_COMPONENT_NBR
	  FROM dbo.INTERNET_DETAIL AS d
	 WHERE d.ACTIVE_REV = 1 
	   AND d.SEQ_NBR = ( SELECT MAX(d2.SEQ_NBR) 
	                       FROM dbo.INTERNET_DETAIL AS d2
						  WHERE d.ORDER_NBR = d2.ORDER_NBR 
						    AND d.LINE_NBR = d2.LINE_NBR 
						    AND d.REV_NBR = d2.REV_NBR )

--Outdoor
UNION 
	SELECT d.ORDER_NBR, d.LINE_NBR, d.REV_NBR, d.SEQ_NBR, d.JOB_NUMBER, d.JOB_COMPONENT_NBR
	  FROM dbo.OUTDOOR_DETAIL AS d
	 WHERE d.ACTIVE_REV = 1 
	   AND d.SEQ_NBR = ( SELECT MAX(d2.SEQ_NBR) 
	                       FROM dbo.OUTDOOR_DETAIL AS d2
						  WHERE d.ORDER_NBR = d2.ORDER_NBR 
						    AND d.LINE_NBR = d2.LINE_NBR 
						    AND d.REV_NBR = d2.REV_NBR )

--Mag (old)
UNION 
	SELECT d.ORDER_NBR, d.LINE_NBR, d.REV_NBR, MAX(d.SEQ_NBR), d.JOB_NUMBER, d.JOB_COMPONENT_NBR
	  FROM dbo.MAG_DETAIL AS d
	 WHERE d.REV_NBR = ( SELECT MAX(d2.REV_NBR) 
						   FROM dbo.MAG_DETAIL AS d2
						  WHERE d.ORDER_NBR = d2.ORDER_NBR 
						    AND d.LINE_NBR = d2.LINE_NBR )
  GROUP BY d.ORDER_NBR, d.LINE_NBR, d.REV_NBR, d.JOB_NUMBER, d.JOB_COMPONENT_NBR

--News (old)
UNION 
	SELECT d.ORDER_NBR, d.LINE_NBR, d.REV_NBR, MAX(d.SEQ_NBR), d.JOB_NUMBER, d.JOB_COMPONENT_NBR
	  FROM dbo.NEWS_DETAIL AS d
	 WHERE d.REV_NBR = ( SELECT MAX(d2.REV_NBR) 
	                       FROM dbo.NEWS_DETAIL AS d2
						  WHERE d.ORDER_NBR = d2.ORDER_NBR AND d.LINE_NBR = d2.LINE_NBR )
  GROUP BY d.ORDER_NBR, d.LINE_NBR, d.REV_NBR, d.JOB_NUMBER, d.JOB_COMPONENT_NBR

--Radio
UNION 
	SELECT d.ORDER_NBR, d.LINE_NBR, d.REV_NBR, MAX(d.SEQ_NBR), d.JOB_NUMBER, d.JOB_COMPONENT_NBR
	  FROM dbo.RADIO_DETAIL1 AS d
	 WHERE d.REV_NBR = ( SELECT MAX(d2.REV_NBR) 
	                       FROM dbo.RADIO_DETAIL1 AS d2
						  WHERE d.ORDER_NBR = d2.ORDER_NBR 
						    AND d.LINE_NBR = d2.LINE_NBR )
  GROUP BY d.ORDER_NBR, d.LINE_NBR, d.REV_NBR, d.JOB_NUMBER, d.JOB_COMPONENT_NBR

--Television
UNION 
	SELECT d.ORDER_NBR, d.LINE_NBR, d.REV_NBR, MAX(d.SEQ_NBR), d.JOB_NUMBER, d.JOB_COMPONENT_NBR
	  FROM dbo.TV_DETAIL1 AS d
	 WHERE d.REV_NBR = ( SELECT MAX(d2.REV_NBR) 
	                       FROM dbo.TV_DETAIL1 AS d2
						  WHERE d.ORDER_NBR = d2.ORDER_NBR 
						    AND d.LINE_NBR = d2.LINE_NBR )	
  GROUP BY d.ORDER_NBR, d.LINE_NBR, d.REV_NBR, d.JOB_NUMBER, d.JOB_COMPONENT_NBR

--Radio (New)
UNION 
	SELECT d.ORDER_NBR, d.LINE_NBR, d.REV_NBR, d.SEQ_NBR, d.JOB_NUMBER, d.JOB_COMPONENT_NBR
	  FROM dbo.RADIO_DETAIL AS d
	 WHERE d.ACTIVE_REV = 1 
	   AND d.SEQ_NBR = ( SELECT MAX(d2.SEQ_NBR) 
			               FROM dbo.RADIO_DETAIL AS d2
						  WHERE d.ORDER_NBR = d2.ORDER_NBR 
							AND d.LINE_NBR = d2.LINE_NBR 
							AND d.REV_NBR = d2.REV_NBR )
--Television (New)
UNION 
	SELECT d.ORDER_NBR, d.LINE_NBR, d.REV_NBR, d.SEQ_NBR, d.JOB_NUMBER, d.JOB_COMPONENT_NBR
	  FROM dbo.TV_DETAIL AS d
	 WHERE d.ACTIVE_REV = 1 
	   AND d.SEQ_NBR = ( SELECT MAX(d2.SEQ_NBR) 
						   FROM dbo.TV_DETAIL AS d2
						  WHERE d.ORDER_NBR = d2.ORDER_NBR 
						    AND d.LINE_NBR = d2.LINE_NBR 
						    AND d.REV_NBR = d2.REV_NBR )
