-- V_PROD_BILLING_DATA_ZERO_AMT
-- #00 08/17/12 - initial version

SET QUOTED_IDENTIFIER ON 
GO

SET ANSI_NULLS ON 
GO

SET ANSI_PADDING OFF
GO

IF EXISTS ( SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID( N'[dbo].[V_PROD_BILLING_DATA_ZERO_AMT]' ) AND OBJECTPROPERTY( id, N'IsView' ) = 1 )
	DROP VIEW [dbo].[V_PROD_BILLING_DATA_ZERO_AMT]
GO

CREATE VIEW dbo.V_PROD_BILLING_DATA_ZERO_AMT 
AS

	SELECT
		p.[USER_ID],
		p.INVOICE_NUMBER,
		p.JOB_NUMBER,
		p.JOB_COMPONENT_NBR,
		p.FNC_CODE,
		CASE 
			WHEN ABS(SUM(p.LINE_TOTAL)) < .01 THEN 0
			ELSE 1
		END AS ZERO_FNC_AMT_CUR,
		CASE 
			WHEN ABS(SUM(p.PRIOR_LINE_TOTAL)) < .01 THEN 0
			ELSE 1
		END AS ZERO_FNC_AMT_PRIOR,
		CASE 
			WHEN ABS(SUM(p.EST_LINE_TOTAL)) < .01 THEN 0
			ELSE 1
		END AS ZERO_FNC_AMT_EST	
	FROM dbo.PROD_BILLING_DATA AS p
	GROUP BY p.[USER_ID], p.INVOICE_NUMBER, p.JOB_NUMBER, p.JOB_COMPONENT_NBR, p.FNC_CODE

GO

IF ( @@ERROR = 0 )
	GRANT ALL ON [V_PROD_BILLING_DATA_ZERO_AMT] TO PUBLIC AS dbo
GO	
