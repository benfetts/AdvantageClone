
CREATE VIEW dbo.WV_CURRENT_EXEC_DESKTOP_DOCUMENTS
AS
SELECT  CASE 
	  WHEN EXEC_DESKTOP_DOCUMENTS.OFFICE_CODE IS NOT NULL AND EXEC_DESKTOP_DOCUMENTS.EMP_CODE IS NULL THEN 'Office' 
	  WHEN EXEC_DESKTOP_DOCUMENTS.OFFICE_CODE IS NULL AND EXEC_DESKTOP_DOCUMENTS.EMP_CODE IS NOT NULL THEN 'Employee' 
	  ELSE 'Executive Desktop' END AS LEVEL,  
		dbo.EXEC_DESKTOP_DOCUMENTS.OFFICE_CODE, dbo.DOCUMENTS.DOCUMENT_ID, 
        dbo.DOCUMENTS.FILENAME, dbo.DOCUMENTS.REPOSITORY_FILENAME, dbo.DOCUMENTS.MIME_TYPE, dbo.DOCUMENTS.DESCRIPTION, 
        dbo.DOCUMENTS.KEYWORDS, dbo.DOCUMENTS.UPLOADED_DATE, dbo.DOCUMENTS.USER_CODE, dbo.DOCUMENTS.FILE_SIZE, 
         dbo.DOCUMENTS.USER_CODE AS [USER_NAME], dbo.DOCUMENT_TYPE.DOCUMENT_TYPE_DESC, ISNULL(dbo.DOCUMENTS.PRIVATE_FLAG, 0) AS PRIVATE_FLAG, dbo.EXEC_DESKTOP_DOCUMENTS.EMP_CODE, 
                      dbo.DOCUMENTS.PROOFHQ_URL
FROM  dbo.EXEC_DESKTOP_DOCUMENTS INNER JOIN
                      dbo.DOCUMENTS ON dbo.EXEC_DESKTOP_DOCUMENTS.DOCUMENT_ID = dbo.DOCUMENTS.DOCUMENT_ID INNER JOIN
                      dbo.DOCUMENT_TYPE ON dbo.DOCUMENTS.DOCUMENT_TYPE_ID = dbo.DOCUMENT_TYPE.DOCUMENT_TYPE_ID 
WHERE (dbo.DOCUMENTS.DOCUMENT_ID IN
                          (SELECT     MAX(EXEC_DESKTOP_DOCUMENTS_1.DOCUMENT_ID) AS DOCUMENT_ID
                            FROM   dbo.EXEC_DESKTOP_DOCUMENTS AS EXEC_DESKTOP_DOCUMENTS_1 INNER JOIN
                                   dbo.DOCUMENTS AS DOCUMENTS_1 ON EXEC_DESKTOP_DOCUMENTS_1.DOCUMENT_ID = DOCUMENTS_1.DOCUMENT_ID
                            GROUP BY EXEC_DESKTOP_DOCUMENTS_1.OFFICE_CODE, DOCUMENTS_1.FILENAME))
