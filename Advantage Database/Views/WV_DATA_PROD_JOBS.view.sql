
CREATE VIEW dbo.WV_DATA_PROD_JOBS
AS
--************************ EMPLOYEE TIME ***********************************
SELECT  JOB_LOG.OFFICE_CODE AS OFFICE_CODE, 
	JOB_LOG.CL_CODE AS CLIENT_CODE, 
	JOB_LOG.DIV_CODE AS DIVISION_CODE, 
	JOB_LOG.PRD_CODE AS PRODUCT_CODE, 
	EMP_TIME_DTL.JOB_NUMBER AS JOB_NUMBER, 
	EMP_TIME_DTL.JOB_COMPONENT_NBR AS JOB_COMPONENT_NUMBER, 
	JOB_LOG.SC_CODE as SALES_CODE, 
	EMP_TIME_DTL.FNC_CODE AS FUNCTION_CODE, 
	FUNCTIONS.FNC_TYPE AS FUNCTION_TYPE, 
	'A' AS RECORD_TYPE, 
	EMP_TIME.EMP_DATE AS ITEM_DATE, 
	EMPLOYEE.EMP_FNAME + ' ' +  EMPLOYEE.EMP_LNAME AS ITEM_DESC, 
	EMP_TIME_DTL.EMP_HOURS AS QTYHOURS, 
	EMP_TIME_DTL.TOTAL_COST AS NET_COST, 
	EMP_TIME_DTL.EXT_MARKUP_AMT AS MARKUP, 
	EMP_TIME_DTL.TOTAL_BILL as AMOUNT,
	0 AS VENDOR_TAX, 
	EMP_TIME_DTL.EXT_STATE_RESALE 
	+ EMP_TIME_DTL.EXT_COUNTY_RESALE 
	+ EMP_TIME_DTL.EXT_CITY_RESALE 	AS RESALE_TAX, 
	EMP_TIME_DTL.AR_INV_NBR AS AR_INVOICE_NUMBER, 
	ISNULL(EMP_TIME_DTL.EMP_NON_BILL_FLAG, 0) AS NONBILL, 
	ACCT_REC.AR_POST_PERIOD AS BILLED_PERIOD, 
	POSTPERIOD.PPPERIOD AS POST_PERIOD,
	EMP_TIME_DTL.GLACODE_SALES AS GL_ACCOUNT_SALES, 
	'' AS GL_ACCOUNT_COS
FROM EMP_TIME 
	INNER JOIN EMP_TIME_DTL 
		ON EMP_TIME.ET_ID = EMP_TIME_DTL.ET_ID 
	INNER JOIN JOB_LOG 
		ON EMP_TIME_DTL.JOB_NUMBER = JOB_LOG.JOB_NUMBER 
	INNER JOIN FUNCTIONS 
		ON EMP_TIME_DTL.FNC_CODE = FUNCTIONS.FNC_CODE
	INNER JOIN EMPLOYEE 
		ON EMP_TIME.EMP_CODE = EMPLOYEE.EMP_CODE
	LEFT OUTER JOIN ACCT_REC 
		ON EMP_TIME_DTL.AR_INV_NBR = ACCT_REC.AR_INV_NBR 
		AND EMP_TIME_DTL.AR_INV_SEQ = ACCT_REC.AR_INV_SEQ
		AND EMP_TIME_DTL.AR_TYPE = ACCT_REC.AR_TYPE
	LEFT OUTER JOIN POSTPERIOD 
		ON EMP_TIME.EMP_DATE >= POSTPERIOD.PPSRTDATE
		AND EMP_TIME.EMP_DATE <= POSTPERIOD.PPENDDATE 
--*******************************************************************************
UNION ALL
--****************************** INCOME ONLY ***************************************
SELECT  JOB_LOG.OFFICE_CODE AS OFFICE_CODE, 
	JOB_LOG.CL_CODE AS CLIENT_CODE, 
	JOB_LOG.DIV_CODE AS DIVISION_CODE, 
	JOB_LOG.PRD_CODE AS PRODUCT_CODE, 
	INCOME_ONLY.JOB_NUMBER AS JOB_NUMBER, 
	INCOME_ONLY.JOB_COMPONENT_NBR AS JOB_COMPONENT_NUMBER, 
	JOB_LOG.SC_CODE as SALES_CODE, 
	INCOME_ONLY.FNC_CODE AS FUNCTION_CODE, 
	FUNCTIONS.FNC_TYPE AS FUNCTION_TYPE, 
	'A' AS RECORD_TYPE, 
	INCOME_ONLY.IO_INV_DATE AS ITEM_DATE, 
	INCOME_ONLY.IO_DESC AS ITEM_DESC, 
	INCOME_ONLY.IO_QTY AS QTYHOURS, 
	0 AS NET_COST, 
	INCOME_ONLY.EXT_MARKUP_AMT AS MARKUP,
	INCOME_ONLY.IO_AMOUNT +  INCOME_ONLY.EXT_MARKUP_AMT as AMOUNT,
	0 AS VENDOR_TAX, 
	INCOME_ONLY.EXT_STATE_RESALE 
	+ INCOME_ONLY.EXT_COUNTY_RESALE 
	+ INCOME_ONLY.EXT_CITY_RESALE 	AS RESALE_TAX, 
	INCOME_ONLY.AR_INV_NBR AS AR_INVOICE_NUMBER, 
	ISNULL(INCOME_ONLY.NON_BILL_FLAG, 0) AS NONBILL, 
	ACCT_REC.AR_POST_PERIOD AS BILLED_PERIOD, 
	POSTPERIOD.PPPERIOD AS POST_PERIOD,
	INCOME_ONLY.GLACODE_SALES AS GL_ACCOUNT_SALES, 
	'' AS GL_ACCOUNT_COS
FROM INCOME_ONLY 
	INNER JOIN JOB_LOG 
		ON INCOME_ONLY.JOB_NUMBER = JOB_LOG.JOB_NUMBER 
	INNER JOIN FUNCTIONS 
		ON INCOME_ONLY.FNC_CODE = FUNCTIONS.FNC_CODE
	LEFT OUTER JOIN ACCT_REC 
		ON INCOME_ONLY.AR_INV_NBR = ACCT_REC.AR_INV_NBR 
		AND INCOME_ONLY.AR_INV_SEQ = ACCT_REC.AR_INV_SEQ
		AND INCOME_ONLY.AR_TYPE = ACCT_REC.AR_TYPE
	LEFT OUTER JOIN POSTPERIOD 
		ON INCOME_ONLY.IO_INV_DATE >= POSTPERIOD.PPSRTDATE
		AND INCOME_ONLY.IO_INV_DATE <= POSTPERIOD.PPENDDATE 
--***************************************************************************
UNION ALL
--****************************** Accounts Payable ***************************
SELECT  JOB_LOG.OFFICE_CODE AS OFFICE_CODE, 
	JOB_LOG.CL_CODE AS CLIENT_CODE, 
	JOB_LOG.DIV_CODE AS DIVISION_CODE, 
	JOB_LOG.PRD_CODE AS PRODUCT_CODE, 
	AP_PRODUCTION.JOB_NUMBER AS JOB_NUMBER, 
	AP_PRODUCTION.JOB_COMPONENT_NBR AS JOB_COMPONENT_NUMBER, 
	JOB_LOG.SC_CODE as SALES_CODE, 
	AP_PRODUCTION.FNC_CODE AS FUNCTION_CODE, 
	FUNCTIONS.FNC_TYPE AS FUNCTION_TYPE, 
	'A' AS RECORD_TYPE, 
	AP_HEADER.AP_INV_DATE AS ITEM_DATE, 
	VENDOR.VN_NAME AS ITEM_DESC, 
	AP_PRODUCTION.AP_PROD_QUANTITY AS QTYHOURS, 
	AP_PRODUCTION.AP_PROD_EXT_AMT AS NET_COST, 
	AP_PRODUCTION.EXT_MARKUP_AMT AS MARKUP, 
	AP_PRODUCTION.AP_PROD_EXT_AMT 
	+ AP_PRODUCTION.EXT_MARKUP_AMT 
	+ AP_PRODUCTION.EXT_NONRESALE_TAX AS AMOUNT,
	AP_PRODUCTION.EXT_NONRESALE_TAX AS VENDOR_TAX, 
	AP_PRODUCTION.EXT_STATE_RESALE 
	+ AP_PRODUCTION.EXT_COUNTY_RESALE 
	+ AP_PRODUCTION.EXT_CITY_RESALE 	AS RESALE_TAX, 
	AP_PRODUCTION.AR_INV_NBR AS AR_INVOICE_NUMBER, 
	ISNULL(AP_PRODUCTION.AP_PROD_NOBILL_FLG, 0) AS NONBILL, 
	ACCT_REC.AR_POST_PERIOD AS BILLED_PERIOD, 
	AP_HEADER.POST_PERIOD AS POST_PERIOD,
	AP_PRODUCTION.GLACODE_SALES AS GL_ACCOUNT_SALES, 
	AP_PRODUCTION.GLACODE_COS AS GL_ACCOUNT_COS
FROM AP_PRODUCTION 
	INNER JOIN AP_HEADER 
		ON AP_PRODUCTION.AP_ID = AP_HEADER.AP_ID 
		AND AP_PRODUCTION.AP_SEQ = AP_HEADER.AP_SEQ 
	INNER JOIN JOB_LOG 
		ON AP_PRODUCTION.JOB_NUMBER = JOB_LOG.JOB_NUMBER 
	INNER JOIN FUNCTIONS 
		ON AP_PRODUCTION.FNC_CODE = FUNCTIONS.FNC_CODE
	INNER JOIN VENDOR 
		ON AP_HEADER.VN_FRL_EMP_CODE = VENDOR.VN_CODE
	LEFT OUTER JOIN ACCT_REC 
		ON AP_PRODUCTION.AR_INV_NBR = ACCT_REC.AR_INV_NBR 
		AND AP_PRODUCTION.AR_INV_SEQ = ACCT_REC.AR_INV_SEQ
		AND AP_PRODUCTION.AR_TYPE = ACCT_REC.AR_TYPE
--***************************************************************************
UNION ALL
--************************* Adv Billing **********************************
SELECT  JOB_LOG.OFFICE_CODE AS OFFICE_CODE, 
	JOB_LOG.CL_CODE AS CLIENT_CODE, 
	JOB_LOG.DIV_CODE AS DIVISION_CODE, 
	JOB_LOG.PRD_CODE AS PRODUCT_CODE, 
	ADVANCE_BILLING.JOB_NUMBER AS JOB_NUMBER, 
	ADVANCE_BILLING.JOB_COMPONENT_NBR AS JOB_COMPONENT_NUMBER, 
	JOB_LOG.SC_CODE as SALES_CODE, 
	ADVANCE_BILLING.FNC_CODE AS FUNCTION_CODE, 
	FUNCTIONS.FNC_TYPE AS FUNCTION_TYPE, 
	'P' AS RECORD_TYPE, 
	ADVANCE_BILLING.CREATE_DATE AS ITEM_DATE, 
	'Advance Billing' AS ITEM_DESC, 
	0 AS QTYHOURS, 
	ADVANCE_BILLING.ADV_BILL_NET_AMT AS NET_COST, 
	ADVANCE_BILLING.EXT_MARKUP_AMT AS MARKUP, 
	ADVANCE_BILLING.ADV_BILL_NET_AMT + ADVANCE_BILLING.EXT_MARKUP_AMT + ADVANCE_BILLING.EXT_NONRESALE_TAX 
AS AMOUNT,
	ADVANCE_BILLING.EXT_NONRESALE_TAX AS VENDOR_TAX, 
	ADVANCE_BILLING.EXT_STATE_RESALE 
	+ ADVANCE_BILLING.EXT_COUNTY_RESALE 
	+ ADVANCE_BILLING.EXT_CITY_RESALE 	AS RESALE_TAX, 
	ADVANCE_BILLING.AR_INV_NBR AS AR_INVOICE_NUMBER, 
	0 AS NONBILL, 
	ACCT_REC.AR_POST_PERIOD AS BILLED_PERIOD, 
	ACCT_REC.AR_POST_PERIOD AS POST_PERIOD,
	ADVANCE_BILLING.GLACODE_SALES AS GL_ACCOUNT_SALES, 
	'' AS GL_ACCOUNT_COS
FROM  ADVANCE_BILLING
	INNER JOIN JOB_LOG 
		ON ADVANCE_BILLING.JOB_NUMBER = JOB_LOG.JOB_NUMBER 
	INNER JOIN FUNCTIONS 
		ON ADVANCE_BILLING.FNC_CODE = FUNCTIONS.FNC_CODE
	LEFT OUTER JOIN ACCT_REC 
		ON ADVANCE_BILLING.AR_INV_NBR = ACCT_REC.AR_INV_NBR 
		AND ADVANCE_BILLING.AR_INV_SEQ = ACCT_REC.AR_INV_SEQ
		AND ADVANCE_BILLING.AR_TYPE = ACCT_REC.AR_TYPE
--***************************************************************************
UNION ALL
--******************** Income Rec ***************************************
SELECT  JOB_LOG.OFFICE_CODE AS OFFICE_CODE, 
	JOB_LOG.CL_CODE AS CLIENT_CODE, 
	JOB_LOG.DIV_CODE AS DIVISION_CODE, 
	JOB_LOG.PRD_CODE AS PRODUCT_CODE, 
	INCOME_REC.JOB_NUMBER AS JOB_NUMBER, 
	INCOME_REC.JOB_COMPONENT_NBR AS JOB_COMPONENT_NUMBER, 
	JOB_LOG.SC_CODE as SALES_CODE, 
	'' AS FUNCTION_CODE, 
	'' AS FUNCTION_TYPE, 
	'I' AS RECORD_TYPE, 
	INCOME_REC.CREATE_DATE AS ITEM_DATE, 
	'' AS ITEM_DESC, 
	0 AS QTYHOURS, 
	0 AS NET_COST, 
	0 AS MARKUP, 
	INCOME_REC.REC_AMT AS AMOUNT,
	0 AS VENDOR_TAX, 
	0 AS RESALE_TAX, 
	INCOME_REC.AR_INV_NBR AS AR_INVOICE_NUMBER, 
	0 AS NONBILL, 
	ACCT_REC.AR_POST_PERIOD AS BILLED_PERIOD, 
	ACCT_REC.AR_POST_PERIOD AS POST_PERIOD,
	INCOME_REC.GLACODE_SALES AS GL_ACCOUNT_SALES, 
	'' AS GL_ACCOUNT_COS
FROM  INCOME_REC 
	INNER JOIN JOB_LOG 
		ON INCOME_REC.JOB_NUMBER = JOB_LOG.JOB_NUMBER 
	LEFT OUTER JOIN ACCT_REC 
		ON INCOME_REC.AR_INV_NBR = ACCT_REC.AR_INV_NBR 
		AND INCOME_REC.AR_INV_SEQ = ACCT_REC.AR_INV_SEQ
		AND INCOME_REC.AR_TYPE = ACCT_REC.AR_TYPE



