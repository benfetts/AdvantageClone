CREATE PROCEDURE [dbo].[advsp_update_national_hutput_with_corrections]
AS
UPDATE h SET 
	HOUSEHOLD_HUT = nhc.HOUSEHOLD_HUT,
	FEMALES_2TO5_PUT = nhc.FEMALES_2TO5_PUT,
	FEMALES_6TO8_PUT = nhc.FEMALES_6TO8_PUT,
	FEMALES_9TO11_PUT = nhc.FEMALES_9TO11_PUT,
	FEMALES_12TO14_PUT = nhc.FEMALES_12TO14_PUT,
	FEMALES_15TO17_PUT = nhc.FEMALES_15TO17_PUT,
	FEMALES_18TO20_PUT = nhc.FEMALES_18TO20_PUT,
	FEMALES_21TO24_PUT = nhc.FEMALES_21TO24_PUT,
	FEMALES_25TO29_PUT = nhc.FEMALES_25TO29_PUT,
	FEMALES_30TO34_PUT = nhc.FEMALES_30TO34_PUT,
	FEMALES_35TO39_PUT = nhc.FEMALES_35TO39_PUT,
	FEMALES_40TO44_PUT = nhc.FEMALES_40TO44_PUT,
	FEMALES_45TO49_PUT = nhc.FEMALES_45TO49_PUT,
	FEMALES_50TO54_PUT = nhc.FEMALES_50TO54_PUT,
	FEMALES_55TO64_PUT = nhc.FEMALES_55TO64_PUT,
	FEMALES_65PLUS_PUT = nhc.FEMALES_65PLUS_PUT,
	MALES_2TO5_PUT = nhc.MALES_2TO5_PUT,
	MALES_6TO8_PUT = nhc.MALES_6TO8_PUT,
	MALES_9TO11_PUT = nhc.MALES_9TO11_PUT,
	MALES_12TO14_PUT = nhc.MALES_12TO14_PUT,
	MALES_15TO17_PUT = nhc.MALES_15TO17_PUT,
	MALES_18TO20_PUT = nhc.MALES_18TO20_PUT,
	MALES_21TO24_PUT = nhc.MALES_21TO24_PUT,
	MALES_25TO29_PUT = nhc.MALES_25TO29_PUT,
	MALES_30TO34_PUT = nhc.MALES_30TO34_PUT,
	MALES_35TO39_PUT = nhc.MALES_35TO39_PUT,
	MALES_40TO44_PUT = nhc.MALES_40TO44_PUT,
	MALES_45TO49_PUT = nhc.MALES_45TO49_PUT,
	MALES_50TO54_PUT = nhc.MALES_50TO54_PUT,
	MALES_55TO64_PUT = nhc.MALES_55TO64_PUT,
	MALES_65PLUS_PUT = nhc.MALES_65PLUS_PUT,
	WORKING_WOMEN_18TO20_PUT = nhc.WORKING_WOMEN_18TO20_PUT,
	WORKING_WOMEN_21TO24_PUT = nhc.WORKING_WOMEN_21TO24_PUT,
	WORKING_WOMEN_25TO34_PUT = nhc.WORKING_WOMEN_25TO34_PUT,
	WORKING_WOMEN_35TO44_PUT = nhc.WORKING_WOMEN_35TO44_PUT,
	WORKING_WOMEN_45TO49_PUT = nhc.WORKING_WOMEN_45TO49_PUT,
	WORKING_WOMEN_50TO54_PUT = nhc.WORKING_WOMEN_50TO54_PUT,
	WORKING_WOMEN_55PLUS_PUT = nhc.WORKING_WOMEN_55PLUS_PUT	
FROM dbo.NATIONAL_HUTPUT h
	INNER JOIN dbo.NATIONAL_DATA d on h.NATIONAL_DATA_ID = d.NATIONAL_DATA_ID 
	INNER JOIN dbo.NATIONAL_HUTPUT_CORRECTION nhc ON d.MARKET_BREAK_ID = nhc.MARKET_BREAK_ID and d.DATA_TYPE = nhc.DATA_TYPE AND d.STREAM = nhc.STREAM 
									AND h.HUTPUT_DATETIME = nhc.HUTPUT_DATETIME AND h.FEED_PATTERN = nhc.FEED_PATTERN
	INNER JOIN (
				select MAX([START_DATE]) AS [START_DATE],[MARKET_BREAK_ID],
					[DATA_TYPE] ,
					[STREAM] ,
					[HUTPUT_DATETIME] ,
					[FEED_PATTERN]
				FROM NATIONAL_HUTPUT_CORRECTION
				group by [MARKET_BREAK_ID],
					[DATA_TYPE],
					[STREAM],
					[HUTPUT_DATETIME],
					[FEED_PATTERN]
				) m ON m.[START_DATE] = nhc.[START_DATE]
							AND m.[MARKET_BREAK_ID] = nhc.[MARKET_BREAK_ID]
							AND m.[DATA_TYPE] = nhc.[DATA_TYPE]
							AND m.[STREAM] = nhc.[STREAM]
							AND m.[HUTPUT_DATETIME] = nhc.[HUTPUT_DATETIME]
							AND m.[FEED_PATTERN] = nhc.[FEED_PATTERN]
