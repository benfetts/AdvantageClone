CREATE PROCEDURE [dbo].[advsp_hosted_spotradio_nielsen_county_get_market_numbers]
	@CLIENT_CODE varchar(6)
AS
BEGIN
	SELECT DISTINCT nrcp.NIELSEN_RADIO_MARKET_NUMBER
	FROM dbo.CLIENT c
		INNER JOIN dbo.CLIENT_ORDER co ON c.CLIENT_ID = co.CLIENT_ID AND co.IS_SUSPENDED = 0 AND co.ALL_STATES = 0
		INNER JOIN dbo.CLIENT_ORDER_STATE com ON co.CLIENT_ORDER_ID = com.CLIENT_ORDER_ID
		INNER JOIN dbo.NIELSEN_RADIO_COUNTY_PERIOD nrcp ON nrcp.[STATE] = com.[STATE]
	WHERE co.ORDER_TYPE = 'C'
	AND c.CODE = @CLIENT_CODE
	
	UNION

	SELECT NUMBER 
	FROM dbo.NIELSEN_RADIO_MARKET nrm
	WHERE nrm.[SOURCE] = 2
	AND EXISTS (
		SELECT 1
		FROM dbo.CLIENT c
				INNER JOIN dbo.CLIENT_ORDER co ON c.CLIENT_ID = co.CLIENT_ID AND co.IS_SUSPENDED = 0 AND co.ALL_STATES = 1
		WHERE co.ORDER_TYPE = 'C'
		AND c.CODE = @CLIENT_CODE)
END
GO

GRANT EXEC ON [advsp_hosted_spotradio_nielsen_county_get_market_numbers] TO PUBLIC
GO