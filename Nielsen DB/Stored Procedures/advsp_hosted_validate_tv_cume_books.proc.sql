CREATE PROC [dbo].[advsp_hosted_validate_tv_cume_books]
AS

UPDATE h SET h.VALIDATED = 1
FROM NIELSENHOSTED.dbo.NIELSEN_TV_CUME_BOOK h
	INNER JOIN NIELSENDATASTORE.dbo.NIELSEN_TV_CUME_BOOK h2 ON h.NIELSEN_TV_CUME_BOOK_ID = h2.NIELSEN_TV_CUME_BOOK_ID 
WHERE h.VALIDATED = 0
AND (
	SELECT COUNT(1) 
	FROM NIELSENHOSTED.[dbo].[NIELSEN_TV_CUME_DAYPART_IMPRESSION]
	WHERE NIELSEN_TV_CUME_BOOK_ID = h.NIELSEN_TV_CUME_BOOK_ID
	) = 
	(
	SELECT COUNT(1) 
	FROM NIELSENDATASTORE.[dbo].[NIELSEN_TV_CUME_DAYPART_IMPRESSION]
	WHERE NIELSEN_TV_CUME_BOOK_ID = h.NIELSEN_TV_CUME_BOOK_ID
	)
GO

GRANT EXEC ON [advsp_hosted_validate_tv_cume_books] TO PUBLIC
GO