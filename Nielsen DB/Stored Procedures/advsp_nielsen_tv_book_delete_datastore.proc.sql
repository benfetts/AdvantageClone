CREATE PROCEDURE [dbo].[advsp_nielsen_tv_book_delete_datastore]
AS

declare @NIELSEN_TV_BOOK_ID int

SELECT NIELSEN_TV_BOOK_ID 
INTO #TV_BOOK_CLEANUP
FROM NIELSENHOSTED.dbo.NIELSEN_TV_BOOK 
WHERE VALIDATED = 1

WHILE (SELECT COUNT(1) FROM #TV_BOOK_CLEANUP) > 0
BEGIN

	SELECT TOP 1 @NIELSEN_TV_BOOK_ID = NIELSEN_TV_BOOK_ID FROM #TV_BOOK_CLEANUP

	exec NIELSENDATASTORE.dbo.advsp_neilsen_tv_book_delete @NIELSEN_TV_BOOK_ID

	DELETE #TV_BOOK_CLEANUP WHERE NIELSEN_TV_BOOK_ID = @NIELSEN_TV_BOOK_ID 

END
GO
