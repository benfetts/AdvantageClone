IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'[dbo].[advsp_agile_update_workitemhours]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
    DROP PROCEDURE [dbo].[advsp_agile_update_workitemhours]
GO
CREATE PROCEDURE [dbo].[advsp_agile_update_workitemhours] 
@ALERT_ID INT
AS
/*=========== QUERY ===========*/
BEGIN

	DECLARE
		@JOB_NUMBER INT,
		@JOB_COMPONENT_NBR SMALLINT,
		@TASK_SEQ_NBR SMALLINT,
		@ALERT_LEVEL VARCHAR(50),
		@LAST_HOURS DECIMAL (7,2),
		@HOURS DECIMAL (7,2)

	SELECT
		@JOB_NUMBER = A.JOB_NUMBER,
		@JOB_COMPONENT_NBR = A.JOB_COMPONENT_NBR,
		@TASK_SEQ_NBR = A.TASK_SEQ_NBR,
		@ALERT_LEVEL = A.ALERT_LEVEL,
		@LAST_HOURS = ISNULL(A.HRS_ALLOWED, 0.00)
	FROM
		ALERT A WITH(NOLOCK)
	WHERE
		A.IS_WORK_ITEM = 1
		AND A.ALERT_ID = @ALERT_ID;

	SELECT 
		@HOURS = SUM([HOURS]) 
	FROM 
		SPRINT_EMPLOYEE SE WITH(NOLOCK)
	WHERE 
		ALERT_ID = @ALERT_ID;

	--IF NOT @ALERT_LEVEL = 'BRD'
	--BEGIN
	--	UPDATE ALERT WITH(ROWLOCK) SET HRS_ALLOWED = @HOURS WHERE ALERT_ID = @ALERT_ID;
	--END

END
/*=========== QUERY ===========*/
GO


