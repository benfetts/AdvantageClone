CREATE PROCEDURE [dbo].[advsp_invoice_printing_settings] ( 
	@IsOneTime AS bit
)
AS
BEGIN

	SELECT
		[ProductionInvoicePrintingOptionsID] = IPS.ProductionInvoicePrintingOptionsID,	
		[IsOneTime] = IPS.IsOneTime,
		[Type] = IPS.[Type],
		[ClientCode] = IPS.ClientCode,
		[IncludeBackupReport] = IPS.IncludeBackupReport,
		[AddressBlockType] = IPS.AddressBlockType,
		[IncludeClientReference] = IPS.IncludeClientReference,
		[IncludeClientPO] = IPS.IncludeClientPO,
		[IncludeAccountExecutive] = IPS.IncludeAccountExecutive,
		[IncludeSalesClass] = IPS.IncludeSalesClass,
		[IncludeBillingComment] = IPS.IncludeBillingComment,
		[IncludeBillingApprovalClientComment] = IPS.IncludeBillingApprovalClientComment,
		[IncludeJobComment] = IPS.IncludeJobComment,
		[IncludeJobComponentComment] = IPS.IncludeJobComponentComment,
		[IncludeEstimateComment] = IPS.IncludeEstimateComment,
		[IncludeEstimateComponentComment] = IPS.IncludeEstimateComponentComment,
		[IncludeEstimateQuoteComment] = IPS.IncludeEstimateQuoteComment,
		[IncludeEstimateRevisionComment] = IPS.IncludeEstimateRevisionComment,
		[IncludeEstimateFunctionComment] = IPS.IncludeEstimateFunctionComment,
		[ReportFormatType] = IPS.ReportFormatType,
		[ShowEmployeeHours] = IPS.ShowEmployeeHours,
		[ShowQuantity] = IPS.ShowQuantity,
		[ApplyExchangeRate] = IPS.ApplyExchangeRate,
		[ExchangeRateAmount] = IPS.ExchangeRateAmount,
		[GroupingOptionType] = IPS.GroupingOptionType,
		[GroupingOptionInsideDescription] = IPS.GroupingOptionInsideDescription,
		[GroupingOptionOutsideDescription] = IPS.GroupingOptionOutsideDescription,
		[SortFunctionByType] = IPS.SortFunctionByType,
		[PrintFunctionType] = IPS.PrintFunctionType,
		[ShowFunctionDetail] = IPS.ShowFunctionDetail,
		[ShowZeroFunctionAmounts] = IPS.ShowZeroFunctionAmounts,
		[TotalsShowCommissionSeparately] = IPS.TotalsShowCommissionSeparately,
		[TotalsShowTaxSeparately] = IPS.TotalsShowTaxSeparately,
		[TotalsShowBillingHistory] = IPS.TotalsShowBillingHistory,
		[InvoiceFooterCommentType] = IPS.InvoiceFooterCommentType,
		[InvoiceFooterComment] = IPS.InvoiceFooterComment,
		[LocationCode] = IPS.LocationCode,
		[UseLocationPrintOptions] = IPS.UseLocationPrintOptions,
		[BackupReportColumnOption] = IPS.BackupReportColumnOption,
		[BackupReportCommentOptionEmployeeTimeFunction] = IPS.BackupReportCommentOptionEmployeeTimeFunction,
		[BackupReportCommentOptionAccountsPayableFunction] = IPS.BackupReportCommentOptionAccountsPayableFunction,
		[BackupReportCommentOptionIncomeOnlyFunction] = IPS.BackupReportCommentOptionIncomeOnlyFunction,
		[BackupReportCommentOptionBillingApprovalClientFunction] = IPS.BackupReportCommentOptionBillingApprovalClientFunction,
		[CustomFormatName] = IPS.CustomFormatName,
		[PrintDivisionName] = IPS.PrintDivisionName,
		[PrintProductDescription] = IPS.PrintProductDescription,
		[HideComponentNumberAndDescription] = IPS.HideComponentNumberAndDescription,
		[InvoiceTitle] = IPS.InvoiceTitle,
		[UseInvoiceCategoryDescription] = IPS.UseInvoiceCategoryDescription,
		[IncludeInvoiceDueDate] = IPS.IncludeInvoiceDueDate,
		[PrintContactAfterAddress] = IPS.PrintContactAfterAddress,
		[IndicateTaxableFunctions] = IPS.IndicateTaxableFunctions,
		[HideFunctionTotals] = IPS.HideFunctionTotals,
		[PageHeaderComment] = CASE WHEN L.PRT_HDR = 1 THEN L.LOC_HDR ELSE '' END,
		[PageFooterComment] = CASE WHEN L.PRT_FTR = 1 THEN L.LOC_FTR ELSE '' END,
		[PageHeaderLogoPath] = CASE WHEN L.LOGO_LOCATION = 'C' THEN L.DFLT_LOGO_PATH ELSE '' END,
		[PageHeaderLogoPathLandscape] = CASE WHEN L.LOGO_LOCATION = 'C' THEN L.DFLT_LOGO_PATH_LAND ELSE '' END,
		[PageFooterLogoPath] = CASE WHEN L.LOGO_LOCATION_2 = 'C' THEN L.DFLT_LOGO_PATH_2 ELSE '' END,
		[PageFooterLogoPathLandscape] = CASE WHEN L.LOGO_LOCATION_2 = 'C' THEN L.DFLT_LOGO_PATH_LAND_2 ELSE '' END,
		[CityTaxLabel] = CTL.FIELD_DESCRIPTION, 
		[CountyTaxLabel] = COTL.FIELD_DESCRIPTION, 
		[StateTaxLabel] = STL.FIELD_DESCRIPTION, 
		[CustomInvoiceID] = IPS.CustomInvoiceID, 
		[ClientPOLocation] = IPS.ClientPOLocation, 
		[HideJobInfo] = IPS.HideJobInfo, 
		[PrintClientName] = IPS.PrintClientName, 
		[ShowCampaign] = IPS.ShowCampaign, 
		[ShowCampaignComment] = IPS.ShowCampaignComment, 
		[ShowCodes] = IPS.ShowCodes, 
		[TaxTotalLocation] = IPS.TaxTotalLocation, 
		[ClientRefLocation] = IPS.ClientRefLocation, 
		[SalesClassLocation] = IPS.SalesClassLocation,
		[CampaignLocation] = IPS.CampaignLocation,
		[HeaderGroupBy] = IPS.HeaderGroupBy,
		[ShowEmployeeTimeDescription] = IPS.ShowEmployeeTimeDescription,
		[ShowEmployeeTimeDate] = IPS.ShowEmployeeTimeDate,
		[ShowEmployeeTimeRate] = IPS.ShowEmployeeTimeRate,
		[ShowIncomeOnlyDescription] = IPS.ShowIncomeOnlyDescription,
		[ShowIncomeOnlyDate] = IPS.ShowIncomeOnlyDate,
		[ShowIncomeOnlyRate] = IPS.ShowIncomeOnlyRate,
		[ShowAPDescription] = IPS.ShowAPDescription,
		[ShowAPDate] = IPS.ShowAPDate,
		[ShowAPRate] = IPS.ShowAPRate,
		[ContactType] = IPS.ContactType,
		[ShowEmployeeTimeFunctionComment] = IPS.ShowEmployeeTimeFunctionComment,
		[ShowAccountsPayableFunctionComment] = IPS.ShowAccountsPayableFunctionComment,
		[ShowIncomeOnlyFunctionComment] = IPS.ShowIncomeOnlyFunctionComment,
		[SummaryLevel] = IPS.[SummaryLevel],
		[ClientDaysToPay] = IPS.[ClientDaysToPay],
		[BreakupByJobComponent] = IPS.[BreakupByJobComponent],
		[HideExchangeRateMessage] = IPS.[HideExchangeRateMessage],
		[ShowPageHeaderLogo] = CAST(CASE WHEN L.LOGO_LOCATION = 'C' THEN 1 ELSE 0 END AS bit),
		[ShowPageFooterLogo] = CAST(CASE WHEN L.LOGO_LOCATION_2 = 'C' THEN 1 ELSE 0 END AS bit)
	FROM
		(SELECT 
				[ProductionInvoicePrintingOptionsID] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN ISNULL(CD.PROD_INV_DEF_ID, AD.PROD_INV_DEF_ID) ELSE OT.PROD_INV_DEF_ID END, 0) AS int),	
				[IsOneTime] = CAST(ISNULL(@IsOneTime, 0) AS bit),		
				[Type] = CAST(CASE @IsOneTime WHEN 0 THEN ISNULL(CD.CLIENT_OR_DEF, AD.CLIENT_OR_DEF) ELSE OT.CLIENT_OR_DEF END AS smallint),
				[ClientCode] = C.CL_CODE,					    
				[LocationCode] = CASE WHEN ISNULL(C.INVOICE_LOCATION_ID, '') = '' THEN CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN ISNULL(AD.PRT_LOC_PG_FTR_DEF, OT.PRT_LOC_PG_FTR_DEF) ELSE ISNULL(CD.PRT_LOC_PG_FTR_DEF, AD.PRT_LOC_PG_FTR_DEF) END ELSE OT.PRT_LOC_PG_FTR_DEF END ELSE C.INVOICE_LOCATION_ID END,
				[UseLocationPrintOptions] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN CASE WHEN ISNULL(ISNULL(AD.PRT_LOC_PG_FTR, OT.PRT_LOC_PG_FTR), 1) = 1 THEN 0 ELSE 1 END ELSE CASE WHEN ISNULL(ISNULL(CD.PRT_LOC_PG_FTR, AD.PRT_LOC_PG_FTR), 1) = 1 THEN 0 ELSE 1 END END ELSE CASE WHEN ISNULL(OT.PRT_LOC_PG_FTR, 1) = 1 THEN 0 ELSE 1 END END, 0) AS bit),       
				[IncludeBackupReport] = CAST(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN CASE WHEN ISNULL(AD.DTL_BCKUP_RPT_INCL, 1) = 1 THEN 0 ELSE 1 END ELSE CASE WHEN CD.DTL_BCKUP_RPT_INCL IS NOT NULL THEN CASE WHEN CD.DTL_BCKUP_RPT_INCL = 1 THEN 0 ELSE 1 END ELSE CASE WHEN ISNULL(AD.DTL_BCKUP_RPT_INCL, 1) = 1 THEN 0 ELSE 1 END END END ELSE CASE WHEN ISNULL(OT.DTL_BCKUP_RPT_INCL, 1) = 1 THEN 0 ELSE 1 END END AS bit),
				[AddressBlockType] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.ADDRESS_BLOCK ELSE ISNULL(CD.ADDRESS_BLOCK, AD.ADDRESS_BLOCK) END ELSE OT.ADDRESS_BLOCK END, 1) AS smallint),
				[IncludeClientReference] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.INV_REF_INCL ELSE ISNULL(CD.INV_REF_INCL, AD.INV_REF_INCL) END ELSE OT.INV_REF_INCL END, 0) AS bit),
				[IncludeClientPO] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.INV_CL_PO_INCL ELSE ISNULL(CD.INV_CL_PO_INCL, AD.INV_CL_PO_INCL) END ELSE OT.INV_CL_PO_INCL END, 0) AS bit),
				[IncludeAccountExecutive] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.INV_AE_INCL ELSE ISNULL(CD.INV_AE_INCL, AD.INV_AE_INCL) END ELSE OT.INV_AE_INCL END, 0) AS bit),
				[IncludeSalesClass] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.INV_CLASS_INCL ELSE ISNULL(CD.INV_CLASS_INCL, AD.INV_CLASS_INCL) END ELSE OT.INV_CLASS_INCL END, 0) AS bit),
				[IncludeBillingComment] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.BILL_COMM_INV_INCL ELSE ISNULL(CD.BILL_COMM_INV_INCL, AD.BILL_COMM_INV_INCL) END ELSE OT.BILL_COMM_INV_INCL END, 0) AS bit),
				[IncludeBillingApprovalClientComment] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.BILL_APPR_CL_COMM_INCL ELSE ISNULL(CD.BILL_APPR_CL_COMM_INCL, AD.BILL_APPR_CL_COMM_INCL) END ELSE OT.BILL_APPR_CL_COMM_INCL END, 0) AS bit),
				[IncludeJobComment] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.JOB_COMM_INCL ELSE ISNULL(CD.JOB_COMM_INCL, AD.JOB_COMM_INCL) END ELSE OT.JOB_COMM_INCL END, 0) AS bit),
				[IncludeJobComponentComment] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.COMP_COMM_INCL ELSE ISNULL(CD.COMP_COMM_INCL, AD.COMP_COMM_INCL) END ELSE OT.COMP_COMM_INCL END, 0) AS bit),
				[IncludeEstimateComment] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.EST_COMM_INCL ELSE ISNULL(CD.EST_COMM_INCL, AD.EST_COMM_INCL) END ELSE OT.EST_COMM_INCL END, 0) AS bit),
				[IncludeEstimateComponentComment] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.EST_COMP_COMM_INCL ELSE ISNULL(CD.EST_COMP_COMM_INCL, AD.EST_COMP_COMM_INCL) END ELSE OT.EST_COMP_COMM_INCL END, 0) AS bit),
				[IncludeEstimateQuoteComment] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.EST_QTE_COMM_INCL ELSE ISNULL(CD.EST_QTE_COMM_INCL, AD.EST_QTE_COMM_INCL) END ELSE OT.EST_QTE_COMM_INCL END, 0) AS bit),
				[IncludeEstimateRevisionComment] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.EST_REV_COMM_INCL ELSE ISNULL(CD.EST_REV_COMM_INCL, AD.EST_REV_COMM_INCL) END ELSE OT.EST_REV_COMM_INCL END, 0) AS bit),
				[IncludeEstimateFunctionComment] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.INCLUDE_ESTIMATE_FUNCTION_COMMENT ELSE ISNULL(CD.INCLUDE_ESTIMATE_FUNCTION_COMMENT, AD.INCLUDE_ESTIMATE_FUNCTION_COMMENT) END ELSE OT.INCLUDE_ESTIMATE_FUNCTION_COMMENT END, 0) AS bit),
				[ReportFormatType] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.COL_OPTION ELSE CD.COL_OPTION END ELSE OT.COL_OPTION END, 1) AS smallint),
				[ShowEmployeeHours] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.COL_OPT_HRS ELSE ISNULL(CD.COL_OPT_HRS, AD.COL_OPT_HRS) END ELSE OT.COL_OPT_HRS END, 0) AS bit),
				[ShowQuantity] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.COL_OPT_QTY ELSE ISNULL(CD.COL_OPT_QTY, AD.COL_OPT_QTY) END ELSE OT.COL_OPT_QTY END, 0) AS bit),
				[ApplyExchangeRate] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.COL_OPT_XCHGE_AMTS ELSE ISNULL(CD.COL_OPT_XCHGE_AMTS, AD.COL_OPT_XCHGE_AMTS) END ELSE OT.COL_OPT_XCHGE_AMTS END, 0) AS smallint),
				[ExchangeRateAmount] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.COL_OPT_XCHGE_DEF ELSE ISNULL(CD.COL_OPT_XCHGE_DEF, AD.COL_OPT_XCHGE_DEF) END ELSE OT.COL_OPT_XCHGE_DEF END, 1) AS decimal(10,4)),
				[GroupingOptionType] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.GRP_OPTION ELSE ISNULL(CD.GRP_OPTION, AD.GRP_OPTION) END ELSE OT.GRP_OPTION END, 1) AS smallint),
				[GroupingOptionInsideDescription] = CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.GRP_INSIDE_DESC ELSE ISNULL(CD.GRP_INSIDE_DESC, AD.GRP_INSIDE_DESC) END ELSE OT.GRP_INSIDE_DESC END,   
				[GroupingOptionOutsideDescription] = CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.GRP_OUTSIDE_DESC ELSE ISNULL(CD.GRP_OUTSIDE_DESC, AD.GRP_OUTSIDE_DESC) END ELSE OT.GRP_OUTSIDE_DESC END,   
				[SortFunctionByType] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.FNC_SORT_BY ELSE ISNULL(CD.FNC_SORT_BY, AD.FNC_SORT_BY) END ELSE OT.FNC_SORT_BY END, 1) AS smallint),
				[PrintFunctionType] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.FNC_FNC_CODE ELSE ISNULL(CD.FNC_FNC_CODE, AD.FNC_FNC_CODE) END ELSE OT.FNC_FNC_CODE END, 1) AS smallint),
				[ShowFunctionDetail] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.SHOW_FNC_DTL ELSE ISNULL(CD.SHOW_FNC_DTL, AD.SHOW_FNC_DTL) END ELSE OT.SHOW_FNC_DTL END, 0) AS bit),
				[ShowZeroFunctionAmounts] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.SHOW_ZERO_FNC ELSE ISNULL(CD.SHOW_ZERO_FNC, AD.SHOW_ZERO_FNC) END ELSE OT.SHOW_ZERO_FNC END, 0) AS bit),
				[TotalsShowCommissionSeparately] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.TOT_SHOW_COMM ELSE ISNULL(CD.TOT_SHOW_COMM, AD.TOT_SHOW_COMM) END ELSE OT.TOT_SHOW_COMM END, 0) AS bit),
				[TotalsShowTaxSeparately] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.TOT_SHOW_TAX ELSE ISNULL(CD.TOT_SHOW_TAX, AD.TOT_SHOW_TAX) END ELSE OT.TOT_SHOW_TAX END, 0) AS bit),
				[TotalsShowBillingHistory] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.TOT_SHOW_BILL_HIST ELSE ISNULL(CD.TOT_SHOW_BILL_HIST, AD.TOT_SHOW_BILL_HIST) END ELSE OT.TOT_SHOW_BILL_HIST END, 0) AS bit),
				[InvoiceFooterCommentType] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.TOT_PAYMNT_TERMS ELSE ISNULL(CD.TOT_PAYMNT_TERMS, AD.TOT_PAYMNT_TERMS) END ELSE OT.TOT_PAYMNT_TERMS END, 1) AS smallint),
				[InvoiceFooterComment] = CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.TOT_PAYMNT_TERMS_DEF ELSE ISNULL(CD.TOT_PAYMNT_TERMS_DEF, AD.TOT_PAYMNT_TERMS_DEF) END ELSE OT.TOT_PAYMNT_TERMS_DEF END,   
				[BackupReportColumnOption] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.BACKUP_COL_OPT ELSE ISNULL(CD.BACKUP_COL_OPT, AD.BACKUP_COL_OPT) END ELSE OT.BACKUP_COL_OPT END, 1) AS smallint),
				[BackupReportCommentOptionEmployeeTimeFunction] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.BACKUP_ET_COL_OPT ELSE ISNULL(CD.BACKUP_ET_COL_OPT, AD.BACKUP_ET_COL_OPT) END ELSE OT.BACKUP_ET_COL_OPT END, 0) AS bit),
				[BackupReportCommentOptionAccountsPayableFunction] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.BACKUP_AP_COL_OPT ELSE ISNULL(CD.BACKUP_AP_COL_OPT, AD.BACKUP_AP_COL_OPT) END ELSE OT.BACKUP_AP_COL_OPT END, 0) AS bit),
				[BackupReportCommentOptionIncomeOnlyFunction] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.BACKUP_IO_COL_OPT ELSE ISNULL(CD.BACKUP_IO_COL_OPT, AD.BACKUP_IO_COL_OPT) END ELSE OT.BACKUP_IO_COL_OPT END, 0) AS bit),
				[BackupReportCommentOptionBillingApprovalClientFunction] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.BACKUP_BA_CL_FNC_CMT ELSE ISNULL(CD.BACKUP_BA_CL_FNC_CMT, AD.BACKUP_BA_CL_FNC_CMT) END ELSE OT.BACKUP_BA_CL_FNC_CMT END, 0) AS bit),
				[CustomFormatName] = CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.CUSTOM_FORMAT ELSE CD.CUSTOM_FORMAT END ELSE OT.CUSTOM_FORMAT END,   
				[PrintDivisionName] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.PRINT_DIV_NAME ELSE ISNULL(CD.PRINT_DIV_NAME, AD.PRINT_DIV_NAME) END ELSE OT.PRINT_DIV_NAME END, 0) AS bit),
				[PrintProductDescription] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.PRINT_PRD_DESC ELSE ISNULL(CD.PRINT_PRD_DESC, AD.PRINT_PRD_DESC) END ELSE OT.PRINT_PRD_DESC END, 0) AS bit),
				[HideComponentNumberAndDescription] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.COMPONENT_INCL ELSE ISNULL(CD.COMPONENT_INCL, AD.COMPONENT_INCL) END ELSE OT.COMPONENT_INCL END, 0) AS bit),
				[InvoiceTitle] = CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.INV_TITLE ELSE ISNULL(CD.INV_TITLE, AD.INV_TITLE) END ELSE OT.INV_TITLE END,   
				[UseInvoiceCategoryDescription] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.INV_CAT_TITLE ELSE ISNULL(CD.INV_CAT_TITLE, AD.INV_CAT_TITLE) END ELSE OT.INV_CAT_TITLE END, 0) AS bit),
				[IncludeInvoiceDueDate] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.PRT_DUE_DATE ELSE CASE WHEN ISNULL(CD.PROD_INV_DEF_ID, 0) <> 0 THEN CD.PRT_DUE_DATE ELSE AD.PRT_DUE_DATE END END ELSE OT.PRT_DUE_DATE END, 0) AS bit),
				[PrintContactAfterAddress] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.CONTACT_POS ELSE ISNULL(CD.CONTACT_POS, AD.CONTACT_POS) END ELSE OT.CONTACT_POS END, 0) AS bit),
				[IndicateTaxableFunctions] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.FNC_IND_TAXABLE ELSE ISNULL(CD.FNC_IND_TAXABLE, AD.FNC_IND_TAXABLE) END ELSE OT.FNC_IND_TAXABLE END, 0) AS bit),
				[HideFunctionTotals] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.FNC_HIDE_TOTALS ELSE ISNULL(CD.FNC_HIDE_TOTALS, AD.FNC_HIDE_TOTALS) END ELSE OT.FNC_HIDE_TOTALS END, 0) AS bit),
				[CustomInvoiceID] = CAST(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.CUSTOM_INVOICE_ID ELSE CD.CUSTOM_INVOICE_ID END ELSE OT.CUSTOM_INVOICE_ID END AS int), 
				[ClientPOLocation] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.CLIENT_PO_LOCATION ELSE ISNULL(CD.CLIENT_PO_LOCATION, AD.CLIENT_PO_LOCATION) END ELSE OT.CLIENT_PO_LOCATION END, 1) AS int),
				[HideJobInfo] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.HIDE_JOB_INFO ELSE ISNULL(CD.HIDE_JOB_INFO, AD.HIDE_JOB_INFO) END ELSE OT.HIDE_JOB_INFO END, 0) AS bit),
				[PrintClientName] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.PRINT_CLIENT_NAME ELSE ISNULL(CD.PRINT_CLIENT_NAME, AD.PRINT_CLIENT_NAME) END ELSE OT.PRINT_CLIENT_NAME END, 0) AS bit),
				[ShowCampaign] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.SHOW_CAMPAIGN ELSE ISNULL(CD.SHOW_CAMPAIGN, AD.SHOW_CAMPAIGN) END ELSE OT.SHOW_CAMPAIGN END, 0) AS bit),
				[ShowCampaignComment] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.SHOW_CAMPAIGN_COMMENT ELSE ISNULL(CD.SHOW_CAMPAIGN_COMMENT, AD.SHOW_CAMPAIGN_COMMENT) END ELSE OT.SHOW_CAMPAIGN_COMMENT END, 0) AS bit),
				[ShowCodes] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.SHOW_CODES ELSE ISNULL(CD.SHOW_CODES, AD.SHOW_CODES) END ELSE OT.SHOW_CODES END, 0) AS bit),
				[TaxTotalLocation] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.TAX_TOTAL_LOCATION ELSE ISNULL(CD.TAX_TOTAL_LOCATION, AD.TAX_TOTAL_LOCATION) END ELSE OT.TAX_TOTAL_LOCATION END, 2) AS int),
				[ClientRefLocation] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.CLIENT_REF_LOCATION ELSE ISNULL(CD.CLIENT_REF_LOCATION, AD.CLIENT_REF_LOCATION) END ELSE OT.CLIENT_REF_LOCATION END, 1) AS int),
				[SalesClassLocation] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.SALES_CLASS_LOCATION ELSE ISNULL(CD.SALES_CLASS_LOCATION, AD.SALES_CLASS_LOCATION) END ELSE OT.SALES_CLASS_LOCATION END, 1) AS int),
				[CampaignLocation] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.CAMPAIGN_LOCATION ELSE ISNULL(CD.CAMPAIGN_LOCATION, AD.CAMPAIGN_LOCATION) END ELSE OT.CAMPAIGN_LOCATION END, 1) AS int),
				[HeaderGroupBy] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.HEADER_GROUP_BY ELSE ISNULL(CD.HEADER_GROUP_BY, AD.HEADER_GROUP_BY) END ELSE OT.HEADER_GROUP_BY END, 0) AS int),
				[ShowEmployeeTimeDescription] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.SHOW_EMPLOYEE_TIME_DESC ELSE ISNULL(CD.SHOW_EMPLOYEE_TIME_DESC, AD.SHOW_EMPLOYEE_TIME_DESC) END ELSE OT.SHOW_EMPLOYEE_TIME_DESC END, 0) AS bit),
				[ShowEmployeeTimeDate] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.SHOW_EMPLOYEE_TIME_DATE ELSE ISNULL(CD.SHOW_EMPLOYEE_TIME_DATE, AD.SHOW_EMPLOYEE_TIME_DATE) END ELSE OT.SHOW_EMPLOYEE_TIME_DATE END, 0) AS bit),
				[ShowEmployeeTimeRate] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.SHOW_EMPLOYEE_TIME_RATE ELSE ISNULL(CD.SHOW_EMPLOYEE_TIME_RATE, AD.SHOW_EMPLOYEE_TIME_RATE) END ELSE OT.SHOW_EMPLOYEE_TIME_RATE END, 0) AS bit),
				[ShowIncomeOnlyDescription] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.SHOW_INCOME_ONLY_DESC ELSE ISNULL(CD.SHOW_INCOME_ONLY_DESC, AD.SHOW_INCOME_ONLY_DESC) END ELSE OT.SHOW_INCOME_ONLY_DESC END, 0) AS bit),
				[ShowIncomeOnlyDate] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.SHOW_INCOME_ONLY_DATE ELSE ISNULL(CD.SHOW_INCOME_ONLY_DATE, AD.SHOW_INCOME_ONLY_DATE) END ELSE OT.SHOW_INCOME_ONLY_DATE END, 0) AS bit),
				[ShowIncomeOnlyRate] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.SHOW_INCOME_ONLY_RATE ELSE ISNULL(CD.SHOW_INCOME_ONLY_RATE, AD.SHOW_INCOME_ONLY_RATE) END ELSE OT.SHOW_INCOME_ONLY_RATE END, 0) AS bit),
				[ShowAPDescription] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.SHOW_AP_DESC ELSE ISNULL(CD.SHOW_AP_DESC, AD.SHOW_AP_DESC) END ELSE OT.SHOW_AP_DESC END, 0) AS bit),
				[ShowAPDate] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.SHOW_AP_DATE ELSE ISNULL(CD.SHOW_AP_DATE, AD.SHOW_AP_DATE) END ELSE OT.SHOW_AP_DATE END, 0) AS bit),
				[ShowAPRate] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.SHOW_AP_RATE ELSE ISNULL(CD.SHOW_AP_RATE, AD.SHOW_AP_RATE) END ELSE OT.SHOW_AP_RATE END, 0) AS bit),
				[ContactType] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.CONTACT_TYPE ELSE ISNULL(CD.CONTACT_TYPE, AD.CONTACT_TYPE) END ELSE OT.CONTACT_TYPE END, CASE WHEN CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.ADDRESS_BLOCK ELSE ISNULL(CD.ADDRESS_BLOCK, AD.ADDRESS_BLOCK) END ELSE OT.ADDRESS_BLOCK END, 1) AS smallint) = 4 THEN 2 ELSE 0 END) AS int),              
				[ShowEmployeeTimeFunctionComment] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.SHOW_ETD_COMMENT ELSE ISNULL(CD.SHOW_ETD_COMMENT, AD.SHOW_ETD_COMMENT) END ELSE OT.SHOW_ETD_COMMENT END, 0) AS bit),
				[ShowAccountsPayableFunctionComment] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.SHOW_AP_COMMENT ELSE ISNULL(CD.SHOW_AP_COMMENT, AD.SHOW_AP_COMMENT) END ELSE OT.SHOW_AP_COMMENT END, 0) AS bit),
				[ShowIncomeOnlyFunctionComment] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.SHOW_IO_COMMENT ELSE ISNULL(CD.SHOW_IO_COMMENT, AD.SHOW_IO_COMMENT) END ELSE OT.SHOW_IO_COMMENT END, 0) AS bit),
				[SummaryLevel] = ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.SUMMARY_LEVEL ELSE ISNULL(CD.SUMMARY_LEVEL, AD.SUMMARY_LEVEL) END ELSE OT.SUMMARY_LEVEL END, 0),
				[ClientDaysToPay] = CAST(ISNULL(C.CL_P_PAYDAYS, 0) AS smallint),
				[BreakupByJobComponent] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.BREAKUP_BY_JOBCOMPONENT ELSE ISNULL(CD.BREAKUP_BY_JOBCOMPONENT, AD.BREAKUP_BY_JOBCOMPONENT) END ELSE OT.BREAKUP_BY_JOBCOMPONENT END, 1) AS bit),
				[HideExchangeRateMessage] = CAST(ISNULL(CASE @IsOneTime WHEN 0 THEN CASE WHEN CD.USE_AGENCY_SETTING = 1 THEN AD.HIDE_EXCHANGE_RATE_MESSAGE ELSE ISNULL(CD.HIDE_EXCHANGE_RATE_MESSAGE, AD.HIDE_EXCHANGE_RATE_MESSAGE) END ELSE OT.HIDE_EXCHANGE_RATE_MESSAGE END, 0) AS bit)
			FROM 
				[dbo].[CLIENT] AS C LEFT OUTER JOIN 
				[dbo].[PROD_INV_DEF] AS CD ON CD.CL_CODE = C.CL_CODE CROSS JOIN 
				[dbo].[PROD_INV_DEF] AS AD CROSS JOIN 
				[dbo].[PROD_INV_DEF] AS OT
			WHERE 
				AD.CLIENT_OR_DEF = 1 AND 
				OT.CLIENT_OR_DEF = 0) AS IPS LEFT OUTER JOIN 
		[dbo].[advtf_location_query]() AS L ON L.LOC_ID = IPS.[LocationCode] INNER JOIN
		(SELECT FIELD_DESCRIPTION FROM [dbo].[GEN_DESC] WHERE FIELD_NAME = 'CITY_TAX') AS CTL ON 1 = 1 INNER JOIN
		(SELECT FIELD_DESCRIPTION FROM [dbo].[GEN_DESC] WHERE FIELD_NAME = 'COUNTY_TAX') AS COTL ON 1 = 1 INNER JOIN
		(SELECT FIELD_DESCRIPTION FROM [dbo].[GEN_DESC] WHERE FIELD_NAME = 'STATE_TAX') AS STL ON 1 = 1

END
GO