--advsp_job_detail_item_load

IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID( N'[dbo].[advsp_job_purchase_order_load]' ) AND OBJECTPROPERTY( id, N'IsProcedure' ) = 1 )
	DROP PROCEDURE [dbo].[advsp_job_purchase_order_load]
GO

CREATE PROCEDURE [dbo].[advsp_job_purchase_order_load] @FromDate datetime, @ToDate datetime, @DATE_TYPE AS int
AS


SELECT 
    [ID] AS [ID], 
    [JobNumber] AS [JobNumber], 
    [OfficeCode] AS [OfficeCode], 
    [OfficeDescription] AS [OfficeDescription], 
    [ClientCode] AS [ClientCode], 
    [ClientDescription] AS [ClientDescription], 
    [DivisionCode] AS [DivisionCode], 
    [DivisionDescription] AS [DivisionDescription], 
    [ProductCode] AS [ProductCode], 
    [ProductDescription] AS [ProductDescription], 
    [CampaignID] AS [CampaignID], 
    [CampaignCode] AS [CampaignCode], 
    [CampaignName] AS [CampaignName], 
    [SalesClassCode] AS [SalesClassCode], 
    [SalesClassDescription] AS [SalesClassDescription], 
    [UserCode] AS [UserCode], 
    [JobCreateDate] AS [JobCreateDate], 
    [JobDescription] AS [JobDescription], 
    [JobDateOpened] AS [JobDateOpened], 
    [RushChargesApproved] AS [RushChargesApproved], 
    [ApprovedEstimateRequired] AS [ApprovedEstimateRequired], 
    [Comment] AS [Comment], 
    [ClientReference] AS [ClientReference], 
    [BillingCoopCode] AS [BillingCoopCode], 
    [SalesClassFormatCode] AS [SalesClassFormatCode], 
    [ComplexityCode] AS [ComplexityCode], 
	[COMPLEX_DESC] AS [ComplexityDescription],
    [PromotionCode] AS [PromotionCode], 
    [BillingComment] AS [BillingComment], 
    [LabelFromUDFTable1] AS [LabelFromUDFTable1], 
    [LabelFromUDFTable2] AS [LabelFromUDFTable2], 
    [LabelFromUDFTable3] AS [LabelFromUDFTable3], 
    [LabelFromUDFTable4] AS [LabelFromUDFTable4], 
    [LabelFromUDFTable5] AS [LabelFromUDFTable5], 
    [JobOpen] AS [JobOpen], 
    [ComponentNumber] AS [ComponentNumber], 
    [JobComponent] AS [JobComponent], 
    [BillHold] AS [BillHold], 
    [AccountExecutiveCode] AS [AccountExecutiveCode], 
    [AccountExecutive] AS [AccountExecutive], 
    [ComponentDateOpened] AS [ComponentDateOpened], 
    [DueDate] AS [DueDate], 
    [StartDate] AS [StartDate], 
    [AdSize] AS [AdSize], 
    [DepartmentTeamCode] AS [DepartmentTeamCode], 
    [DepartmentTeam] AS [DepartmentTeam], 
    [MarkupPercent] AS [MarkupPercent], 
    [CreativeInstructions] AS [CreativeInstructions], 
    [JobProcessControl] AS [JobProcessControl], 
    [ComponentDescription] AS [ComponentDescription], 
    [ComponentComments] AS [ComponentComments], 
    [ComponentBudget] AS [ComponentBudget], 
    [EstimateNumber] AS [EstimateNumber], 
    [EstimateComponentNumber] AS [EstimateComponentNumber], 
    [BillingUser] AS [BillingUser], 
    [AdvanceBillFlag] AS [AdvanceBillFlag], 
    [DeliveryInstructions] AS [DeliveryInstructions], 
    [JobTypeCode] AS [JobTypeCode], 
    [JobTypeDescription] AS [JobTypeDescription], 
    [Taxable] AS [Taxable], 
    [TaxCode] AS [TaxCode], 
    [TaxCodeDescription] AS [TaxCodeDescription], 
    [NonBillable] AS [NonBillable], 
    [AlertGroup] AS [AlertGroup], 
    [AdNumber] AS [AdNumber], 
    [AccountNumber] AS [AccountNumber], 
    [IncomeRecognitionMethod] AS [IncomeRecognitionMethod], 
    [MarketCode] AS [MarketCode], 
    [MarketDescription] AS [MarketDescription], 
    [ServiceFeeJob] AS [ServiceFeeJob], 
    [ServiceFeeTypeCode] AS [ServiceFeeTypeCode], 
    [ServiceFeeTypeDescription] AS [ServiceFeeTypeDescription], 
    [Archived] AS [Archived], 
    [TrafficScheduleRequired] AS [TrafficScheduleRequired], 
    [ClientPO] AS [ClientPO], 
    [CompLabelFromUDFTable1] AS [CompLabelFromUDFTable1], 
    [CompLabelFromUDFTable2] AS [CompLabelFromUDFTable2], 
    [CompLabelFromUDFTable3] AS [CompLabelFromUDFTable3], 
    [CompLabelFromUDFTable4] AS [CompLabelFromUDFTable4], 
    [CompLabelFromUDFTable5] AS [CompLabelFromUDFTable5], 
    [JobTemplateCode] AS [JobTemplateCode], 
    [FiscalPeriodCode] AS [FiscalPeriodCode], 
    [FiscalPeriodDescription] AS [FiscalPeriodDescription], 
    [JobQuantity] AS [JobQuantity], 
    [BlackplateVersionCode] AS [BlackplateVersionCode], 
    [BlackplateVersionDesc] AS [BlackplateVersionDesc], 
    [ClientContactCode] AS [ClientContactCode], 
    [ClientContactID] AS [ClientContactID], 
    [BABatchID] AS [BABatchID], 
    [ClientContact] AS [ClientContact], 
    [SelectedBABatchID] AS [SelectedBABatchID], 
    [BillingCommandCenterID] AS [BillingCommandCenterID], 
    [AlertAssignmentTemplate] AS [AlertAssignmentTemplate], 
    [PONumber] AS [PONumber], 
    [VendorCode] AS [VendorCode], 
    [VendorName] AS [VendorName], 
    [EmployeeCode] AS [EmployeeCode], 
    [EmployeeName] AS [EmployeeName], 
    [PODate] AS [PODate], 
    [PODueDate] AS [PODueDate], 
    [LineNumber] AS [LineNumber], 
    [LineDescription] AS [LineDescription], 
    [DetailDescription] AS [DetailDescription], 
    [FunctionCode] AS [FunctionCode], 
    [FunctionDescription] AS [FunctionDescription], 
    [POQuantity] AS [POQuantity], 
    [PORate] AS [PORate], 
    [POLineAmount] AS [POLineAmount], 
    [POMarkupAmount] AS [POMarkupAmount], 
    [POLineTotal] AS [POLineTotal], 
    [POInstructions] AS [POInstructions], 
    [PODetailInstructions] AS [PODetailInstructions], 
    [POComplete] AS [POComplete], 
    [POCreateDate] AS [POCreateDate], 
    [BlackplateVersion2Code] AS [BlackplateVersion2Code], 
    [BlackplateVersion2Desc] AS [BlackplateVersion2Desc]
    FROM [dbo].[V_DRPT_JOB_PO] A LEFT OUTER JOIN
		[dbo].[COMPLEXITY] AS CMPL ON [ComplexityCode] = CMPL.COMPLEX_CODE
    WHERE --([JobCreateDate] >= @FromDate) AND ([JobCreateDate] <= @ToDate)
          1 = CASE WHEN @DATE_TYPE = 1 THEN CASE WHEN [JobCreateDate] >= @FromDate AND [JobCreateDate] <= CONVERT(DATETIME, @ToDate +' 23:59:00', 101) THEN 1 ELSE 0 END
				 WHEN @DATE_TYPE = 2 THEN CASE WHEN [ComponentDateOpened] >= @FromDate AND [ComponentDateOpened] <= CONVERT(DATETIME, @ToDate +' 23:59:00', 101) THEN 1 ELSE 0 END
				 WHEN @DATE_TYPE = 3 THEN CASE WHEN [DueDate] >= @FromDate AND [DueDate] <= CONVERT(DATETIME, @ToDate +' 23:59:00', 101) THEN 1 ELSE 0 END
				 WHEN @DATE_TYPE = 4 THEN CASE WHEN [StartDate] >= @FromDate AND [StartDate] <= CONVERT(DATETIME, @ToDate +' 23:59:00', 101) THEN 1 ELSE 0 END 
				 WHEN @DATE_TYPE = 5 THEN CASE WHEN [POCreateDate] >= @FromDate AND [POCreateDate] <= CONVERT(DATETIME, @ToDate +' 23:59:00', 101) THEN 1 ELSE 0 END ELSE 1 END


GO

GRANT EXECUTE ON [advsp_job_purchase_order_load] TO PUBLIC
GO