CREATE PROCEDURE [dbo].[advsp_media_broadcast_worksheet_search_by_order_number]
	@OrderNumbers AS varchar(max)
AS
BEGIN

	SELECT 
		DISTINCT
		WorksheetID = MBW.MEDIA_BROADCAST_WORKSHEET_ID,
		WorksheetMarketID = MBWM.MEDIA_BROADCAST_WORKSHEET_MARKET_ID,
		OrderNumber = MBWMDD.ORDER_NBR
	FROM 
		dbo.MEDIA_BROADCAST_WORKSHEET_MARKET_DETAIL_DATE MBWMDD
		INNER JOIN dbo.MEDIA_BROADCAST_WORKSHEET_MARKET_DETAIL MBWMD ON MBWMD.MEDIA_BROADCAST_WORKSHEET_MARKET_DETAIL_ID = MBWMDD.MEDIA_BROADCAST_WORKSHEET_MARKET_DETAIL_ID
		INNER JOIN dbo.MEDIA_BROADCAST_WORKSHEET_MARKET MBWM ON MBWM.MEDIA_BROADCAST_WORKSHEET_MARKET_ID = MBWMD.MEDIA_BROADCAST_WORKSHEET_MARKET_ID
		INNER JOIN dbo.MEDIA_BROADCAST_WORKSHEET MBW ON MBW.MEDIA_BROADCAST_WORKSHEET_ID = MBWM.MEDIA_BROADCAST_WORKSHEET_ID
	WHERE 
		MBWMDD.ORDER_NBR IS NOT NULL 
		AND MBWMDD.ORDER_NBR IN (SELECT items FROM dbo.udf_split_list(@OrderNumbers, ','))

END
GO