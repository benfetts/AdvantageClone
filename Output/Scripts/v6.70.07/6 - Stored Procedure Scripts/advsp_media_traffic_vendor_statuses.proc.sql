CREATE PROCEDURE [dbo].[advsp_media_traffic_vendor_statuses]
	@MEDIA_TRAFFIC_VENDOR_ID int
AS

SELECT
	[VendorName] = V.VN_NAME,
	[StatusDescription] = MTS.STATUS_DESCRIPTION,
	[StatusDate] = MTVS.CREATED_DATE,
	[By] = CASE WHEN E.EMP_CODE IS NOT NULL THEN ISNULL(E.EMP_FNAME+' ','') + CASE WHEN NULLIF(E.EMP_MI,'') IS NULL THEN '' ELSE E.EMP_MI + '. ' END +  ISNULL(E.EMP_LNAME,'')
				ELSE MTVS.USER_CREATED END
FROM dbo.MEDIA_TRAFFIC_VENDOR_STATUS MTVS 
	INNER JOIN dbo.MEDIA_TRAFFIC_VENDOR MTV ON MTVS.MEDIA_TRAFFIC_VENDOR_ID = MTV.MEDIA_TRAFFIC_VENDOR_ID 
	INNER JOIN dbo.VENDOR V ON V.VN_CODE = MTV.VN_CODE
	INNER JOIN dbo.MEDIA_TRAFFIC_STATUS MTS ON MTVS.MEDIA_TRAFFIC_STATUS_ID = MTS.MEDIA_TRAFFIC_STATUS_ID 
	LEFT OUTER JOIN dbo.SEC_USER SU ON MTVS.USER_CREATED = SU.USER_CODE 
	LEFT OUTER JOIN dbo.EMPLOYEE E ON SU.EMP_CODE = E.EMP_CODE
WHERE MTVS.MEDIA_TRAFFIC_VENDOR_ID = @MEDIA_TRAFFIC_VENDOR_ID
ORDER BY MTVS.CREATED_DATE DESC, MTVS.MEDIA_TRAFFIC_VENDOR_STATUS_ID DESC
GO
