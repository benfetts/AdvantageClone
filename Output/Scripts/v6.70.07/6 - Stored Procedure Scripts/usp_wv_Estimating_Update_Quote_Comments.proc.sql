if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[usp_wv_Estimating_Update_Quote_Comments]') and OBJECTPROPERTY(id, N'IsProcedure') = 1)
drop procedure [dbo].[usp_wv_Estimating_Update_Quote_Comments]
GO

CREATE PROCEDURE [dbo].[usp_wv_Estimating_Update_Quote_Comments]
(
	@ESTIMATE_NUMBER INT,
	@EST_COMPONENT_NBR INT,
	@EST_QUOTE_NBR INT,
	@EST_REV_NBR INT,
	@COPY_FROM_ESTIMATE_NUMBER INT,
	@COPY_FROM_EST_COMPONENT_NBR INT,
	@COPY_FROM_EST_QUOTE_NBR INT,
	@COPY_FROM_EST_REV_NBR INT
	
)
AS
BEGIN
	SET NOCOUNT OFF
	DECLARE 
	@ERR INT,
	@EST_QTE_COMMENT VARCHAR(MAX),
	@EST_QTE_COMMENT_HTML VARCHAR(MAX)
	
    --SELECT @NEXT_EST_NBR = ISNULL(MAX(ESTIMATE_NUMBER),-1) + 1 FROM ESTIMATE_LOG 

	SELECT @EST_QTE_COMMENT = EST_QTE_COMMENT, @EST_QTE_COMMENT_HTML = EST_QTE_COMMENT_HTML
	FROM ESTIMATE_QUOTE
	WHERE ESTIMATE_NUMBER = @COPY_FROM_ESTIMATE_NUMBER AND EST_COMPONENT_NBR = @COPY_FROM_EST_COMPONENT_NBR AND EST_QUOTE_NBR = @COPY_FROM_EST_QUOTE_NBR
    
    UPDATE [ESTIMATE_QUOTE]
	SET	[EST_QTE_COMMENT] = @EST_QTE_COMMENT,
		[EST_QTE_COMMENT_HTML] = @EST_QTE_COMMENT_HTML
	WHERE	
		[ESTIMATE_NUMBER] = @ESTIMATE_NUMBER AND
		[EST_COMPONENT_NBR] = @EST_COMPONENT_NBR AND
		[EST_QUOTE_NBR] = @EST_QUOTE_NBR
			
	
			

	SET @ERR = @@Error

	--RETURN @ERR
END

--SELECT @QTE_NUM = @NEXT_EST_NBR


