
CREATE PROCEDURE usp_wv_get_arptJobVersions 
	@Job	INTEGER,
	@Comp	INTEGER

AS

SET NOCOUNT ON


SELECT JVH.JOB_VER_SEQ_NBR AS VERSION, JVTD.JV_TMPLT_LABEL AS LABEL,  
	CASE JVT.ADVAN_DTYPE_ID WHEN 1 THEN CONVERT(VARCHAR(2000), JVD.JOB_VER_VALUE)
				WHEN 6 THEN CONVERT(VARCHAR(4000), JVD.JOB_VER_VALUE)
				WHEN 7 THEN CONVERT(VARCHAR(3), CASE JVD.JOB_VER_VALUE WHEN '0' THEN 'No' ELSE 'Yes' END )
				ELSE CONVERT(VARCHAR(20), JVD.JOB_VER_VALUE)
	END AS VALUE,
	JVH.JOB_VER_DESC AS JOB_VER_DESC,
	JVTH.JV_TMPLT_DESC AS JV_TMPLT_DESC

FROM JOB_VER_HDR JVH
INNER JOIN JOB_VER_DTL JVD ON JVH.JOB_VER_HDR_ID = JVD.JOB_VER_HDR_ID
INNER JOIN JOB_VER_TMPLT_HDR JVTH ON JVH.JV_TMPLT_CODE = JVTH.JV_TMPLT_CODE
INNER JOIN JOB_VER_TMPLT_DTL JVTD ON JVTD.JV_TMPLT_CODE = JVTH.JV_TMPLT_CODE
				AND JVTD.JV_TMPLT_DTL_ID = JVD.JV_TMPLT_DTL_ID
INNER JOIN JOB_VER_DTYPE JVT ON JVTD.JV_DTYPE_ID = JVT.JV_DTYPE_ID

WHERE    ( JVTD.INACTIVE_FLAG = 0 OR JVTD.INACTIVE_FLAG IS NULL )
AND JVH.JOB_NUMBER = @Job AND JVH.JOB_COMPONENT_NBR = @Comp

ORDER BY JVH.JOB_VER_SEQ_NBR, JVTD.JV_TMPLT_ORDER


SET QUOTED_IDENTIFIER ON 
