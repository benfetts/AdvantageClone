DECLARE 
	@ALERTS TABLE (ID INT IDENTITY, ALERT_ID INT);

DECLARE
	@CT INT;

INSERT INTO @ALERTS
SELECT ALERT_ID
FROM
	ALERT WITH(NOLOCK)
WHERE 
	ALERT_CAT_ID = 71
	AND ALERT_LEVEL = 'BRD'
	AND ([SUBJECT] = '[Blank task description]' OR TASK_SEQ_NBR IS NULL)
	AND BODY IS NULL
	AND (ASSIGN_COMPLETED IS NULL OR ASSIGN_COMPLETED = 0);

SELECT @CT = COUNT(1) FROM @ALERTS;
IF @CT > 0
BEGIN
	DELETE @ALERTS
	FROM
		@ALERTS A
		INNER JOIN ALERT_RCPT AR ON A.ALERT_ID = AR.ALERT_ID
END

SELECT @CT = COUNT(1) FROM @ALERTS;
IF @CT > 0
BEGIN
	DELETE @ALERTS
	FROM
		@ALERTS A
		INNER JOIN ALERT_RCPT_DISMISSED AR ON A.ALERT_ID = AR.ALERT_ID
END

SELECT @CT = COUNT(1) FROM @ALERTS;
IF @CT > 0
BEGIN
	BEGIN TRY
		DELETE ALERT WITH(ROWLOCK)
		FROM
			ALERT A 
			INNER JOIN @ALERTS AA ON A.ALERT_ID = AA.ALERT_ID
	END TRY
	BEGIN CATCH
		SELECT @@ERROR;
	END CATCH
END
