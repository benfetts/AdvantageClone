/* STEP 1

	CLEAN UP OLD GRIDS
	IF YOU RENAME A GRID, CLEAN UP THE OLD GRID DATA

*/

DECLARE @OLD_GRID_ID INT;

/* STEP 2

	ADD GRID NAMES

*/
IF NOT EXISTS (SELECT GRID_ID FROM [GRID] WHERE [NAME] = 'ExpenseReportGrid')
BEGIN
	INSERT INTO GRID ([NAME]) VALUES ('ExpenseReportGrid');
END

/* STEP 3

	ADD COLUMNS TO GRID
	IF YOU RENAME COLUMNS, DELETE OLD SETTINGS
*/

DECLARE 
	@GRID_ID AS INT,
	@GRID_NAME AS VARCHAR(100),
	@COLUMN_NAME AS VARCHAR(100),
	@COLUMN_IS_EDITABLE AS BIT;

DECLARE GRID_NAME_CURSOR CURSOR FOR
SELECT GRID_ID, [NAME] FROM [GRID] WITH(NOLOCK);

OPEN GRID_NAME_CURSOR;
FETCH NEXT FROM GRID_NAME_CURSOR INTO @GRID_ID, @GRID_NAME;

WHILE (@@FETCH_STATUS = 0)
BEGIN

	IF (@GRID_NAME = 'ExpenseReportGrid')
	BEGIN	
		
		--All new columns go in here.
		SET @COLUMN_NAME = 'Quantity_Rate';
		SET @COLUMN_IS_EDITABLE = 1;

		IF NOT EXISTS (SELECT GRID_COLUMN_ID FROM GRID_COLUMN WITH(NOLOCK) WHERE GRID_ID = @GRID_ID AND NAME = @COLUMN_NAME)
		BEGIN
			INSERT INTO GRID_COLUMN (GRID_ID, [NAME], IS_EDITABLE) VALUES (@GRID_ID, @COLUMN_NAME, @COLUMN_IS_EDITABLE);
		END
		
		SET @COLUMN_NAME = 'Client';
		SET @COLUMN_IS_EDITABLE = 1;

		IF NOT EXISTS (SELECT GRID_COLUMN_ID FROM GRID_COLUMN WITH(NOLOCK) WHERE GRID_ID = @GRID_ID AND NAME = @COLUMN_NAME)
		BEGIN
			INSERT INTO GRID_COLUMN (GRID_ID, [NAME], IS_EDITABLE) VALUES (@GRID_ID, @COLUMN_NAME, @COLUMN_IS_EDITABLE);
		END
		
		SET @COLUMN_NAME = 'Division';
		SET @COLUMN_IS_EDITABLE = 1;

		IF NOT EXISTS (SELECT GRID_COLUMN_ID FROM GRID_COLUMN WITH(NOLOCK) WHERE GRID_ID = @GRID_ID AND NAME = @COLUMN_NAME)
		BEGIN
			INSERT INTO GRID_COLUMN (GRID_ID, [NAME], IS_EDITABLE) VALUES (@GRID_ID, @COLUMN_NAME, @COLUMN_IS_EDITABLE);
		END

		SET @COLUMN_NAME = 'Product';
		SET @COLUMN_IS_EDITABLE = 1;

		IF NOT EXISTS (SELECT GRID_COLUMN_ID FROM GRID_COLUMN WITH(NOLOCK) WHERE GRID_ID = @GRID_ID AND NAME = @COLUMN_NAME)
		BEGIN
			INSERT INTO GRID_COLUMN (GRID_ID, [NAME], IS_EDITABLE) VALUES (@GRID_ID, @COLUMN_NAME, @COLUMN_IS_EDITABLE);
		END

		SET @COLUMN_NAME = 'Job_Component';
		SET @COLUMN_IS_EDITABLE = 1;

		IF NOT EXISTS (SELECT GRID_COLUMN_ID FROM GRID_COLUMN WITH(NOLOCK) WHERE GRID_ID = @GRID_ID AND NAME = @COLUMN_NAME)
		BEGIN
			INSERT INTO GRID_COLUMN (GRID_ID, [NAME], IS_EDITABLE) VALUES (@GRID_ID, @COLUMN_NAME, @COLUMN_IS_EDITABLE);
		END
		

END

	FETCH NEXT FROM GRID_NAME_CURSOR INTO @GRID_ID, @GRID_NAME;

END
CLOSE GRID_NAME_CURSOR;
DEALLOCATE GRID_NAME_CURSOR;