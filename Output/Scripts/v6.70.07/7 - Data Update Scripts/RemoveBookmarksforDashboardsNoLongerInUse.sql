/*
	Remove bookmarks for modules no longer being used.  Task List, My Task List, and Alert and Assignments dashbords - 11/20/2020
*/

DECLARE @BOOKMARKS TABLE (ID INT IDENTITY,
					      BOOKMARK_ID INT)

INSERT INTO @BOOKMARKS
SELECT ID FROM WV_BOOKMARKS
WHERE BOOKMARK_TYPE_ID IN (54,53,44,10)

DECLARE	@ID INT,
		@ROW_COUNT INT,
		@BOOKMARK_ID INT;

SET @ID = 0;
SET @ROW_COUNT = 0;

SELECT @ROW_COUNT = COUNT(*) FROM @BOOKMARKS;

	IF @ROW_COUNT > 0
	BEGIN
		WHILE @ID < @ROW_COUNT
		BEGIN			
			SET @ID = @ID + 1;
			SET @BOOKMARK_ID = NULL;

			SELECT @BOOKMARK_ID = BOOKMARK_ID 
			FROM @BOOKMARKS WHERE ID = @ID;            

            IF (EXISTS (SELECT BOOKMARK_ID FROM WV_BOOKMARKS_BOOKMARK_FOLDERS WV WITH(NOLOCK) WHERE WV.BOOKMARK_ID = @BOOKMARK_ID))
            BEGIN
                DELETE FROM WV_BOOKMARKS_BOOKMARK_FOLDERS WHERE BOOKMARK_ID = @BOOKMARK_ID
            END			
			
		END
	END


DELETE FROM WV_BOOKMARKS
WHERE BOOKMARK_TYPE_ID IN (54,53,44)

DELETE FROM WV_BOOKMARKS
WHERE BOOKMARK_TYPE_ID = 10 AND PAGE_URL NOT LIKE '%Desktop/Inbox%'