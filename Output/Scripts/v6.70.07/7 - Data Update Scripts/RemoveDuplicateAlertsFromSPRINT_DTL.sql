/*	REMOVE DUPLICATE ALERT RECORDS FROM SPRINT_DTL  */
DECLARE @DUPES TABLE (ID INT IDENTITY, ALERT_ID INT)
INSERT INTO @DUPES(ALERT_ID)
SELECT
	A.ALERT_ID
FROM
	ALERT A
	INNER JOIN (
SELECT 
	ALERT_ID, COUNT(1) AS DUPE_COUNT
FROM
	SPRINT_DTL
GROUP BY
	ALERT_ID
HAVING
	COUNT(1) > 1 ) AS B ON A.ALERT_ID = B.ALERT_ID;
DECLARE
	@DUPE_CT INT,
	@CTR INT,
	@CURR_ALERT_ID INT,
	@MAX_SPRINT_DTL_ID INT
	;
SELECT @DUPE_CT = COUNT(1) FROM @DUPES;
IF @DUPE_CT IS NOT NULL AND @DUPE_CT > 0
BEGIN
	WHILE @DUPE_CT > 0
	BEGIN
		SELECT @CURR_ALERT_ID = 0;
		SELECT @MAX_SPRINT_DTL_ID = 0;
		SELECT @CURR_ALERT_ID = D.ALERT_ID FROM @DUPES D WHERE D.ID = @DUPE_CT;
		IF @CURR_ALERT_ID > 0
		BEGIN
			SELECT @MAX_SPRINT_DTL_ID = MAX(ID) FROM SPRINT_DTL WHERE ALERT_ID = @CURR_ALERT_ID;
			DELETE FROM SPRINT_DTL WITH(ROWLOCK) WHERE ALERT_ID = @CURR_ALERT_ID AND ID <> @MAX_SPRINT_DTL_ID;
		END
		SELECT @DUPE_CT = @DUPE_CT -1;
	END
END