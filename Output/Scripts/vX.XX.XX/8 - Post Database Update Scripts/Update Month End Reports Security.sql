/*

Script to open up new month end reports module based on old month end reports module (Legacy) - 5/12/2020

*/


DECLARE @SEC_MODULE_ID AS int
DECLARE @SEC_MODULE_INFO_ID AS int
DECLARE @SEC_MODULE_CODE AS varchar(100)
DECLARE @NEW_SEC_MODULE_ID AS int
DECLARE @NEW_MODULE_INFO_ID AS int

IF EXISTS(SELECT SEC_MODULE_ID FROM [SEC_MODULE] WHERE SEC_MODULE_CODE = 'FinanceAccounting_Reports_MonthEndReportsRTP') AND
		EXISTS(SELECT SEC_MODULE_ID FROM [SEC_MODULE] WHERE SEC_MODULE_CODE = 'FinanceAccounting_Reports_MonthEndReportsEnhancedRTP') BEGIN
		
	SELECT @SEC_MODULE_ID = SEC_MODULE_ID, @SEC_MODULE_INFO_ID = SEC_MODULE_INFO_ID FROM [SEC_MODULE] WHERE SEC_MODULE_CODE = 'FinanceAccounting_Reports_MonthEndReportsRTP'
	SELECT @NEW_SEC_MODULE_ID = SEC_MODULE_ID, @NEW_MODULE_INFO_ID = SEC_MODULE_INFO_ID FROM [SEC_MODULE] WHERE SEC_MODULE_CODE = 'FinanceAccounting_Reports_MonthEndReportsEnhancedRTP'
	
	DELETE FROM [dbo].[SEC_GROUP_MODACCESS] WHERE SEC_MODULE_ID = @NEW_SEC_MODULE_ID
	DELETE FROM [dbo].[SEC_USER_MODACCESS] WHERE SEC_MODULE_ID = @NEW_SEC_MODULE_ID
	DELETE FROM [dbo].[SEC_CPUSER_MODACCESS] WHERE SEC_MODULE_ID = @NEW_SEC_MODULE_ID

	INSERT INTO [dbo].[SEC_GROUP_MODACCESS]([SEC_GROUP_ID], [SEC_MODULE_ID], [IS_BLOCKED], [CAN_ADD], [CAN_PRINT], [CAN_UPDATE], [CUSTOM1], [CUSTOM2])
	SELECT [SEC_GROUP_ID], @NEW_SEC_MODULE_ID, [IS_BLOCKED], [CAN_ADD], [CAN_PRINT], [CAN_UPDATE], [CUSTOM1], [CUSTOM2] FROM [dbo].[SEC_GROUP_MODACCESS] WHERE SEC_MODULE_ID = @SEC_MODULE_ID
	
	INSERT INTO [dbo].[SEC_USER_MODACCESS]([SEC_USER_ID], [SEC_MODULE_ID], [IS_BLOCKED], [CAN_ADD], [CAN_PRINT], [CAN_UPDATE], [CUSTOM1], [CUSTOM2])
	SELECT [SEC_USER_ID], @NEW_SEC_MODULE_ID, [IS_BLOCKED], [CAN_ADD], [CAN_PRINT], [CAN_UPDATE], [CUSTOM1], [CUSTOM2] FROM [dbo].[SEC_USER_MODACCESS] WHERE SEC_MODULE_ID = @SEC_MODULE_ID
	
	INSERT INTO [dbo].[SEC_CPUSER_MODACCESS]([CPUSER_GUID], [SEC_MODULE_ID], [IS_BLOCKED], [CAN_ADD], [CAN_PRINT], [CAN_UPDATE], [CUSTOM1], [CUSTOM2])
	SELECT [CPUSER_GUID], @NEW_SEC_MODULE_ID, [IS_BLOCKED], [CAN_ADD], [CAN_PRINT], [CAN_UPDATE], [CUSTOM1], [CUSTOM2] FROM [dbo].[SEC_CPUSER_MODACCESS] WHERE SEC_MODULE_ID = @SEC_MODULE_ID

END