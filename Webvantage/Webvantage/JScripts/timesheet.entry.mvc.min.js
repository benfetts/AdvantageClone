function initControls(){var n=$("#EntryDate").data("kendoDatePicker");n&&n.bind("change",function(n){dateChanged(n)});isTrueNewEntry===!0?(initClientsMultiSelect(),initDivisionsMultiSelect(),initProductsMultiSelect(),initJobsMultiSelect(),initJobAssignmentsComboBox(),initFunctionCategoryComboBox()):isEdit===!1&&(jobNumber&&jobNumber>0&&jobComponentNumber&&jobComponentNumber>0?(timeType="D",setReadOnlyJob(),initJobAssignmentsComboBox(),initFunctionCategoryComboBox()):functionCategoryCode&&(timeType="N",showClientAndJobContainers(),setReadOnlyDate(),showDirectTimeContainer()));$("#hoursInput").keyup(function(){setSaveButton()});$("#newEntryDialogSave").click(function(){saveClick()});$("#newEntryDialogCancel").click(function(){window.parent.closeDialogs!==undefined?window.parent.closeDialogs():CloseDialog()});$("#checkBoxSaveAsTemplateContainer").prop("title",templateToolTip);setSaveButton();getTimesheetAgencySettings();isTrueNewEntry===!0}function getTimesheetAgencySettings(){try{$.get({url:window.appBase+"Employee/Timesheet/GetTimesheetAgencySettings",dataType:"json",data:{}}).always(function(n){n&&(useCopyTimesheetFeature=n.UseCopyTimesheetFeature,agencyCommentsRequired=n.RequireTimeComments,setCommentRequiredTextArea());useCopyTimesheetFeature===!1&&$("#checkBoxSaveAsTemplateContainer").hide()})}catch(n){}}function initQueryString(n){n&&(n.emp&&(employeeCode=n.emp),n.etid&&(employeeTimeId=n.etid),n.etdid&&(employeeTimeDetailId=n.etdid),n.j&&(jobNumber=n.j),n.jc&&(jobComponentNumber=n.jc),n.s&&(taskSequenceNumber=n.s),n.a&&(alertId=n.a*1),n.fn&&(functionCategoryCode=n.fn),n.dtc&&(departmentTeamCode=n.dtc),n.sd,jobNumber>0&&jobComponentNumber>0?(isDirectTime=!0,timeType="D"):(isDirectTime=!1,timeType="N"),isTrueNewEntry=n.new&&n.new*1==1?!0:!1,n.udc&&(n.udc==="1"||n.udc===1)&&(unlockDateControl=!0),n.hrs&&isNaN(n.hrs)===!1&&($("#hoursInput").val(kendo.toString(n.hrs,"n2")),$("#hoursInputDefault").val(kendo.toString(n.hrs,"n2")),hours=kendo.toString(n.hrs,"n2")),type=n.Type?n.Type:"",type==="New"&&(fromOldUC=!0))}function init(){var r=!1,n,t,i;if(employeeTimeId>0&&employeeTimeDetailId>0&&(isEdit=!0,isTrueNewEntry=!1),initControls(),isEdit===!0)$("#newEntryDialogSave").html("Save"),isStopwatch=!1,loadEntry(),loadComment();else{if(jobNumber&&jobNumber>0&&jobComponentNumber&&jobComponentNumber>0){r=!0;try{n=$("#jobsMultiSelect").data("kendoMultiSelect");n&&(jobComponentID=[],jobComponentID[0]=jobNumber+","+jobComponentNumber,n.value(jobComponentID[0]),n.trigger("change"))}catch(u){}isDirectTime=!0}isDirectTime===!0&&alertId&&alertId>0&&(t=$("#jobAssignmentsComboBox").data("kendoComboBox"),t&&t.value(alertId));i=$("#functionCategoryComboBox").data("kendoComboBox");i&&i.value(functionCategoryCode);isEdit===!1&&isTrueNewEntry===!1&&r===!1?(isStopwatch=!1,$("#newEntryDialogSave").html("Save"),showClientAndJobComboBoxs(!1)):showClientAndJobComboBoxs(!0);$("#jobAssignmentsListContainer").show();$("#functionCategoryComboBoxContainer").show()}checkPostPeriod();setAssignmentAndFunctions();setFunctionCategoryLabel()}function checkBoxSaveAsTemplateChanged(n){saveAsTemplate=n.isChecked;n.isChecked===!0?($("#newEntryDialogSave").html("Save"),$("#newEntryDialogSave").prop("title",templateToolTip),isStopwatch=!1):setSaveButton()}function functionDropDowListDataBound(){}function getFunctionCategoryDataSourceRequestParameters(){return{EmployeeCode:employeeCode,TimeType:timeType,JobNumber:jobNumber}}function setFunctionComboBoxDefault(){if(functionCategoryCode&&functionCategoryCode!==""){var n=$("#functionCategoryComboBox").data("kendoComboBox");n&&n.value(functionCategoryCode)}else timeType==="D"?setTaskFunctionCode():unSetDefaultEmployeeCode()}function dateChanged(){if(entryDate=$("#EntryDate").data("kendoDatePicker").value(),!entryDate||entryDate===null||entryDate===""||entryDate===undefined){var n=$("#EntryDate").data("kendoDatePicker");n&&n.value(kendo.parseDate(kShortDateStringFromDatePicker(n)))}checkPostPeriod()}function setSaveButton(){var n=$("#hoursInput").val();isEdit===!1&&(n===""||isNaN(n)===!0?($("#newEntryDialogSave").html("Start Stopwatch"),$("#newEntryDialogSave").prop("title","Start a stopwatch."),isStopwatch=!0):($("#newEntryDialogSave").html("Save"),$("#newEntryDialogSave").prop("title","Save."),isStopwatch=!1))}function setTaskFunctionCode(){if(jobNumber>0&&jobComponentNumber>0&&taskSequenceNumber>-1){var n={JobNumber:jobNumber,JobComponentNumber:jobComponentNumber,TaskSequenceNumber:taskSequenceNumber};$.get({url:window.appBase+"Employee/Timesheet/GetTaskFunctionCodeForTaskTimeEntry",dataType:"json",data:n}).always(function(n){var t,i;n&&n!==""?(taskFunctionCode=n,taskFunctionCode&&taskFunctionCode!==""?(employeeDefaultFunctionCode=taskFunctionCode,t=$("#functionCategoryComboBox").data("kendoComboBox"),t&&(t.value(taskFunctionCode),i="",i=t.value(),(i==""||i==null)&&setDefaultEmployeeFunctionCode())):setDefaultEmployeeFunctionCode()):setDefaultEmployeeFunctionCode()})}else setDefaultEmployeeFunctionCode()}function setDefaultEmployeeFunctionCode(){window.setTimeout(function(){var n,t;employeeDefaultFunctionCode&&employeeDefaultFunctionCode!==""&&(n=$("#functionCategoryComboBox").data("kendoComboBox"),n&&(n.value(employeeDefaultFunctionCode),t="",t=n.value(),(t==""||t==null)&&(n.value(null),n.text(null))))},0)}function unSetDefaultEmployeeCode(){var n=$("#functionCategoryComboBox").data("kendoComboBox");n&&(n.value(""),n.select(-1))}function setAssignmentAndFunctions(){timeTypeChanged===!0&&(timeType==="D"?setTaskFunctionCode():unSetDefaultEmployeeCode());reloadFunctionsComboBox();setFunctionComboBoxDefault();setReadOnlyFunctionCategory();reloadJobAssignmentsComboBox();window.setTimeout(function(){var n=$("#jobAssignmentsComboBox").data("kendoComboBox");alertId&&alertId>0?n.value(alertId):n.value("");setReadOnlyAssignment()},250)}function reloadJobAssignmentsComboBox(){var n=new kendo.data.DataSource({});isEdit===!1&&isTrueNewEntry===!1&&type!=="New"?(n=new kendo.data.DataSource({}),setJobAssignmentsComboBoxDataSource(n)):(n=new kendo.data.DataSource({serverFiltering:!1,transport:{read:{url:window.appBase+"Employee/Timesheet/GetJobAssignments?j="+jobNumber+"&jc="+jobComponentNumber+"&inclps="}},requestStart:function(n){n.type==="read"},requestEnd:function(n){var t=n.type,i=n.response}}),setJobAssignmentsComboBoxDataSource(n))}function clearAndDisableAssignmentsComboBox(){var n=$("#jobAssignmentsComboBox").data("kendoComboBox");n&&(n.dataSource.data({}),n.text(null),n.value(null),n.enable(!1))}function closeAndRefresh(){try{isSaving(!1);try{window.parent.refreshTimesheet()}catch(n){try{refreshTimesheetTab()}catch(n){}}try{window.parent.updateDashboardWeeklyHours()}catch(n){try{refreshDashboardTime()}catch(n){}}window.parent.closeDialogs!==undefined?window.parent.closeDialogs():CloseDialog()}catch(n){}}function showClientAndJobContainers(n){n===!0?($("#client-division-product-container").show(),$("#jobs-container").show()):($("#client-division-product-container").hide(),$("#jobs-container").hide())}function showDirectTimeContainer(){timeType==="D"?$("#direct-time-container").show():$("#direct-time-container").hide()}function showClientAndJobComboBoxs(n){n===!0?($("#selectedJobSpanContainer").hide(),$("#jobsComboBoxContainer").show(),$("#selectedClientSpanContainer").hide(),$("#clientComboBoxContainer").show(),$("#selectedDivisionSpanContainer").hide(),$("#divisionComboBoxContainer").show(),$("#selectedProductSpanContainer").hide(),$("#productComboBoxContainer").show()):($("#selectedJobSpanContainer").show(),$("#jobsComboBoxContainer").hide(),$("#selectedClientSpanContainer").show(),$("#clientComboBoxContainer").hide(),$("#selectedDivisionSpanContainer").show(),$("#divisionComboBoxContainer").hide(),$("#selectedProductSpanContainer").show(),$("#productComboBoxContainer").hide())}function hideClientReq(){$("#client-req-asterisk").hide();$("#client-req-msg-container").hide();$("#client-req-msg").text("")}function isSaving(n){n===!0?($("#buttonsContainer").hide(),$("#buttonMessageContainer").show()):($("#buttonsContainer").show(),$("#buttonMessageContainer").hide(),$("#hoursInput").val(""),setSaveButton())}function hoursKeyUp(n){var t=0;if(n.value!=="."&&n.value!==","&&n.value!=="-"&&n.value!=="-."&&n.value!=="-,"&&jQuery.isNumeric(n.value)===!1)return n.value="",!1;isNaN(n.value)===!1&&(t=n.value*1)}function validateInput(){var n,t,i;isValidInput=!0;try{if($("#EntryDate")[0]&&(entryDate=$("#EntryDate")[0].value),$("#hoursInput")&&(hours=$("#hoursInput").val(),hours=hours*1),$("#commentsInput")&&(comment=$("#commentsInput").val()),fromOldUC===!0)try{if(alertId===0&&jobAssignmentsSpanContainerVisible===!1&&$("#jobAssignmentsComboBox")&&(alertId=$("#jobAssignmentsComboBox").data("kendoComboBox").value(),isNaN(alertId)===!0)){try{n=null;n=$("#jobAssignmentsComboBox").data("kendoComboBox").dataItem($("#jobAssignmentsComboBox").data("kendoComboBox").select())}catch(r){n=null}n&&n.AlertID&&(alertId=n.AlertID)}}catch(r){}if(isTrueNewEntry===!0){try{if(alertId===0&&jobAssignmentsSpanContainerVisible===!1&&$("#jobAssignmentsComboBox")&&(alertId=$("#jobAssignmentsComboBox").data("kendoComboBox").value(),isNaN(alertId)===!0)){try{n=null;n=$("#jobAssignmentsComboBox").data("kendoComboBox").dataItem($("#jobAssignmentsComboBox").data("kendoComboBox").select())}catch(r){n=null}n&&n.AlertID&&(alertId=n.AlertID)}}catch(r){}try{if((!functionCategoryCode||functionCategoryCode==="")&&isEdit===!1&&isTrueNewEntry===!0&&$("#functionCategoryComboBox")){try{n=null;n=$("#functionCategoryComboBox").data("kendoComboBox").dataItem($("#functionCategoryComboBox").data("kendoComboBox").select())}catch(r){n=null}n&&n.Code&&(functionCategoryCode=n.Code)}}catch(r){}if(!functionCategoryCode||functionCategoryCode===""){try{n=$("#functionCategoryComboBox").data("kendoComboBox").dataItem($("#functionCategoryComboBox").data("kendoComboBox").select())}catch(r){n=null}n&&n.Code&&(functionCategoryCode=n.Code)}}if((!functionCategoryCode||functionCategoryCode==="")&&$("#functionCategoryComboBox")){try{n=$("#functionCategoryComboBox").data("kendoComboBox").dataItem($("#functionCategoryComboBox").data("kendoComboBox").select())}catch(r){n=null}n&&n.Code&&(functionCategoryCode=n.Code)}isValidInput===!0&&(alertId&&isNaN(alertId)!==!0&&alertId!==undefined||(alertId=0));isValidInput===!0&&hours>24&&(window.parent.showNotification("Seriously?  You worked more than 24 hours today on this one entry?","error"),isValidInput=!1);isValidInput===!0&&assignmentIsRequired===!0&&jobNumber&&jobNumber>0&&jobComponentNumber&&jobComponentNumber>0&&(!alertId||alertId===0)&&(t=$("#jobAssignmentsComboBox").data("kendoComboBox"),t&&(i=t.dataSource.data().length,i>0&&(window.parent.showNotification("Please select an assignment.","error"),isValidInput=!1)));isValidInput===!0&&jobNumber&&jobNumber>0&&jobComponentNumber&&jobComponentNumber>0&&isStopwatch===!1&&commentsRequired===!0&&(comment&&comment.trim()!==""&&comment.length!==0||hours&&hours!==0&&(window.parent.showNotification("Comment required.","error"),isValidInput=!1));isValidInput===!0&&(functionCategoryCode&&functionCategoryCode!==""||(jobNumber&&jobNumber>0&&jobComponentNumber&&jobComponentNumber>0&&employeeDefaultFunctionCode&&employeeDefaultFunctionCode!=""?functionCategoryCode=employeeDefaultFunctionCode:isValidInput=!1),functionCategoryCode&&functionCategoryCode!==""||(window.parent.showNotification("No function/category code!","error"),isValidInput=!1));isValidInput===!0}catch(r){isValidInput=!0}}function checkJobCommentRequired(){if(jobNumber>0){var n={JobNumber:jobNumber};$.get({url:window.appBase+"Employee/Timesheet/IsCommentRequiredJob",dataType:"json",data:n}).always(function(n){commentsRequired=n;setCommentRequiredTextArea()})}else commentsRequired=!1,setCommentRequiredTextArea()}function setCommentRequiredTextArea(){commentsRequired===!0?$("#commentsInput").addClass("RequiredInput"):$("#commentsInput").removeClass("RequiredInput")}function checkPostPeriod(){if($("#postperiod-warning").hide(),postPeriodIsClosed=!1,entryDate=$("#EntryDate").data("kendoDatePicker").value(),entryDate){var n={EntryDate:kendo.toString(entryDate,"d")};$.get({url:window.appBase+"Employee/Timesheet/CheckIfPostPeriodIsAvailable",dataType:"json",data:n}).always(function(n){n&&n.PostPeriodIsAvailable===!1?($("#postperiod-warning").show(),postPeriodIsClosed=!0):($("#postperiod-warning").hide(),postPeriodIsClosed=!1);postPeriodIsClosed===!0?($("#newEntryDialogSave").prop("disabled",!0),$("#newEntryDialogSave").attr("disabled","disabled")):($("#newEntryDialogSave").prop("disabled",!1),$("#newEntryDialogSave").removeAttr("disabled"));checkDayEditStatus()})}}function checkDayEditStatus(){if($("#edit-status-warning").hide(),dayIsAvailable=!0,entryDate=$("#EntryDate").data("kendoDatePicker").value(),entryDate){var n={EmployeeCode:employeeCode,EntryDate:kendo.toString(entryDate,"d")};$.get({url:window.appBase+"Employee/Timesheet/CheckDayEditStatus",dataType:"json",data:n}).always(function(n){n&&n.DayIsAvailable===!1?(dayIsAvailable=!1,$("#edit-status-warning").show(),$("#edit-status-warning-message").text(n.ErrorMessage)):(dayIsAvailable=!0,$("#edit-status-warning").hide());dayIsAvailable===!1?($("#newEntryDialogSave").prop("disabled",!0),$("#newEntryDialogSave").attr("disabled","disabled")):postPeriodIsClosed===!1&&($("#newEntryDialogSave").prop("disabled",!1),$("#newEntryDialogSave").removeAttr("disabled"))})}}function saveClick(){validateInput();isValidInput===!0&&(isStopwatch===!0?startStopwatch():(saveAsTemplate===!0&&saveEntryAsTimeTemplate(),isEdit===!1?addEntry():updateEntry()))}function updateEntry(){var t=!1,i=!1,r,n,u;($("#commentsInput").val()!==$("#commentsInputDefault").val()||$("#hoursInput").val()!==$("#hoursInputDefault").val())&&(t=!0);t===!0?(isSaving(!0),$("#hoursInput").val()&&$("#hoursInput").val()!==""&&isNaN($("#hoursInput").val())!==!0&&$("#hoursInput").val()!==undefined||(i=!0),i===!1?(r={IsDirectTime:isDirectTime,EmployeeTimeID:employeeTimeId,EmployeeTimeDetailID:employeeTimeDetailId,Hours:hours,Comment:comment,FunctionOrCategoryCode:functionCategoryCode,DepartmentTeamCode:departmentTeamCode,AlertID:alertId},$.post({url:window.appBase+"Employee/Timesheet/UpdateEntry",dataType:"json",data:r}).always(function(n){if(n)if(n.Success&&n.Success===!0)closeAndRefresh();else if(n.Message&&n.Message!=="")try{window.parent.showNotification(JSON.parse(n.Message),"error")}catch(t){window.parent.showNotification(n.Message,"error")}isSaving(!1)})):(n="",n=isDirectTime===!0?"D":"N",u={EmployeeTimeID:employeeTimeId,EmployeeTimeDetailID:employeeTimeDetailId,TimeType:n},$.post({url:window.appBase+"Employee/Timesheet/DeleteEntry",dataType:"json",data:u}).always(function(n){n&&(n.Success===!0&&closeAndRefresh(),n.Success===!1&&showNotification(n.Message),isSaving(!1))}))):window.parent.showNotification("No change detected")}function addEntry(){if(isSaving(!0),employeeTimeId&&employeeTimeId>0&&employeeTimeDetailId&&employeeTimeDetailId>0)updateEntry();else{taskSequenceNumber&&taskSequenceNumber!==undefined&&taskSequenceNumber!==null&&isNaN(taskSequenceNumber)!==!0&&taskSequenceNumber!==""||(taskSequenceNumber=-1);alertId&&alertId!==undefined&&alertId!==null&&isNaN(alertId)!==!0&&alertId!==""||(alertId=0);hours&&hours!==undefined&&isNaN(hours)!==!0||(hours=0);var n={EmployeeCode:employeeCode,EntryDate:entryDate,Hours:hours,Comment:comment,FunctionOrCategoryCode:functionCategoryCode,DepartmentTeamCode:departmentTeamCode,JobNumber:jobNumber,JobComponentNumber:jobComponentNumber,AlertID:alertId};$.post({url:window.appBase+"Employee/Timesheet/AddEntry",dataType:"json",data:n}).always(function(n){try{n&&(n.Success&&n.Success===!0?n.Message&&n.Message!==""?checkForEstimateWarning(n.Message).hasWarning===!0?(window.parent.showNotification(checkForEstimateWarning(n.Message).message,"info"),window.setTimeout(function(){closeAndRefresh()},1500)):closeAndRefresh():closeAndRefresh():n.Message&&n.Message!==""&&(parseTimesheetMessage(n.Message).success===!1?window.parent.showNotification(parseTimesheetMessage(n.Message).message,"error"):window.parent.showNotification(parseTimesheetMessage(n.Message).message,"info"),isSaving(!1)))}catch(t){}isSaving(!1)})}}function startStopwatch(){var n={EmployeeCode:employeeCode};$.post({url:window.appBase+"Employee/Timesheet/HasStopwatch",dataType:"json",data:n}).always(function(t){t&&(t.StopwatchIsRunning===!0?showKendoConfirm("There is a stopwatch already running.<br/>Stop it and start a new stopwatch?").done(function(){$.post({url:window.appBase+"Employee/Timesheet/StopStopwatch",dataType:"json",data:n}).always(function(n){n&&_startStopwatch()})}).fail(function(){return!1}):_startStopwatch())})}function _startStopwatch(){var n={EmployeeCode:employeeCode,EntryDate:entryDate,Hours:0,Comments:comment,FunctionCode:functionCategoryCode,DepartmentTeamCode:departmentTeamCode,JobNumber:jobNumber,JobComponentNumber:jobComponentNumber,AlertID:alertId};$.post({url:window.appBase+"Employee/Timesheet/StartStopwatch",dataType:"json",data:n}).always(function(n){if(n)if(n.Success&&n.Success===!0){window.parent.showSuccessNotification("Stopwatch started.");try{checkForStopwatch()}catch(t){}try{refreshDashboardTime()}catch(t){}try{window.parent.refreshTimesheet()}catch(t){}window.parent.closeDialogs!==undefined?window.parent.closeDialogs():CloseDialog()}else if(n.Message&&n.Message!=="")try{window.parent.showNotification(JSON.parse(n.Message),"error")}catch(t){window.parent.showNotification(n.Message,"error")}})}function saveEntryAsTimeTemplate(){var n={EmployeeCode:employeeCode,EntryDate:entryDate,Hours:hours,Comment:comment,FunctionOrCategoryCode:functionCategoryCode,DepartmentTeamCode:departmentTeamCode,JobNumber:jobNumber,JobComponentNumber:jobComponentNumber,AlertID:alertId};$.post({url:window.appBase+"Employee/Timesheet/SaveEntryAsTimeTemplate",dataType:"json",data:n}).always(function(n){n&&(n.Success&&n.Success===!0||n.Message&&n.Message!==""&&window.parent.showNotification(n.Message,"error"))})}function loadEntry(){var n={IsDirectTime:isDirectTime,EmployeeTimeID:employeeTimeId,EmployeeTimeDetailID:employeeTimeDetailId};$.get({url:window.appBase+"Employee/Timesheet/GetTimeEntry",dataType:"json",data:n}).always(function(n){n&&(isEdit=!0,isNaN(n.EmployeeTimeID)===!1&&n.EmployeeTimeID*1>0&&(employeeTimeId=n.EmployeeTimeID*1),isNaN(n.EmployeeTimeDetailID)===!1&&n.EmployeeTimeDetailID*1>0&&(employeeTimeDetailId=n.EmployeeTimeDetailID*1),isNaN(n.EditFlag)===!1&&n.EditFlag*1>0&&(editFlag=n.EditFlag*1),n.TimeType&&n.TimeType!==""&&(timeType=n.TimeType),n.HasStopwatch&&(hasStopwatch=n.HasStopwatch),n.CommentsRequired&&(commentsRequired=n.CommentsRequired,setCommentRequiredTextArea()),n.CanDelete&&(canDelete=n.CanDelete),n.FunctionCategoryCode&&n.FunctionCategoryCode!==""&&(functionCategoryCode=n.FunctionCategoryCode),n.DepartmentTeamCode&&n.DepartmentTeamCode!==""&&(departmentTeamCode=n.DepartmentTeamCode),isNaN(n.Hours)===!1&&($("#newEntryDialogSave").html("Save"),$("#hoursInput").val(kendo.toString(n.Hours,"n2")),$("#hoursInputDefault").val(kendo.toString(n.Hours,"n2"))),isNaN(n.JobNumber)===!1&&n.JobNumber*1>0&&(jobNumber=n.JobNumber*1,isNaN(n.JobComponentNumber)===!1&&n.JobComponentNumber*1>0&&(jobComponentNumber=n.JobComponentNumber*1,isDirectTime=!0,timeType="D")),(jobNumber===undefined||jobNumber===0||jobComponentNumber===undefined||jobComponentNumber===0)&&(isDirectTime=!1,timeType="N"),showDirectTimeContainer(),isDirectTime===!1&&(commentsRequired=!1,setCommentRequiredTextArea()),setFunctionCategoryLabel(),alertId=isNaN(n.AlertID)===!1&&n.AlertID*1>0?n.AlertID*1:0,isTrueNewEntry===!1&&(n.ClientDisplay?$("#client-division-product-container").prop("title",n.ClientDisplay):$("#client-division-product-container").prop("title","Use these to filter jobs by client, division, and product."),n.ClientName?($("#selectedClientSpan").text(n.ClientName),$("#client-filter-container").prop("title",n.ClientName)):$("#client-filter-container").prop("title","Use this to filter jobs by client."),n.DivisionName?($("#selectedDivisionSpan").text(n.DivisionName),$("#division-filter-container").prop("title",n.DivisionName)):$("#division-filter-container").prop("title","Use this to filter jobs by division (client required)."),n.ProductName?($("#selectedProductSpan").text(n.ProductName),$("#filter-filter-container").prop("title",n.ProductName)):$("#filter-filter-container").prop("title","Use this to filter jobs by product (client and division required)."),n.JobDisplay?(selectedJob=n.JobDisplay,$("#selectedJobSpan").text(selectedJob),$("#jobs-container").prop("title",selectedJob),showClientAndJobComboBoxs(!1),jobEditSet=!0):$("#jobs-container").prop("title","Job for time entry.  Leave blank to save indirect ti"),n.AssignmentDisplay?(selectedAssignment=n.AssignmentDisplay,$("#jobAssignmentsSpan").text(selectedAssignment),$("#assignments-container").prop("title",selectedAssignment),$("#assignments-container").show(),$("#jobAssignmentsSpanContainer").show(),jobAssignmentsSpanContainerVisible=!0,$("#jobAssignmentsListContainer").hide()):$("#assignments-container").hide(),assignmentEditSet=!0,n.FunctionCategoryDisplay&&(selectedFunctionCategory=n.FunctionCategoryDisplay,$("#functionCategorySpan").text(selectedFunctionCategory),$("#functionCategorySpanContainer").show(),$("#functionCategoryComboBoxContainer").hide(),functionEditSet=!0),setReadOnlyDate(),hideClientReq()))})}function loadComment(){var n={IsDirectTime:isDirectTime,EmployeeTimeID:employeeTimeId,EmployeeTimeDetailID:employeeTimeDetailId};$.get({url:window.appBase+"Employee/Timesheet/GetTimeEntryComment",dataType:"json",data:n}).always(function(n){n&&n.EmployeeComments&&($("#commentsInput").val(n.EmployeeComments),$("#commentsInputDefault").val(n.EmployeeComments))})}function loadJobsCount(){isOverJobLimit=!1;try{clientCode&&clientCode!==null&&clientCode!=="null"&&clientCode!==undefined||(clientCode="",hasClient=!1);divisionCode&&divisionCode!==null&&divisionCode!=="null"&&divisionCode!==undefined||(divisionCode="",hasDivision=!1);productCode&&productCode!==null&&productCode!=="null"&&productCode!==undefined||(productCode="",hasProduct=!1);$.get({url:window.appBase+"Employee/Timesheet/GetJobsForEmployeeCount?emp="+employeeCode+"&c="+clientCode+"&d="+divisionCode+"&p="+productCode,dataType:"json",data:{}}).always(function(n){n&&isNaN(n)===!1&&(jobCount=n*1)})}catch(n){isOverJobLimit=!1}}function setReadOnlyJob(){jobEditSet===!1&&window.setTimeout(function(){if(isTrueNewEntry===!1)if(jobNumber&&jobNumber>0&&jobComponentNumber&&jobComponentNumber>0){showClientAndJobComboBoxs(!1);var n={JobNumber:jobNumber,JobComponentNumber:jobComponentNumber};$.get({url:window.appBase+"Employee/Timesheet/GetJobDisplay",dataType:"json",data:n}).always(function(n){n&&(n.JobDisplay&&($("#selectedJobSpan").text(n.JobDisplay),$("#jobs-container").prop("title",n.JobDisplay)),n.ClientDivisionProductDisplay&&($("#selectedClientSpan").text(n.ClientDivisionProductDisplay),$("#client-division-product-container").prop("title",n.ClientDivisionProductDisplay)),n.ClientName&&($("#selectedClientSpan").text(n.ClientName),$("#selectedClientSpanContainer").prop("title",n.ClientName)),n.DivisionName&&($("#selectedDivisionSpan").text(n.DivisionName),$("#selectedDivisionSpanContainer").prop("title",n.DivisionName)),n.ProductName&&($("#selectedProductSpan").text(n.ProductName),$("#selectedProductSpanContainer").prop("title",n.ProductName)))})}else showClientAndJobComboBoxs(!0);jobEditSet=!0;setReadOnlyDate()},5)}function setReadOnlyAssignment(){assignmentEditSet===!1&&window.setTimeout(function(){var t,n,i;isTrueNewEntry===!1&&(alertId&&alertId>0?(t=$("#jobAssignmentsComboBox").data("kendoComboBox"),t&&(n=$("#jobAssignmentsComboBox").data("kendoComboBox").text()),i={AlertID:alertId},$.get({url:window.appBase+"Employee/Timesheet/GetAssignmentSubject",dataType:"json",data:i}).always(function(t){t?(n=t,$("#jobAssignmentsSpan").text(n),$("#assignments-container").show(),$("#jobAssignmentsSpanContainer").show(),jobAssignmentsSpanContainerVisible=!0,$("#jobAssignmentsListContainer").hide()):$("#assignments-container").hide()})):type!=="New"&&$("#assignments-container").hide());assignmentEditSet=!0},5)}function setReadOnlyFunctionCategory(){functionEditSet===!1&&window.setTimeout(function(){var n,t,i;isTrueNewEntry===!1&&functionCategoryCode&&functionCategoryCode!==""&&(functionCategoryCode&&functionCategoryCode!==""?(n=$("#functionCategoryComboBox").data("kendoComboBox"),n&&(t=n.text(),i={FunctionCategoryCode:functionCategoryCode,IsFunction:isDirectTime},$.get({url:window.appBase+"Employee/Timesheet/GetFunctionCategoryDescription",dataType:"json",data:i}).always(function(n){n&&(t=n,$("#functionCategorySpan").text(t),$("#functionCategorySpanContainer").show(),$("#functionCategoryComboBoxContainer").hide())}))):($("#functionCategoryComboBoxContainer").show(),$("#functionCategorySpanContainer").hide()));functionEditSet=!0},5)}function setReadOnlyDate(){dateEditSet===!1&&window.setTimeout(function(){isTrueNewEntry===!1?($("#dateSpan").text(kendo.toString($("#EntryDate").data("kendoDatePicker").value(),"d")),$("#dateSpan").prop("title",kendo.toString($("#EntryDate").data("kendoDatePicker").value(),"D")),$("#dateSpanContainer").show(),$("#dateDatePickerContainer").hide(),$("#commentsInput").focus()):($("#dateSpanContainer").hide(),$("#dateDatePickerContainer").show());unlockDateControl===!1&&($("#dateSpanContainer").hide(),$("#dateDatePickerContainer").show());dateEditSet=!0},500)}function setFunctionCategoryLabel(){isDirectTime===!1?($("#functionCategoryLabel").text("Category:"),$("#function-category-container").prop("title","Indirect time category."),timeType="N",commentsRequired=!1,setCommentRequiredTextArea()):($("#functionCategoryLabel").text("Function:"),$("#function-category-container").prop("title","Direct time function."),timeType="D");try{var n=$("#jobAssignmentsComboBox").data("kendoComboBox");n&&n.enable(isDirectTime)}catch(t){}}function getKeyPress(n){var t=n.keyCode?n.keyCode:n.charCode}function initJobAssignmentsComboBox(){assignmentMultiSelectDataSource=new kendo.data.DataSource({transport:{read:{url:window.appBase+"Employee/Timesheet/GetJobAssignments",data:function(){return{j:jobNumber,jc:jobComponentNumber,inclps:!1}}}},requestStart:function(n){n.type==="read"},requestEnd:function(n){var i=n.type,t=[];if(t=n.response,t&&t.length>0)try{window.setTimeout(()=>{var n=$("#jobAssignmentsComboBox").data("kendoComboBox");n&&n.focus()},500)}catch(n){}else try{window.setTimeout(()=>{},500)}catch(n){}}});try{$("#jobAssignmentsComboBox").kendoComboBox({animation:!1,filter:"contains",dataTextField:"Description",dataValueField:"AlertID",noDataTemplate:"",delay:750,suggest:!1,dataSource:assignmentMultiSelectDataSource,dataBound:function(){setReadOnlyAssignment()},change:function(){},error:function(n,t){console.debug(n);console.debug(t)}})}catch(n){}}function initFunctionCategoryComboBox(){try{var n="";n=timeType==="N"?"No categories":"No functions";$("#functionCategoryComboBox").kendoComboBox({animation:!1,filter:"contains",dataTextField:"Description",dataValueField:"Code",footerTemplate:"",valueTemplate:'<span class="selected-value" style="" title="#:data.Description#">#:data.Description# (#:data.Code#)<\/span>',template:'<span class="k-state-default" style="" title="#:data.Description# (#:data.Code#)">#:data.Description# (#:data.Code#)<\/span>',noDataTemplate:"",delay:750,suggest:!1,dataBound:function(n){functionDropDowListDataBound(n)},filtering:function(n){var t=n.filter!==undefined?n.filter.value:"";n.preventDefault();this.dataSource.filter({logic:"or",filters:[{field:"Description",operator:"contains",value:t},{field:"Code",operator:"contains",value:t}]})},change:functionCategoryComboBoxChanged,error:function(n,t){console.debug(n);console.debug(t)}})}catch(t){}}function setJobAssignmentsComboBoxDataSource(){}function setFunctionCategoryComboBoxDataSource(n){initFunctionCategoryComboBox();var t=$("#functionCategoryComboBox").data("kendoComboBox");t&&(t.setDataSource(n),t.enable(!0))}function reloadFunctionsComboBox(){functionCategoryDataSourceURL=window.appBase+"Employee/Timesheet/GetFunctionsAndCategories";var n=new kendo.data.DataSource({serverFiltering:!1,transport:{read:{url:functionCategoryDataSourceURL,dataType:"json",data:{EmployeeCode:employeeCode,TimeType:timeType,JobNumber:jobNumber,ClientCode:clientCode}}},requestStart:function(n){n.type==="read"},requestEnd:function(n){var f=n.type,t=[],u=!1,i,r;if(t=n.response,t&&employeeDefaultFunctionCode!==""){for(i=$("#functionCategoryComboBox").data("kendoComboBox"),r=0;r<t.length;r++)if(t[r].Code===employeeDefaultFunctionCode){functionListHasDefault=!0;i&&(i.value(employeeDefaultFunctionCode),i.text(t[r].Description+" ("+t[r].Code+")"));u=!0;break}u===!1&&(i.value(null),i.text(null))}}});setFunctionCategoryComboBoxDataSource(n)}function functionCategoryComboBoxChanged(n){var t=n.sender.selectedIndex;functionCategoryChanged()}function functionCategoryChanged(){timeType==="N"&&(clientCode="",divisionCode="",productCode="",clientID=[],divisionID=[],productID=[],setClientsMultiSelectValue(""),setDivisionsMultiSelectValue(""),setProductsMultiSelectValue(""),hasClient=!1);try{selectedDataItem=null;selectedDataItem=$("#functionCategoryComboBox").data("kendoComboBox").dataItem($("#functionCategoryComboBox").data("kendoComboBox").select())}catch(n){selectedDataItem=null}selectedDataItem&&selectedDataItem.Code&&(functionCategoryCode=selectedDataItem.Code)}function getClientCodeFromMultiSelect(){var r=$("#clientsMultiSelect").data("kendoMultiSelect"),i="",n,t;return n=r.value(),n&&n.length>0&&(n[0].indexOf(",")>-1?(t=n[0].split(","),t&&t.length>0&&(i=t[0])):i=n[0]),i}function getDivisionCodeFromMultiSelect(){var r=$("#divisionsMultiSelect").data("kendoMultiSelect"),i="",n,t;return n=r.value(),n&&n.length>0&&(n[0].indexOf(",")>-1?(t=n[0].split(","),t&&t.length>0&&(i=t[1])):i=n[0]),i}function getProductCodeFromMultiSelect(){var r=$("#productsMultiSelect").data("kendoMultiSelect"),i="",n,t;return n=r.value(),n&&n.length>0&&(n[0].indexOf(",")>-1?(t=n[0].split(","),t&&t.length>0&&(i=t[2])):i=n[0]),i}function getJobCodeFromMultiSelect(){var i=$("#jobsMultiSelect").data("kendoMultiSelect"),t="",n;return n=i.value(),n&&n.length>0&&(t=n[0]),t}function getAssignmentCodeFromMultiSelect(){var i=$("#jobAssignmentsMultiSelect").data("kendoMultiSelect"),t="",n;return n=i.value(),n&&n.length>0&&(t=n[0]),t}function getFunctionCategoryCodeFromMultiSelect(){var i=$("#functionCategoryMultiSelect").data("kendoMultiSelect"),t="",n;return n=i.value(),n&&n.length>0&&(t=n[0]),t}function setClientsMultiSelectValue(n){var t=$("#clientsMultiSelect").data("kendoMultiSelect");t&&t.value(n)}function setDivisionsMultiSelectValue(n){var t=$("#divisionsMultiSelect").data("kendoMultiSelect");t&&t.value(n)}function setProductsMultiSelectValue(n){var t=$("#productsMultiSelect").data("kendoMultiSelect");t&&t.value(n)}function setJobsMultiSelectValue(n){var t=$("#jobsMultiSelect").data("kendoMultiSelect");t&&t.value(n)}function setJobAssignmentsMultiSelectValue(n){var t=$("#jobAssignmentsMultiSelect").data("kendoMultiSelect");t&&t.value(n)}function setFunctionCategoryMultiSelectValue(n){var t=$("#functionCategoryMultiSelect").data("kendoMultiSelect");t&&t.value(n)}function enableClientsMultiSelect(n){var t=$("#clientsMultiSelect").data("kendoMultiSelect");t&&t.enable(n)}function enableDivisionsMultiSelect(n){var t=$("#divisionsMultiSelect").data("kendoMultiSelect");t&&t.enable(n)}function enableProductsMultiSelect(n){var t=$("#productsMultiSelect").data("kendoMultiSelect");t&&t.enable(n)}function enableJobsMultiSelect(n){var t=$("#jobsMultiSelect").data("kendoMultiSelect");t&&t.enable(n)}function enableJobAssignmentsMultiSelect(n){var t=$("#jobAssignmentsMultiSelect").data("kendoMultiSelect");t&&t.enable(n)}function enableFunctionCategoryMultiSelect(n){var t=$("#functionCategoryMultiSelect").data("kendoMultiSelect");t&&t.enable(n)}function backFillCDP(){var n=jQuery.Deferred();return clientID&&clientID.length!=0&&clientID[0]!=""&&divisionID&&divisionID.length!=0&&divisionID[0]!=""&&productID&&productID.length!=0&&productID[0]!=""?n.resolve():backFillInProgress||(backFillInProgress=!0,$.ajax({url:window.appBase+"Utilities/SearchCDPForJob",type:"GET",dataType:"json",data:{JobNumber:jobComponentID[0]},success:t=>{t.ClientCode!=clientID[0]&&(clientID=[],clientID[0]=t.ClientCode),divisionID[0]!=t.ClientCode+","+t.DivisionCode?setTimeout(()=>{divisionsMultiSelectDataSource.read().then(()=>{divisionID=[],divisionID[0]=t.ClientCode+","+t.DivisionCode,setTimeout(()=>{productsMultiSelectDataSource.page(0),productsMultiSelectDataSource.read().then(()=>{productID=[],productID[0]=t.ClientCode+","+t.DivisionCode+","+t.ProductCode,backFillInProgress=!1,n.resolve()})},15)})},15):productID[0]!=t.ClientCode+","+t.DivisionCode+","+t.ProductCode&&(productID=[],productsMultiSelectDataSource.page(0),productsMultiSelectDataSource.read().then(()=>{productID[0]=t.ClientCode+","+t.DivisionCode+","+t.ProductCode,backFillInProgress=!1,n.resolve()}))}})),n}function initClientsMultiSelect(){clientsMultiSelectDataSource=new kendo.data.DataSource({serverFiltering:!0,serverPaging:!0,pageSize:31,schema:{data:"Clients",total:"Total"},transport:{read:{url:window.appBase+"Utilities/SearchClients",data:function(){var n="",i=$("#clientsMultiSelect").data("kendoMultiSelect"),t;if(i)if(n=i.input.val(),n=="Client"&&(n=""),resetClient)resetClient=!1;else if(n==""&&(t=i.dataItems(),t&&t.length>0))try{n=t[0].Nasubstring(0,t[0].NalastIndexOf("(")-1)}catch(r){}return{OfficeCode:"",Text:n}}}},requestStart:function(n){n.type==="read"},requestEnd:function(){}});$("#clientsMultiSelect").kendoMultiSelect({autoBind:!1,filter:"contains",delay:750,tagTemplate:"<span title='#: data.Name #' class='ms-tag'>#: data.Name #<\/span>",template:"<span title='#: data.Name #'>#: data.Name #<\/span>",placeholder:"Client",dataTextField:"Name",dataValueField:"Code",dataSource:clientsMultiSelectDataSource,virtual:{itemHeight:26,me:this,valueMapper:clientMapper},change:function(){var t=$("#clientsMultiSelect").data("kendoMultiSelect"),n=$("#divisionsMultiSelect").data("kendoMultiSelect"),i=$("#productsMultiSelect").data("kendoMultiSelect"),r=$("#jobsMultiSelect").data("kendoMultiSelect");this&&this.value()&&(clientID=this.value());resetDivision=!0;resetProduct=!0;resetJob=!0;resetComponent=!0;resetAssignment=!0;resetFunction=!0;checkMultiSelectsEnableClient();clientID&&clientID.length!=0&&clientID[0]!=""?(divisionsMultiSelectDataSource.read().then(function(){divisionsMultiSelectDataSource.total()>0&&enableDivisionsMultiSelect(!0);divisionsMultiSelectDataSource.total()==1&&(divisionID=[],divisionID[0]=divisionsMultiSelectDataSource.data()[0].ID,n.value(divisionID[0]));n.trigger("change")}),n.focus()):(divisionID=[],productID=[],setDivisionsMultiSelectValue(divisionID),setProductsMultiSelectValue(productID),divisionsMultiSelectDataSource.read(),refreshProducsMultiSelectDatasource(),isDirectTime=!0,timeType="D");jobComponentID=[];setJobsMultiSelectValue(jobComponentID);componentMultiSelectDataSource.read()},deselect:function(n){var i=n.dataItem,r=n.item,t=$("#clientsMultiSelect").data("kendoMultiSelect");timeType==="D"&&(timeTypeChanged=!0);timeType="N";isDirectTime=!1;jobNumber=0;jobComponentNumber=0;setAssignmentAndFunctions();setFunctionCategoryLabel();clientID=[];t.value(clientID);t.trigger("change");jobNumber=0;jobComponentNumber=0},maxSelectedItems:1});window.setTimeout(function(){try{var n=$("#clientsMultiSelect").data("kendoMultiSelect");n.list.width(658)}catch(t){}checkMultiSelectsEnableClient()},10)}function clientMapper(n){var t,i,r;if(Text="",t=$("#clientsMultiSelect").data("kendoMultiSelect"),t&&(Text=t.input.val()),Text=="Client"&&(Text=""),Text==""&&t&&(i=t.dataItems(),i&&i.length>0))try{Text=i[0].Nasubstring(0,i[0].NalastIndexOf("(")-1)}catch(u){}r={OfficeCode:"",Text:Text,ClientCode:n.value[0]};$.ajax({url:window.appBase+"Utilities/SearchClientIndex",type:"GET",dataType:"json",data:r,success:t=>{n.success(t)}}).fail(function(n,t,i){alert(i)})}function initDivisionsMultiSelect(){divisionsMultiSelectDataSource=new kendo.data.DataSource({serverFiltering:!0,serverPaging:!0,pageSize:31,schema:{data:"Divisions",total:"Total"},transport:{read:{url:window.appBase+"Utilities/SearchDivisions",data:function(){var r="",n="",u=$("#clientsMultiSelect").data("kendoMultiSelect"),i=$("#divisionsMultiSelect").data("kendoMultiSelect"),t;if(i)if(n=i.input.val(),n=="Division"&&(n=""),resetDivision)resetDivision=!1;else if(n==""&&(t=i.dataItems(),t&&t.length>0))try{n=t[0].Nasubstring(0,t[0].NalastIndexOf("(")-1)}catch(f){}return clientID&&clientID.length>0&&(r=clientID[0]),{OfficeCode:"",ClientCode:r,Text:n}}}},requestStart:function(n){n.type==="read"},requestEnd:function(){}});$("#divisionsMultiSelect").kendoMultiSelect({autoBind:!1,filter:"contains",delay:750,tagTemplate:"<span title='#: data.Name #'  class='ms-tag'>#: data.Name #<\/span>",template:"<span title='#: data.Name #'>#: data.Name #<\/span>",placeholder:"Division",dataTextField:"Name",dataValueField:"ID",dataSource:divisionsMultiSelectDataSource,virtual:{itemHeight:26,me:this,valueMapper:divisionMapper},change:function(){var t=$("#clientsMultiSelect").data("kendoMultiSelect"),i=$("#divisionsMultiSelect").data("kendoMultiSelect"),r=$("#productsMultiSelect").data("kendoMultiSelect"),n;this&&this.value()&&(divisionID=this.value());resetProduct=!0;resetJob=!0;resetComponent=!0;divisionID&&divisionID.length!=0&&divisionID[0]!=""?(divisionID&&divisionID.length>0&&(n=divisionID[0].split(","),clientID&&clientID[0]!=""&&clientID.length!=0&&clientID[0]==n[0]||(clientID=[],clientID[0]=n[0],setClientsMultiSelectValue(clientID[0])),isDirectTime=!0,timeType="D"),refreshProducsMultiSelectDatasource()):(productID=[],setProductsMultiSelectValue(productID),refreshProducsMultiSelectDatasource(),jobComponentID=[],setJobsMultiSelectValue(jobComponentID));jobComponentID=[];setJobsMultiSelectValue(null);componentMultiSelectDataSource.read()},deselect:function(){var t=$("#clientsMultiSelect").data("kendoMultiSelect"),n=$("#divisionsMultiSelect").data("kendoMultiSelect");divisionID=[];n.value(divisionID);divisionsMultiSelectDataSource.read().then(function(){n.trigger("change")});n.focus();jobNumber=0;jobComponentNumber=0},maxSelectedItems:1});window.setTimeout(function(){try{var n=$("#divisionsMultiSelect").data("kendoMultiSelect");n.list.width(658)}catch(t){}},10)}function divisionMapper(n){var u="",t="",r=$("#divisionsMultiSelect").data("kendoMultiSelect"),i,f;if(r&&(t=r.input.val()),t=="Division"&&(t=""),t==""&&r&&(i=r.dataItems(),i&&i.length>0))try{t=i[0].Nasubstring(0,i[0].NalastIndexOf("(")-1)}catch(e){}clientID&&clientID.length>0&&(u=clientID[0]);f={OfficeCode:"",ClientCode:u,DivisionCode:n.value[0],SprintID:0,Text:t};$.ajax({url:window.appBase+"Utilities/SearchDivisionIndex",type:"GET",dataType:"json",data:f,success:t=>{n.success(t)}}).fail(function(n,t,i){alert(i)})}function initProductsMultiSelect(){productsMultiSelectDataSource=new kendo.data.DataSource({serverFiltering:!0,serverPaging:!0,pageSize:31,schema:{data:"Products",total:"Total"},transport:{read:{url:window.appBase+"Utilities/SearchProducts",data:function(){var e="",r="",n="",o=$("#divisionsMultiSelect").data("kendoMultiSelect"),u=$("#productsMultiSelect").data("kendoMultiSelect"),t,i,f;if(u&&(n=u.input.val()),n=="Product"&&(n=""),resetProduct)resetProduct=!1;else if(n==""&&u&&(t=u.dataItems(),t&&t.length>0))try{n=t[0].Nasubstring(0,t[0].NalastIndexOf("(")-1)}catch(s){}return clientID&&clientID.length>0&&(e=clientID[0]),divisionID&&divisionID.length>0?r=divisionID[0].split(",")[1]:(i=o.value(),i&&i.length>0&&(f=i[0].split(","),f&&f.length>1&&(r=f[1])),r=getDivisionCodeFromMultiSelect(),divisionID=[],divisionID=i),{OfficeCode:"",ClientCode:e,DivisionCode:r,Text:n}}}},requestStart:function(n){n.type==="read"},requestEnd:function(){}});$("#productsMultiSelect").kendoMultiSelect({autoBind:!1,filter:"contains",delay:750,tagTemplate:"<span title='#: data.Name #' class='ms-tag'>#: data.Name #<\/span>",template:"<span title='#: data.Name #'>#: data.Name #<\/span>",placeholder:"Product",dataTextField:"Name",dataValueField:"ID",dataSource:productsMultiSelectDataSource,virtual:{itemHeight:26,me:this,valueMapper:productMapper},change:function(){var t=$("#productsMultiSelect").data("kendoMultiSelect"),n;this&&this.value()&&(productID=this.value());resetJob=!0;resetComponent=!0;productID&&productID.length>0?(n=productID[0].split(","),clientID&&clientID[0]!=""&&clientID.length!=0&&clientID[0]==n[0]||clientsMultiSelectDataSource.read().then(()=>{clientID=[],clientID[0]=n[0],setClientsMultiSelectValue(clientID[0])}),divisionID&&divisionID[0]!=""&&divisionID.length!=0&&divisionID[0]==n[0]+","+n[1]||divisionsMultiSelectDataSource.read().then(()=>{divisionID=[],divisionID[0]=n[0]+","+n[1],setDivisionsMultiSelectValue(divisionID[0])}),isDirectTime=!0,timeType="D"):refreshProducsMultiSelectDatasource(!0);jobComponentID=[];setJobsMultiSelectValue(null);componentMultiSelectDataSource.read().then(()=>{var n=$("#jobsMultiSelect").data("kendoMultiSelect");productID&&productID[0]!=""&&productID.length!=0||t.value()&&(productID=t.value());componentMultiSelectDataSource.total()>0&&enableJobsMultiSelect(!0);componentMultiSelectDataSource.total()==1?(jobComponentID=[],jobComponentID[0]=componentMultiSelectDataSource.data()[0].ID,n.value(jobComponentID[0]),enableDivisionsMultiSelect(!0),enableProductsMultiSelect(!0),setJobNumberAndJobComponentNumberFromJobIDArray(jobComponentID[0]),setAssignmentAndFunctions(),setFunctionCategoryLabel()):productID&&productID.length!=0?n.focus():t.focus()})},deselect:function(){var n=$("#productsMultiSelect").data("kendoMultiSelect");productID=[];n.value(null);n.trigger("change");jobNumber=0;jobComponentNumber=0},maxSelectedItems:1});window.setTimeout(function(){try{var n=$("#productsMultiSelect").data("kendoMultiSelect");n.list.width(658)}catch(t){}},10)}function productMapper(n){var u="",f="",t="",r=$("#productsMultiSelect").data("kendoMultiSelect"),i,e;if(r&&(t=r.input.val()),t=="Product"&&(t=""),t==""&&r&&(i=r.dataItems(),i&&i.length>0))try{t=i[0].Nasubstring(0,i[0].NalastIndexOf("(")-1)}catch(o){}u&&clientID.length>0&&(u=clientID[0]);divisionID&&divisionID.length>0&&(f=divisionID[0].split(",")[1]);e={OfficeCode:"",ClientCode:u,DivisionCode:f,ProductID:n.value[0],Text:t};$.ajax({url:window.appBase+"Utilities/SearchProductIndex",type:"GET",dataType:"json",data:e,success:t=>{n.success(t)}}).fail(function(n,t,i){alert(i)})}function initJobsMultiSelect(){componentMultiSelectDataSource=new kendo.data.DataSource({serverFiltering:!0,serverPaging:!0,pageSize:31,schema:{data:"JobComponents",total:"Total"},transport:{read:{url:window.appBase+"Utilities/SearchComponentFromTimesheet",data:function(){var t="",r="",f="",e="",n="",u=$("#jobsMultiSelect").data("kendoMultiSelect"),i;if(u&&(n=u.input.val()),(n=="Component"||n=="Job")&&(n=""),resetComponent)resetComponent=!1;else if(n==""&&u&&(i=u.dataItems(),i&&i.length>0))try{n=i[0].Nasubstring(0,i[0].NalastIndexOf("(")-1)}catch(o){}return t=clientID&&clientID.length>0?clientID[0]:getClientCodeFromMultiSelect(),r=divisionID&&divisionID.length>0?divisionID[0].toString().indexOf(",")>-1?divisionID[0].toString().split(",")[1]:divisionID[0].toString():getDivisionCodeFromMultiSelect(),productID&&productID.length>0?(t=productID[0].split(",")[0],r=productID[0].split(",")[1],f=productID[0].split(",")[2],clientID=[],clientID[0]=t,divisionID=[],divisionID[0]=t+","+r):f=getProductCodeFromMultiSelect(),jobComponentID&&jobComponentID.length>0&&(e=jobComponentID[0]),{OfficeCode:"",ClientCode:t,DivisionCode:r,ProductCode:f,JobCode:e,AccountExecutive:"",CampaignID:0,SalesClass:"",JobType:"",ShowClosedJobs:!1,Text:n}}}},requestStart:function(n){n.type==="read"},requestEnd:function(){}});$("#jobsMultiSelect").kendoMultiSelect({autoBind:!1,filter:"contains",delay:750,tagTemplate:"<span title='#: data.Name #' class='ms-tag'>#: data.Name #<\/span>",template:"<span title='#: data.Name #'>#: data.Name #<\/span>",placeholder:"Job",dataTextField:"Name",dataValueField:"ID",dataSource:componentMultiSelectDataSource,virtual:{itemHeight:26,me:this,valueMapper:jobMapper},change:function(){var n;try{this&&this.value()&&(jobComponentID=this.value())}catch(e){}var t=$("#divisionsMultiSelect").data("kendoMultiSelect"),i=$("#productsMultiSelect").data("kendoMultiSelect"),r=$("#jobAssignmentsComboBox").data("kendoComboBox");jobComponentID&&jobComponentID.length==1&&jobComponentID[0]!=""?(n=jobComponentID[0].split(","),n&&(jobNumber=n[0]*1,jobComponentNumber=n[1]*1,jobNumber>0&&jobComponentNumber>0?(isDirectTime=!0,timeType="D"):(isDirectTime=!1,timeType="N")),jobNumber&&jobNumber>0&&checkJobCommentRequired(),assignmentMultiSelectDataSource.read().then(()=>{setAssignmentAndFunctions(),setFunctionCategoryLabel()}),clientID&&clientID.length!=0&&clientID[0]!=""&&divisionID&&divisionID.length!=0&&divisionID[0]!=""&&productID&&productID.length!=0&&productID[0]!=""||backFillInProgress||(backFillInProgress=!0,$.ajax({url:window.appBase+"Utilities/SearchCDPForJob",type:"GET",dataType:"json",data:{JobNumber:n[0]},success:n=>{clientsMultiSelectDataSource.read().then(()=>{clientID=[],clientID[0]=n.ClientCode,setClientsMultiSelectValue(clientID[0]),divisionsMultiSelectDataSource.read().then(()=>{divisionID=[],divisionID[0]=n.ClientCode+","+n.DivisionCode,setDivisionsMultiSelectValue(divisionID[0]),productsMultiSelectDataSource.page(0),productsMultiSelectDataSource.read().then(()=>{productID=[],productID[0]=n.ClientCode+","+n.DivisionCode+","+n.ProductCode,setProductsMultiSelectValue(productID[0]),backFillInProgress=!1})})})}}))):componentMultiSelectDataSource.read().then(()=>{assignmentMultiSelectDataSource.read().then(()=>{setAssignmentAndFunctions(),setFunctionCategoryLabel()})});enableDivisionsMultiSelect(!0);enableProductsMultiSelect(!0)},deselect:function(){try{var n=$("#jobsMultiSelect").data("kendoMultiSelect");jobComponentID=[];n&&(n.value(null),n.trigger("change"));jobNumber=0;jobComponentNumber=0;commentsRequired=!1;setCommentRequiredTextArea()}catch(e){}},maxSelectedItems:1});window.setTimeout(function(){try{var n=$("#jobsMultiSelect").data("kendoMultiSelect");n.list.width(666)}catch(t){}},10)}function jobMapper(n){var u="",f="",e="",o="",t="",r=$("#jobsMultiSelect").data("kendoMultiSelect"),i,s;if(r&&(t=r.input.val()),t=="Job"&&(t=""),t==""&&r&&(i=r.dataItems(),i&&i.length>0))try{t=i[0].Nasubstring(0,i[0].NalastIndexOf("(")-1)}catch(h){}clientID&&clientID.length>0&&(u=clientID[0]);divisionID&&divisionID.length>0&&(f=divisionID[0].split(",")[1]);productID&&productID.length>0&&(e=productID[0].split(",")[2]);jobComponentID&&jobComponentID.length>0&&(o=jobComponentID[0]);s={OfficeCode:"",ClientCode:u,DivisionCode:f,ProductCode:e,JobCode:o,ComponentID:n.value[0],AccountExecutive:"",CampaignID:0,SalesClass:"",JobType:"",ShowClosedJobs:!1,Text:t};$.ajax({url:window.appBase+"Utilities/SearchComponentIndexFromTimesheet",type:"GET",dataType:"json",data:s,success:t=>{n.success(t)}}).fail(function(n,t,i){alert(i)})}function setJobNumberAndJobComponentNumberFromJobIDArray(n){var t=n.split(",");t&&(jobNumber=t[0]*1,jobComponentNumber=t[1]*1,jobNumber>0&&jobComponentNumber>0?(isDirectTime=!0,timeType="D"):(isDirectTime=!1,timeType="N"))}function initJobAssignmentsMultiSelect(){assignmentMultiSelectDataSource=new kendo.data.DataSource({transport:{read:{url:window.appBase+"Employee/Timesheet/GetJobAssignments",data:function(){var n="",i=$("#jobAssignmentsMultiSelect").data("kendoMultiSelect"),t;if(i)if(n=i.input.val(),n=="Assignment"&&(n=""),resetAssignment)resetAssignment=!1;else if(n==""&&(t=i.dataItems(),t&&t.length>0))try{n=t[0].Nasubstring(0,t[0].NalastIndexOf("(")-1)}catch(r){}return{j:jobNumber,jc:jobComponentNumber,inclps:!1,Text:n}}}},requestStart:function(n){n.type==="read"},requestEnd:function(){}})}function jobAssignmentMapper(){}function initFunctionsMultiSelect(){}function functionMapper(){}function checkMultiSelectsEnableClient(){window.setTimeout(function(){var n=$("#clientsMultiSelect").data("kendoMultiSelect"),t=$("#divisionsMultiSelect").data("kendoMultiSelect"),i=$("#productsMultiSelect").data("kendoMultiSelect"),r=$("#jobsMultiSelect").data("kendoMultiSelect"),u=$("#jobAssignmentsComboBox").data("kendoComboBox");n&&(n.value()&&n.value().length!=0||(divisionID=[],productID=[],jobComponentID=[],t&&(t.value(null),t.enable(!1)),i&&(i.value(null),i.enable(!1)),r&&(r.value(null),r.enable(!0),u&&u.enable(!1))),n.focus())},250)}function refreshProducsMultiSelectDatasource(n){var r=$("#clientsMultiSelect").data("kendoMultiSelect"),i=$("#divisionsMultiSelect").data("kendoMultiSelect"),t=$("#productsMultiSelect").data("kendoMultiSelect");productsMultiSelectDataSource.page(0);productsMultiSelectDataSource.read().then(function(){productsMultiSelectDataSource.total()>0&&enableProductsMultiSelect(!0);(divisionID&&divisionID.length>0||i&&i.value().length>0)&&(n&&n!=!1||(productsMultiSelectDataSource.total()==1&&(productID=[],productID[0]=productsMultiSelectDataSource.data()[0].ID,t.value(productID[0])),t.focus(),t.trigger("change")))})}var fromOldUC=!1,clientInitiated=!1,clientSearchText="",hasChange=!1,jobInitiated=!1,lastJobClient="",lastJobDivision="",lastJobProduct="",backFillInProgress=!1,clientsMultiSelectDataSource,divisionsMultiSelectDataSource,productsMultiSelectDataSource,componentMultiSelectDataSource,assignmentMultiSelectDataSource,functionCategoryMultiSelectDataSource,resetClient,resetDivision,resetProduct,resetJob,resetComponent,resetAssignment,resetFunction,clientID=[],divisionID=[],productID=[],jobComponentID=[],assignmentID=[],functionCategoryID=[],codes=[],lastClientID,lastDivisionID,lastProductID;