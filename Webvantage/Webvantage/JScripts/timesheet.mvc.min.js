function dayOrWeekSelect(n){saveClick("dayOrWeekSelect",n)}function _dayOrWeekSelect(){if(dayOrWeekView=$("#DayOrWeek > .k-state-active").attr("view"),dayOrWeekView=="Day"){var n={StartDate:kendo.toString($("#DatePicker")[0].value,"d")};$.get({url:window.appBase+"Employee/Timesheet/IsCurrentWeek",dataType:"json",data:n}).always(function(n){if(n==!0){var t=new Date;selectSingleDay(kendo.toString(t,"d"))}else selectSingleDay(kendo.toString($("#DatePicker")[0].value,"d"))})}else selectWeek()}function selectSingleDay(n){saveClick("selectSingleDay",n)}function _selectSingleDay(n){n?(activeDateString=n,startDate=activeDateString):(getDatePickerDate(),activeDateString=startDate);setDayView()}function changeSingleDay(n,t){saveClick("changeSingleDay",n,t)}function _changeSingleDay(n,t){t?(activeDateString=t,manualSingleDayDateString=t):(getDatePickerDate(),activeDateString=startDate);$($(n).parent()).find("td").each(function(){var n=$(this);$(n).removeClass("day-view-day-cell-selected")});$(n).addClass("day-view-day-cell-selected");isViewingSingleDay=!0;loadSingleDayTimesheet()}function setDayView(){isViewingSingleDay=!0;loadSingleDayTimesheet()}function selectWeek(){isViewingSingleDay=!1;backToWeekView()}function loadDayNav(){isViewingSingleDay=!0;var n={EmployeeCode:employeeCode,ActiveDate:kendo.toString(startDate,"d"),StartDate:kendo.toString(startDate,"d")};$.get({url:window.appBase+"Employee/Timesheet/GetTimesheetDayHeader",dataType:"json",data:n}).always(function(n){var r,i,t;if(n){for(r=0,i="",t=0;t<n.length;t++)t==0&&(startOfWeekDate=n[t].ShortDate),endOfWeekDate=n[t].ShortDate,$("#day-"+t+"-text").text(n[t].ShortDayOfWeek+" "+n[t].DayMonthDisplay),$("#day-"+t+"-hours").text(kendo.toString(n[t].Hours,"N2")),i=n[t].ShortDate,$("#day-"+t+"-cell").removeAttr("onclick"),n[t].Selected==!0||n[t].ShortDate==activeDateString?$("#day-"+t+"-cell").addClass("day-view-day-cell-selected"):$("#day-"+t+"-cell").removeClass("day-view-day-cell-selected"),$("#day-"+t+"-cell").attr("abbr",i),$("#day-"+t+"-cell").attr("onclick","changeSingleDay(this, '"+i+"');"),r+=n[t].Hours*1;$("#day-nav-total-hours").html(kendo.toString(r,"N2"));manualSingleDayDateString&&manualSingleDayDateString!=""?setManualDayNavDay(manualSingleDayDateString):selectDayNavDay();$("#dayViewNavRow").show();$("#dayViewNav").show();setDateLabelOrPicker()}})}function selectDayNavDay(){activeDateString=kendo.toString(startDate,"d");$(".day-view-day-cell").each(function(){$(this).removeClass("day-view-day-cell-selected");$(this).prop("abbr")==activeDateString&&($(this).addClass("day-view-day-cell-selected"),daySet=!0)})}function setManualDayNavDay(n){$(".day-view-day-cell").each(function(){$(this).removeClass("day-view-day-cell-selected");$(this).prop("abbr")==n&&$(this).addClass("day-view-day-cell-selected")})}function loadSingleDayTimesheet(){isViewingSingleDay=!0;setDatePickerDate(activeDateString);var n=window.appBase+"Employee/Timesheet/_Timesheet?emp="+employeeCode+"&sd="+activeDateString+"&dtd=1&nav="+navType+"&cct="+currentCopyType+"&isdd=1&sort="+sortValue+"&grp="+groupValue;n&&$("#day-view-refresh").load(n,function(){loadDayNav();initTimesheetPartialView(!1);setSortValue(sortValue);setGroupValue(groupValue);unCheckAndClearAllSelectedRows();restoreCollapsedRows();window.setTimeout(function(){hideProgress()},750);window.setTimeout(function(){initTooltips()},500)})}function groupDropDownListChanged(){saveClick("groupDropDownListChanged")}function _groupDropDownListChanged(){try{groupValue=$("#groupDropDownList").val();var n={GroupBy:groupValue};$.post({url:window.appBase+"Employee/Timesheet/SaveUserGroup",dataType:"json",data:n}).always(function(n){n;navigate()})}catch(t){}}function sortDropDownListChanged(){saveClick("sortDropDownListChanged")}function _sortDropDownListChanged(){try{sortValue=$("#sortDropDownList").val();var n={SortValue:sortValue};$.post({url:window.appBase+"Employee/Timesheet/SaveUserTimesheetSort",dataType:"json",data:n}).always(function(){navigate()})}catch(t){}}function getUserSort(){$.get({url:window.appBase+"Employee/Timesheet/GetUserTimesheetSort",dataType:"json",data:{}}).always(function(n){n?setSortValue(n):setSortValue("")})}function backToWeekView(){saveClick("backToWeekView")}function _backToWeekView(){isViewingSingleDay=!1;activeDateString="";manualSingleDayDateString="";$("#dayViewNavRow").hide();$("#dayViewNav").hide();var n=$("#DayOrWeek").kendoButtonGroup({}).data("kendoButtonGroup");n&&n.select(1);navType=0;daysToDisplay=settingsDaysToDisplay;navigate()}function navigatorClicked(){navDirection=$("#Navigator > .k-state-active").attr("direction");navDirection=="previous"?navigateToPrevious():navDirection=="next"?navigateToNext():navigateToToday()}function navigateToPrevious(){saveClick("navigateToPrevious")}function _navigateToPrevious(){clearExpandedRows();navType=2;navigate()}function navigateToNext(){saveClick("navigateToNext")}function _navigateToNext(){clearExpandedRows();navType=3;navigate()}function navigateToToday(){saveClick("navigateToToday")}function _navigateToToday(){clearExpandedRows();navType=1;navigate()}function navigateToDate(){saveClick("navigateToDate")}function _navigateToDate(){clearExpandedRows();navType=4;navigate()}function navigate(){if(allowNavigate==!0){showProgress();inserts=[];var n="";if(isViewingSingleDay==!0){n=window.appBase+"Employee/Timesheet/_Timesheet?emp="+employeeCode+"&sd="+activeDateString+"&dtd="+daysToDisplay+"&nav="+navType+"&cct="+currentCopyType+"&isdd=1&sort="+sortValue+"&grp="+groupValue;try{window.setTimeout(function(){$("#timesheet-control").load(n,function(){navType=0;initTimesheetPartialView(!0);manualSingleDayDateString="";loadDayNav();setSortValue(sortValue);setGroupValue(groupValue);unCheckAndClearAllSelectedRows();restoreCollapsedRows();restoreSelectedRows();window.setTimeout(function(){hideProgress()},750);window.setTimeout(function(){initTooltips()},500)})},10)}catch(t){hideProgress()}}else getDatePickerDate(),n=window.appBase+"Employee/Timesheet/_Timesheet?emp="+employeeCode+"&sd="+startDate+"&dtd="+daysToDisplay+"&nav="+navType+"&cct="+currentCopyType+"&isdd=0&sort="+sortValue+"&grp="+groupValue,window.setTimeout(function(){try{$("#timesheet-control").load(n,function(){navType=0;initTimesheetPartialView(!0);setDatePickerDate(startDate);setSortValue(sortValue);setGroupValue(groupValue);unCheckAndClearAllSelectedRows();restoreCollapsedRows();restoreSelectedRows();window.setTimeout(function(){hideProgress()},750);window.setTimeout(function(){initTooltips()},500)})}catch(t){hideProgress()}},10)}}function setGroupValue(n){try{groupValue=n;(!groupValue||groupValue=="")&&savedGroup&&savedGroup!=""&&(groupValue=savedGroup);groupValue||(groupValue="");var t=$("#groupDropDownList").data("kendoDropDownList");t&&t.value(groupValue)}catch(i){}}function setSortValue(n){try{sortValue=n;sortValue||(sortValue="");var t=$("#sortDropDownList").data("kendoDropDownList");t&&t.value(sortValue)}catch(i){}}function checkForCurrentWeek(){var n=!1,t=new Date,i=kendo.toString(t,"d");return $("#employeeTimeTable thead>tr.day_header_row>td").filter(function(){i==$(this)[0].id.replace("time-col-","")&&(n=!0)}),n}function showSelectEmployeeDialog(){employeeDialogInitiated==!1&&initEmployees();saveClick("showSelectEmployeeDialog")}function _showSelectEmployeeDialog(){$("#selectEmployeeDialogEmployeeName").text("");$("#selectEmployeeDialogEmployeeName").html("");$("#selectEmployeeDialogEmployeeName").val("");$("#selectEmployeeDialogEmployeeName").focus();var n=$("#selectEmployeeDialogEmployeeListBox").getKendoListBox();n&&n.dataSource.filter({});$("#selectEmployeeDialog").ejDialog({showFooter:!1,enableModal:!0,closeOnEscape:!0,backgroundScroll:!1,enablePersistence:!0,enableResize:!1});$("#selectEmployeeDialog").ejDialog("open")}function selectEmployeeSelectButtonClick(){var t=$("#selectEmployeeDialogEmployeeListBox").data("kendoListBox"),i,n;t&&(i=t.select(),n=t.dataItem(i[0]),n&&n.Code!=employeeCode&&(employeeCode=n.Code,navigate(),$("#employeeImage").attr("src",employeePictureURL+employeeCode),$("#employeeName").attr("title",n.Description),$("#employeeName").text(n.Description),$("#selectEmployeeDialog").ejDialog("close"),selectEmployeeInListBox(),copyProjectsDataSource=null,loadCopyFromMyProjects()))}function selectEmployeeCancelButtonClick(){refreshTimesheet();$("#selectEmployeeDialog").ejDialog("close")}function openNewEntryDialog(){var n="",t,i;if(isViewingSingleDay==!0)n=window.appBase+"Employee/Timesheet/Entry?emp="+employeeCode+"&sd="+activeDateString+"&new=1";else{t="";try{t=kendo.toString(startDate,"d")}catch(r){t=startDate}checkForCurrentWeek()==!0?(i=new Date,n=window.appBase+"Employee/Timesheet/Entry?emp="+employeeCode+"&new=1&sd="+kendo.toString(i,"d")):n=window.appBase+"Employee/Timesheet/Entry?emp="+employeeCode+"&sd="+t+"&new=1"}_openEntryDialog("Add Time",n,!0)}function closeDialogs(){closeNewEntryDialog()}function openEntryDialog(n,t,i,r,u,f,e,o,s){var c="",l="Edit Time",a,y,v;if(n||(n=0),t||(t=0),r||(r=0),u||(u=0),e||(e=0),c=window.appBase+"Employee/Timesheet/Entry?emp="+employeeCode+"&etid="+n+"&etdid="+t+"&fn="+i+"&j="+r+"&jc="+u+"&sd="+f+"&a="+e+"&dtc="+o+"&new=0&udc=1",n>0&&t>0)l="Edit Time",_openEntryDialog(l,c,!1);else{if(s&&(s.defaultValue==""&s.value!=""&&isNaN(s.value)==!1&&(c=c+"&hrs="+s.value),a=s.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement,v=-1,a)){y=a.id;v=getRowNumber(a);let n=new RowInfo(y);var p=s.getAttribute("entry-date"),h,w=!1,b=!1;h=new EntryInfo;h.RowNumber=v;h.EmployeeCode=employeeCode;h.EntryDate=p;n.JobNumber&&n.JobNumber>0&&(h.JobNumber=n.JobNumber,w=!0);n.JobComponentNumber&&n.JobComponentNumber>0&&(h.JobComponentNumber=n.JobComponentNumber,b=!0);h.TimeType=w==!0&&b==!0?"D":"N";h.FunctionCategoryCode=n.FunctionCode;h.DepartmentTeamCode=n.DepartmentTeamCode;h.Hours=s.value*1;h.Comment&&h.Comment!=""&&(h.HasComments=!0);h.AlertID=n.AlertID;h.key=employeeCode+"|"+n.FunctionCode+"|"+n.DepartmentTeamCode+"|"+n.JobNumber+"|"+n.JobComponentNumber+"|0|0|0|"+h.TimeType+"|"+p+"|false|false|0|"+n.AlertID;removeInsert(h)}l="Add Time";_openEntryDialog(l,c,!0)}}function _openEntryDialog(n,t,i){saveClick();var r="600px",u="600px";i==!0&&(r="570px",u="700px");$("#entryDialog").ejDialog("destroy");$("#entryDialog").ejDialog({contentUrl:t,title:n+"",closeOnEscape:!0,showOnInit:!1,contentType:"iframe",height:r,width:u,showFooter:!1,enableModal:!1,backgroundScroll:!0,enableResize:!1});$("#entryDialog").ejDialog("open");$("#entryDialog").ejDialog("refresh")}function closeNewEntryDialog(){$("#entryDialog").ejDialog("close")}function openTimeTemplateEditDialog(){var t="",n;if(isViewingSingleDay==!0)t=window.appBase+"Timesheet_CopyFrom.aspx?v=2&emp="+employeeCode+"&sd="+activeDateString;else{n="";try{n=kendo.toString(startDate,"d")}catch(i){n=startDate}t=checkForCurrentWeek()==!0?window.appBase+"Timesheet_CopyFrom.aspx?v=2&emp="+employeeCode:window.appBase+"Timesheet_CopyFrom.aspx?v=2&emp="+employeeCode+"&sd="+n}$("#settingsDialog").ejDialog("destroy");$("#settingsDialog").ejDialog({contentUrl:t,title:"Copy From Time Template Options",closeOnEscape:!0,showOnInit:!1,contentType:"iframe",height:"750px",width:"1100px",showFooter:!1,enableModal:!0,backgroundScroll:!0,enableResize:!0,close:function(){currentCopyType=2;refreshCopyFromList()}});$("#settingsDialog").ejDialog("open");$("#settingsDialog").ejDialog("refresh")}function openCalendarEditDialog(){var t="",n;if(isViewingSingleDay==!0)t=window.appBase+"Timesheet_CopyFrom.aspx?v=2&emp="+employeeCode+"&sd="+activeDateString;else{n="";try{n=kendo.toString(startDate,"d")}catch(i){n=startDate}t=checkForCurrentWeek()==!0?window.appBase+"Timesheet_CopyFrom.aspx?v=3&emp="+employeeCode:window.appBase+"Timesheet_CopyFrom.aspx?v=3&emp="+employeeCode+"&sd="+n}$("#settingsDialog").ejDialog("destroy");$("#settingsDialog").ejDialog({contentUrl:t,title:"Copy From Calendar Options",closeOnEscape:!0,showOnInit:!1,contentType:"iframe",height:"750px",width:"1250px",showFooter:!1,enableModal:!0,backgroundScroll:!0,enableResize:!0});$("#settingsDialog").ejDialog("open");$("#settingsDialog").ejDialog("refresh")}function settingsClick(){openSettingsDialog()}function openSettingsDialog(){saveClick("openSettingsDialog")}function _openSettingsDialog(){var n="";n=window.appBase+"Employee/Timesheet/Settings?my=1&emp="+employeeCode;$("#settingsDialog").ejDialog("destroy");$("#settingsDialog").ejDialog({contentUrl:n,title:"Settings",showOnInit:!1,contentType:"iframe",height:"640px",width:"550px",showFooter:!1,enableModal:!0,backgroundScroll:!1,enableResize:!1});$("#settingsDialog").ejDialog("open");$("#settingsDialog").ejDialog("refresh")}function closeSettingsDialog(){$("#settingsDialog").ejDialog("close")}function getDatePickerDate(){var n=$("#DatePicker").data("kendoDatePicker");try{startDate=kendo.toString(n.value(),"d")}catch(t){startDate=null}startDate&&startDate!=null&&startDate!=""&&startDate!=undefined||(startDate=kShortDateStringFromDatePicker(n))}function parseDate(n){var i=!1,t=kendo.parseDate(n);return t||$.each(["MM/dd/yyyy","MM/dd/yy","MMddyyyy","MMddyy"],function(){return t=kendo.parseDate(n,this),t?!1:void 0}),t&&(t=kendo.toString(t,"d"),i=!0),{isValid:i,value:t}}function setDatePickerDate(n){var t=$("#DatePicker").data("kendoDatePicker");try{t.value(n)}catch(i){}}function hardRefresh(){window.location.reload()}function cancelClick(){inserts=[];updates=[];disableSaveButton();disableCancelButton();navigate()}function refreshTimesheet(){cancelClick()}function bookmark(){$.post({url:window.appBase+"Employee/Timesheet/Bookmark",dataType:"json",data:{PageURL:"Employee/Timesheet",Name:"Timesheet"}})}function initEmployees(){var t=window.appBase+"Employee/Timesheet",i=new kendo.data.DataSource({serverFiltering:!1,transport:{read:{url:t+"/GetMyEmployees",dataType:"json"}},requestStart:function(n){n.type=="read"},requestEnd:function(n){n.type=="read"&&(employeeDialogInitiated=!0)},schema:{model:{id:"Code",fields:{Code:{editable:!1,nullable:!0},Description:{type:"string"}}}}}),n;$("#selectEmployeeDialogEmployeeName").on("input",function(t){window.setTimeout(function(){var i=$("#selectEmployeeDialogEmployeeName").val();(n.items().length!=1||isBackspace==!0)&&(n.dataSource.filter({field:"Description",value:$(t.target).val(),operator:"contains"}),selectEmployeeInListBox())},0)});if(n=$("#selectEmployeeDialogEmployeeListBox").kendoListBox({dataSource:i,draggable:!1,dataTextField:"Description",dataValueField:"Code",selectable:"single",template:kendo.template($("#employeeLookupTemplate").html())}).data("kendoListBox"),n)n.wrapper.find(".k-list").on("dblclick",".k-item",function(){selectEmployeeSelectButtonClick()})}function selectEmployeeInListBox(){window.setTimeout(function(){var n=$("#selectEmployeeDialogEmployeeListBox").data("kendoListBox");if(n.items())if(n.clearSelection(),n.items().length==1)n.select(n.items()[0]),n.items()[0].focus();else{for(i=0;i<n.element.children().length;i++)employeeCode==$(n.element.children()[i]).val()&&(n.select(n.items()[i]),n.items()[i].focus());$("#selectEmployeeDialogEmployeeListBox").focus()}},100)}function rowChangeFunctionClick(n,t){currentRowContextRowId=t*1;showSelectFunctionDialog(n)}function showSelectFunctionDialog(n){var t,r,u,f;functionChangeRowInfo=null;t=new RowInfo(n);t&&(functionChangeRowInfo=t,r="D",u=0,t.JobNumber&&t.JobNumber>0?(r="D",u=t.JobNumber):(r="N",u=0),r=="N"?($("#selectFunctionDialog").ejDialog({title:"Available Categories"}),$("#selectFunctionDialogFunction").attr("placeholder","Select a category")):($("#selectFunctionDialog").ejDialog({title:"Available Functions"}),$("#selectFunctionDialogFunction").attr("placeholder","Select a function")),f={EmployeeCode:employeeCode,TimeType:r,JobNumber:u,IncludePleaseSelect:!1},$.get({url:window.appBase+"Employee/Timesheet/GetFunctionsAndCategories",dataType:"json",data:f}).always(function(n){if(n){var r=$("#selectFunctionsListBox").data("kendoListBox");if(r&&(r.setDataSource(n),t&&t.FunctionCode&&r.items())){for(i=0;i<r.element.children().length;i++)t.FunctionCode==$(r.element.children()[i]).val()&&r.enable(r.items()[i],!1);$("#selectFunctionDialogFunction").focus();$("#selectFunctionDialog").ejDialog("open")}}}))}function selectFunctionSelectButtonClick(){var u=$("#selectFunctionsListBox").data("kendoListBox"),n,t=[],o=0,s=0,f=!1,h,i,c,e,r;functionChangeRowInfo.JobNumber&&functionChangeRowInfo.JobNumber>0&&(o=functionChangeRowInfo.JobNumber);functionChangeRowInfo.JobComponentNumber&&functionChangeRowInfo.JobComponentNumber>0&&(s=functionChangeRowInfo.JobComponentNumber);o==0&&s==0&&(f=!0);u&&(h=u.select(),i=u.dataItem(h[0]),i&&i.Code&&(n=i.Code));n&&n!=""?functionChangeRowInfo&&n&&(c="#"+functionChangeRowInfo.key,$("#employeeTimeTable tbody>tr.border_bottom").filter(function(){$(this)[0].id&&$(this)[0].id==functionChangeRowInfo.key&&(e=$(this)[0],$(e).attr("row-id")*1==currentRowContextRowId&&$(e).find("td.input-cell").each(function(){r=$(this)[0];$(r).attr("property")&&$(r).attr("property")!="0|0"&&t.push($(r).attr("property"))}))}),t&&t.length>0&&(saveClick(),f==!1?updateRowFunction(t,n):updateRowCategory(t,n))):(f==!1?showNotification("No function selected'","warning"):showNotification("No category selected'","warning"),selectFunctionCancelButtonClick())}function selectFunctionCancelButtonClick(){functionChangeRowInfo=null;currentRowContextRowId=0;$("#selectFunctionDialog").ejDialog("close")}function updateRowFunction(n,t){var i={Entries:n.toString(),FunctionCode:t,EmployeeCode:employeeCode};$.post({url:window.appBase+"Employee/Timesheet/UpdateFunction",dataType:"json",data:i}).always(function(n){n&&(n.Success==!0&&(n.Message&&n.Message!=""?showNotification(n.Message):showSuccessNotification("Function updated for row."),selectFunctionCancelButtonClick()),n.Success==!1&&(n.Message&&n.Message!=""?showNotification(n.Message,"error"):showNotification("Function not updated.","error"),selectFunctionCancelButtonClick()));refreshTimesheet();currentRowContextRowId=0})}function updateRowCategory(n,t){var i={Entries:n.toString(),CategoryCode:t};$.post({url:window.appBase+"Employee/Timesheet/UpdateCategory",dataType:"json",data:i}).always(function(n){n&&(n.Success==!0&&(showSuccessNotification("Category updated for row."),selectFunctionCancelButtonClick()),n.Success==!1&&(n.Message&&n.Message!=""?showNotification(n.Message,"error"):showNotification("Category not updated.","error"),selectFunctionCancelButtonClick()));refreshTimesheet();currentRowContextRowId=0})}function rowDialogClosed(){currentRowContextRowId=0}function rowChangeAssignmentClick(n,t){currentRowContextRowId=t*1;showChangeAssignmentDialog(n)}function showChangeAssignmentDialog(n){var t,r,u,f;currentRowContextRowId==0;assignmentChangeRowInfo=null;t=new RowInfo(n);t&&(assignmentChangeRowInfo=t,r=0,u=0,t.JobNumber&&t.JobNumber>0&&(r=t.JobNumber),t.JobComponentNumber&&t.JobComponentNumber>0&&(u=t.JobComponentNumber),r&&r>0&&u&&u>0?(f={JobNumber:r,JobComponentNumber:u},$.get({url:window.appBase+"Employee/Timesheet/GetJobAssignments?inclps=0&j="+r+"&jc="+u,dataType:"json",data:f}).always(function(n){if(n){var r=$("#changeAssignmentDialogListBox").data("kendoListBox");if(r&&n&&(r.setDataSource(n),t&&t.AlertID&&r.items())){for(i=0;i<r.element.children().length;i++)t.AlertID==$(r.element.children()[i]).val()&&r.enable(r.items()[i],!1);$("#changeAssignmentDialog").focus();$("#changeAssignmentDialog").ejDialog("open")}}})):showNotification("Option not available for indirect time"))}function changeAssignmentDialogSaveButtonClick(){var u=$("#changeAssignmentDialogListBox").data("kendoListBox"),n,t=[],e,i,o,f,r;u&&(e=u.select(),i=u.dataItem(e[0]),i&&i.AlertID&&(n=i.AlertID*1));n&&isNaN(n)!=!0&&n!=undefined&&n!=0?assignmentChangeRowInfo&&n&&(o="#"+assignmentChangeRowInfo.key,$("#employeeTimeTable tbody>tr.border_bottom").filter(function(){$(this)[0].id&&$(this)[0].id==assignmentChangeRowInfo.key&&(f=$(this)[0],$(f).attr("row-id")*1==currentRowContextRowId&&$(f).find("td").each(function(){r=$(this)[0];$(r).attr("property")&&$(r).attr("property")!="0|0"&&t.push($(r).attr("property"))}))}),t&&t.length>0&&(saveClick(),updateRowAssignment(t,n))):(showNotification("No assignment selected"),changeAssignmentDialogCancelButtonClick())}function changeAssignmentDialogCancelButtonClick(){assignmentChangeRowInfo=null;currentRowContextRowId=0;var n=$("#changeAssignmentDialogListBox").data("kendoListBox");n&&n.dataSource.data([]);$("#changeAssignmentDialog").ejDialog("close")}function updateRowAssignment(n,t){var i={Entries:n.toString(),AlertID:t};$.post({url:window.appBase+"Employee/Timesheet/UpdateAssignment",dataType:"json",data:i}).always(function(n){n&&(n.Success==!0&&(showSuccessNotification("Assignment updated for row."),changeAssignmentDialogCancelButtonClick()),n.Success==!1&&(n.Message&&n.Message!=""?showNotification(n.Message,"error"):showNotification("Assignment not updated.","error"),changeAssignmentDialogCancelButtonClick()));refreshTimesheet();currentRowContextRowId=0})}function startStopwatchFromRow(n){saveClick("startStopwatchFromRow",n)}function _startStopwatchFromRow(n){var t,i,r;stopWatchRowInfo=null;t=new RowInfo(n);t&&(stopWatchRowInfo=t,i=new Date,r={EmployeeCode:employeeCode,EntryDate:kendo.toString(i,"d"),JobNumber:stopWatchRowInfo.JobNumber,JobComponentNumber:stopWatchRowInfo.JobComponentNumber,FunctionCode:stopWatchRowInfo.FunctionCode,AlertID:stopWatchRowInfo.AlertID},$.post({url:window.appBase+"Employee/Timesheet/StartStopwatchFromRow",dataType:"json",data:r}).always(function(n){if(n)if(n.Success&&n.Success==!0)refreshTimesheet(),checkForStopwatch(),showSuccessNotification("Stopwatch started.");else if(n.Message&&n.Message!="")try{showNotification(JSON.parse(n.Message),"error")}catch(t){showNotification(n.Message,"error")}refreshTimesheet()}))}function copyRow(n){saveClick("copyRow",n)}function _copyRow(n){var r,e,u,t,i,f;copyRowRowInfo=null;r=new RowInfo(n);r&&(saveClick(),copyRowRowInfo=r,e="#"+n,$("#employeeTimeTable tbody>tr.border_bottom").filter(function(){$(this)[0].id&&$(this)[0].id==n&&(u=$(this)[0],$(u).find("td.input-cell").each(function(){t=$(this)[0];$(t).attr("property")&&$(t).attr("property")!="0|0"&&(i=$(t).attr("abbr"))}))}),i||(i=kendo.toString(startDate,"d")),f={EmployeeCode:employeeCode,StartDate:i,JobNumber:copyRowRowInfo.JobNumber,JobComponentNumber:copyRowRowInfo.JobComponentNumber,FunctionCategoryCode:copyRowRowInfo.FunctionCode,AlertID:copyRowRowInfo.AlertID},$.post({url:window.appBase+"Employee/Timesheet/CopyRow",dataType:"json",data:f}).always(function(n){n&&(showSuccessNotification("Row copied."),refreshTimesheet())}))}function copyFromOptionsClick(){saveClick("copyFromOptionsClick")}function _copyFromOptionsClick(){copyPanelVisible==!1?showCopyPanel():hideCopyPanel();copyPanelVisible=!copyPanelVisible;hideProgress()}function copyToOptionsClick(){saveClick("copyToOptionsClick")}function _copyToOptionsClick(){$("#copyToDialogCopyItems").focus();$("#copyToDialog").ejDialog("open")}function copyToDialogSelectButtonClick(){var n=$("#copyToDialogCopyItemsButtonGroup > .k-state-active")[0].innerText.toLowerCase();n.indexOf("timesheet")>-1==!0?copyEntireTimesheet():n.indexOf("rows")>-1==!0&&(hasSelectedRows()==!1?showNotification("No rows selected to copy!","warning"):copySelectedRows())}function copyEntireTimesheet(){var n=$("#copyToDialogCalendar").data("kendoCalendar"),u=$("#copyToDialogCopyItemsButtonGroup > .k-state-active")[0],f=kendo.toString(n.value(),"d"),t=!1,i,r;i=u.innerText.toLowerCase().indexOf("timesheet")>-1==!0?0:1;t=$("#DayOrWeek > .k-state-active").attr("view")=="Week"?!1:!0;r={Type:i,EmployeeCode:employeeCode,SourceDate:$("#DatePicker")[0].value,TargetDate:f,IncludeHours:$("#copyToDialogIncludeHoursCheckBox").is(":checked"),IncludeComments:$("#copyToDialogIncludeCommentsCheckBox").is(":checked"),SingleDay:t};$.post({url:window.appBase+"Employee/Timesheet/CopyTimesheet",dataType:"json",data:r}).always(function(t){t&&(t.Success==!0?(setDatePickerDate(kendo.toString(n.value(),"d")),copyToDialogCancelButtonClick(),navigate()):t.Message&&t.Message!=""&&showNotification(t.Message,"error"))})}function copySelectedRows(){for(var r,i,f,e=$("#copyToDialogCalendar").data("kendoCalendar"),o=$("#DatePicker")[0].value,u=kendo.toString(e.value(),"d"),s=$("#copyToDialogIncludeHoursCheckBox").is(":checked"),h=$("#copyToDialogIncludeCommentsCheckBox").is(":checked"),n=[],t=selectedRows.length;t--;)selectedRows[t]&&$("#employeeTimeTable tbody>tr.border_bottom").filter(function(){$(this)[0].id&&$(this)[0].id==selectedRows[t].RowInfo.key&&(r=$(this)[0],$(r).attr("row-id")*1==selectedRows[t].ID&&$(r).find("td.input-cell").each(function(){if(i=$(this)[0],$(i).attr("property")&&$(i).attr("property")!="0|0"){var t;$(i).find("input.hours-textbox").each(function(){if(this&&(t=this,t.id)){let r=new EntryInfo(t.id);if(r&&r.EmployeeTimeID>0&&r.EmployeeTimeDetailID>0){r.TimeType&&r.TimeType!=""&&r.TimeType!=undefined||(r.TimeType=r.JobNumber&&r.JobNumber>0?"D":"N");var i={EmployeeTimeID:r.EmployeeTimeID,EmployeeTimeDetailID:r.EmployeeTimeDetailID,TimeType:r.TimeType,EntryDate:r.EntryDate,Hours:r.Hours,Comment:r.Comment};n.push(i)}}})}}))});if(n&&n.length>0){showProgress();try{f={EmployeeCode:employeeCode,SourceDate:o,TargetDate:u,IncludeHours:s,IncludeComments:h,Entries:JSON.stringify(n)};$.post({url:window.appBase+"Employee/Timesheet/CopySelectedRows",dataType:"json",data:f}).always(function(n){var t,i;if(hideProgress(),copyToDialogCancelButtonClick(),unCheckAndClearAllSelectedRows(),n){if(console.log("Copy results!",n.Data.ErrorMessages),n.Data.Failed*1>0?showNotification("Some entries could not be copied.","error"):n.Data.Saved*1==0&&showNotification("No entries were copied.","error"),n.Data.ErrorMessages.length>0)for(t="",i=0;i<n.Data.ErrorMessages.length;i++)t="",t=n.Data.ErrorMessages[i],t&&t!=""&&t.indexOf("SUCCESS")==-1&&showNotification(t,"error");n.Data.Saved*1>0&&(n.Data.Failed*1==0,setDatePickerDate(u),navigate())}})}catch(c){hideProgress()}}}function copyToDialogCancelButtonClick(){$("#copyToDialog").ejDialog("close")}function exportToExcel(){saveClick("exportToExcel")}function _exportToExcel(){window.location.href=window.appBase+"Employee/Timesheet/GetReport?EmployeeCode="+employeeCode+"&StartDate="+startDate+"&DaysToGet=7&Sort=1"}function openPrintSettingsPage(){saveClick("openPrintSettingsPage")}function _openPrintSettingsPage(){hideProgress();var t=kendo.toString(startDate,"d"),n=window.appBase+"Timesheet_QuickPrintSettings.aspx?empcode="+employeeCode+"&tsdate="+kendo.toString(startDate,"d")+"&sortkey=&Type=1&Report=timesheetprint";$("#approvalCommentDialog").ejDialog({contentUrl:n,title:"Print Timesheet",closeOnEscape:!0,showOnInit:!1,contentType:"iframe",height:"400px",width:"450px",showFooter:!1,enableModal:!0,backgroundScroll:!1,enableResize:!1});$("#approvalCommentDialog").ejDialog("open");$("#approvalCommentDialog").ejDialog("refresh")}function initAgencySettings(){agencyTimesheetSettings=new AgencyTimesheetSettings;$.get({url:window.appBase+"Employee/Timesheet/GetTimesheetAgencySettings",dataType:"json",data:{}}).always(function(n){n&&(agencyTimesheetSettings=n,agencyTimesheetSettings&&(useCopyTimesheetFeature=agencyTimesheetSettings.UseCopyTimesheetFeature,agencyCommentsRequired=agencyTimesheetSettings.RequireTimeComments,useCopyTimesheetFeature==!1&&($("#copyToListItem").hide(),$("#copyFromListItem").hide()),agencyTimesheetSettings.AllowCopyOfTimesheetHours==!1&&$("#copyToDialogIncludeHoursDiv").hide()))})}function hoursKeyUp(n){var t=0;if(n.value!="."&&n.value!=","&&n.value!="-"&&n.value!="-."&&n.value!="-,"&&jQuery.isNumeric(n.value)==!1)return n.value="",!1;isNaN(n.value)==!1&&(t=n.value*1);calculateTotals(n)}function hoursChanged(n){var e,w,t,tt,o,f,b,k;if(n){var i=!1,s=!1,y=n.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement,h,c,p,l="",d="",g=!1,a=n.id,nt,r=!1,u=!1,v=-1;y&&(nt=y.id,v=getRowNumber(y));let it=new RowInfo(nt);if(h=n.parentElement.parentElement,e=!1,w=n.getAttribute("entry-date"),a&&a!=""&&(e=!0),h&&(c=$(h).find("#commentsInput")[0],p=$(h).find("#commentsDefault")[0]),c&&(l=c.value),p&&(d=p.value),n.defaultValue!=n.value&&(i=!0),d!=l&&(i=!0,s=!0),i==!0&&(n.defaultValue!=""&&isNaN(n.defaultValue)==!1?(tt=n.defaultValue*1,r=!0):r=!1,n.value!=""&&isNaN(n.value)==!1?(o=n.value*1,o>24&&(o=24,n.value=o),u=!0):u=!1,tt==o&&s==!1&&(i=!1),r==!1&&u==!1?i=!1:r==!0&&u==!0?e=!0:r==!0&&u==!1?g=!0:r==!1&&u==!0&&(e=!1),i==!1&&(t=null,t=new EntryInfo(a),t&&(t.RowNumber=v,removeInsert(t),removeUpdate(t),removeDelete(t)))),i==!0||s==!0){if(f=0,n.value&&isNaN(n.value)==!1&&(f=n.value*1),e==!0)try{if(t=null,t=new EntryInfo(a),t.RowNumber=v,t.Hours!=f||i==!0||s==!0)if(t.Hours=f,t.Comment=l,t.HasComments=t.Comment&&t.Comment!=""?!0:!1,g==!1){if(removeDelete(t),t.HasComments==!1&&t.CommentsRequired==!0&&isViewingSingleDay==!0&&f!=0)return $(c).focus(),showNotification("Comment required.","error"),!1;addUpdate(t)}else addDelete(t)}catch(it){}else try{t=null;t=new EntryInfo;t.RowNumber=v;b=!1;k=!1;t.EmployeeCode=employeeCode;t.EntryDate=w;it.JobNumber&&it.JobNumber>0&&(t.JobNumber=it.JobNumber,b=!0);it.JobComponentNumber&&it.JobComponentNumber>0&&(t.JobComponentNumber=it.JobComponentNumber,k=!0);t.TimeType=b==!0&&k==!0?"D":"N";t.FunctionCategoryCode=it.FunctionCode;t.DepartmentTeamCode=it.DepartmentTeamCode;t.Hours=f;t.Comment=l;t.Comment&&t.Comment!=""&&(t.HasComments=!0);t.AlertID=it.AlertID;t.key=employeeCode+"|"+it.FunctionCode+"|"+it.DepartmentTeamCode+"|"+it.JobNumber+"|"+it.JobComponentNumber+"|0|0|0|"+t.TimeType+"|"+w+"|false|false|0|"+it.AlertID;addInsert(t)}catch(it){}setSaveCancelButtons()}calculateTotals(n)}}function commentsChanged(n){var t;if(n){var e=!1,i,h,r,u,f,o="",s="";i=n.parentElement;h=n.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement;r=n.parentElement.parentElement.parentElement;i&&(u=$(i).find("#commentsInput")[0],f=$(i).find("#commentsDefault")[0]);u&&(o=u.value);f&&(s=f.value);s!=o&&(e=!0);e==!0&&r&&(t=$(r).find("input.hours-textbox")[0],t&&((isNaN($(t).val())==!0||$(t).val()=="")&&$(t).val(0),hoursChanged(t)))}}function calculateTotals(n){var u=n.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement,i,c,r,f,e,o;try{if(u){var s=0,h=$(u).find("#totalRowHours"),a=0;$(u).find("input.hours-textbox").each(function(){a+=1;isNaN($(this).val())==!1&&(s+=$(this).val()*1)});h&&h.text(kendo.toString(s,"n"))}}catch(v){}i=$(n).parent().parent().parent().parent().parent();try{if(i&&(c=$(i).index(),r=$(i).closest("table").find("tr").find(">td:eq("+c+")"),r)){var l=0,y=$(r).find("#footerTotalCell"),t="";t=$(i).attr("abbr");t=t.replace("/","");t=t.replace("/","");$(r).find("input.hours-textbox").each(function(){isNaN($(this).val())==!1&&(l+=$(this).val()*1)});f=$("#totalColHours-"+t);f&&f.text(kendo.toString(l,"n"))}}catch(v){}e=0;o=$("#totalGridHours");try{$("#employeeTimeTable").find("input.hours-textbox").each(function(){isNaN($(this).val())==!1&&(e+=$(this).val()*1)});o&&o.text(kendo.toString(e,"n"))}catch(v){}}function clearAllEdits(){inserts=[];updates=[];deletes=[];setSaveCancelButtons()}function setSaveCancelButtons(){inserts.length>0||updates.length>0||deletes.length>0?(enableSaveButton(),enableCancelButton()):inserts.length==0&&updates.length==0&&deletes.length==0&&(disableSaveButton(),disableCancelButton())}function addUpdate(n){n&&n!=undefined&&(removeDelete(n),removeUpdate(n),updates.push(n))}function addInsert(n){n&&n!=undefined&&(removeInsert(n),inserts.push(n))}function addDelete(n){n&&n!=undefined&&(removeUpdate(n),removeDelete(n),deletes.push(n))}function removeUpdate(n){var i,f,t,r,u;if(n&&n!=undefined)if(i=n.key,f=n.RowNumber,i){if(updates&&updates.length>0)for(t=updates.length;t--;)updates[t]&&updates[t].key==i&&updates[t].RowNumber==f&&updates.splice(t,1)}else if(updates&&updates.length>0)for(t=updates.length;t--;)updates[t]&&(r="",u="",r=tempKey(n),u=tempKey(updates[t]),r==u&&updates.splice(t,1))}function removeInsert(n){var i,r,t,u,f;if(n&&n!=undefined)if(i=n.key,r=n.RowNumber,i){if(inserts&&inserts.length>0)for(t=inserts.length;t--;)inserts[t]&&inserts[t].key==i&&inserts[t].RowNumber==r&&inserts.splice(t,1)}else if(inserts&&inserts.length>0)for(t=inserts.length;t--;)inserts[t]&&(u="",f="",u=tempKey(n),f=tempKey(inserts[t]),u==f&&inserts[t].RowNumber==r&&inserts.splice(t,1))}function removeDelete(n){var i,f,t,r,u;if(n&&n!=undefined)if(i=n.key,f=n.RowNumber,i){if(deletes&&deletes.length>0)for(t=deletes.length;t--;)deletes[t]&&deletes[t].key==i&&deletes[t].RowNumber==f&&deletes.splice(t,1)}else if(deletes&&deletes.length>0)for(t=deletes.length;t--;)deletes[t]&&(r="",u="",r=tempKey(n),u=tempKey(deletes[t]),r==u&&deletes.splice(t,1))}function tempKey(n){var t="";return t+=n.EmployeeCode?n.EmployeeCode+"|":"|",t+=n.FunctionCategoryCode?n.FunctionCategoryCode+"|":"|",t+=n.DepartmentTeamCode?n.DepartmentTeamCode+"|":"|",t+=n.JobNumber?n.JobNumber+"|":"|",t+=n.JobComponentNumber?n.JobComponentNumber+"|":"|",t+=n.EmployeeTimeID?n.EmployeeTimeID+"|":"|",t+=n.EmployeeTimeDetailID?n.EmployeeTimeDetailID+"|":"|",t+=n.EditFlag?n.EditFlag+"|":"|",t+=n.TimeType?n.TimeType+"|":"|",t+=n.EntryDate?n.EntryDate+"|":"|",t+=n.CommentsRequired?n.CommentsRequired+"|":"|",t+=n.HasComments?n.HasComments+"|":"|",t+="0|",t+(n.AlertID?n.AlertID+"|":"|")}function updateDashboardWeeklyHours(){this.refreshDashboardTime()}function saveClick(n,t,i){var r,u;insertsCount=inserts.length;updatesCount=updates.length;deletesCount=deletes.length;insertedCount=0;insertedFailedCount=0;updatedCount=0;updatedFailedCount=0;deletedCount=0;deletedFailedCount;hasInserts=!1;hasUpdates=!1;hasDeletes=!1;insertsCount>0&&(hasInserts=!0);updatesCount>0&&(hasUpdates=!0);deletesCount>0&&(hasDeletes=!0);hasUpdates==!0||hasInserts==!0||hasDeletes==!0?(r=!1,showProgress(),u={Inserts:inserts,Updates:updates,Deletes:deletes},$.post({url:window.appBase+"Employee/Timesheet/SaveTimesheetWeekViewChanges",dataType:"json",data:u}).always(function(u){var s,h,c;if(u&&u.Data){var f=0,y=0,p=0,e=0,w=0,b=0,o=0,k=0,d=0,a=!1,v=!1,l="";u.Data.DeleteFails&&isNaN(u.Data.DeleteFails)==!1&&(f=u.Data.DeleteFails*1);u.Data.DeleteSuccesses&&isNaN(u.Data.DeleteSuccesses)==!1&&(y=u.Data.DeleteSuccesses*1);u.Data.DeleteTotal&&isNaN(u.Data.DeleteTotal)==!1&&(p=u.Data.DeleteTotal*1);u.Data.InsertFails&&isNaN(u.Data.InsertFails)==!1&&(e=u.Data.InsertFails*1);u.Data.InsertSuccesses&&isNaN(u.Data.InsertSuccesses)==!1&&(w=u.Data.InsertSuccesses*1);u.Data.InsertTotal&&isNaN(u.Data.InsertTotal)==!1&&(b=u.Data.InsertTotal*1);u.Data.UpdateFails&&isNaN(u.Data.UpdateFails)==!1&&(o=u.Data.UpdateFails*1);u.Data.UpdateSuccesses&&isNaN(u.Data.UpdateSuccesses)==!1&&(k=u.Data.UpdateSuccesses*1);u.Data.UpdateTotal&&isNaN(u.Data.UpdateTotal)==!1&&(d=u.Data.UpdateTotal*1);u.Data.HasEstimateWarning&&(a=u.Data.HasEstimateWarning);u.Data.EstimateWarning&&(l=u.Data.EstimateWarning);u.Data.BlockedByExceedOption&&(v=u.Data.BlockedByExceedOption);f&&f>0&&(s="",f==1?s="One entry":f>1&&(s=f+" entries"),s=s+" did not delete.",showNotification(s,"error"));e&&e>0&&(h="",e==1?h="One entry":e>1&&(h=e+" entries"),h=h+" did not insert.",showNotification(h,"error"));o&&o>0&&(c="",o==1?c="One entry":o>1&&(c=o+" entries"),c=c+" did not update.",showNotification(c,"error"));a==!0&&l!=""&&(v==!1?showNotification(l,"info"):showNotification(l,"error"))}inserts=[];updates=[];deletes=[];setSaveCancelButtons();n&&n!=""?executeAfterSave(n,!0,t,i):(window.setTimeout(function(){refreshTimesheet();r=!0;resetAfterSave()},500),checkForSaveFail(),updateDashboardWeeklyHours())})):n&&n!=""&&executeAfterSave(n,!1,t,i)}function executeAfterSave(n,t,i,r){n=="submitWeekForApproval"&&_submitWeekForApproval();n=="submitForApproval"&&i!=undefined&&_submitForApproval(i);n=="groupDropDownListChanged"&&_groupDropDownListChanged();n=="sortDropDownListChanged"&&_sortDropDownListChanged();n=="dayOrWeekSelect"&&i!=undefined&&_dayOrWeekSelect(i);n=="backToWeekView"&&_backToWeekView();n=="navigateToPrevious"&&_navigateToPrevious();n=="navigateToNext"&&_navigateToNext();n=="navigateToToday"&&_navigateToToday();n=="navigateToDate"&&_navigateToDate();n=="showSelectEmployeeDialog"&&(setSaveCancelButtons(),hideProgress(),_showSelectEmployeeDialog());n=="openSettingsDialog"&&_openSettingsDialog();n=="startStopwatchFromRow"&&i!=undefined&&_startStopwatchFromRow(i);n=="copyRow"&&i!=undefined&&_copyRow(i);n=="exportToExcel"&&_exportToExcel();n=="unSubmitWeekForApproval"&&_unSubmitWeekForApproval();n=="changeSingleDay"&&i!=undefined&&r!=undefined&&_changeSingleDay(i,r);n=="selectSingleDay"&&i!=undefined&&_selectSingleDay(i);n=="deleteClick"&&_deleteClick();n=="copyFromOptionsClick"&&(t==!0&&(window.setTimeout(function(){refreshTimesheet()},500),checkForSaveFail(),updateDashboardWeeklyHours()),_copyFromOptionsClick());n=="copyToOptionsClick"&&(t==!0&&(window.setTimeout(function(){refreshTimesheet()},500),checkForSaveFail(),updateDashboardWeeklyHours()),_copyToOptionsClick());n=="openPrintSettingsPage"&&(t==!0&&(window.setTimeout(function(){refreshTimesheet()},500),checkForSaveFail(),updateDashboardWeeklyHours()),_openPrintSettingsPage())}function resetAfterSave(){setSaveCancelButtons();hideProgress()}function checkForSaveFail(){}function saveAll(){}function saveFinished(){hideProgress();refreshTimesheet();checkForSaveFail()}function enableSaveButton(){$("#saveButton")&&$("#saveButton").removeClass("k-state-disabled")}function disableSaveButton(){$("#saveButton")&&$("#saveButton").addClass("k-state-disabled")}function enableCancelButton(){$("#cancelButton")&&$("#cancelButton").removeClass("k-state-disabled")}function disableCancelButton(){$("#cancelButton")&&$("#cancelButton").addClass("k-state-disabled")}function refreshCopyFromList(){currentCopyType==1?(copyProjectsDataSource=null,loadCopyFromMyProjects()):currentCopyType==2?(copyFromMyTimeTemplatesDataSource=null,loadCopyFromMyTemplates()):currentCopyType==3?(copyFromMyCalendarDataSource=null,loadCopyFromMyCalendar()):currentCopyType==4?(copyRecentAssignmentsDataSource=null,loadCopyFromRecentAssignments()):currentCopyType==5?(copyRecentJobsDataSource=null,loadCopyFromRecentJobs()):(copyProjectsDataSource=null,copyRecentAssignmentsDataSource=null,copyRecentJobsDataSource=null,copyFromMyTimeTemplatesDataSource=null,copyFromMyCalendarDataSource=null)}function copyFromSelect(n){var t=n.value;_copyFromSelect(t)}function _copyFromSelect(n){$("#copyFromSettingsButton").prop("disabled",!0);$("#copyFromSettingsButton").prop("title","No options available.");n?(copyProjectsDataSource=null,copyRecentAssignmentsDataSource=null,copyRecentJobsDataSource=null,copyFromMyTimeTemplatesDataSource=null,copyFromMyCalendarDataSource=null,n=="projects"?(currentCopyType=1,loadCopyFromMyProjects()):n=="templates"?(currentCopyType=2,$("#copyFromSettingsButton").prop("disabled",!1),$("#copyFromSettingsButton").prop("title","Time Template Options"),loadCopyFromMyTemplates()):n=="calendar"?(currentCopyType=3,$("#copyFromSettingsButton").prop("disabled",!1),$("#copyFromSettingsButton").prop("title","Calendar Options"),loadCopyFromMyCalendar()):n=="recent-assignments"?(currentCopyType=4,loadCopyFromRecentAssignments()):n=="recent-jobs"?(currentCopyType=5,loadCopyFromRecentJobs()):(currentCopyType=-1,hideCopyPanel())):(currentCopyType=-1,hideCopyPanel());hideAllCopyFromContainers()}function showCopyPanel(){currentCopyType=0;$("#CopyCell").show();$("#copyFromSettingsButton").prop("disabled",!0)}function hideCopyPanel(){currentCopyType=-1;copyProjectsDataSource=null;copyRecentAssignmentsDataSource=null;copyRecentJobsDataSource=null;copyFromMyTimeTemplatesDataSource=null;copyFromMyCalendarDataSource=null;hideAllCopyFromContainers();var n=$("#copyFrom").data("kendoDropDownList");n&&n.select(0);setTimeout(function(){$("#CopyCell").hide();$("#copyFromSettingsButton").prop("disabled",!0)},0)}function hideAllCopyFromContainers(){$("#copyFromMyProjectsContainer").hide();$("#copyFromRecentAssignmentsContainer").hide();$("#copyFromRecentJobsContainer").hide();$("#copyFromMyTimeTemplatesContainer").hide();$("#copyFromMyCalendarContainer").hide();currentCopyType==1?$("#copyFromMyProjectsContainer").show():currentCopyType==2?$("#copyFromMyTimeTemplatesContainer").show():currentCopyType==3?$("#copyFromMyCalendarContainer").show():currentCopyType==4?$("#copyFromRecentAssignmentsContainer").show():currentCopyType==5&&$("#copyFromRecentJobsContainer").show()}function loadCopyFromMyProjects(){$("#copyFromPanelHeader").html("Projects");copyProjectsDataSource||(copyProjectsDataSource=new kendo.data.DataSource({transport:{read:{url:window.appBase+"Employee/Timesheet/GetMyAssignments?emp="+employeeCode,dataType:"json"}}}));$("#copyFromMyProjectsListView").kendoListView({dataSource:copyProjectsDataSource,dataBound:function(){this.dataSource.data().length==0&&$("#copyFromMyProjectsListView").append("<span>No projects<\/span>")},selectable:"single",navigatable:!0,template:kendo.template($("#copyFromMyProjectsItemTemplate").html())})}function filterCopyFromMyProjectsDataSource(n){var t,r,i;try{t=$(n).val();r=$("#copyFromMyProjectsListView").data("kendoListView");r&&(t&&t!=""?(i={logic:"or",filters:[]},isNaN(t)==!0?(i.filters.push({field:"ClientCode",operator:"contains",value:t}),i.filters.push({field:"ClientName",operator:"contains",value:t}),i.filters.push({field:"DivisionCode",operator:"contains",value:t}),i.filters.push({field:"ProductCode",operator:"contains",value:t}),i.filters.push({field:"FunctionCategory",operator:"contains",value:t}),i.filters.push({field:"JobDescription",operator:"contains",value:t}),i.filters.push({field:"JobComponentDescription",operator:"contains",value:t}),i.filters.push({field:"TaskDescription",operator:"contains",value:t})):(i.filters.push({field:"JobNumber",operator:"eq",value:parseInt(t)}),i.filters.push({field:"JobComponentNumber",operator:"eq",value:parseInt(t)})),i.filters.length>0?r.dataSource.query({filter:i}):r.dataSource.filter({})):r.dataSource.filter({}))}catch(u){}}function loadCopyFromRecentAssignments(){$("#copyFromPanelHeader").html("My Recent Assignments");copyRecentAssignmentsDataSource||(copyRecentAssignmentsDataSource=new kendo.data.DataSource({transport:{read:{url:window.appBase+"Employee/Timesheet/GetMyRecentAssignments",dataType:"json"}}}));$("#copyFromRecentAssignmentsListView").kendoListView({dataSource:copyRecentAssignmentsDataSource,dataBound:function(){this.dataSource.data().length==0&&$("#copyFromRecentAssignmentsListView").append("<span>No recent assignments<\/span>")},selectable:"single",navigatable:!0,template:kendo.template($("#copyRecentItemTemplate").html())})}function filterCopyFromRecentAssignmentsDataSource(n){var t,r,i;try{t=$(n).val();r=$("#copyFromRecentAssignmentsListView").data("kendoListView");r&&(t&&t!=""?(i={logic:"or",filters:[]},isNaN(t)==!0?(i.filters.push({field:"ClientCode",operator:"contains",value:t}),i.filters.push({field:"ClientName",operator:"contains",value:t}),i.filters.push({field:"DivisionCode",operator:"contains",value:t}),i.filters.push({field:"ProductCode",operator:"contains",value:t}),i.filters.push({field:"JobDescription",operator:"contains",value:t}),i.filters.push({field:"JobComponentDescription",operator:"contains",value:t}),i.filters.push({field:"Title",operator:"contains",value:t})):(i.filters.push({field:"JobNumber",operator:"eq",value:parseInt(t)}),i.filters.push({field:"JobComponentNumber",operator:"eq",value:parseInt(t)})),i.filters.length>0?r.dataSource.query({filter:i}):r.dataSource.filter({})):r.dataSource.filter({}))}catch(u){}}function loadCopyFromRecentJobs(){$("#copyFromPanelHeader").html("My Recent Jobs");copyRecentJobsDataSource||(copyRecentJobsDataSource=new kendo.data.DataSource({transport:{read:{url:window.appBase+"Employee/Timesheet/GetMyRecentJobs",dataType:"json"}}}));$("#copyFromRecentJobsListView").kendoListView({dataSource:copyRecentJobsDataSource,dataBound:function(){this.dataSource.data().length==0&&$("#copyFromRecentJobsListView").append("<span>No recent jobs<\/span>")},selectable:"single",navigatable:!0,template:kendo.template($("#copyRecentItemTemplate").html())})}function filterCopyFromRecentJobsDataSource(n){var t,r,i;try{t=$(n).val();r=$("#copyFromRecentJobsListView").data("kendoListView");r&&(t&&t!=""?(i={logic:"or",filters:[]},isNaN(t)==!0?(i.filters.push({field:"ClientCode",operator:"contains",value:t}),i.filters.push({field:"ClientName",operator:"contains",value:t}),i.filters.push({field:"DivisionCode",operator:"contains",value:t}),i.filters.push({field:"ProductCode",operator:"contains",value:t}),i.filters.push({field:"JobDescription",operator:"contains",value:t}),i.filters.push({field:"JobComponentDescription",operator:"contains",value:t}),i.filters.push({field:"Title",operator:"contains",value:t})):(i.filters.push({field:"JobNumber",operator:"eq",value:parseInt(t)}),i.filters.push({field:"JobComponentNumber",operator:"eq",value:parseInt(t)})),i.filters.length>0?r.dataSource.query({filter:i}):r.dataSource.filter({})):r.dataSource.filter({}))}catch(u){console.log("Error: ",u)}}function loadCopyFromMyTemplates(){$("#copyFromPanelHeader").html("Time Templates");copyFromMyTimeTemplatesDataSource||(copyFromMyTimeTemplatesDataSource=new kendo.data.DataSource({transport:{read:{url:window.appBase+"Employee/Timesheet/GetEmployeeTimeTemplates?EmployeeCode="+employeeCode,dataType:"json"}}}));$("#copyFromMyTimeTemplatesListView").kendoListView({dataSource:copyFromMyTimeTemplatesDataSource,dataBound:function(){this.dataSource.data().length==0&&$("#copyFromMyTimeTemplatesListView").append("<span>No template items<\/span>")},selectable:"single",navigatable:!0,template:kendo.template($("#copyFromMyTimeTemplatesItemTemplate").html())})}function filterCopyFromMyTimeTemplatesDataSource(n){var t,r,i;try{t=$(n).val();r=$("#copyFromMyTimeTemplatesListView").data("kendoListView");r&&(t&&t!=""?(i={logic:"or",filters:[]},isNaN(t)==!0?(i.filters.push({field:"ClientCode",operator:"contains",value:t}),i.filters.push({field:"ClientName",operator:"contains",value:t}),i.filters.push({field:"DivisionCode",operator:"contains",value:t}),i.filters.push({field:"ProductCode",operator:"contains",value:t}),i.filters.push({field:"JobDescription",operator:"contains",value:t}),i.filters.push({field:"JobComponentDescription",operator:"contains",value:t}),i.filters.push({field:"Title",operator:"contains",value:t})):(i.filters.push({field:"JobNumber",operator:"eq",value:parseInt(t)}),i.filters.push({field:"JobComponentNumber",operator:"eq",value:parseInt(t)})),i.filters.length>0?r.dataSource.query({filter:i}):r.dataSource.filter({})):r.dataSource.filter({}))}catch(u){console.log("Error: ",u)}}function loadCopyFromMyCalendar(){getDatePickerDate();$("#copyFromPanelHeader").html("Calendar");var n="";n=window.appBase+"Employee/Timesheet/GetEmployeeCalendarItems?EmployeeCode="+employeeCode+"&StartDate="+startDate;copyFromMyCalendarDataSource=new kendo.data.DataSource({transport:{read:{url:n,dataType:"json"}}});$("#copyFromMyCalendarListView").kendoListView({dataSource:copyFromMyCalendarDataSource,dataBound:function(){this.dataSource.data().length==0&&$("#copyFromMyCalendarListView").append("<span>No calendar items<\/span>")},selectable:"single",navigatable:!0,template:kendo.template($("#copyFromMyCalendarTemplate").html())})}function filterCopyFromMyCalendarDataSource(n){var t,r,i;try{t=$(n).val();r=$("#copyFromMyCalendarListView").data("kendoListView");r&&(t&&t!=""?(i={logic:"or",filters:[]},isNaN(t)==!0?(i.filters.push({field:"ClientCode",operator:"contains",value:t}),i.filters.push({field:"DivisionCode",operator:"contains",value:t}),i.filters.push({field:"ProductCode",operator:"contains",value:t})):(i.filters.push({field:"JobNumber",operator:"eq",value:parseInt(t)}),i.filters.push({field:"JobComponentNumber",operator:"eq",value:parseInt(t)})),i.filters.length>0?r.dataSource.query({filter:i}):r.dataSource.filter({})):r.dataSource.filter({}))}catch(u){console.log("Error: ",u)}}function copyFromSettingsButtonClick(){currentCopyType==1||(currentCopyType==2?openTimeTemplateEditDialog():currentCopyType==3?openCalendarEditDialog():currentCopyType==4||currentCopyType==5)}function adjustDropDownWidth(n){var t=n.sender.list.closest(".k-list-container");t.width(t.width()+kendo.support.scrollbar())}function dropTargetOnDrop(n){window.setTimeout(function(){var t;currentCopyType==1?copyProjectsDataSource&&(t=copyProjectsDataSource.getByUid(n.draggable.hint.data().uid),t&&t!=undefined||window.setTimeout(function(){var r=copyProjectsDataSource.data(),i;if(r)for(i=0;i<r.length;i++)r[i].uid==n.draggable.hint.data().uid&&(t=r[i])},50),dropMyProjectsItem(t)):currentCopyType==2?copyFromMyTimeTemplatesDataSource&&(t=copyFromMyTimeTemplatesDataSource.getByUid(n.draggable.hint.data().uid),t&&t!=undefined||window.setTimeout(function(){t=copyFromMyTimeTemplatesDataSource.getByUid(n.draggable.hint.data().uid)},10),dropMyTimeTemplatesItem(t)):currentCopyType==3?copyFromMyCalendarDataSource&&(t=copyFromMyCalendarDataSource.getByUid(n.draggable.hint.data().uid),t&&t!=undefined||window.setTimeout(function(){t=copyFromMyCalendarDataSource.getByUid(n.draggable.hint.data().uid)},10),dropMyCalendarItem(t)):currentCopyType==4?copyRecentAssignmentsDataSource&&(t=copyRecentAssignmentsDataSource.getByUid(n.draggable.hint.data().uid),t&&t!=undefined||window.setTimeout(function(){t=copyRecentAssignmentsDataSource.getByUid(n.draggable.hint.data().uid)},10),dropRecentsItem(t)):currentCopyType==5&&copyRecentJobsDataSource&&(t=copyRecentJobsDataSource.getByUid(n.draggable.hint.data().uid),t&&t!=undefined||window.setTimeout(function(){t=copyRecentJobsDataSource.getByUid(n.draggable.hint.data().uid)},10),dropRecentsItem(t))},10)}function dropMyProjectsItem(n){window.setTimeout(function(){var e;if(n){var t="",i=0,r=0,u=-1,f=0;n.TaskCode&&(t=n.TaskCode);n.JobNumber&&(i=n.JobNumber);n.JobComponentNumber&&(r=n.JobComponentNumber);n.TaskSequenceNumber&&(u=n.TaskSequenceNumber);n.ID&&(f=n.ID);showProgress();try{e={EmployeeCode:employeeCode,EntryDate:$("#DatePicker")[0].value,Hours:hours,Comment:comment,FunctionOrCategoryCode:t,DepartmentTeamCode:"",JobNumber:i,JobComponentNumber:r,TaskSequenceNumber:u,AlertID:f};$.post({url:window.appBase+"Employee/Timesheet/AddEntryFromCopyFromMyProjects",dataType:"json",data:e}).always(function(n){hideProgress();n&&(n.Success&&n.Success==!0?n.Message!=""?n.Message.indexOf("NO_CHANGE")>-1?showNotification("Job already on timesheet."):showNotification(n.Message):showSuccessNotification("Item added!"):n.Message!=""&&showNotification(n.Message,"error"));isViewingSingleDay==!0?loadSingleDayTimesheet():refreshTimesheet()})}catch(o){hideProgress()}}},10)}function dropRecentsItem(n){window.setTimeout(function(){var u;if(n){showProgress();try{var t=0,i=0,r=0;n.AlertID&&(t=n.AlertID);n.JobNumber&&(i=n.JobNumber);n.JobComponentNumber&&(r=n.JobComponentNumber);u={EmployeeCode:employeeCode,EntryDate:$("#DatePicker")[0].value,AlertID:t,JobNumber:i,JobComponentNumber:r};$.post({url:window.appBase+"Employee/Timesheet/AddEntryFromCopyFromMyRecents",dataType:"json",data:u}).always(function(n){hideProgress();n&&(n.Success&&n.Success==!0?n.Message!=""?n.Message.indexOf("NO_CHANGE")>-1?showNotification("Item already on timesheet."):showNotification(n.Message):showSuccessNotification("Item added!"):n.Message!=""&&showNotification(n.Message,"error"));isViewingSingleDay==!0?loadSingleDayTimesheet():refreshTimesheet()})}catch(f){hideProgress()}}},10)}function dropMyTimeTemplatesItem(n){window.setTimeout(function(){var t,i;if(n){showProgress();try{t=0;n.EmployeeTimeTemplateID&&(t=n.EmployeeTimeTemplateID);i={EmployeeCode:employeeCode,EntryDate:$("#DatePicker")[0].value,EmployeeTimeTemplateID:t};$.post({url:window.appBase+"Employee/Timesheet/AddEntryFromCopyFromMyTimeTemplates",dataType:"json",data:i}).always(function(n){var i,t;if(hideProgress(),n)if(n.Data&&n.Data.length>0)for(i=n.Data,t=0;t<i.length;t++)i[t]&&i[t]!=""&&showNotification(i[t],"error");else n.Success&&n.Success==!0?n.Message!=""?n.Message.indexOf("NO_CHANGE")>-1?showNotification("Item already on timesheet."):showNotification(n.Message):showSuccessNotification("Item added!"):n.Message!=""&&showNotification(n.Message,"error");isViewingSingleDay==!0?loadSingleDayTimesheet():refreshTimesheet()})}catch(r){hideProgress()}}},10)}function dropMyCalendarItem(n){window.setTimeout(function(){var h;if(n){showProgress();try{var u=0,f="",e="",o=0,s="",t=0,i=0,r="";n.ID&&parseInt(n.ID)>0&&(u=parseInt(n.ID));n.FunctionCode&&(f=n.FunctionCode);n.DepartmentCode&&(e=n.DepartmentCode);n.Hours&&parseFloat(n.Hours)>0&&(o=parseFloat(n.Hours));n.Comment&&(s=n.Comment);n.JobNumber&&parseInt(n.JobNumber)>0&&(t=parseInt(n.JobNumber));n.JobComponentNumber&&parseInt(n.JobComponentNumber)>0&&(i=parseInt(n.JobComponentNumber));n.TimeType&&(r=n.TimeType);r=t>0&&i>0?"D":"N";h={EmployeeCode:employeeCode,EntryDate:$("#DatePicker")[0].value,EmployeeTimeStagingID:u,FunctionCode:f,DepartmentCode:e,Hours:o,Comment:s,JobNumber:t,JobComponentNumber:i,TimeType:r};$.post({url:window.appBase+"Employee/Timesheet/AddEntryFromCopyFromCalendar",dataType:"json",data:h}).always(function(n){hideProgress();n&&(n.Success&&n.Success==!0?showSuccessNotification("Success!"):n.Message!=""&&showNotification(n.Message,"error"));isViewingSingleDay==!0?loadSingleDayTimesheet():refreshTimesheet()})}catch(c){hideProgress()}}},10)}function lineContextMenuSelect(n){window.setTimeout(function(){var u=$(n.target).parent().parent(),i=u.attr("id"),f,t,e;let r=new RowInfo(i);currentRowContextRowId=$(u).attr("row-id");r&&(f="",n.item.id=="details"?(f=window.appBase+"Timesheet_Details.aspx?j="+r.JobNumber+"&jc="+r.JobComponentNumber+"&fn="+r.FunctionCode+"&emp="+employeeCode+"&alertid="+r.AlertID,$("#detailsDialog").ejDialog("destroy"),$("#detailsDialog").ejDialog({contentUrl:f,title:"Details",showOnInit:!1,contentType:"iframe",height:"600px",width:"900px",showFooter:!1,enableModal:!0,backgroundScroll:!1,enableResize:!0}),$("#detailsDialog").ejDialog("open"),$("#detailsDialog").ejDialog("refresh")):n.item.id=="rowView"?showNotification("Not implemented."):n.item.id=="deleteRow"?(t=[],showKendoConfirm("Delete  row?").done(function(){var i;if($(u).each(function(){$("td",this).each(function(){var n=$(this).find(":input"),i,r;if(n.attr("id")!=undefined&&n.attr("id")!=""){i="";i=n.attr("id");let u=new EntryInfo(i);u&&u.EmployeeTimeID>0&&u.EmployeeTimeDetailID>0&&(u.TimeType&&u.TimeType!=""&&u.TimeType!=undefined||(u.TimeType=u.JobNumber>0?"D":"N"),r={EmployeeTimeID:u.EmployeeTimeID,EmployeeTimeDetailID:u.EmployeeTimeDetailID,TimeType:u.TimeType},t.push(r))}})}),t&&t.length>0){showProgress();saveClick();var f=0,n=0,r=0;for(i=0;i<t.length;i++)try{$.post({url:window.appBase+"Employee/Timesheet/DeleteEntry",dataType:"json",data:t[i]}).always(function(i){i&&(i.Success==!0&&(f+=1),i.Success==!1&&(n+=1),r=r+1,r==t.length&&(refreshTimesheet(),f>0&&(n==0&&showSuccessNotification("Row deleted!"),n>0&&showNotification("Some entries successfully deleted.","warning")),n>0&&showNotification("Some entries could not be deleted.","error"),updateDashboardWeeklyHours(),hideProgress()))}).done(function(){})}catch(e){}hideProgress()}}).fail(function(){})):n.item.id=="changeFunction"?showSelectFunctionDialog(i):n.item.id=="changeAssignment"?showChangeAssignmentDialog(i):n.item.id=="copyRow"?copyRow(i):n.item.id=="startStopwatch"&&(e={EmployeeCode:employeeCode},$.post({url:window.appBase+"Employee/Timesheet/HasStopwatch",dataType:"json",data:e}).always(function(n){n&&(n.StopwatchIsRunning==!0?showKendoConfirm("There is a stopwatch already running.\nStop it and start a new stopwatch?").done(function(){startStopwatchFromRow(i)}).fail(function(){return!1}):startStopwatchFromRow(i))})))},10)}function lineContextMenuOpen(n){try{n.item&&agencyTimesheetSettings&&agencyTimesheetSettings.AllowQvADrilldownInTimesheets==!1&&$(n.item[0].childNodes[0]).hide()}catch(n){console.log("Error: ",n)}}function hasSelectedRows(){return selectedRows&&selectedRows.length>0?!0:!1}function rowCheckedChanged(n){var i=n.id.replace("checkBox_",""),r=$(n).attr("row-id")*1,u,t;i&&r&&(u=new RowInfo(i),t={ID:r,RowInfo:u},n.checked==!0?addSelectedRow(t):removeSelectedRow(t))}function addSelectedRow(n){n&&n!=undefined&&(removeSelectedRow(n),selectedRows.push(n));setDeleteButton()}function removeSelectedRow(n){var i,t;if(n&&n!=undefined&&(i=n.ID,i&&selectedRows&&selectedRows.length>0))for(t=selectedRows.length;t--;)selectedRows[t]&&selectedRows[t].ID==i&&selectedRows.splice(t,1);setDeleteButton()}function unCheckAndClearAllSelectedRows(){selectedRows=[];setDeleteButton()}function restoreSelectedRows(){if(selectedRows&&selectedRows.length>0){var n;$("#employeeTimeTable tbody>tr.border_bottom").filter(function(){if($(this)[0].id&&(n=$(this)[0],n)){var t=$(n).attr("row-id")*1;isRowInSelectedList(t)==!0&&$(n).toggleClass("row-selected")}})}}function isRowInSelectedList(n){for(var i=!1,t=selectedRows.length;t--;)if(selectedRows[t]&&selectedRows[t].ID*1==n*1){i=!0;break}return i}function setDeleteButton(){hasSelectedRows()==!0?enableDeleteButton():disableDeleteButton()}function enableDeleteButton(){$("#deleteButton")&&$("#deleteButton").removeClass("k-state-disabled")}function disableDeleteButton(){$("#deleteButton")&&$("#deleteButton").addClass("k-state-disabled")}function deleteClick(){saveClick("deleteClick")}function _deleteClick(){if(hasSelectedRows()==!0){var n="",t=0;selectedRows&&(t=selectedRows.length);t==1?n="Delete selected row?":t>1&&(n="Delete selected rows?");showKendoConfirm(n).done(function(){var t=[],n,r,i;for(showProgress(),n=selectedRows.length;n--;)selectedRows[n]&&$("#employeeTimeTable tbody>tr.border_bottom").filter(function(){$(this)[0].id&&$(this)[0].id==selectedRows[n].RowInfo.key&&(r=$(this)[0],$(r).attr("row-id")*1==selectedRows[n].ID&&$(r).find("td.input-cell").each(function(){if(i=$(this)[0],$(i).attr("property")&&$(i).attr("property")!="0|0"){var n;$(i).find("input.hours-textbox").each(function(){if(this&&(n=this,n.id)){let r=new EntryInfo(n.id);if(r&&r.EmployeeTimeID>0&&r.EmployeeTimeDetailID>0){r.TimeType&&r.TimeType!=""&&r.TimeType!=undefined||(r.TimeType=r.JobNumber>0?"D":"N");var i={EmployeeTimeID:r.EmployeeTimeID,EmployeeTimeDetailID:r.EmployeeTimeDetailID,TimeType:r.TimeType};t.push(i)}}})}}))});t&&t.length>0?deleteAllEntries(t):hideProgress()}).fail(function(){hideProgress()})}else showNotification("No rows selected to delete.")}function deleteAllEntries(n){var t={Deletes:n};try{showProgress();$.post({url:window.appBase+"Employee/Timesheet/DeleteEntries",dataType:"json",data:t}).always(function(n){if(n){var t=0;t=n.Data.Fails*1;t>0&&(t==1?showNotification("One entry could not be deleted.","error"):t>1&&showNotification(t+" entries could not be deleted.","error"))}deletes=[];hideProgress();unCheckAndClearAllSelectedRows();refreshTimesheet()}).done(function(){})}catch(i){hideProgress()}}function submitForApproval(n){saveClick("submitForApproval",n)}function _submitForApproval(n){var i=$(n).parent().attr("appr-status"),r=$(n).parent().attr("appr-date"),t,u;if(i=="Submit"?t=!0:i=="Pending"?t=!1:i=="Denied"&&(t=!1),t!=undefined&&r){showProgress();try{u={EmployeeCode:employeeCode,EmployeeDate:r,Approve:t};$.post({url:window.appBase+"Employee/Timesheet/SubmitForApproval",dataType:"json",data:u}).always(function(n){hideProgress();n&&(n.Success==!0&&t==!0&&notifySupervisorOfApproval(),n.Success==!1,n.Message&&n.Message!=""&&showNotification(n.Message));refreshTimesheet()})}catch(f){hideProgress()}}}function submitWeekForApproval(){saveClick("submitWeekForApproval")}function _submitWeekForApproval(){showProgress();try{var n=$("#DatePicker").data("kendoDatePicker"),t={EmployeeCode:employeeCode,EmployeeDate:kendo.toString(n.value(),"d")};$.post({url:window.appBase+"Employee/Timesheet/SubmitWeekForApproval",dataType:"json",data:t}).always(function(n){var i,t;if(hideProgress(),refreshTimesheet(),n&&(n.Success==!0&&notifySupervisorOfApproval(),n.Success==!1,n.Message&&n.Message!=""))if(n.Message.indexOf("|")==-1)showNotification(n.Message);else for(i=n.Message.split("|"),t=0;t<i.length;t++)showNotification(i[t])})}catch(i){hideProgress()}}function unSubmitWeekForApproval(){saveClick("unSubmitWeekForApproval")}function _unSubmitWeekForApproval(){showProgress();try{var n=$("#DatePicker").data("kendoDatePicker"),t={EmployeeCode:employeeCode,EmployeeDate:kendo.toString(n.value(),"d")};$.post({url:window.appBase+"Employee/Timesheet/UnSubmitWeekForApproval",dataType:"json",data:t}).always(function(n){hideProgress();refreshTimesheet();n&&(n.Success==!0,n.Success==!1,n.Message&&n.Message!=""&&showNotification(n.Message))})}catch(i){hideProgress()}}function viewApprovalComments(n){var t=$(n).parent().attr("appr-date");$.get({url:window.appBase+"Employee/Timesheet/HasApprovalComment?emp="+employeeCode+"&sd="+t,dataType:"json"}).always(function(n){n!=undefined&&(n==!0?$.get({url:window.appBase+"Employee/Timesheet/GetApprovalComment?emp="+employeeCode+"&sd="+t,dataType:"json"}).always(function(n){n&&n!=""?($("#approvalCommentDialog").html(n.replace(/\r?\n/g,"<br />")),$("#approvalCommentDialog").ejDialog({title:"Approval Comment",closeOnEscape:!0,showOnInit:!1,height:"200px",width:"400px",showFooter:!1,enableModal:!0,backgroundScroll:!1,enableResize:!1}),$("#approvalCommentDialog").ejDialog("open")):($("#approvalCommentDialog").html(""),showNotification("No supervisor approval comment."))}):showNotification("No supervisor approval comment."))})}function showApprovalRow(){try{$("#approvalRow")&&$("#approvalRow").show()}catch(n){}}function hideApprovalRow(){try{$("#approvalRow")&&$("#approvalRow").hide()}catch(n){}}function isApprovalActive(){var n={EmployeeCode:employeeCode};$.get({url:window.appBase+"Employee/Timesheet/IsApprovalActive",dataType:"json",data:n}).always(function(n){n&&n==!0?showApprovalRow():hideApprovalRow()})}function notifySupervisorOfApproval(){var n={EmployeeCode:employeeCode};$.post({url:window.appBase+"Employee/Timesheet/NotifySupervisorOfApproval",dataType:"json",data:n}).always(function(){})}function isUserLimited(){$.get({url:window.appBase+"Employee/Timesheet/UserLimited",dataType:"json",data:null}).always(function(n){n==!1?hookupEmployeeSelector(!0):hookupEmployeeSelector(!1)})}function showProgress(){progressShowing==!1&&(kendo.ui.progress($("body"),!0),progressShowing=!0)}function hideProgress(){progressShowing==!0&&window.setTimeout(function(){kendo.ui.progress($("body"),!1);progressShowing=!1},750)}function goOld(){var n=window.appBase+"Timesheet.aspx";window.location=n}function setDateLabelOrPicker(){isViewingSingleDay==!1?($("#DatePickerContainer").show(),$("#WeekOfLabel").hide()):($("#DatePickerContainer").hide(),$("#WeekOfLabel").show(),$("#WeekOfLabel").text(startOfWeekDate))}function searchTimesheet(n){var t=$(n).val().toLowerCase();filterTimesheet(t)}function filterTimesheet(n){userSearchString=n;$("#employeeTimeTable tbody>tr.border_bottom").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(n)>-1)})}function hookupEmployeeSelector(n){n==!0?($("#employee-selector").click(function(){showSelectEmployeeDialog()}),$("#employee-selector").css("cursor","pointer"),$("#selectEmployee").show(),$("#employee-selector").show()):($("#employee-selector").click(function(){return!1}),$("#employee-selector").css("cursor","default"),$("#selectEmployee").hide(),$("#employee-selector").hide())}function initTimesheetPartialView(n){var i,r,u,t;n==!0&&(startDateString=$("#dateValue").text(),startDateString&&(startDate=kendo.parseDate(startDateString),startDate&&$("#DatePicker").data("kendoDatePicker").value(startDate)),setDateLabelOrPicker());currentCopyType&&currentCopyType>0&&(i="",currentCopyType==1?i="projects":currentCopyType==2?i="templates":currentCopyType==3?i="calendar":currentCopyType==4?i="recent-assignments":currentCopyType==5&&(i="recent-jobs"),$("#copyFrom").val(i),_copyFromSelect(i));$("#copyFrom").kendoDropDownList({open:adjustDropDownWidth});initSortDropDownList();initGroupDropDownList();getUserSort();r={filter:">div.copy-item",cursor:"move",hint:function(n){return n.clone().css({opacity:1,"background-color":"#449D44",border:"1px solid #398439",color:"#FFF"})}};$("#copyFromMyProjectsListView").kendoDraggable(r);$("#copyFromRecentAssignmentsListView").kendoDraggable(r);$("#copyFromRecentJobsListView").kendoDraggable(r);$("#copyFromMyTimeTemplatesListView").kendoDraggable(r);$("#copyFromMyCalendarListView").kendoDraggable(r);u={top:10,left:10};t=$("#copyFromMyProjectsListView").data("kendoDraggable");t.options.cursorOffset=u;t=$("#copyFromRecentAssignmentsListView").data("kendoDraggable");t.options.cursorOffset=u;t=$("#copyFromRecentJobsListView").data("kendoDraggable");t.options.cursorOffset=u;t=$("#copyFromMyTimeTemplatesListView").data("kendoDraggable");t.options.cursorOffset=u;t=$("#copyFromMyCalendarListView").data("kendoDraggable");t.options.cursorOffset=u;$("#employeeTimeTable").kendoDropTarget({drop:dropTargetOnDrop});isUserLimited();window.setTimeout(function(){initTooltips()},500)}function clearExpandedRows(){expandedRows=[]}function expandCollapseRow(n){var t=$(n)[0];$(n).nextUntil("tr.group_row").slideToggle(0,function(){});$(t).data("is-collapsed",!$(t).data("is-collapsed"));trackCollapsedRows(n.id)}function trackCollapsedRows(n){var i,t;if(expandedRows){for(i=!1,t=expandedRows.length;t--;)expandedRows[t]&&expandedRows[t]==n&&(expandedRows.splice(t,1),i=!0);i==!1&&expandedRows.push(n)}hasCollapsedRows=expandedRows&&expandedRows.length>0?!0:!1}function isCollapsed(n){for(var i=!1,t=expandedRows.length;t--;)if(expandedRows[t]&&expandedRows[t]==n){i=!0;break}return i}function restoreCollapsedRows(){expandedRows&&expandedRows.length>0&&$("#employeeTimeTable tbody>tr.group_row").filter(function(){var n,t="",i=!1;n=$(this)[0];t=$(this)[0].id;i=$(n).data("is-collapsed");t&&isCollapsed(t)==!0&&expandCollapseRow(n)})}function detailRowClick(n){var u,t;$(n).toggleClass("row-selected");var f=$(n).hasClass("row-selected"),i=n.id,r=$(n).attr("row-id")*1;i&&r&&(u=new RowInfo(i),t={ID:r,RowInfo:u},f==!0?addSelectedRow(t):removeSelectedRow(t));setDeleteButton()}function descriptionColumnClick(n){detailRowClick($(n).parent()[0])}function expandCollapseAll(){isAllCollapsed==!0?expandAllHeaders():collapseAllHeaders()}function expandAllHeaders(){window.setTimeout(function(){$("#employeeTimeTable tbody>tr.group_row").filter(function(){var n,t="",i=!1;n=$(this)[0];t=$(this)[0].id;i=$(n).data("is-collapsed");t&&(isCollapsed(t)==!0||i==!0)&&expandCollapseRow(n)});$("#expandCollapseAllDiv").prop("title","Expand all");$("#expandCollapseSpan").toggleClass("rotate-180");isAllCollapsed=!0},200)}function collapseAllHeaders(){window.setTimeout(function(){$("#employeeTimeTable tbody>tr.group_row").filter(function(){var n,t="",i=!1;n=$(this)[0];t=$(this)[0].id;i=$(n).data("is-collapsed");t&&(isCollapsed(t)==!1||i==!1)&&expandCollapseRow(n)});$("#expandCollapseAllDiv").prop("title","Expand all");$("#expandCollapseSpan").toggleClass("rotate-180");isAllCollapsed=!0},200)}function getRowNumber(n){try{return $(n).attr("row-id")*1}catch(t){return-1}}function tooltipShow(n){var t={etid:n.sender.target().first().data("etid"),etdid:n.sender.target().first().data("etdid"),tt:n.sender.target().first().data("tt")};$.get({url:window.appBase+"Employee/Timesheet/GetTimeEntryCommentText",dataType:"json",data:t}).always(function(n){n&&$("#commentSpan").html(n.responseText)})}function initTooltips(){}function progressTooltip(n,t,i,r){var f="",s="",e="",u=0,h=0,o=0;u=t-i;t&&isNaN(t)==!1&&t!=0?(h=i/t*100,s=n==!0?"traffic":"quoted",u&&(u>0?e="remaining:  "+kendo.toString(u,"N2")+" hours":u<0&&(e="over by:  "+kendo.toString(u,"N2")+" hours")),f=kendo.toString(i,"N2")+" posted hours of "+kendo.toString(t,"N2")+" "+s+" hours, "+e,r&&r>0&&(o=t*r*.01,f=tooltip+", threshold:  "+kendo.toString(o,"N2")+" hours ("+kendo.toString(o,"N2")+"%)")):f=kendo.toString(i,"N2")+" posted hours"}var employeeDialogInitiated=!1;class AgencyTimesheetSettings{constructor(){this.UseBatchMethodToPostEmployeeTime=!1;this.UseCopyTimesheetFeature=!1;this.AllowCopyOfTimesheetHours=!1;this.CheckForClosedPostingPeriods=!1;this.RequireTimeComments=!1;this.AllowQvADrilldownInTimesheets=!1;this.SupervisorApprovalActive=!1;this.SupervisorCanEditOthersTimeWithinApprovals=!1;this.AutoAlertSupervisor=!1;this.DefaultDisplayDays=7;this.AddUniqueRowWhenCommentsAreIncluded=!1;this.RequireAssignment=!1;this.WeeklyTimeType=0}}class RowInfo{constructor(n){if(this.ClientCode="",this.DivisionCode="",this.ProductCode="",this.JobNumber=0,this.JobComponentNumber=0,this.FunctionCode=null,this.DepartmentTeamCode="",this.JobProcessControl=0,this.AlertID=0,this.key=n,this.key){var t=this.key.split("|");if(t){try{this.ClientCode=t[0]}catch(i){this.ClientCode=""}try{this.DivisionCode=t[1]}catch(i){this.DivisionCode=""}try{this.ProductCode=t[2]}catch(i){this.ProductCode=""}try{this.JobNumber=t[3]}catch(i){this.JobNumber=0}try{this.JobComponentNumber=t[4]}catch(i){this.JobComponentNumber=0}try{this.FunctionCode=t[5]}catch(i){this.FunctionCode=null}try{this.DepartmentTeamCode=t[6]}catch(i){this.DepartmentTeamCode=""}try{this.JobProcessControl=t[7]}catch(i){this.JobProcessControl=0}try{this.AlertID=t[8]}catch(i){this.AlertID=0}}}}}class EntryInfo{constructor(n){if(this.key=n,this.key){var t=this.key.split("|");this.EmployeeCode=t[0];this.FunctionCategoryCode=t[1];this.DepartmentTeamCode=t[2];this.JobNumber=t[3]?t[3]*1:0;this.JobComponentNumber=t[4]?t[4]*1:0;this.EmployeeTimeID=t[5]?t[5]*1:0;this.EmployeeTimeDetailID=t[6]?t[6]*1:0;this.EditFlag=t[7]?t[7]*1:0;this.TimeType=t[8];this.EntryDate=t[9]?t[9]:null;this.CommentsRequired=t[10]?t[10].toLowerCase()=="true"||t[10]==!0?!0:!1:!1;this.HasComments=t[11]?t[11].toLowerCase()=="true"||t[11]==!0?!0:!1:!1;this.Hours=t[12]?t[12]*1:0;this.AlertID=t[13]?t[13]*1:0}else this.EmployeeCode="",this.FunctionCategoryCode="",this.DepartmentTeamCode="",this.JobNumber=0,this.JobComponentNumber=0,this.EmployeeTimeID=0,this.EmployeeTimeDetailID=0,this.EntryDate=null,this.TimeType="D",this.EditFlag="",this.CommentsRequired=!1,this.HasComments=!1,this.Hours=0,this.AlertID=0;this.Comment="";this.RowNumber=-1}}$(document).bind("keydown","shift+return",function(){saveClick()});$(document).bind("keydown","shift+s",function(){saveClick()});$(document).bind("keydown","shift+t",function(){copyToOptionsClick()});$(document).bind("keydown","shift+f",function(){copyFromOptionsClick()});$(document).bind("keydown","shift+w",function(){selectWeek()});$(document).bind("keydown","shift+d",function(){var n={StartDate:kendo.toString($("#DatePicker")[0].value,"d")};$.get({url:window.appBase+"Employee/Timesheet/IsCurrentWeek",dataType:"json",data:n}).always(function(n){if(n==!0){var t=new Date;selectSingleDay(kendo.toString(t,"d"))}else selectSingleDay(kendo.toString($("#DatePicker")[0].value,"d"))})});$(document).bind("keydown","shift+right",function(){navigateToNext()});$(document).bind("keydown","shift+left",function(){navigateToPrevious()});$(document).bind("keydown","shift+up",function(){navigateToToday()});$(document).bind("keydown","shift+down",function(){navigateToToday()});$(document).bind("keydown","shift+r",function(){refreshTimesheet()});$(document).bind("keydown","shift+b",function(){bookmark()});$(document).bind("keydown","shift+p",function(){openPrintSettingsPage()});$(document).bind("keydown","shift+e",function(){settingsClick()});$(document).bind("keydown","shift+n",function(){openNewEntryDialog()});$(document).bind("keydown","alt+shift+return",function(){saveClick()});$(document).bind("keydown","alt+shift+s",function(){saveClick()});$(document).bind("keydown","alt+shift+t",function(){copyToOptionsClick()});$(document).bind("keydown","alt+shift+f",function(){copyFromOptionsClick()});$(document).bind("keydown","alt+shift+w",function(){selectWeek()});$(document).bind("keydown","alt+shift+d",function(){var n={StartDate:kendo.toString($("#DatePicker")[0].value,"d")};$.get({url:window.appBase+"Employee/Timesheet/IsCurrentWeek",dataType:"json",data:n}).always(function(n){if(n==!0){var t=new Date;selectSingleDay(kendo.toString(t,"d"))}else selectSingleDay(kendo.toString($("#DatePicker")[0].value,"d"))})});$(document).bind("keydown","alt+shift+right",function(){navigateToNext()});$(document).bind("keydown","alt+shift+left",function(){navigateToPrevious()});$(document).bind("keydown","alt+shift+up",function(){navigateToToday()});$(document).bind("keydown","alt+shift+down",function(){navigateToToday()});$(document).bind("keydown","alt+shift+r",function(){refreshTimesheet()});$(document).bind("keydown","alt+shift+b",function(){bookmark()});$(document).bind("keydown","alt+shift+p",function(){openPrintSettingsPage()});$(document).bind("keydown","alt+shift+e",function(){settingsClick()});$(document).bind("keydown","alt+shift+n",function(){openNewEntryDialog()});